<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Chilli] chilliJSON: request timed out (or reply is not valid JS)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20chilliJSON%3A%20request%20timed%20out%20%28or%20reply%20is%20not%20valid%20JS%29&In-Reply-To=%3CCAOyZXpRqNXQ-j6ACRidicS0KAFezDQ2AshFP21PLX-XkZLrNAQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002499.html">
   <LINK REL="Next"  HREF="002488.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Chilli] chilliJSON: request timed out (or reply is not valid JS)</H1>
    <B>Le Tran Dat</B> 
    <A HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20chilliJSON%3A%20request%20timed%20out%20%28or%20reply%20is%20not%20valid%20JS%29&In-Reply-To=%3CCAOyZXpRqNXQ-j6ACRidicS0KAFezDQ2AshFP21PLX-XkZLrNAQ%40mail.gmail.com%3E"
       TITLE="[Chilli] chilliJSON: request timed out (or reply is not valid JS)">trandatnh at gmail.com
       </A><BR>
    <I>Tue Dec  3 08:01:26 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="002499.html">[Chilli] [Layer3] Like uamallowed, but for source address - like macallowed but for IPs - ip source whitelist - server whitelist - Layer3: help with connections / dhcp connections
</A></li>
        <LI>Next message: <A HREF="002488.html">[Chilli] Point to &quot;Contributing&quot; in CoovaChilli Development web page? (was: RE: [Layer3] Like uamallowed, but for source address - like macallowed but for IPs - ip source whitelist - server whitelist)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2486">[ date ]</a>
              <a href="thread.html#2486">[ thread ]</a>
              <a href="subject.html#2486">[ subject ]</a>
              <a href="author.html#2486">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I trying to troubleshoot why CoovaChilli can not read radius's reply
message:

*You are already logged in - access denied*


If an account is already logged in to radius and another attempt to use the
same account to log on then CoovaChilli should show the message  &quot;*You are
already logged in - access denied&quot;.*

In my case, CoovaChilli keeps showing waiting page. This is my CoovaChilli
+ Radius debug log

*Radius: - Rejected &quot;You are already logged in - access denied&quot;.*

&gt;<i> rad_recv: Accounting-Request packet from host 192.168.0.101 port 37822,
</I>&gt;<i> id=65, length=207
</I>&gt;<i>         ChilliSpot-Version = &quot;1.3.0&quot;
</I>&gt;<i>         ChilliSpot-Attr-10 = 0x00000002
</I>&gt;<i>         Event-Timestamp = &quot;Dec  2 2013 14:52:41 GMT&quot;
</I>&gt;<i>         User-Name = &quot;win&quot;
</I>&gt;<i>         Acct-Input-Octets = 183
</I>&gt;<i>         Acct-Output-Octets = 104
</I>&gt;<i>         Acct-Input-Gigawords = 0
</I>&gt;<i>         Acct-Output-Gigawords = 0
</I>&gt;<i>         Acct-Input-Packets = 3
</I>&gt;<i>         Acct-Output-Packets = 2
</I>&gt;<i>         Acct-Session-Time = 73
</I>&gt;<i>         Acct-Terminate-Cause = User-Request
</I>&gt;<i>         Acct-Status-Type = Stop
</I>&gt;<i>         Acct-Session-Id = &quot;529d89bb00000001&quot;
</I>&gt;<i>         Framed-IP-Address = 192.168.1.2
</I>&gt;<i>         NAS-Port-Type = Wireless-802.11
</I>&gt;<i>         NAS-Port = 1
</I>&gt;<i>         NAS-Port-Id = &quot;00000001&quot;
</I>&gt;<i>         Calling-Station-Id = &quot;00-0E-35-A1-5A-B9&quot;
</I>&gt;<i>         Called-Station-Id = &quot;04-F0-21-0A-EC-C0&quot;
</I>&gt;<i>         NAS-IP-Address = 192.168.1.1
</I>&gt;<i>         NAS-Identifier = &quot;nas01&quot;
</I>&gt;<i>   WARNING: Empty preacct section.  Using default return values.
</I>&gt;<i> # Executing section accounting from file /etc/raddb/sites/default
</I>&gt;<i> +- entering group accounting {...}
</I>&gt;<i> [sql]   expand: %{User-Name} -&gt; win
</I>&gt;<i> [sql] sql_set_user escaped user --&gt; 'win'
</I>&gt;<i> [sql]   expand: %{Acct-Input-Gigawords} -&gt; 0
</I>&gt;<i> [sql]   expand: %{Acct-Input-Octets} -&gt; 183
</I>&gt;<i> [sql]   expand: %{Acct-Output-Gigawords} -&gt; 0
</I>&gt;<i> [sql]   expand: %{Acct-Output-Octets} -&gt; 104
</I>&gt;<i> [sql]   expand: %{Acct-Delay-Time} -&gt;
</I>&gt;<i> [sql]   ... expanding second conditional
</I>&gt;<i> [sql]   expand:            UPDATE radacct SET              acctstoptime
</I>&gt;<i>     = '%S',              acctsessiontime    = '%{Acct-Session-Time}',
</I>&gt;<i>        acctinputoctets    = '%{%{Acct-Input-Gigawords}:-0}' &lt;&lt; 32 |
</I>&gt;<i>                           '%{%{Acct-Input-Octets}:-0}',
</I>&gt;<i>  acctoutputoctets   = '%{%{Acct-Output-Gigawords}:-0}' &lt;&lt; 32 |
</I>&gt;<i>                       '%{%{Acct-Output-Octets}:-0}',
</I>&gt;<i>  acctterminatecause = '%{Acct-Terminate-Cause}',              acctstopdelay
</I>&gt;<i>      = '%{%{Acct-Delay-Time}:-0}',              connectinfo_stop   =
</I>&gt;<i> '%{Connect-Info}'           WHERE acctsessionid   = '%{Acct-Session-Id}'
</I>&gt;<i>         AND username          = '%{SQL-User-Name}'           AND
</I>&gt;<i> nasipaddress      = '%{NAS-IP-Address}';           delete FROM kickuser
</I>&gt;<i>       where user_mac = '%{Calling-Station-Id}'  -&gt;            UPDATE
</I>&gt;<i> radacct SET              acctstoptime       = '2013-12-03 07:36:37',
</I>&gt;<i>        acctsessiontime    = '73',              acctinputoctets    = '0' &lt;&lt;
</I>&gt;<i> 32 |
</I>&gt;<i> rlm_sql (sql): Reserving sql socket id: 4
</I>&gt;<i> rlm_sql (sql): Released sql socket id: 4
</I>&gt;<i> ++[sql] returns ok
</I>&gt;<i> ++[exec] returns noop
</I>&gt;<i> Sending Accounting-Response of id 65 to 192.168.0.101 port 37822
</I>&gt;<i> Finished request 0.
</I>&gt;<i> Cleaning up request 0 ID 65 with timestamp +8
</I>&gt;<i> Going to the next request
</I>&gt;<i> Ready to process requests.
</I>&gt;<i> rad_recv: Access-Request packet from host 192.168.0.101 port 37474,
</I>&gt;<i> id=193, length=238
</I>&gt;<i>         ChilliSpot-Version = &quot;1.3.0&quot;
</I>&gt;<i>         User-Name = &quot;pc_free&quot;
</I>&gt;<i>         CHAP-Challenge = 0xbdee061bf023b7419ebf2ab5f72558ef
</I>&gt;<i>         CHAP-Password = 0x000c106595a19c42d402c69a3e0ef60e14
</I>&gt;<i>         Service-Type = Login-User
</I>&gt;<i>         Acct-Session-Id = &quot;529d8a0500000001&quot;
</I>&gt;<i>         Framed-IP-Address = 192.168.1.2
</I>&gt;<i>         NAS-Port-Type = Wireless-802.11
</I>&gt;<i>         NAS-Port = 1
</I>&gt;<i>         NAS-Port-Id = &quot;00000001&quot;
</I>&gt;<i>         Calling-Station-Id = &quot;00-0E-35-A1-5A-B9&quot;
</I>&gt;<i>         Called-Station-Id = &quot;04-F0-21-0A-EC-C0&quot;
</I>&gt;<i>         NAS-IP-Address = 192.168.1.1
</I>&gt;<i>         NAS-Identifier = &quot;nas01&quot;
</I>&gt;<i>         WISPr-Logoff-URL = &quot;<A HREF="http://192.168.1.1:3990/logoff">http://192.168.1.1:3990/logoff</A>&quot;
</I>&gt;<i>         Message-Authenticator = 0xd915b0c9f65d05890df3f013da5eb1ff
</I>&gt;<i> # Executing section authorize from file /etc/raddb/sites/default
</I>&gt;<i> +- entering group authorize {...}
</I>&gt;<i> [chap] Setting 'Auth-Type := CHAP'
</I>&gt;<i> ++[chap] returns ok
</I>&gt;<i> [sql]   expand: %{User-Name} -&gt; pc_free
</I>&gt;<i> [sql] sql_set_user escaped user --&gt; 'pc_free'
</I>&gt;<i> rlm_sql (sql): Reserving sql socket id: 3
</I>&gt;<i> [sql]   expand: SELECT id, username, attribute, value, op           FROM
</I>&gt;<i> radcheck           WHERE username = '%{SQL-User-Name}'           ORDER BY
</I>&gt;<i> id -&gt; SELECT id, username, attribute, value, op           FROM radcheck
</I>&gt;<i>       WHERE username = 'pc_free'           ORDER BY id
</I>&gt;<i> [sql] User found in radcheck table
</I>&gt;<i> [sql]   expand: SELECT id, username, attribute, value, op           FROM
</I>&gt;<i> radreply           WHERE username = '%{SQL-User-Name}'           ORDER BY
</I>&gt;<i> id -&gt; SELECT id, username, attribute, value, op           FROM radreply
</I>&gt;<i>       WHERE username = 'pc_free'           ORDER BY id
</I>&gt;<i> [sql]   expand: SELECT groupname           FROM radusergroup
</I>&gt;<i> WHERE username = '%{SQL-User-Name}'           ORDER BY priority -&gt; SELECT
</I>&gt;<i> groupname           FROM radusergroup           WHERE username = 'pc_free'
</I>&gt;<i>           ORDER BY priority
</I>&gt;<i> [sql]   expand: SELECT id, groupname, attribute,           Value, op
</I>&gt;<i>     FROM radgroupcheck           WHERE groupname = '%{Sql-Group}'
</I>&gt;<i> ORDER BY id -&gt; SELECT id, groupname, attribute,           Value, op
</I>&gt;<i>   FROM radgroupcheck           WHERE groupname = '4'           ORDER BY id
</I>&gt;<i> [sql] User found in group 4
</I>&gt;<i> [sql]   expand: SELECT id, groupname, attribute,           value, op
</I>&gt;<i>     FROM radgroupreply           WHERE groupname = '%{Sql-Group}'
</I>&gt;<i> ORDER BY id -&gt; SELECT id, groupname, attribute,           value, op
</I>&gt;<i>   FROM radgroupreply           WHERE groupname = '4'           ORDER BY id
</I>&gt;<i> rlm_sql (sql): Released sql socket id: 3
</I>&gt;<i> ++[sql] returns ok
</I>&gt;<i> ++? if (notfound)
</I>&gt;<i> ? Evaluating (notfound) -&gt; FALSE
</I>&gt;<i> ++? if (notfound) -&gt; FALSE
</I>&gt;<i> rlm_sqlcounter: Entering module authorize code
</I>&gt;<i> rlm_sqlcounter: Could not find Check item value pair
</I>&gt;<i> ++[max-total-octets] returns noop
</I>&gt;<i> ++? if (reject)
</I>&gt;<i> ? Evaluating (reject) -&gt; FALSE
</I>&gt;<i> ++? if (reject) -&gt; FALSE
</I>&gt;<i> rlm_sqlcounter: Entering module authorize code
</I>&gt;<i> rlm_sqlcounter: Could not find Check item value pair
</I>&gt;<i> ++[max-total-dl-octets] returns noop
</I>&gt;<i> ++? if (reject)
</I>&gt;<i> ? Evaluating (reject) -&gt; FALSE
</I>&gt;<i> ++? if (reject) -&gt; FALSE
</I>&gt;<i> rlm_sqlcounter: Entering module authorize code
</I>&gt;<i> rlm_sqlcounter: Could not find Check item value pair
</I>&gt;<i> ++[max-total-ul-octets] returns noop
</I>&gt;<i> ++? if (reject)
</I>&gt;<i> ? Evaluating (reject) -&gt; FALSE
</I>&gt;<i> ++? if (reject) -&gt; FALSE
</I>&gt;<i> rlm_sqlcounter: Entering module authorize code
</I>&gt;<i> rlm_sqlcounter: Could not find Check item value pair
</I>&gt;<i> ++[max-session-timeout] returns noop
</I>&gt;<i> ++? if (reject)
</I>&gt;<i> ? Evaluating (reject) -&gt; FALSE
</I>&gt;<i> ++? if (reject) -&gt; FALSE
</I>&gt;<i> rlm_sqlcounter: Entering module authorize code
</I>&gt;<i> rlm_sqlcounter: Could not find Check item value pair
</I>&gt;<i> ++[accessperiod] returns noop
</I>&gt;<i> ++? if (reject)
</I>&gt;<i> ? Evaluating (reject) -&gt; FALSE
</I>&gt;<i> ++? if (reject) -&gt; FALSE
</I>&gt;<i> Found Auth-Type = CHAP
</I>&gt;<i> # Executing group from file /etc/raddb/sites/default
</I>&gt;<i> +- entering group CHAP {...}
</I>&gt;<i> [chap] login attempt by &quot;pc_free&quot; with CHAP password
</I>&gt;<i> [chap] Using clear text password &quot;123123&quot; for user pc_free authentication.
</I>&gt;<i> [chap] chap user pc_free authenticated succesfully
</I>&gt;<i> ++[chap] returns ok
</I>&gt;<i> ++? if (reject)
</I>&gt;<i> ? Evaluating (reject) -&gt; FALSE
</I>&gt;<i> ++? if (reject) -&gt; FALSE
</I>&gt;<i> # Executing section session from file /etc/raddb/sites/default
</I>&gt;<i> +- entering group session {...}
</I>&gt;<i> [sql]   expand: %{User-Name} -&gt; pc_free
</I>&gt;<i> [sql] sql_set_user escaped user --&gt; 'pc_free'
</I>&gt;<i> [sql]   expand: SELECT COUNT(*)                              FROM radacct
</I>&gt;<i>                              WHERE username = '%{SQL-User-Name}'
</I>&gt;<i>                    AND   calledstationid = '%{Called-Station-Id}'
</I>&gt;<i>                    AND   calledstationid = '%{Called-Station-Id}'
</I>&gt;<i>                    AND acctstoptime IS NULL -&gt; SELECT COUNT(*)
</I>&gt;<i>                  FROM radacct                              WHERE username =
</I>&gt;<i> 'pc_free'                              AND   calledstationid =
</I>&gt;<i> '04-F0-21-0A-EC-C0'                              AND   calledstationid =
</I>&gt;<i> '04-F0-21-0A-EC-C0'                              AND acctstoptime IS NULL
</I>&gt;<i> rlm_sql (sql): Reserving sql socket id: 2
</I>&gt;<i> [sql]   expand: SELECT radacctid, acctsessionid, username,
</I>&gt;<i>                nasipaddress, nasportid, framedipaddress,
</I>&gt;<i>              callingstationid, framedprotocol
</I>&gt;<i>  FROM radacct                                WHERE username =
</I>&gt;<i> '%{SQL-User-Name}'                                AND   calledstationid =
</I>&gt;<i> '%{Called-Station-Id}'                                AND   calledstationid
</I>&gt;<i> = '%{Called-Station-Id}'                                AND acctstoptime IS
</I>&gt;<i> NULL -&gt; SELECT radacctid, acctsessionid, username,
</I>&gt;<i>        nasipaddress, nasportid, framedipaddress,
</I>&gt;<i>      callingstationid, framedprotocol                                FROM
</I>&gt;<i> radacct                                WHERE username = 'pc_free'
</I>&gt;<i>                      AND   calledstationid = '04-F0-21-0A-EC-C0'
</I>&gt;<i>                      AND   calledstationid = '04-F0-21-0A-EC-C0'
</I>&gt;<i>                      AND acctstoptime IS NULL
</I>&gt;<i> checkrad: No NAS type, or type &quot;other&quot; not checking
</I>&gt;<i> checkrad: No NAS type, or type &quot;other&quot; not checking
</I>&gt;<i> rlm_sql (sql): Released sql socket id: 2
</I>&gt;<i> ++[sql] returns ok
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *Delaying reject of request 1 for 1 seconds Going to the next
</I>&gt;<i> requestWaking up in 0.9 seconds.Sending delayed reject for request 1Sending
</I>&gt;<i> Access-Reject of id 193 to 192.168.0.101 port 37474        Reply-Message :=
</I>&gt;<i> &quot;\r\nYou are already logged in - access denied\r\n\n&quot;*
</I>&gt;<i> Waking up in 4.9 seconds.
</I>&gt;<i> Cleaning up request 1 ID 193 with timestamp +21
</I>&gt;<i> Ready to process requests.
</I>

*CoovaChilli log:*

&gt;<i> chilliController.logon( &quot;pc_free&quot; , &quot;123123 &quot; )
</I>&gt;<i> chilliController.logon: asking for a new challenge
</I>&gt;<i> chilliJSON: getting <A HREF="http://1.0.0.1/json/status">http://1.0.0.1/json/status</A> . Waiting for reply ...
</I>&gt;<i> enter chilliJSON.reply
</I>&gt;<i> chilliJSON: JSON reply received in 63 ms
</I>&gt;<i>     version = 1.0
</I>&gt;<i>     clientState = 0
</I>&gt;<i>     challenge = bdee061bf023b7419ebf2ab5f72558ef
</I>&gt;<i>     location = [object Object]
</I>&gt;<i>       name = HotSpot
</I>&gt;<i>     redir = [object Object]
</I>&gt;<i>       originalURL = <A HREF="http://www.google.com.sg/">http://www.google.com.sg/</A>
</I>&gt;<i>       redirectionURL =
</I>&gt;<i>       logoutURL = <A HREF="http://192.168.1.1:3990/logoff">http://192.168.1.1:3990/logoff</A>
</I>&gt;<i>       ipAddress = 192.168.1.2
</I>&gt;<i>       macAddress = 00-0E-35-A1-5A-B9
</I>&gt;<i> Entering logonStep 2
</I>&gt;<i> chilliController.logonStep2: Got challenge =
</I>&gt;<i> bdee061bf023b7419ebf2ab5f72558ef
</I>&gt;<i> chilliController.logonStep2: Calculating CHAP-Password =
</I>&gt;<i> 0c106595a19c42d402c69a3e0ef60e14
</I>&gt;<i>
</I>&gt;<i> *chilliJSON: getting
</I>&gt;<i> <A HREF="http://1.0.0.1/json/logon?username=pc_free&amp;response=0c106595a19c42d402c69a3e0ef60e14&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f">http://1.0.0.1/json/logon?username=pc_free&amp;response=0c106595a19c42d402c69a3e0ef60e14&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f</A>
</I>&gt;<i> &lt;<A HREF="http://1.0.0.1/json/logon?username=pc_free&amp;response=0c106595a19c42d402c69a3e0ef60e14&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f">http://1.0.0.1/json/logon?username=pc_free&amp;response=0c106595a19c42d402c69a3e0ef60e14&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f</A>&gt;
</I>&gt;<i> . Waiting for reply ... chilliJSON: request timed out (or reply is not
</I>&gt;<i> valid JS)*
</I>

I attached logs of successful case as well
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.coova.org/pipermail/chilli/attachments/20131203/a89ec16b/attachment-0001.html">http://lists.coova.org/pipermail/chilli/attachments/20131203/a89ec16b/attachment-0001.html</A>&gt;
-------------- next part --------------
rad_recv: Access-Request packet from host 192.168.0.101 port 41360, id=201, length=234
        ChilliSpot-Version = &quot;1.3.0&quot;
        User-Name = &quot;win&quot;
        CHAP-Challenge = 0x08d4e2b8583eb807d297b3c31d6486d2
        CHAP-Password = 0x00b646ade54a0a7fcbb2acd99763c4404e
        Service-Type = Login-User
        Acct-Session-Id = &quot;529d8b1400000001&quot;
        Framed-IP-Address = 192.168.1.2
        NAS-Port-Type = Wireless-802.11
        NAS-Port = 1
        NAS-Port-Id = &quot;00000001&quot;
        Calling-Station-Id = &quot;00-0E-35-A1-5A-B9&quot;
        Called-Station-Id = &quot;04-F0-21-0A-EC-C0&quot;
        NAS-IP-Address = 192.168.1.1
        NAS-Identifier = &quot;nas01&quot;
        WISPr-Logoff-URL = &quot;<A HREF="http://192.168.1.1:3990/logoff">http://192.168.1.1:3990/logoff</A>&quot;
        Message-Authenticator = 0xe8d082a6011655514db2c0943bd7b477
# Executing section authorize from file /etc/raddb/sites/default
+- entering group authorize {...}
[chap] Setting 'Auth-Type := CHAP'
++[chap] returns ok
[sql]   expand: %{User-Name} -&gt; win
[sql] sql_set_user escaped user --&gt; 'win'
rlm_sql (sql): Reserving sql socket id: 0
[sql]   expand: SELECT id, username, attribute, value, op           FROM radcheck           WHERE username = '%{SQL-User-Name}'           ORDER BY id -&gt; SELECT id, username, attribute, value, op           FROM radcheck           WHERE username = 'win'           ORDER BY id
[sql] User found in radcheck table
[sql]   expand: SELECT id, username, attribute, value, op           FROM radreply           WHERE username = '%{SQL-User-Name}'           ORDER BY id -&gt; SELECT id, username, attribute, value, op           FROM radreply           WHERE username = 'win'           ORDER BY id
[sql]   expand: SELECT groupname           FROM radusergroup           WHERE username = '%{SQL-User-Name}'           ORDER BY priority -&gt; SELECT groupname           FROM radusergroup           WHERE username = 'win'           ORDER BY priority
[sql]   expand: SELECT id, groupname, attribute,           Value, op           FROM radgroupcheck           WHERE groupname = '%{Sql-Group}'           ORDER BY id -&gt; SELECT id, groupname, attribute,           Value, op           FROM radgroupcheck           WHERE groupname = '4'           ORDER BY id
[sql] User found in group 4
[sql]   expand: SELECT id, groupname, attribute,           value, op           FROM radgroupreply           WHERE groupname = '%{Sql-Group}'           ORDER BY id -&gt; SELECT id, groupname, attribute,           value, op           FROM radgroupreply           WHERE groupname = '4'           ORDER BY id
rlm_sql (sql): Released sql socket id: 0
++[sql] returns ok
++? if (notfound)
? Evaluating (notfound) -&gt; FALSE
++? if (notfound) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[max-total-octets] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[max-total-dl-octets] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[max-total-ul-octets] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[max-session-timeout] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[accessperiod] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
Found Auth-Type = CHAP
# Executing group from file /etc/raddb/sites/default
+- entering group CHAP {...}
[chap] login attempt by &quot;win&quot; with CHAP password
[chap] Using clear text password &quot;123123&quot; for user win authentication.
[chap] chap user win authenticated succesfully
++[chap] returns ok
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
# Executing section session from file /etc/raddb/sites/default
+- entering group session {...}
[sql]   expand: %{User-Name} -&gt; win
[sql] sql_set_user escaped user --&gt; 'win'
[sql]   expand: SELECT COUNT(*)                              FROM radacct                              WHERE username = '%{SQL-User-Name}'                              AND   calledstationid = '%{Called-Station-Id}'                              AND   calledstationid = '%{Called-Station-Id}'                              AND acctstoptime IS NULL -&gt; SELECT COUNT(*)                              FROM radacct                              WHERE username = 'win'                              AND   calledstationid = '04-F0-21-0A-EC-C0'                              AND   calledstationid = '04-F0-21-0A-EC-C0'                              AND acctstoptime IS NULL
rlm_sql (sql): Reserving sql socket id: 4
rlm_sql (sql): Released sql socket id: 4
++[sql] returns ok
  WARNING: Empty post-auth section.  Using default return values.
Sending Access-Accept of id 201 to 192.168.0.101 port 41360
        ChilliSpot-Bandwidth-Max-Up := 102400
        ChilliSpot-Bandwidth-Max-Down := 102400
Finished request 3.
Going to the next request
Waking up in 4.9 seconds.
rad_recv: Accounting-Request packet from host 192.168.0.101 port 37822, id=67, length=159
        ChilliSpot-Version = &quot;1.3.0&quot;
        ChilliSpot-Attr-10 = 0x00000002
        Event-Timestamp = &quot;Dec  2 2013 14:57:12 GMT&quot;
        User-Name = &quot;win&quot;
        Acct-Status-Type = Start
        Acct-Session-Id = &quot;529d8b1400000001&quot;
        Framed-IP-Address = 192.168.1.2
        NAS-Port-Type = Wireless-802.11
        NAS-Port = 1
        NAS-Port-Id = &quot;00000001&quot;
        Calling-Station-Id = &quot;00-0E-35-A1-5A-B9&quot;
        Called-Station-Id = &quot;04-F0-21-0A-EC-C0&quot;
        NAS-IP-Address = 192.168.1.1
        NAS-Identifier = &quot;nas01&quot;
  WARNING: Empty preacct section.  Using default return values.
# Executing section accounting from file /etc/raddb/sites/default
+- entering group accounting {...}
[sql]   expand: %{User-Name} -&gt; win
[sql] sql_set_user escaped user --&gt; 'win'
[sql]   expand: %{Acct-Delay-Time} -&gt;
[sql]   ... expanding second conditional
[sql] WARNING: Unknown module &quot;X-Ascend-Session-Svr-Key&quot; in string expansion &quot;%&quot;
[sql]   ... expanding second conditional
[sql]   expand: %{Tropos-Average-RSSI} -&gt;
[sql]   ... expanding second conditional
[sql]   expand: %{ChilliSpot-DHCP-Hostname} -&gt;
[sql]   ... expanding second conditional
[sql]   expand: %{ChilliSpot-DHCP-Vendor-Class-Id} -&gt;
[sql]   ... expanding second conditional
[sql]   expand:            INSERT INTO radacct             (acctsessionid,    acctuniqueid,     username,              realm,            nasipaddress,     nasportid,              nasporttype,      acctstarttime,    acctstoptime,              acctsessiontime,  acctauthentic,    connectinfo_start,              connectinfo_stop, acctinputoctets,  acctoutputoctets,              calledstationid,  callingstationid, acctterminatecause,              servicetype,      framedprotocol,   framedipaddress,              acctstartdelay,   acctstopdelay,    xascendsessionsvrkey,              rssi, hostname,         hostarch, groupname )           VALUES             ('%{Acct-Session-Id}', '%{Acct-Unique-Session-Id}',              '%{SQL-User-Name}',              '%{Realm}', '%{NAS-IP-Address}', '%{NAS-Port}',              '%{NAS-Port-Type}', '%S', NULL,              '0', '%{Acct-Authentic}', '%{Connect-Info}',              '', '0', '0',              '%{Called-Station-Id}', '%{Calling-Station-Id}', '',              '%{Service-
rlm_sql (sql): Reserving sql socket id: 3
rlm_sql (sql): Released sql socket id: 3
++[sql] returns ok
++[exec] returns noop
Sending Accounting-Response of id 67 to 192.168.0.101 port 37822
Finished request 4.
Cleaning up request 4 ID 67 with timestamp +280
Going to the next request
Waking up in 4.9 seconds.
Cleaning up request 3 ID 201 with timestamp +280
Ready to process requests.
-------------- next part --------------
rad_recv: Accounting-Request packet from host 192.168.0.101 port 37822, id=65, length=207
        ChilliSpot-Version = &quot;1.3.0&quot;
        ChilliSpot-Attr-10 = 0x00000002
        Event-Timestamp = &quot;Dec  2 2013 14:52:41 GMT&quot;
        User-Name = &quot;win&quot;
        Acct-Input-Octets = 183
        Acct-Output-Octets = 104
        Acct-Input-Gigawords = 0
        Acct-Output-Gigawords = 0
        Acct-Input-Packets = 3
        Acct-Output-Packets = 2
        Acct-Session-Time = 73
        Acct-Terminate-Cause = User-Request
        Acct-Status-Type = Stop
        Acct-Session-Id = &quot;529d89bb00000001&quot;
        Framed-IP-Address = 192.168.1.2
        NAS-Port-Type = Wireless-802.11
        NAS-Port = 1
        NAS-Port-Id = &quot;00000001&quot;
        Calling-Station-Id = &quot;00-0E-35-A1-5A-B9&quot;
        Called-Station-Id = &quot;04-F0-21-0A-EC-C0&quot;
        NAS-IP-Address = 192.168.1.1
        NAS-Identifier = &quot;nas01&quot;
  WARNING: Empty preacct section.  Using default return values.
# Executing section accounting from file /etc/raddb/sites/default
+- entering group accounting {...}
[sql]   expand: %{User-Name} -&gt; win
[sql] sql_set_user escaped user --&gt; 'win'
[sql]   expand: %{Acct-Input-Gigawords} -&gt; 0
[sql]   expand: %{Acct-Input-Octets} -&gt; 183
[sql]   expand: %{Acct-Output-Gigawords} -&gt; 0
[sql]   expand: %{Acct-Output-Octets} -&gt; 104
[sql]   expand: %{Acct-Delay-Time} -&gt;
[sql]   ... expanding second conditional
[sql]   expand:            UPDATE radacct SET              acctstoptime       = '%S',              acctsessiontime    = '%{Acct-Session-Time}',              acctinputoctets    = '%{%{Acct-Input-Gigawords}:-0}' &lt;&lt; 32 |                                   '%{%{Acct-Input-Octets}:-0}',              acctoutputoctets   = '%{%{Acct-Output-Gigawords}:-0}' &lt;&lt; 32 |                                   '%{%{Acct-Output-Octets}:-0}',              acctterminatecause = '%{Acct-Terminate-Cause}',              acctstopdelay      = '%{%{Acct-Delay-Time}:-0}',              connectinfo_stop   = '%{Connect-Info}'           WHERE acctsessionid   = '%{Acct-Session-Id}'           AND username          = '%{SQL-User-Name}'           AND nasipaddress      = '%{NAS-IP-Address}';           delete FROM kickuser           where user_mac = '%{Calling-Station-Id}'  -&gt;            UPDATE radacct SET              acctstoptime       = '2013-12-03 07:36:37',              acctsessiontime    = '73',              acctinputoctets    = '0' &lt;&lt; 32 |
rlm_sql (sql): Reserving sql socket id: 4
rlm_sql (sql): Released sql socket id: 4
++[sql] returns ok
++[exec] returns noop
Sending Accounting-Response of id 65 to 192.168.0.101 port 37822
Finished request 0.
Cleaning up request 0 ID 65 with timestamp +8
Going to the next request
Ready to process requests.
rad_recv: Access-Request packet from host 192.168.0.101 port 37474, id=193, length=238
        ChilliSpot-Version = &quot;1.3.0&quot;
        User-Name = &quot;pc_free&quot;
        CHAP-Challenge = 0xbdee061bf023b7419ebf2ab5f72558ef
        CHAP-Password = 0x000c106595a19c42d402c69a3e0ef60e14
        Service-Type = Login-User
        Acct-Session-Id = &quot;529d8a0500000001&quot;
        Framed-IP-Address = 192.168.1.2
        NAS-Port-Type = Wireless-802.11
        NAS-Port = 1
        NAS-Port-Id = &quot;00000001&quot;
        Calling-Station-Id = &quot;00-0E-35-A1-5A-B9&quot;
        Called-Station-Id = &quot;04-F0-21-0A-EC-C0&quot;
        NAS-IP-Address = 192.168.1.1
        NAS-Identifier = &quot;nas01&quot;
        WISPr-Logoff-URL = &quot;<A HREF="http://192.168.1.1:3990/logoff">http://192.168.1.1:3990/logoff</A>&quot;
        Message-Authenticator = 0xd915b0c9f65d05890df3f013da5eb1ff
# Executing section authorize from file /etc/raddb/sites/default
+- entering group authorize {...}
[chap] Setting 'Auth-Type := CHAP'
++[chap] returns ok
[sql]   expand: %{User-Name} -&gt; pc_free
[sql] sql_set_user escaped user --&gt; 'pc_free'
rlm_sql (sql): Reserving sql socket id: 3
[sql]   expand: SELECT id, username, attribute, value, op           FROM radcheck           WHERE username = '%{SQL-User-Name}'           ORDER BY id -&gt; SELECT id, username, attribute, value, op           FROM radcheck           WHERE username = 'pc_free'           ORDER BY id
[sql] User found in radcheck table
[sql]   expand: SELECT id, username, attribute, value, op           FROM radreply           WHERE username = '%{SQL-User-Name}'           ORDER BY id -&gt; SELECT id, username, attribute, value, op           FROM radreply           WHERE username = 'pc_free'           ORDER BY id
[sql]   expand: SELECT groupname           FROM radusergroup           WHERE username = '%{SQL-User-Name}'           ORDER BY priority -&gt; SELECT groupname           FROM radusergroup           WHERE username = 'pc_free'           ORDER BY priority
[sql]   expand: SELECT id, groupname, attribute,           Value, op           FROM radgroupcheck           WHERE groupname = '%{Sql-Group}'           ORDER BY id -&gt; SELECT id, groupname, attribute,           Value, op           FROM radgroupcheck           WHERE groupname = '4'           ORDER BY id
[sql] User found in group 4
[sql]   expand: SELECT id, groupname, attribute,           value, op           FROM radgroupreply           WHERE groupname = '%{Sql-Group}'           ORDER BY id -&gt; SELECT id, groupname, attribute,           value, op           FROM radgroupreply           WHERE groupname = '4'           ORDER BY id
rlm_sql (sql): Released sql socket id: 3
++[sql] returns ok
++? if (notfound)
? Evaluating (notfound) -&gt; FALSE
++? if (notfound) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[max-total-octets] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[max-total-dl-octets] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[max-total-ul-octets] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[max-session-timeout] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
rlm_sqlcounter: Entering module authorize code
rlm_sqlcounter: Could not find Check item value pair
++[accessperiod] returns noop
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
Found Auth-Type = CHAP
# Executing group from file /etc/raddb/sites/default
+- entering group CHAP {...}
[chap] login attempt by &quot;pc_free&quot; with CHAP password
[chap] Using clear text password &quot;123123&quot; for user pc_free authentication.
[chap] chap user pc_free authenticated succesfully
++[chap] returns ok
++? if (reject)
? Evaluating (reject) -&gt; FALSE
++? if (reject) -&gt; FALSE
# Executing section session from file /etc/raddb/sites/default
+- entering group session {...}
[sql]   expand: %{User-Name} -&gt; pc_free
[sql] sql_set_user escaped user --&gt; 'pc_free'
[sql]   expand: SELECT COUNT(*)                              FROM radacct                              WHERE username = '%{SQL-User-Name}'                              AND   calledstationid = '%{Called-Station-Id}'                              AND   calledstationid = '%{Called-Station-Id}'                              AND acctstoptime IS NULL -&gt; SELECT COUNT(*)                              FROM radacct                              WHERE username = 'pc_free'                              AND   calledstationid = '04-F0-21-0A-EC-C0'                              AND   calledstationid = '04-F0-21-0A-EC-C0'                              AND acctstoptime IS NULL
rlm_sql (sql): Reserving sql socket id: 2
[sql]   expand: SELECT radacctid, acctsessionid, username,                                nasipaddress, nasportid, framedipaddress,                                callingstationid, framedprotocol                                FROM radacct                                WHERE username = '%{SQL-User-Name}'                                AND   calledstationid = '%{Called-Station-Id}'                                AND   calledstationid = '%{Called-Station-Id}'                                AND acctstoptime IS NULL -&gt; SELECT radacctid, acctsessionid, username,                                nasipaddress, nasportid, framedipaddress,                                callingstationid, framedprotocol                                FROM radacct                                WHERE username = 'pc_free'                                AND   calledstationid = '04-F0-21-0A-EC-C0'                                AND   calledstationid = '04-F0-21-0A-EC-C0'                                AND acctstoptime IS NULL
checkrad: No NAS type, or type &quot;other&quot; not checking
checkrad: No NAS type, or type &quot;other&quot; not checking
rlm_sql (sql): Released sql socket id: 2
++[sql] returns ok
Delaying reject of request 1 for 1 seconds
Going to the next request
Waking up in 0.9 seconds.
Sending delayed reject for request 1
Sending Access-Reject of id 193 to 192.168.0.101 port 37474
        Reply-Message := &quot;\r\nYou are already logged in - access denied\r\n\n&quot;
Waking up in 4.9 seconds.
Cleaning up request 1 ID 193 with timestamp +21
Ready to process requests.
-------------- next part --------------
chilliController.logon( &quot;win&quot; , &quot;123123 &quot; )
chilliController.logon: asking for a new challenge 
scriptElement: <A HREF="http://1.0.0.1/json/status?callback=chilliJSON.reply&amp;0.8985460929106921">http://1.0.0.1/json/status?callback=chilliJSON.reply&amp;0.8985460929106921</A>
chilliJSON: getting <A HREF="http://1.0.0.1/json/status">http://1.0.0.1/json/status</A> . Waiting for reply ...
enter chilliJSON.reply 
chilliJSON: JSON reply received in 275 ms
    version = 1.0
    clientState = 0
    challenge = 08d4e2b8583eb807d297b3c31d6486d2
    location = [object Object]
      name = HotSpot
    redir = [object Object]
      originalURL = 
      redirectionURL = 
      logoutURL = <A HREF="http://192.168.1.1:3990/logoff">http://192.168.1.1:3990/logoff</A>
      ipAddress = 192.168.1.2
      macAddress = 00-0E-35-A1-5A-B9
Entering logonStep 2
chilliController.logonStep2: Got challenge = 08d4e2b8583eb807d297b3c31d6486d2
chilliController.logonStep2: Calculating CHAP-Password = b646ade54a0a7fcbb2acd99763c4404e
scriptElement: <A HREF="http://1.0.0.1/json/logon?username=win&amp;response=b646ade54a0a7fcbb2acd99763c4404e&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f&amp;callback=chilliJSON.reply&amp;0.18908492452464998">http://1.0.0.1/json/logon?username=win&amp;response=b646ade54a0a7fcbb2acd99763c4404e&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f&amp;callback=chilliJSON.reply&amp;0.18908492452464998</A>
chilliJSON: getting <A HREF="http://1.0.0.1/json/logon?username=win&amp;response=b646ade54a0a7fcbb2acd99763c4404e&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f">http://1.0.0.1/json/logon?username=win&amp;response=b646ade54a0a7fcbb2acd99763c4404e&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f</A> . Waiting for reply ...
enter chilliJSON.reply 
chilliJSON: JSON reply received in 43 ms
    version = 1.0
    clientState = 1
    redir = [object Object]
      originalURL = <A HREF="http://www.google.com.sg/">http://www.google.com.sg/</A>
      redirectionURL = 
      logoutURL = <A HREF="http://192.168.1.1:3990/logoff">http://192.168.1.1:3990/logoff</A>
      ipAddress = 192.168.1.2
      macAddress = 00-0E-35-A1-5A-B9
    session = [object Object]
      sessionId = 529d8b1400000001
      userName = win
      startTime = 1385996232
      sessionTimeout = 0
      idleTimeout = 300
    accounting = [object Object]
      sessionTime = 0
      idleTime = 0
      inputOctets = 0
      outputOctets = 0
      inputGigawords = 0
      outputGigawords = 0
      viewPoint = client
chilliController.processReply: Calling onUpdate. clienState = 1
Update UI is called. chilliController.clientState = 1
-------------- next part --------------
chilliController.processReply: Calling onUpdate. clienState = 0
Update UI is called. chilliController.clientState = 0
chilliController.logon( &quot;pc_free&quot; , &quot;123123 &quot; )
chilliController.logon: asking for a new challenge 
chilliJSON: getting <A HREF="http://1.0.0.1/json/status">http://1.0.0.1/json/status</A> . Waiting for reply ...
enter chilliJSON.reply 
chilliJSON: JSON reply received in 63 ms
    version = 1.0
    clientState = 0
    challenge = bdee061bf023b7419ebf2ab5f72558ef
    location = [object Object]
      name = HotSpot
    redir = [object Object]
      originalURL = <A HREF="http://www.google.com.sg/">http://www.google.com.sg/</A>
      redirectionURL = 
      logoutURL = <A HREF="http://192.168.1.1:3990/logoff">http://192.168.1.1:3990/logoff</A>
      ipAddress = 192.168.1.2
      macAddress = 00-0E-35-A1-5A-B9
Entering logonStep 2
chilliController.logonStep2: Got challenge = bdee061bf023b7419ebf2ab5f72558ef
chilliController.logonStep2: Calculating CHAP-Password = 0c106595a19c42d402c69a3e0ef60e14
chilliJSON: getting <A HREF="http://1.0.0.1/json/logon?username=pc_free&amp;response=0c106595a19c42d402c69a3e0ef60e14&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f">http://1.0.0.1/json/logon?username=pc_free&amp;response=0c106595a19c42d402c69a3e0ef60e14&amp;userurl=http%3a%2f%2fwww.google.com.sg%2f</A> . Waiting for reply ...
chilliJSON: request timed out (or reply is not valid JS)
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002499.html">[Chilli] [Layer3] Like uamallowed, but for source address - like macallowed but for IPs - ip source whitelist - server whitelist - Layer3: help with connections / dhcp connections
</A></li>
	<LI>Next message: <A HREF="002488.html">[Chilli] Point to &quot;Contributing&quot; in CoovaChilli Development web page? (was: RE: [Layer3] Like uamallowed, but for source address - like macallowed but for IPs - ip source whitelist - server whitelist)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2486">[ date ]</a>
              <a href="thread.html#2486">[ thread ]</a>
              <a href="subject.html#2486">[ subject ]</a>
              <a href="author.html#2486">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">More information about the Chilli
mailing list</a><br>
</body></html>
