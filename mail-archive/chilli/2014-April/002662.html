<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Chilli] Running with kmod
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20Running%20with%20kmod&In-Reply-To=%3C1396904165.22272.YahooMailNeo%40web161701.mail.bf1.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002657.html">
   <LINK REL="Next"  HREF="002658.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Chilli] Running with kmod</H1>
    <B>Tariq Ramadan</B> 
    <A HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20Running%20with%20kmod&In-Reply-To=%3C1396904165.22272.YahooMailNeo%40web161701.mail.bf1.yahoo.com%3E"
       TITLE="[Chilli] Running with kmod">tr23101 at yahoo.com
       </A><BR>
    <I>Mon Apr  7 20:56:05 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="002657.html">[Chilli] Running with kmod
</A></li>
        <LI>Next message: <A HREF="002658.html">[Chilli] Chilli starting multiple times
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2662">[ date ]</a>
              <a href="thread.html#2662">[ thread ]</a>
              <a href="subject.html#2662">[ subject ]</a>
              <a href="author.html#2662">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>And here's the debug output, when redirection fails:

Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 187: It was a dns record type: 1 class: 1
Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 187: It was a dns record type: 1 class: 1
Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 187: It was a dns record type: 1 class: 1
Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 187: It was a dns record type: 1 class: 1
Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 194: DNS: www.google.com
Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 187: It was a dns record type: 1 class: 1
Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 187: It was a dns record type: 1 class: 1
Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 187: It was a dns record type: 1 class: 1
Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 187: It was a dns record type: 1 class: 1
Apr&#160; 7 23:50:37 ubuntu coova-chilli[25086]: dns.c: 187: It was a dns record type: 1 class: 1
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 5060: Layer2 PROT: 0x86dd dropped
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3555: chopping off trailer length 6
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3593: Not for our MAC or broadcast: 08-00-27-78-5A-6D
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3555: chopping off trailer length 6
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25380]: redir.c: 2103: The path:&#160;
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25380]: redir.c: 2413: --&gt;&gt; Setting userurl=[<A HREF="http://www.google.com/">http://www.google.com/</A>]
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25380]: redir.c: 3962: redir_accept: Original request host=www.google.com
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25380]: redir.c: 4071: ----&gt;&gt;&gt; resetting challenge: b7d65709eded1854be6b1e50e106cb73
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25380]: redir.c: 987: redir_wispr2_reply
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: chilli.c: 379: caught 17 via selfpipe
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: chilli.c: 310: child 25380 terminated
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: chilli.c: 135: Freed child process 25380 [[redir]]
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3555: chopping off trailer length 6
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3555: chopping off trailer length 6
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3555: chopping off trailer length 6
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3593: Not for our MAC or broadcast: 08-00-27-78-5A-6D
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3555: chopping off trailer length 6
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3555: chopping off trailer length 6
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3593: Not for our MAC or broadcast: 08-00-27-78-5A-6D
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25382]: redir.c: 2103: The path: www/coova.html
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25382]: redir.c: 2398: Serving file coova.html
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3593: Not for our MAC or broadcast: 08-00-27-78-5A-6D
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: dhcp.c: 3555: chopping off trailer length 6
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: chilli.c: 379: caught 17 via selfpipe
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: chilli.c: 310: child 25382 terminated
Apr&#160; 7 23:50:38 ubuntu coova-chilli[25086]: chilli.c: 135: Freed child process 25382 [[redir]]
Apr&#160; 7 23:50:39 ubuntu coova-chilli[25381]: redir.c: 2020: 104 (Connection reset by peer) redir_read(0) failed!
Apr&#160; 7 23:50:39 ubuntu coova-chilli[25381]: redir.c: 3383: Error calling get_req. Terminating -1
Apr&#160; 7 23:50:39 ubuntu coova-chilli[25086]: dhcp.c: 3555: chopping off trailer length 6
Apr&#160; 7 23:50:39 ubuntu coova-chilli[25086]: chilli.c: 379: caught 17 via selfpipe
Apr&#160; 7 23:50:39 ubuntu coova-chilli[25086]: chilli.c: 310: child 25381 terminated
Apr&#160; 7 23:50:39 ubuntu coova-chilli[25086]: chilli.c: 135: Freed child process 25381 [[redir]]
Apr&#160; 7 23:50:41 ubuntu coova-chilli[25086]: dhcp.c: 5060: Layer2 PROT: 0x86dd dropped

On Monday, April 7, 2014 3:53 PM, Tariq Ramadan &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">tr23101 at yahoo.com</A>&gt; wrote:
 
Hello

I've compiled and set up coovachilli --with-nfcoova on ubuntu successfully. But I can not run properly. I think there's a kind of routing problem with the interfaces. I tried to set up as David described here: <A HREF="http://lists.coova.org/pipermail/chilli/2010-April/001239.html&#160;">http://lists.coova.org/pipermail/chilli/2010-April/001239.html&#160;</A>

At this configuration client is getting IP, then trying to resolve and getting dns request result, and redirecting the browser to the uamurl, but page is not displaying properly(getting connection reset response)
If I remove the network route of tun0(11.1.0.0/24) here, the client can continue to reach and display the uampage, then login and access to the internet. But this time dns resolving and redirection doesn't work.

My configuration:

cmdsocket &#160; &#160; &#160; /var/run/chilli.eth1.sock
unixipc &#160; &#160; &#160; &#160; chilli.eth1.ipc
pidfile &#160; &#160; &#160; &#160; /var/run/chilli.eth1.pid
net10.1.0.0/255.255.255.0
uamlisten11.1.0.1
uamport &#160; &#160; &#160; &#160; 3100
dhcpifeth1
uamallowed&quot;10.0.0.0/8,11.0.0.0/8&quot;
uamanydns
kname &quot;chilli&quot;
dhcplisten &quot;10.1.0.1&quot;
domain &quot;lan&quot;
dns1 &quot;208.67.222.222&quot;
dns2 &quot;8.8.8.8&quot;

radiusserver1&quot;localhost&quot;
radiusserver2&quot;localhost&quot;
radiussecret&quot;testing123&quot;
radiusauthport&#160; 1812
radiusacctport&#160; 1813
uamserver&quot;<A HREF="http://11.1.0.1/login/login.php">http://11.1.0.1/login/login.php</A>&quot;
radiusnasid&quot;nas-10&quot;
papalwaysok
macauth
usestatusfile &quot;/etc/chilli/eth1/status.dat&quot;
uamaliasname &quot;chilli&quot;
adminupdatefile &quot;/etc/chilli/eth1/local.conf&quot;
uamsecret &quot;testing123&quot;

dhcpstart 10
dhcpend 239
lease 3600
dhcpnotidle
seskeepalive
logfacility 22

WAN side - eth0 : 192.168.0.88 (def gw:192.168.0.1)
LAN side - eth1 : 10.1.0.1
tun0: 11.1.0.1

iptables output:
Chain INPUT (policy ACCEPT)

target &#160; &#160; prot opt source &#160; &#160; &#160; &#160; &#160; &#160; &#160; destination&#160; &#160; &#160; &#160; &#160;

Chain FORWARD (policy DROP)
target &#160; &#160; prot opt source &#160; &#160; &#160; &#160; &#160; &#160; &#160; destination&#160; &#160; &#160; &#160; &#160;
ACCEPT &#160; &#160; all&#160; --&#160; 0.0.0.0/0&#160; &#160; &#160; &#160; &#160; &#160; 0.0.0.0/0&#160; &#160; &#160; &#160; &#160; &#160;
ACCEPT &#160; &#160; all&#160; --&#160; 0.0.0.0/0&#160; &#160; &#160; &#160; &#160; &#160; 0.0.0.0/0&#160; &#160; &#160; &#160; &#160; &#160;
ACCEPT &#160; &#160; all&#160; --&#160; 0.0.0.0/0&#160; &#160; &#160; &#160; &#160; &#160; 0.0.0.0/0 &#160; &#160; &#160; &#160; &#160; coova: name: chilli side: dest
ACCEPT &#160; &#160; all&#160; --&#160; 0.0.0.0/0&#160; &#160; &#160; &#160; &#160; &#160; 0.0.0.0/0 &#160; &#160; &#160; &#160; &#160; coova: name: chilli side: source&#160;

Chain OUTPUT (policy ACCEPT)
target &#160; &#160; prot opt source &#160; &#160; &#160; &#160; &#160; &#160; &#160; destination


route -n output:

Kernel IP routing table
Destination &#160; &#160; Gateway &#160; &#160; &#160; &#160; Genmask &#160; &#160; &#160; &#160; Flags Metric Ref&#160; &#160; Use Iface
0.0.0.0 &#160; &#160; &#160; &#160; 192.168.0.1 &#160; &#160; 0.0.0.0 &#160; &#160; &#160; &#160; UG&#160; &#160; 100&#160; &#160; 0&#160; &#160; &#160; &#160; 0 eth0
10.0.0.0&#160; &#160; &#160; &#160; 0.0.0.0 &#160; &#160; &#160; &#160; 255.0.0.0 &#160; &#160; &#160; U &#160; &#160; 0&#160; &#160; &#160; 0&#160; &#160; &#160; &#160; 0 eth1
11.1.0.0&#160; &#160; &#160; &#160; 0.0.0.0 &#160; &#160; &#160; &#160; 255.255.255.0 &#160; U &#160; &#160; 0&#160; &#160; &#160; 0&#160; &#160; &#160; &#160; 0 tun0
192.168.0.0 &#160; &#160; 0.0.0.0 &#160; &#160; &#160; &#160; 255.255.255.0 &#160; U &#160; &#160; 0&#160; &#160; &#160; 0&#160; &#160; &#160; &#160; 0 eth0


Can anyone help me?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.coova.org/pipermail/chilli/attachments/20140407/4745a92b/attachment-0001.html">http://lists.coova.org/pipermail/chilli/attachments/20140407/4745a92b/attachment-0001.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002657.html">[Chilli] Running with kmod
</A></li>
	<LI>Next message: <A HREF="002658.html">[Chilli] Chilli starting multiple times
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2662">[ date ]</a>
              <a href="thread.html#2662">[ thread ]</a>
              <a href="subject.html#2662">[ subject ]</a>
              <a href="author.html#2662">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">More information about the Chilli
mailing list</a><br>
</body></html>
