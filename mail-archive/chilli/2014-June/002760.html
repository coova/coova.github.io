<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Chilli] CoovaChilli behind ADSL2+ router
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20CoovaChilli%20behind%20ADSL2%2B%20router&In-Reply-To=%3C1401887300.93156.YahooMailNeo%40web161301.mail.bf1.yahoo.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002759.html">
   <LINK REL="Next"  HREF="002761.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Chilli] CoovaChilli behind ADSL2+ router</H1>
    <B>Sachin Yadav</B> 
    <A HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20CoovaChilli%20behind%20ADSL2%2B%20router&In-Reply-To=%3C1401887300.93156.YahooMailNeo%40web161301.mail.bf1.yahoo.com%3E"
       TITLE="[Chilli] CoovaChilli behind ADSL2+ router">sachin0235 at yahoo.com
       </A><BR>
    <I>Wed Jun  4 13:08:20 UTC 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="002759.html">[Chilli] miniportal: wwwsh wrapper not receiving POST via stdin for login.chi
</A></li>
        <LI>Next message: <A HREF="002761.html">[Chilli] HTTPS JSON
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2760">[ date ]</a>
              <a href="thread.html#2760">[ thread ]</a>
              <a href="subject.html#2760">[ subject ]</a>
              <a href="author.html#2760">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I have a configuration where my Chilli wifi router is behind ISP provided ADSL2 modem+router. So final configuration is like -

client (192.168.182.x) ===&gt; coovachilli router (192.168.1.99) ==&gt; ISP ADSL2 modem (192.168.1.1) ==&gt; (public IP) Internet

Sometimes what happen is due to electricity fluctuation ISP ADSL2 modem reboots along with coova chilli router. Coova chilli router reboots faster while modem is still trying to get a stable link. After this once WAN link is stable, if client tries to connect our UAM portal opens up for taking username and password but coovachilli request to radius for access gets failed due to timed out. We have to reboot coovachilli router and only then the problem resolves. Following are the logs -

Log - 1
----------------------------------------

redir.c: 2103: 0 (Debug) The path: ncsi.txt
redir.c: 2413: 0 (Debug) --&gt;&gt; Setting userurl=[<A HREF="http://www.msftncsi.com/ncsi.txt">http://www.msftncsi.com/ncsi.txt</A>]
redir.c: 3962: 0 (Debug) redir_accept: Original request host=www.msftncsi.com
redir.c: 987: 0 (Debug) redir_wispr2_reply
chilli.c: 379: 0 (Debug) caught 18 via selfpipe
chilli.c: 310: 0 (Debug) child 1334 terminated
chilli.c: 135: 0 (Debug) Freed child process 1334 [[redir]]
redir.c: 2020: 131 (Connection reset by peer) redir_read(0) failed!
redir.c: 3383: 0 (Debug) Error calling get_req. Terminating -1
chilli.c: 379: 0 (Debug) caught 18 via selfpipe
chilli.c: 310: 0 (Debug) child 1335 terminated
chilli.c: 135: 0 (Debug) Freed child process 1335 [[redir]]


Log 2
==================================================================-


dhcp.c: 1173: 0 (Debug) dhcpif (wlan0) IPv6 address fe80::cad3:a3ff:fe6e:32b0
radius.c: 1315: 0 (Debug) RADIUS client 0.0.0.0:0
chilli.c: 7303: 0 (Debug) Waiting for client request...
radius.c: 321: 0 (Debug) Allocating RADIUS packet
net.c: 388: 0 (Debug) net select count: 1
net.c: 388: 0 (Debug) net select count: 2
net.c: 388: 0 (Debug) net select count: 3
net.c: 388: 0 (Debug) net select count: 4
net.c: 388: 0 (Debug) net select count: 5
net.c: 388: 0 (Debug) net select count: 6
net.c: 388: 0 (Debug) net select count: 7
net.c: 388: 0 (Debug) net select count: 8
dhcp.c: 3555: 0 (Debug) chopping off trailer length 6
dhcp.c: 3555: 0 (Debug) chopping off trailer length 6

dhcp.c: 3640: 0 (Debug) Address not found (192.168.182.5)
dhcp.c: 730: 0 (Debug) DHCP newconn: dc:85:de:52:41:f4
chilli.c: 5117: 0 (Debug) New DHCP request from MAC=DC-85-DE-52-41-F4
chilli.c: 5120: 0 (Debug) New DHCP connection established
chilli.c: 5076: 0 (Debug) New Chilli Connection
chilli.c: 4869: 0 (Debug) ----&gt; cb_dhcp_request &lt;----
chilli.c: 4873: 0 (Debug) DHCP request for IP address 192.168.182.5
chilli.c: 835: 0 (Debug) newip 192.168.182.5
ippool.c: 456: 0 (Debug) Requesting new static ip: 192.168.182.5
ippool.c: 479: 0 (Debug) HERE!!! -&gt; 0
ippool.c: 482: 0 (Debug) Static IP address not allowed
ippool.c: 456: 0 (Debug) Requesting new dynamic ip: 192.168.182.5
chilli.c: 5005: 0 (Debug) Client MAC=DC-85-DE-52-41-F4 assigned IP 192.168.182.5
dhcp.c: 3921: 0 (Debug) dropping packet; unhandled auth state 0
chilli.c: 310: 0 (Debug) child 1260 terminated

radius.c: 1898: 0 (Debug) Received RADIUS packet id=0
radius.c: 421: 0 (Debug) Freeing RADIUS packet
radius.c: 426: 0 (Debug) RADIUS queue-out id=0 idx=0
dhcp.c: 3509: 0 (Debug) dropping non-IPv4
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.coova.org/pipermail/chilli/attachments/20140604/234f7640/attachment.html">http://lists.coova.org/pipermail/chilli/attachments/20140604/234f7640/attachment.html</A>&gt;
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002759.html">[Chilli] miniportal: wwwsh wrapper not receiving POST via stdin for login.chi
</A></li>
	<LI>Next message: <A HREF="002761.html">[Chilli] HTTPS JSON
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2760">[ date ]</a>
              <a href="thread.html#2760">[ thread ]</a>
              <a href="subject.html#2760">[ subject ]</a>
              <a href="author.html#2760">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">More information about the Chilli
mailing list</a><br>
</body></html>
