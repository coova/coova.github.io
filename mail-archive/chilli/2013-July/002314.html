<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Chilli] Captive portal &quot;looping&quot; problem - maybe radius / radius-proxy timeout problem ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20Captive%20portal%20%22looping%22%20problem%20-%20maybe%20radius%20/%0A%20radius-proxy%20timeout%20problem%20%3F&In-Reply-To=%3CCABTDJHCcGB88cvjbeJj0vFbqq4wtb8x5u0zaRgeNW%3DFHAAXLZw%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002296.html">
   <LINK REL="Next"  HREF="002287.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Chilli] Captive portal &quot;looping&quot; problem - maybe radius / radius-proxy timeout problem ?</H1>
    <B>Maria Ang&#233;lica Lizarazo</B> 
    <A HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20Captive%20portal%20%22looping%22%20problem%20-%20maybe%20radius%20/%0A%20radius-proxy%20timeout%20problem%20%3F&In-Reply-To=%3CCABTDJHCcGB88cvjbeJj0vFbqq4wtb8x5u0zaRgeNW%3DFHAAXLZw%40mail.gmail.com%3E"
       TITLE="[Chilli] Captive portal &quot;looping&quot; problem - maybe radius / radius-proxy timeout problem ?">maltara86 at gmail.com
       </A><BR>
    <I>Thu Jul 25 12:17:44 UTC 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="002296.html">[Chilli] Macreauth question
</A></li>
        <LI>Next message: <A HREF="002287.html">[Chilli] Content-injection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2314">[ date ]</a>
              <a href="thread.html#2314">[ thread ]</a>
              <a href="subject.html#2314">[ subject ]</a>
              <a href="author.html#2314">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Derek. You should check the date format that you're using. I have the
same problem but it is because the date that radius use is like this:
YYYY:MM:DD-hh:mm:ss:ss. In numbers, the date is set like
2013:05:03-00:00:00. So radius gets caught in a loop because the date is
still valid but the hours are not.  Unfortunately , in my case I have to
use that format but maybe you can change the one that you use.
Could you tell me how are you using the chilli_proxy feature? Is it to
intercept the borwser request to a proxy server
2013/7/15 &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">chilli-request at coova.org</A>&gt;

&gt;<i> Send Chilli mailing list submissions to
</I>&gt;<i>         <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">chilli at coova.org</A>
</I>&gt;<i>
</I>&gt;<i> To subscribe or unsubscribe via the World Wide Web, visit
</I>&gt;<i>         <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">http://lists.coova.org/cgi-bin/mailman/listinfo/chilli</A>
</I>&gt;<i> or, via email, send a message with subject or body 'help' to
</I>&gt;<i>         <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">chilli-request at coova.org</A>
</I>&gt;<i>
</I>&gt;<i> You can reach the person managing the list at
</I>&gt;<i>         <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">chilli-owner at coova.org</A>
</I>&gt;<i>
</I>&gt;<i> When replying, please edit your Subject line so it is more specific
</I>&gt;<i> than &quot;Re: Contents of Chilli digest...&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Today's Topics:
</I>&gt;<i>
</I>&gt;<i>    1. Content-injection (Derek Conniffe)
</I>&gt;<i>    2. Captive portal &quot;looping&quot; problem - maybe radius /
</I>&gt;<i>       radius-proxy timeout problem ? (Derek Conniffe)
</I>&gt;<i>    3. Re: Captive portal &quot;looping&quot; problem - maybe radius /
</I>&gt;<i>       radius-proxy timeout problem ? (Derek Conniffe)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 1
</I>&gt;<i> Date: Sun, 14 Jul 2013 15:48:21 +0100
</I>&gt;<i> From: Derek Conniffe &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">derek at hssl.ie</A>&gt;
</I>&gt;<i> To: &quot;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">chilli at coova.org</A>&quot; &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">chilli at coova.org</A>&gt;
</I>&gt;<i> Subject: [Chilli] Content-injection
</I>&gt;<i> Message-ID: &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">04D5D258-BEB3-4667-9178-F5E91C796DFB at hssl.ie</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=us-ascii
</I>&gt;<i>
</I>&gt;<i> Hi Jed,
</I>&gt;<i>
</I>&gt;<i> Did you get Content-Injection working with Coova Chilli?
</I>&gt;<i>
</I>&gt;<i> A long time ago I tried this with various proxies (Tinyproxy, Privoxy,
</I>&gt;<i> Squid with content adaption) but I do remember reading David Bird's blog
</I>&gt;<i> post about content injection natively in Coova Chilli which sounds much
</I>&gt;<i> neater if its now part of Coova Chilli (I didn't think it was yet?)
</I>&gt;<i>
</I>&gt;<i> thanks,
</I>&gt;<i>
</I>&gt;<i> Derek
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 2
</I>&gt;<i> Date: Sun, 14 Jul 2013 15:33:19 +0100
</I>&gt;<i> From: Derek Conniffe &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">derek at hssl.ie</A>&gt;
</I>&gt;<i> To: <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">chilli at coova.org</A>
</I>&gt;<i> Subject: [Chilli] Captive portal &quot;looping&quot; problem - maybe radius /
</I>&gt;<i>         radius-proxy timeout problem ?
</I>&gt;<i> Message-ID: &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">B85120C0-55ED-4E4F-824D-3CB07CE274DD at hssl.ie</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=us-ascii
</I>&gt;<i>
</I>&gt;<i> Hi everyone,
</I>&gt;<i>
</I>&gt;<i> I've been playing with coova chilli for years and its feature set is great
</I>&gt;<i> and I really love new features (especially chilli_proxy that appeared in
</I>&gt;<i> 1.2.9)!.
</I>&gt;<i>
</I>&gt;<i> I'm having a problem and I think I've also seen this problem over the
</I>&gt;<i> years too.
</I>&gt;<i>
</I>&gt;<i> I'm using coova chilli 1.2.9 and right now I'm using chilli-proxy with
</I>&gt;<i> HTTP authentication (so no radius server at all) and I'm using mac
</I>&gt;<i> authentication.
</I>&gt;<i>
</I>&gt;<i> The problem is that for some reason coova chilli thinks the user isn't
</I>&gt;<i> authorised so it sends the user to the login page (uamhomepage) *but* I
</I>&gt;<i> have checking in my home page to see if the user is actually authenticated
</I>&gt;<i> (in the DB) or not and, if they are, I try to redirect them to
</I>&gt;<i> www.google.com - I'd hope this situation wouldn't happen but it does
</I>&gt;<i> regularly.  Its worse actually because I can sometimes see devices looping
</I>&gt;<i> through my uamhomepage page over and over again and then, maybe, eventually
</I>&gt;<i> getting Google.  (coova chilli keeps thinking the client isn't
</I>&gt;<i> authenticated - when this happens I can see that my web server handling the
</I>&gt;<i> chilli proxy requests as per the uamaaaurl directive is *NOT* getting the
</I>&gt;<i> coova chilli request at all!).
</I>&gt;<i>
</I>&gt;<i> I see this problem more if the internet connection to the coova chilli
</I>&gt;<i> enabled AP is slow.  This makes me think its some kind of radius timeout
</I>&gt;<i> issue.  I did add the line &quot;radiustimeout=90&quot; to my chilli conf file (I
</I>&gt;<i> think that sets the radius timeout to 90 seconds) but this didn't appear to
</I>&gt;<i> have any effect.
</I>&gt;<i>
</I>&gt;<i> I haven't seen anything in the chilli log output yet but mostly this is
</I>&gt;<i> because I haven't been getting detailed logs in my APs.  Now I'm trying to
</I>&gt;<i> use remote syslog to a dedicated server so this might help.
</I>&gt;<i>
</I>&gt;<i> The issue could be in chilli_proxy.  If so I might have to go back to
</I>&gt;<i> having a freeradius server but I'd hate to do that.
</I>&gt;<i>
</I>&gt;<i> Has anyone else seen this type of problem before?
</I>&gt;<i>
</I>&gt;<i> thanks for any info!
</I>&gt;<i>
</I>&gt;<i> Derek
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> Message: 3
</I>&gt;<i> Date: Sun, 14 Jul 2013 16:24:28 +0100
</I>&gt;<i> From: Derek Conniffe &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">derek at hssl.ie</A>&gt;
</I>&gt;<i> To: <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">chilli at coova.org</A>
</I>&gt;<i> Subject: Re: [Chilli] Captive portal &quot;looping&quot; problem - maybe radius
</I>&gt;<i>         /       radius-proxy timeout problem ?
</I>&gt;<i> Message-ID: &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">38272CD1-794D-495B-9E23-16B417AEE822 at hssl.ie</A>&gt;
</I>&gt;<i> Content-Type: text/plain; charset=us-ascii
</I>&gt;<i>
</I>&gt;<i> Ok - an update.
</I>&gt;<i>
</I>&gt;<i> Adding in syslog-ng and remote logging *was* a good idea for sure!
</I>&gt;<i>
</I>&gt;<i> This is the error that seems to be related to my problem: -
</I>&gt;<i>
</I>&gt;<i> Jul 14 15:16:17 5.54.29.155 syslog: main-proxy.c: 142: out of connections
</I>&gt;<i>
</I>&gt;<i> I wonder is there somehow a connect leak?
</I>&gt;<i>
</I>&gt;<i> This AP would not be that busy.  I see that in the source code there is a
</I>&gt;<i> max number of requests set to 16 and I would think that this should be
</I>&gt;<i> perfectly good so I wonder is there some kind of connection leak?
</I>&gt;<i>
</I>&gt;<i> Derek
</I>&gt;<i>
</I>&gt;<i> Log file output: -
</I>&gt;<i>
</I>&gt;<i> Jul 14 15:20:46 5.54.29.155 syslog: main-proxy.c: 142: out of connections
</I>&gt;<i> Jul 14 15:20:46 5.54.29.155 syslog: main-proxy.c: 102: 000. inuse=1
</I>&gt;<i> prev=-001 next=-001 url=
</I>&gt;<i> <A HREF="http://MY-UAM-AAA-URL?stage=counters&amp;status=update&amp;user=AC-3C-0B-30-XX-XX&amp;ap=02-DB-36-1D-XX-XX&amp;mac=AC-3C-0B-30-XX-XX&amp;ip=10.0.0.54&amp;sessionid=51e075db00000009&amp;nasid=dc9fdb3xxxx&amp;duration=241&amp;bytes_down=0&amp;pkts_down=0&amp;bytes_up=0&amp;pkts_up=0fd=29">http://MY-UAM-AAA-URL?stage=counters&amp;status=update&amp;user=AC-3C-0B-30-XX-XX&amp;ap=02-DB-36-1D-XX-XX&amp;mac=AC-3C-0B-30-XX-XX&amp;ip=10.0.0.54&amp;sessionid=51e075db00000009&amp;nasid=dc9fdb3xxxx&amp;duration=241&amp;bytes_down=0&amp;pkts_down=0&amp;bytes_up=0&amp;pkts_up=0fd=29</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 14 Jul 2013, at 15:33, Derek Conniffe &lt;<A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">derek at hssl.ie</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Hi everyone,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I've been playing with coova chilli for years and its feature set is
</I>&gt;<i> great and I really love new features (especially chilli_proxy that appeared
</I>&gt;<i> in 1.2.9)!.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm having a problem and I think I've also seen this problem over the
</I>&gt;<i> years too.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I'm using coova chilli 1.2.9 and right now I'm using chilli-proxy with
</I>&gt;<i> HTTP authentication (so no radius server at all) and I'm using mac
</I>&gt;<i> authentication.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The problem is that for some reason coova chilli thinks the user isn't
</I>&gt;<i> authorised so it sends the user to the login page (uamhomepage) *but* I
</I>&gt;<i> have checking in my home page to see if the user is actually authenticated
</I>&gt;<i> (in the DB) or not and, if they are, I try to redirect them to
</I>&gt;<i> www.google.com - I'd hope this situation wouldn't happen but it does
</I>&gt;<i> regularly.  Its worse actually because I can sometimes see devices looping
</I>&gt;<i> through my uamhomepage page over and over again and then, maybe, eventually
</I>&gt;<i> getting Google.  (coova chilli keeps thinking the client isn't
</I>&gt;<i> authenticated - when this happens I can see that my web server handling the
</I>&gt;<i> chilli proxy requests as per the uamaaaurl directive is *NOT* getting the
</I>&gt;<i> coova chilli request at all!).
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I see this problem more if the internet connection to the coova chilli
</I>&gt;<i> enabled AP is slow.  This makes me think its some kind of radius timeout
</I>&gt;<i> issue.  I did add the line &quot;radiustimeout=90&quot; to my chilli conf file (I
</I>&gt;<i> think that sets the radius timeout to 90 seconds) but this didn't appear to
</I>&gt;<i> have any effect.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I haven't seen anything in the chilli log output yet but mostly this is
</I>&gt;<i> because I haven't been getting detailed logs in my APs.  Now I'm trying to
</I>&gt;<i> use remote syslog to a dedicated server so this might help.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The issue could be in chilli_proxy.  If so I might have to go back to
</I>&gt;<i> having a freeradius server but I'd hate to do that.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Has anyone else seen this type of problem before?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; thanks for any info!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Derek
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Chilli mailing list
</I>&gt;<i> &gt; <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">Chilli at coova.org</A>
</I>&gt;<i> &gt; <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">http://lists.coova.org/cgi-bin/mailman/listinfo/chilli</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------------------------
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Chilli mailing list
</I>&gt;<i> <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">Chilli at coova.org</A>
</I>&gt;<i> <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">http://lists.coova.org/cgi-bin/mailman/listinfo/chilli</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> End of Chilli Digest, Vol 44, Issue 3
</I>&gt;<i> *************************************
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.coova.org/pipermail/chilli/attachments/20130725/3de61266/attachment.html">http://lists.coova.org/pipermail/chilli/attachments/20130725/3de61266/attachment.html</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002296.html">[Chilli] Macreauth question
</A></li>
	<LI>Next message: <A HREF="002287.html">[Chilli] Content-injection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2314">[ date ]</a>
              <a href="thread.html#2314">[ thread ]</a>
              <a href="subject.html#2314">[ subject ]</a>
              <a href="author.html#2314">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">More information about the Chilli
mailing list</a><br>
</body></html>
