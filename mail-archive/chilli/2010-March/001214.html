<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Chilli] CoovaChilli init.d script for OpenWRT 8.09.2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20CoovaChilli%20init.d%20script%20for%20OpenWRT%208.09.2&In-Reply-To=%3C2587f0781003261716u6bcef447m4c204522fe94fa51%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001215.html">
   <LINK REL="Next"  HREF="001217.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Chilli] CoovaChilli init.d script for OpenWRT 8.09.2</H1>
    <B>Stephen Potter</B> 
    <A HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20CoovaChilli%20init.d%20script%20for%20OpenWRT%208.09.2&In-Reply-To=%3C2587f0781003261716u6bcef447m4c204522fe94fa51%40mail.gmail.com%3E"
       TITLE="[Chilli] CoovaChilli init.d script for OpenWRT 8.09.2">surfingsteve at gmail.com
       </A><BR>
    <I>Sat Mar 27 00:16:49 UTC 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="001215.html">[Chilli] dhcp.c Resetting connection on port 80
</A></li>
        <LI>Next message: <A HREF="001217.html">[Chilli] Whitelist MAC to bypass authentication?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1214">[ date ]</a>
              <a href="thread.html#1214">[ thread ]</a>
              <a href="subject.html#1214">[ subject ]</a>
              <a href="author.html#1214">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I am trying to install CoovaChlli on the kamikaze version of Openwrt.  I
installed openwrt 8.09.2 and then the binary package from the wiki for
openwrt 8.09.2 (<A HREF="http://coova.org/CoovaChilli/Binaries">http://coova.org/CoovaChilli/Binaries</A>).

After setting up the configuration file  I was unable to find the
/etc/init.d/chilli or /etc/init.d/coovachilli startup script to start the
program.  I installed the Ubuntu version of Coovachilli on my local machine
and tried to modify it's startup script for openwrt, however I am not
familiar enough with Openwrt to know what I am doing.

I can start CoovaChilli on the openwrt box with chilli --fg --debug but it
doesnt seem to work right.  While the chilli dhcp server does give out an IP
address to my laptop, it does not redirect the webbrowser to the login
page.  Instead it presents a &quot;The connection was reset&quot; error page when I
try to visit a webpage outside of the walled garden.  If I visit a webpage
that is allowed in the walled garden, such as paypal.com then it works
fine.  Also, if I type in manual the address of the redirect
<A HREF="http://192.168.182.1:3990/www/coova.html">http://192.168.182.1:3990/www/coova.html</A> then I am presented with the login
screen and everything works from there.

Some of the output is included in this email.  I have a feeling that I have
a mis-configuration in openwrt that might be handled by a startup file.
Either that or I have something trivial wrong in my coovachilli
configuration.

If anyone has any ideas or spots anything wrong in my configuration please
let me know.

Thanks,
Stephen




Debug Output
some content replaced with xx

main-opt.c: 306: 0 (Debug) DHCP Listen: 192.168.182.1
main-opt.c: 307: 0 (Debug) UAM Listen: 192.168.182.1
garden.c: 72: 0 (Debug) Uamallowed coova.org
garden.c: 54: 0 (Debug) Uamallowed IP address #0:128: proto=0
host=174.129.195.118 port=0
options.c: 478: 0 (Debug) reloaded binary options file
chilli.c: 4302: 0 (Debug) clock realtime sec 1262250030 nsec 878531000
chilli.c: 4305: 22 (Invalid argument) getting startup (monotonic) time
chilli.c: 4307: 0 (Debug) clock monotonic sec 0 nsec 0
tun.c: 506: 0 (Debug) TX queue length set to 100
ippool.c: 234: 0 (Debug) Hashlog 8 253 256

net.c: 778: 0 (Debug) device br-lan ifindex 5
chilli.c: 4532: 0 (Debug) Waiting for client request...
radius.c: 1421: 0 (Debug) RADIUS to *xx*:1813
radius.c: 1421: 0 (Debug) RADIUS to *xx*:1812
dhcp.c: 2330: 0 (Debug) Not for our MAC or broadcast: 00-24-1D-33-99-20
dhcp.c: 2330: 0 (Debug) Not for our MAC or broadcast: 00-24-1D-33-99-20
dhcp.c: 2361: 0 (Debug) Address not found (192.168.15.55)
dhcp.c: 389: 0 (Debug) DHCP newconn: 00:24:1d:33:99:20
chilli.c: 3248: 0 (Debug) New DHCP request from MAC=00-24-1D-33-99-20
chilli.c: 3251: 0 (Debug) New DHCP connection established
chilli.c: 3108: 0 (Debug) DHCP request for IP address
chilli.c: 767: 0 (Debug) Starting radius authentication
radius.c: 1421: 0 (Debug) RADIUS to *xx*:1812
ippool.c: 344: 0 (Debug) Requesting new static ip: 192.168.15.55
ippool.c: 364: 0 (Debug) Static IP address not allowed
ippool.c: 344: 0 (Debug) Requesting new dynamic ip: 192.168.15.55
chilli.c: 3209: 0 (Debug) Client MAC=00-24-1D-33-99-20 assigned IP
192.168.182.2
dhcp.c: 1198: 0 (Debug) Resetting connection on port 41435-&gt;22
dhcp.c: 2462: 0 (Debug) dropping packet; not nat'ed
dhcp.c: 1198: 0 (Debug) Resetting connection on port 41435-&gt;22
dhcp.c: 2462: 0 (Debug) dropping packet; not nat'ed
chilli.c: 2756: 0 (Debug) Received access request confirmation from radius
server

chilli.c: 2610: 0 (Debug) looking to replace: /etc/chilli/local.conf
radius.c: 1421: 0 (Debug) RADIUS to *xx*:1813
chilli.c: 92: 0 (Debug) SIGTERM: shutdown
chilli.c: 92: 0 (Debug) SIGTERM: shutdown
chilli.c: 86: 0 (Debug) received 18 signal
chilli.c: 86: 0 (Debug) received 18 signal
chilli.c: 4685: 0 (Debug) CoovaChilli shutting down
radius.c: 1421: 0 (Debug) RADIUS to *xx*:1813
radius.c: 1421: 0 (Debug) RADIUS to *xx*:1813





*main.conf*

# THIS FILE IS AUTOMATICALLY GENERATED
cmdsocket       /var/run/chilli.sock
pidfile         /var/run/chilli.pid
net        192.168.182.0/255.255.255.0
uamlisten    192.168.182.1
uamport         3990
dhcpif        br-lan
adminuser       chillispot
adminpasswd     chillispot
uamallowed      coova.org

uamdomain       paypalobjects.com
uamdomain       paypal.112.2o7.net
uamdomain       paypal.com
uamdomain       *xx*.net
uamdomain       wikipedia.com
uamdomain       wikipedia.org
uamdomain       wikimedia.org

macpasswd       *xx*

uamanydns

domain lan
dns1 208.67.222.222
dns2 208.67.220.220
uamhomepage <A HREF="http://192.168.182.1:3990/www/coova.html">http://192.168.182.1:3990/www/coova.html</A>
wisprlogin <A HREF="https://coova.org/app/uam/auth">https://coova.org/app/uam/auth</A>
wwwdir /etc/chilli/www
wwwbin /etc/chilli/wwwsh
locationname &quot;My HotSpot&quot;
radiuslocationname My_HotSpot
radiuslocationid isocc=,cc=,ac=,network=Coova,
radiusserver1    *xx*.net
radiusserver2    *xx*.net
radiussecret    *xx*
radiusauthport  1812
radiusacctport  1813
uamserver    <A HREF="https://www.xx.net/login.pl">https://www.xx.net/login.pl</A>
radiusnasid    bda

papalwaysok
macauth
uamsecret *xx*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://lists.coova.org/pipermail/chilli/attachments/20100326/e69842d8/attachment.htm">http://lists.coova.org/pipermail/chilli/attachments/20100326/e69842d8/attachment.htm</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001215.html">[Chilli] dhcp.c Resetting connection on port 80
</A></li>
	<LI>Next message: <A HREF="001217.html">[Chilli] Whitelist MAC to bypass authentication?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1214">[ date ]</a>
              <a href="thread.html#1214">[ thread ]</a>
              <a href="subject.html#1214">[ subject ]</a>
              <a href="author.html#1214">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">More information about the Chilli
mailing list</a><br>
</body></html>
