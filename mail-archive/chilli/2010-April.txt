From david at coova.com  Thu Apr  1 04:43:05 2010
From: david at coova.com (David Bird)
Date: Thu, 01 Apr 2010 06:43:05 +0200
Subject: [Chilli] CoovaChilli and dhcpgateway
In-Reply-To: <41892.195.19.214.216.1270020003.squirrel@mail.pnpi.spb.ru>
References: <47324.195.19.214.216.1269964247.squirrel@mail.pnpi.spb.ru>
	<1270010121.18129.12.camel@david-laptop>
	<41892.195.19.214.216.1270020003.squirrel@mail.pnpi.spb.ru>
Message-ID: <1270096985.18129.41.camel@david-laptop>

I asked if you are using the uamanyip option, because I do understand
your question. The option can influence _when_ IP addresses are taken
out of the pool. Sounds like you don't want the option and you should
not be using it, just make sure you are not using it..

On Wed, 2010-03-31 at 11:20 +0400, Anatoly Oreshkin wrote:
> You misunderstood me.
> 
> I would like wireless clients to get addresses from external dhcp server,
> not from chilli. With dhcpgateway specified chilli relays dhcp request
> to our dhcp server which assigns address to client from pool.
> At the same time chilli itself assigns address to client.
> For example, dhcpserver assigns address 10.2.3.7 but chilli assigns
> 10.2.3.45 and as I think, wants to work with client having address
> 10.2.3.45.
> Really client has address 10.2.3.7 and I guess, because of
> this a client can't authenticate through chilli.
> How to make chilli not assign addresses  itself but get from external
> dhcp server ? Is it possible at all ?
> We need external dhcp server also for wire clients.
> 
> My main idea  is the following:
> 
> At present we have 3Com APs configured with security WPA2/AES
> EAP-PEAP-MSCHAPv2
> and authentication is performed via radius server. Wireless clients get
> their fixed addresses from dhcp server by their MAC addresses.
> 
> Also we need temporary wireless connections (for workshops, conferences
> ...) using UAM authentication regardless of MAC addresses, only with
> login and password.
> So we would like to use the same APs for UAM authenticaton too using chilli
> at the same time preserving secure authentication in secure SSID for
> permanent clients.
> For this end we configure on each AP second SSID but without security.
> Temporary clients should connect to this insecure SSID, get
> addresses from pool regardless of MAC addresses and authenticate through
> chilli using UAM.
> 
> Any hints, ideas.
> Thanks.
> 
> > Are you also using uamanyip? If so, try without.
> >
> >
> > On Tue, 2010-03-30 at 19:50 +0400, Anatoly Oreshkin wrote:
> >> Hello,
> >>
> >> My coovachili has such configuration:
> >>
> >> HS_WANIF=eth0  (195.19.214.216)
> >> HS_LANIF=eth1
> >> HS_NETWORK=10.2.3.0
> >> HS_NETMASK=255.255.255.0
> >> HS_UAMLISTEN=10.2.3.1
> >>
> >> I've configured coovachilli with dhcpgateway in order to get ip
> >> addresses
> >> for clients from external dhcp server. For this goal I've specified in
> >> local.conf
> >>
> >> dhcpgateway=212.193.96.134   (external dhcp address)
> >> dhcpgatewayport=67
> >> dhcprelayagent=195.19.214.216  (chilli eth0 address)
> >>
> >> DHCP server is configured as:
> >> subnet 10.2.3.0 netmask 255.255.255.0 {
> >> option routers                  10.2.3.1;
> >> option subnet-mask              255.255.255.0;
> >> range  10.2.3.2  10.2.3.254;
> >> ...
> >> }
> >>
> >> On chilli server in /var/log/messages I see
> >>
> >> New DHCP request from MAC=00-16-EA-8A-DE-38
> >> Client MAC=00-16-EA-8A-DE-38 assigned IP 10.2.3.53
> >>
> >> On dhcp server in /var/log/messages I see
> >>
> >> DHCPDISCOVER from 00:16:ea:8a:de:38 via 195.19.214.216
> >> DHCPOFFER on 10.2.3.2 to 00:16:ea:8a:de:38 (csd-notebook) via
> >> 195.19.214.216
> >> DHCPREQUEST for 10.2.3.2 (10.2.3.1) from 00:16:ea:8a:de:38 via
> >> 195.19.214.216
> >> DHCPACK on 10.2.3.2 to 00:16:ea:8a:de:38 via 195.19.214.216
> >>
> >> On client I see configuration
> >> IP-address: 10.2.3.2
> >> network mask: 255.255.255.0
> >> gateway: 10.2.3.1
> >> dhcp server: 10.2.3.1
> >>
> >> That is the client have got ip address from dhcp server rather than from
> >> chilli. As the consequence of this the client could not authenticate
> >> through
> >> chilli.
> >>
> >> What is wrong ?  What purpose is dhcpgateway designed for ?
> >>
> >> Thanks.
> >>
> >>
> >>
> >>
> >>
> >>
> >>
> >> _______________________________________________
> >> Chilli mailing list
> >> Chilli at coova.org
> >> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> >
> >
> 



From Anatoly.Oreshkin at pnpi.spb.ru  Thu Apr  1 06:35:58 2010
From: Anatoly.Oreshkin at pnpi.spb.ru (Anatoly Oreshkin)
Date: Thu, 1 Apr 2010 10:35:58 +0400 (MSD)
Subject: [Chilli] CoovaChilli and dhcpgateway
In-Reply-To: <1270096985.18129.41.camel@david-laptop>
References: <47324.195.19.214.216.1269964247.squirrel@mail.pnpi.spb.ru>
	<1270010121.18129.12.camel@david-laptop>
	<41892.195.19.214.216.1270020003.squirrel@mail.pnpi.spb.ru>
	<1270096985.18129.41.camel@david-laptop>
Message-ID: <48744.195.19.214.216.1270103758.squirrel@mail.pnpi.spb.ru>


I don't use uamanyip option.

Config file /usr/local/etc/chilli/config have such lines:

HS_WANIF=eth0        # has address 195.19.214.216
HS_LANIF=eth1
HS_NETWORK=10.2.3.0
HS_NETMASK=255.255.255.0
HS_UAMLISTEN=10.2.3.1
HS_UAMPORT=3990
HS_UAMUIPORT=4990
HS_DNS_DOMAIN=my.domain
HS_DNS1=<ip address1>
HS_DNS2=<ip address2>
HS_NASID=nas01
HS_RADIUS=<ip address>
HS_RADIUS2=<ip address>
HS_UAMALLOW="10.2.3.1/24,195.19.214.216"
HS_RADSECRET=<secret>
HS_UAMSECRET=<uam secret>
HS_UAMALIASNAME=chilli
HS_UAMSERVER=<uam server>
HS_UAMFORMAT=https://\$HS_UAMSERVER/cgi-bin/hotspotlogin.cgi
HS_TCP_PORTS="80 443"
HS_MODE=hotspot
HS_TYPE=chillispot
HS_WWWDIR=/usr/local/etc/chilli/www
HS_WWWBIN=/usr/local/etc/chilli/wwwsh
HS_PROVIDER=Coova
HS_PROVIDER_LINK=http://www.coova.org/
HS_LOC_NAME="My HotSpot"


The file /usr/local/etc/chilli/local.conf have the lines:

dhcpgateway=212.193.96.134
dhcpgatewayport=67
dhcprelayagent=195.19.214.216



> I asked if you are using the uamanyip option, because I do understand
> your question. The option can influence _when_ IP addresses are taken
> out of the pool. Sounds like you don't want the option and you should
> not be using it, just make sure you are not using it..
>
> On Wed, 2010-03-31 at 11:20 +0400, Anatoly Oreshkin wrote:
>> You misunderstood me.
>>
>> I would like wireless clients to get addresses from external dhcp
>> server,
>> not from chilli. With dhcpgateway specified chilli relays dhcp request
>> to our dhcp server which assigns address to client from pool.
>> At the same time chilli itself assigns address to client.
>> For example, dhcpserver assigns address 10.2.3.7 but chilli assigns
>> 10.2.3.45 and as I think, wants to work with client having address
>> 10.2.3.45.
>> Really client has address 10.2.3.7 and I guess, because of
>> this a client can't authenticate through chilli.
>> How to make chilli not assign addresses  itself but get from external
>> dhcp server ? Is it possible at all ?
>> We need external dhcp server also for wire clients.
>>
>> My main idea  is the following:
>>
>> At present we have 3Com APs configured with security WPA2/AES
>> EAP-PEAP-MSCHAPv2
>> and authentication is performed via radius server. Wireless clients get
>> their fixed addresses from dhcp server by their MAC addresses.
>>
>> Also we need temporary wireless connections (for workshops, conferences
>> ...) using UAM authentication regardless of MAC addresses, only with
>> login and password.
>> So we would like to use the same APs for UAM authenticaton too using
>> chilli
>> at the same time preserving secure authentication in secure SSID for
>> permanent clients.
>> For this end we configure on each AP second SSID but without security.
>> Temporary clients should connect to this insecure SSID, get
>> addresses from pool regardless of MAC addresses and authenticate through
>> chilli using UAM.
>>
>> Any hints, ideas.
>> Thanks.
>>
>> > Are you also using uamanyip? If so, try without.
>> >
>> >
>> > On Tue, 2010-03-30 at 19:50 +0400, Anatoly Oreshkin wrote:
>> >> Hello,
>> >>
>> >> My coovachili has such configuration:
>> >>
>> >> HS_WANIF=eth0  (195.19.214.216)
>> >> HS_LANIF=eth1
>> >> HS_NETWORK=10.2.3.0
>> >> HS_NETMASK=255.255.255.0
>> >> HS_UAMLISTEN=10.2.3.1
>> >>
>> >> I've configured coovachilli with dhcpgateway in order to get ip
>> >> addresses
>> >> for clients from external dhcp server. For this goal I've specified
>> in
>> >> local.conf
>> >>
>> >> dhcpgateway=212.193.96.134   (external dhcp address)
>> >> dhcpgatewayport=67
>> >> dhcprelayagent=195.19.214.216  (chilli eth0 address)
>> >>
>> >> DHCP server is configured as:
>> >> subnet 10.2.3.0 netmask 255.255.255.0 {
>> >> option routers                  10.2.3.1;
>> >> option subnet-mask              255.255.255.0;
>> >> range  10.2.3.2  10.2.3.254;
>> >> ...
>> >> }
>> >>
>> >> On chilli server in /var/log/messages I see
>> >>
>> >> New DHCP request from MAC=00-16-EA-8A-DE-38
>> >> Client MAC=00-16-EA-8A-DE-38 assigned IP 10.2.3.53
>> >>
>> >> On dhcp server in /var/log/messages I see
>> >>
>> >> DHCPDISCOVER from 00:16:ea:8a:de:38 via 195.19.214.216
>> >> DHCPOFFER on 10.2.3.2 to 00:16:ea:8a:de:38 (csd-notebook) via
>> >> 195.19.214.216
>> >> DHCPREQUEST for 10.2.3.2 (10.2.3.1) from 00:16:ea:8a:de:38 via
>> >> 195.19.214.216
>> >> DHCPACK on 10.2.3.2 to 00:16:ea:8a:de:38 via 195.19.214.216
>> >>
>> >> On client I see configuration
>> >> IP-address: 10.2.3.2
>> >> network mask: 255.255.255.0
>> >> gateway: 10.2.3.1
>> >> dhcp server: 10.2.3.1
>> >>
>> >> That is the client have got ip address from dhcp server rather than
>> from
>> >> chilli. As the consequence of this the client could not authenticate
>> >> through
>> >> chilli.
>> >>
>> >> What is wrong ?  What purpose is dhcpgateway designed for ?
>> >>
>> >> Thanks.
>> >>
>> >>
>> >>
>> >>
>> >>
>> >>
>> >>
>> >> _______________________________________________
>> >> Chilli mailing list
>> >> Chilli at coova.org
>> >> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>> >
>> >
>>
>
>


From antoine.benoist at univ-lehavre.fr  Thu Apr  1 12:18:16 2010
From: antoine.benoist at univ-lehavre.fr (Antoine Benoist)
Date: Thu, 01 Apr 2010 14:18:16 +0200
Subject: [Chilli] Dynamic VLAN Assignement
Message-ID: <4BB48F08.8010705@univ-lehavre.fr>

Hello,
I'm on a project and I have to install a captive portal. Let me explains 
what we want :

A client connects on a switch via Ethernet, the PC receives a IP, and 
when the user ask for a webpage, he's redirected to the login page of 
the captive portal. He enters his login, and the captive portal checks 
on a RADIUS if the user is authorised. The RADIUS send back the 
authorisation and the VLAN in which the user is in. The captive portal 
accepts the user, the PC change the VLAN and receives a new IP.

IMHO, after lots of researches, I'm pretty sure that's impossible. But I 
would like to have some experts advices.

Thank you for you Help


-- 
Antoine BENOIST
Universit? du Havre

From fahd.kasri at weblib.eu  Thu Apr  1 18:11:56 2010
From: fahd.kasri at weblib.eu (Fahd Kasri)
Date: Thu, 1 Apr 2010 20:11:56 +0200
Subject: [Chilli]  Radius with dynamic IPs
Message-ID: <n2xddc827aa1004011111ma87a80a3sdcd65c9123c93907@mail.gmail.com>

Hi all,

First of all thanks for the help on my previous questions. I have several
wireless APs with Coova installed that have dynamic IPs and that use a
Freeradius server for authentication. When one of the APs IP addresses
change, the configuration for the client on the Freeradius server must be
updated, and Freeradius has to be restarted. I have scripts that do this,
but there are always times when my clients won't be able to connect. Is
there a way for Coova to know when the IP address has changed and to have it
run a script when this happens, for example when the Radius server doesn't
accept its request or when the connection to the server is dropped?

Thanks.

Regards,

-- 
Fahd
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100401/53a1bfcb/attachment.htm>

From liran.tal at gmail.com  Thu Apr  1 18:14:48 2010
From: liran.tal at gmail.com (Liran Tal)
Date: Thu, 1 Apr 2010 21:14:48 +0300
Subject: [Chilli] Radius with dynamic IPs
In-Reply-To: <n2xddc827aa1004011111ma87a80a3sdcd65c9123c93907@mail.gmail.com>
References: <n2xddc827aa1004011111ma87a80a3sdcd65c9123c93907@mail.gmail.com>
Message-ID: <k2k81237f641004011114rbfef44b6t96884980eaa9ae98@mail.gmail.com>

Are the dynamic IPs too different so that you can't even specify classes of
IP ranges?


Regards,
Liran.



On Thu, Apr 1, 2010 at 9:11 PM, Fahd Kasri <fahd.kasri at weblib.eu> wrote:

> Hi all,
>
> First of all thanks for the help on my previous questions. I have several
> wireless APs with Coova installed that have dynamic IPs and that use a
> Freeradius server for authentication. When one of the APs IP addresses
> change, the configuration for the client on the Freeradius server must be
> updated, and Freeradius has to be restarted. I have scripts that do this,
> but there are always times when my clients won't be able to connect. Is
> there a way for Coova to know when the IP address has changed and to have it
> run a script when this happens, for example when the Radius server doesn't
> accept its request or when the connection to the server is dropped?
>
> Thanks.
>
> Regards,
>
> --
> Fahd
>
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>


-- 
-- 
Sincerely, Liran Tal

Founder and CTO
Linux and Open Source
Enginx - http://enginx.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100401/56cd06f6/attachment.htm>

From david at coova.com  Sat Apr  3 05:23:33 2010
From: david at coova.com (David Bird)
Date: Sat, 03 Apr 2010 07:23:33 +0200
Subject: [Chilli] Dynamic VLAN Assignement
In-Reply-To: <4BB48F08.8010705@univ-lehavre.fr>
References: <4BB48F08.8010705@univ-lehavre.fr>
Message-ID: <1270272213.18129.56.camel@david-laptop>

Hi,

Sounds like 802.1x would be a better solution for this. But, I think it
_might_ be possible. It has been recommended that chilli could have
clients change their IP with a DHCP Nak to start the client
reconfiguring. Though, I suspect it would be somewhat client device
(operating system) dependent...

David


On Thu, 2010-04-01 at 14:18 +0200, Antoine Benoist wrote:
> Hello,
> I'm on a project and I have to install a captive portal. Let me explains 
> what we want :
> 
> A client connects on a switch via Ethernet, the PC receives a IP, and 
> when the user ask for a webpage, he's redirected to the login page of 
> the captive portal. He enters his login, and the captive portal checks 
> on a RADIUS if the user is authorised. The RADIUS send back the 
> authorisation and the VLAN in which the user is in. The captive portal 
> accepts the user, the PC change the VLAN and receives a new IP.
> 
> IMHO, after lots of researches, I'm pretty sure that's impossible. But I 
> would like to have some experts advices.
> 
> Thank you for you Help
> 
> 



From Anatoly.Oreshkin at pnpi.spb.ru  Mon Apr  5 14:29:26 2010
From: Anatoly.Oreshkin at pnpi.spb.ru (Anatoly Oreshkin)
Date: Mon, 5 Apr 2010 18:29:26 +0400 (MSD)
Subject: [Chilli] chilli as proxy for 802.1X
Message-ID: <32838.195.19.214.216.1270477766.squirrel@mail.pnpi.spb.ru>

Hello,

I would like to use chilli as proxy between Access Point (AP) and
Radius server.
AP (not CoovaAP) is configured for WPA2/AES security with
802.1X/EAP/PEAP/MSCHAPv2
authentication. Chilli address is specified as radius server in AP.

Coovachilli is configured as follows.

/usr/local/etc/chilli/config have the lines:

HS_WANIF=eth0     # has 195.19.214.216 address
HS_LANIF=eth1
HS_NETWORK=10.2.3.0
HS_NETMASK=255.255.255.0
HS_UAMLISTEN=10.2.3.1
HS_UAMPORT=3990
HS_UAMUIPORT=4990
HS_DNS_DOMAIN=<my domain>
HS_DNS1=ipaddress1
HS_DNS2=ipaddress2
HS_RADIUS=<radius server address>
HS_RADIUS2=<radius server address>
HS_UAMALLOW="10.2.3.1/24,195.19.214.216"
HS_RADSECRET=<radius secret>
HS_UAMSECRET=<uam secret>
HS_UAMALIASNAME=chilli
HS_UAMSERVER=<uam server>
HS_UAMFORMAT=https://\$HS_UAMSERVER/cgi-bin/hotspotlogin.cgi
HS_TCP_PORTS="80 443"
HS_MODE=hotspot
HS_TYPE=chillispot
HS_WWWDIR=/usr/local/etc/chilli/www
HS_WWWBIN=/usr/local/etc/chilli/wwwsh
HS_PROVIDER=Coova
HS_PROVIDER_LINK=http://www.coova.org/
HS_LOC_NAME="My HotSpot"

/usr/local/etc/chilli/local.conf:

proxylisten=195.19.214.216     # eth0 address
proxyport=1812
proxyclient=192.168.14.242    #  AP address
proxysecret=<proxy secret>



Radius configuration.
--------------------

/usr/local/etc/raddb/clients.conf:

# chilli hotspot
client 195.19.214.216 {
        secret      = <chilli secret>
        shortname   = Chilli
        nastype     = other
}

/usr/local/etc/raddb/users:

oreshkin Cleartext-Password := "client password", Calling-Station-Id ==
"00-16-EA-8A-DE-38"

When a client is trying to authenticate through chilli I see on chilli
server in /var/log/messages:

chilli.c: 3274: New DHCP request from MAC=00-16-EA-8A-DE-38
radius.c: 1703: Authenticator does not match request!
radius.c: 337: No such id in radius queue: id=12!
radius.c: 1698: Matching request was not found in queue: 12!
radius.c: 337: No such id in radius queue: id=12!
....

What do these messages mean ?

On radius server in /usr/local/var/log/radius/radius.log I see

 Auth: Login OK: [csd-notebook\\oreshkin] (from client Chilli port 15 cli
00-16-EA-8A-DE-38 via TLS tunnel)
Auth: Login OK: [csd-notebook\\oreshkin] (from client Chilli port 15 cli
00-16-EA-8A-DE-38)


That is the radius server authenticates the client successfully however
chilli does not.

Coovachilli is taken from SVN and installed with the options:

./configure --enable-chilliproxy --with-curl


Also I've tried with additional parameter "eapolenable"  in local.conf but
with no difference.

What might be wrong ? What more parameters should I specify ?

Thanks.


From david at coova.com  Tue Apr  6 08:38:15 2010
From: david at coova.com (David Bird)
Date: Tue, 06 Apr 2010 10:38:15 +0200
Subject: [Chilli] chilli as proxy for 802.1X
In-Reply-To: <32838.195.19.214.216.1270477766.squirrel@mail.pnpi.spb.ru>
References: <32838.195.19.214.216.1270477766.squirrel@mail.pnpi.spb.ru>
Message-ID: <1270543095.18129.79.camel@david-laptop>

The chilli log suggests a bad shared secret. Of course, the auth success
doesn't. Though, you would have seen more than just one packet to
accomplish the EAP success, so the secret must be correct (and working).
Run chilli and FreeRADIUS in debug mode for additional debugging. 


On Mon, 2010-04-05 at 18:29 +0400, Anatoly Oreshkin wrote:
> Hello,
> 
> I would like to use chilli as proxy between Access Point (AP) and
> Radius server.
> AP (not CoovaAP) is configured for WPA2/AES security with
> 802.1X/EAP/PEAP/MSCHAPv2
> authentication. Chilli address is specified as radius server in AP.
> 
> Coovachilli is configured as follows.
> 
> /usr/local/etc/chilli/config have the lines:
> 
> HS_WANIF=eth0     # has 195.19.214.216 address
> HS_LANIF=eth1
> HS_NETWORK=10.2.3.0
> HS_NETMASK=255.255.255.0
> HS_UAMLISTEN=10.2.3.1
> HS_UAMPORT=3990
> HS_UAMUIPORT=4990
> HS_DNS_DOMAIN=<my domain>
> HS_DNS1=ipaddress1
> HS_DNS2=ipaddress2
> HS_RADIUS=<radius server address>
> HS_RADIUS2=<radius server address>
> HS_UAMALLOW="10.2.3.1/24,195.19.214.216"
> HS_RADSECRET=<radius secret>
> HS_UAMSECRET=<uam secret>
> HS_UAMALIASNAME=chilli
> HS_UAMSERVER=<uam server>
> HS_UAMFORMAT=https://\$HS_UAMSERVER/cgi-bin/hotspotlogin.cgi
> HS_TCP_PORTS="80 443"
> HS_MODE=hotspot
> HS_TYPE=chillispot
> HS_WWWDIR=/usr/local/etc/chilli/www
> HS_WWWBIN=/usr/local/etc/chilli/wwwsh
> HS_PROVIDER=Coova
> HS_PROVIDER_LINK=http://www.coova.org/
> HS_LOC_NAME="My HotSpot"
> 
> /usr/local/etc/chilli/local.conf:
> 
> proxylisten=195.19.214.216     # eth0 address
> proxyport=1812
> proxyclient=192.168.14.242    #  AP address
> proxysecret=<proxy secret>
> 
> 
> 
> Radius configuration.
> --------------------
> 
> /usr/local/etc/raddb/clients.conf:
> 
> # chilli hotspot
> client 195.19.214.216 {
>         secret      = <chilli secret>
>         shortname   = Chilli
>         nastype     = other
> }
> 
> /usr/local/etc/raddb/users:
> 
> oreshkin Cleartext-Password := "client password", Calling-Station-Id ==
> "00-16-EA-8A-DE-38"
> 
> When a client is trying to authenticate through chilli I see on chilli
> server in /var/log/messages:
> 
> chilli.c: 3274: New DHCP request from MAC=00-16-EA-8A-DE-38
> radius.c: 1703: Authenticator does not match request!
> radius.c: 337: No such id in radius queue: id=12!
> radius.c: 1698: Matching request was not found in queue: 12!
> radius.c: 337: No such id in radius queue: id=12!
> ....
> 
> What do these messages mean ?
> 
> On radius server in /usr/local/var/log/radius/radius.log I see
> 
>  Auth: Login OK: [csd-notebook\\oreshkin] (from client Chilli port 15 cli
> 00-16-EA-8A-DE-38 via TLS tunnel)
> Auth: Login OK: [csd-notebook\\oreshkin] (from client Chilli port 15 cli
> 00-16-EA-8A-DE-38)
> 
> 
> That is the radius server authenticates the client successfully however
> chilli does not.
> 
> Coovachilli is taken from SVN and installed with the options:
> 
> ./configure --enable-chilliproxy --with-curl
> 
> 
> Also I've tried with additional parameter "eapolenable"  in local.conf but
> with no difference.
> 
> What might be wrong ? What more parameters should I specify ?
> 
> Thanks.
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From antoine.benoist at univ-lehavre.fr  Tue Apr  6 08:43:38 2010
From: antoine.benoist at univ-lehavre.fr (Antoine Benoist)
Date: Tue, 06 Apr 2010 10:43:38 +0200
Subject: [Chilli] Dynamic VLAN Assignement
In-Reply-To: <1270272213.18129.56.camel@david-laptop>
References: <4BB48F08.8010705@univ-lehavre.fr>
	<1270272213.18129.56.camel@david-laptop>
Message-ID: <4BBAF43A.9080908@univ-lehavre.fr>

Hi,
In fact, we don't want to install new software on final users's PC.
So, what we ask is impossible?


David Bird wrote:
> Hi,
> 
> Sounds like 802.1x would be a better solution for this. But, I think it
> _might_ be possible. It has been recommended that chilli could have
> clients change their IP with a DHCP Nak to start the client
> reconfiguring. Though, I suspect it would be somewhat client device
> (operating system) dependent...
> 
> David
> 
> 
> On Thu, 2010-04-01 at 14:18 +0200, Antoine Benoist wrote:
>> Hello,
>> I'm on a project and I have to install a captive portal. Let me explains 
>> what we want :
>>
>> A client connects on a switch via Ethernet, the PC receives a IP, and 
>> when the user ask for a webpage, he's redirected to the login page of 
>> the captive portal. He enters his login, and the captive portal checks 
>> on a RADIUS if the user is authorised. The RADIUS send back the 
>> authorisation and the VLAN in which the user is in. The captive portal 
>> accepts the user, the PC change the VLAN and receives a new IP.
>>
>> IMHO, after lots of researches, I'm pretty sure that's impossible. But I 
>> would like to have some experts advices.
>>
>> Thank you for you Help
>>
>>
> 
> 

-- 
Antoine BENOIST -  CRI/P?le Syst?me et R?seau  -  +33 (0)2 32 74 42 94
Universit? du Havre - 25 rue Philippe Lebon  - 76600 LE HAVRE
_______________________________________________________________________

_/_/_/  _/_/    _/      Centre de Ressources Informatiques
_/      _/  _/  _/      Secretariat: +33 (0)2 32 74 42 76
_/      _/_/    _/      Telecopie: +33 (0)2 35 21 49 59
_/      _/  _/  _/      mailto: antoine.benoist at univ-lehavre.fr
_/_/_/  _/  _/  _/      https://cri.univ-lehavre.fr

From felipe.wiel at hpp.org.br  Tue Apr  6 15:42:45 2010
From: felipe.wiel at hpp.org.br (Felipe Augusto van de Wiel)
Date: Tue, 06 Apr 2010 12:42:45 -0300
Subject: [Chilli] MAC blacklist and other security measures
In-Reply-To: <1269152189.4135.167.camel@david-laptop>
References: <4BA25D15.8030400@hpp.org.br>
	<1269152189.4135.167.camel@david-laptop>
Message-ID: <4BBB5675.6090504@hpp.org.br>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Hi,

	Although it seems that I finally could make
the below configuration to work, I would like to
confirm if the solution is correct (or properly
implemented). I would also like to report a possible
bug related to this setup.

	I'm also writing to document it on the list
archive as reference for people trying to get the
blacklist of MAC addresses working while still
allowing users to authenticate thru the captive
portal.


On 21-03-2010 03:16, David Bird wrote:
> Hm.. one way might be to enable MAC authentication
> such that:

	That means enable 'macauth', right?  Using
only 'macauthdeny' didn't result in the expected
behavior.


> - You always return Access-Accept (plus attribute
>   Chillispot-Config = 'splash') for non-blocked
>   users.

> - You can return an Access-Reject for blocked users.
>   When used with --macauthdeny, it means these
>   devices will be ignored.

	The proper way to achieve that would be to
use a DEFAULT user in RADIUS? Here is the relevant
part of my FreeRADIUS' users file:

<...>
| AA-BB-CC-DD-EE-FF  Auth-Type := Reject
|                    Reply-Message = "MAC address administratively blocked."
|
| 11-22-33-44-55-66  Auth-Type := Reject
|                    Reply-Message = "MAC address administratively blocked."
|
| DEFAULT            Auth-Type := Accept
|                    Chillispot-config = 'splash',
|                    Fall-Through = Yes
|
| "user"             Cleartext-Password := "pass"
|                    Reply-Message = "Hello, %{User-Name}"
<...>


	Of course, that only worked after I added an
include line inside /etc/freeradius/dictionary:

$INCLUDE        /etc/freeradius/dictionary.chillispot


	Now, the MAC addresses listed on the users
file gets a 'drop' state when chilli starts, the rest
gets a 'splash' state and addresses in the ethers file
stays as 'dnat'. Once the user authenticates thru the
splash screen they change to 'pass' as expected.

	There is one interesting side effect that
smells like a bug. Once I started using the
Chillispot-config = 'splash' the contents of my
local.conf file is replaced with 'splash' and Coova
complains that there is no option '--splash':

Starting chilli: coova-chilli: unrecognized option `--splash'
coova-chilli[7358]: options.c: 174: could not generate
  configuration (/tmp/chilli-7358/config.bin), sleeping
  one second
coova-chilli: unrecognized option `--splash'


	The dirty hack I used is 'chattr +i local.conf'.
I tried to figure out something from the functions or
shell scripts but I couldn't spot where it replaces
the contents of local.conf. For now, it solved the
problem, but it isn't supposed to do that, or am I
missing something?

	So, I hope this helps others. :)

Kind regards,
- -- 
Felipe Augusto van de Wiel <felipe.wiel at hpp.org.br>
Tecnologia da Informa??o (TI) - Complexo Pequeno Pr?ncipe
http://www.pequenoprincipe.org.br/    T: +55 41 3310 1747
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQIcBAEBCgAGBQJLu1ZyAAoJECCPPxLgxLxPyLMP+gM7u6DJWZzZ89F0WaFhmKAB
BxnLklJv2jsKvgFCH/AVlEhK3j1q9BaGJkZJnizC90PkgwKzz065iu7x+9v1zvN4
xyfrUoRIbyO+4iUuDbP+bmg3j9WGnsKrvouKZDvXb+sBd5LB/prWHlVdOUi22XwP
y56RibxFkNqg08rQfZAHFiUKOAWQEXSVmAkc7ung9U2K1AxWyvuW9nDAcWGylD0h
4+8lOzU8ghlDfGR+5KKStdyIU1Qmsq4boe5qNknAlB1elUlk/8ohLQAulPhaROI4
UPCPUZ4kzuP1YrYbCcyRC35A6UvTGo62pFiayJH7rD0pun8ueEljIRLARNW5n3j9
Z2uZ3uDu08vVks7Pt9F2Yi53K3zFlKq9xxp+j8wTiefOwrnShnfbe5+v/ZnIu41Q
Qs45z8DnhrhOPIwBCUZCQTxUwHFQn0Y81nNlVEI+9oNGjlsZ6g3w5r52hh7cErxd
tXpg+ZidB2IZBQonhC3QvQCtzO+Z418erSlfcnP1Dw2b7nCud5AycvbIQvfKnKC8
VCnBnbHRvW+SdNq3SLRJW0ZMpOULRbLu+VpeYGfKo98EH/ceWpwbyMlmxtwvfrKk
EI18niSHbhbG9UuLm7BhIVQcTYpBnTmH680LIGwIAVHgoV/QtddaEZOWDE+x1rZ0
Qr/CPJBG4RVQapvqAKx4
=8VQ7
-----END PGP SIGNATURE-----

From david at coova.com  Wed Apr  7 05:10:50 2010
From: david at coova.com (David Bird)
Date: Wed, 07 Apr 2010 07:10:50 +0200
Subject: [Chilli] kmod-coova
Message-ID: <1270617050.18129.899.camel@david-laptop>

Hi,

Been working on a concept for a kernel module for CoovaChilli. With the
subversion code, configure with "--with-nfcoova" to have the module
built. With the support built in, and the xt_coova module loaded, the
idea is that authenticated traffic goes straight through the kernel and
unauthorized traffic still goes through chilli user-space - enforcing
captive portal and doing the walled garden, etc. xt_coova (which borrows
from the 'recent' module) does a simple allow/drop decision based on
authentication status. Some specific configurations are needed for this
to work. 

The iptables rules might look like this:

iptables -I FORWARD -o eth0 --src 10.0.0.0/8 \
  -m coova --name chilli -j ACCEPT
iptables -I FORWARD -i eth0 --dst 10.0.0.0/8 \
  -m coova --name chilli --dest -j ACCEPT

iptables -I FORWARD --src 11.0.0.0/8 -j ACCEPT
iptables -I FORWARD --dst 11.0.0.0/8 -j ACCEPT

(where the assumption is that the default FORWARD rule is to DENY). The
idea is that traffic to/from eth0 (WAN) from source 10.0.0.0/8 (the
chilli DHCP IP space) is either allowed or dropped by the xt_coova
module based on authentication status. The 11.0.0.0/8 network, in this
example, is the network chilli has configured for it's uamlisten. 

I should mention that when using the kernel module, I have it setup such
that the dhcpif (eth1) is actually configured with IP address 10.1.0.1
and the same IP is configured in chilli as the 'dhcplisten' (note that
typically chilli doesn't want the dhcpif interface configured with an
IP). Chilli is then also configured with 'uamlisten' of 11.0.0.1 and
this is the IP address that gets assigned to tun0 (so note that
dhcplisten and uamlisten are different!). The high level concept is that
subscribers get a 10.1.0.0/24 IP address which is routed (when
authenticated) through the kernel. Chilli still monitors all traffic on
the dhcpif and when users are not authorized yet (i.e. their 10.1.0.0/24
address is not being forwarded), then chilli does the routing (after
doing a NAT translation from 10.1.0.0/24 to 11.1.0.0/24). 

Thus, chilli basically is only routing unauthorized traffic while
authorized traffic goes straight through the kernel. With some testing
on open-mesh routers, we have seen this can drastically increase
throughput for authenticated users.

With the iptables rules above, here is an example chilli.conf that I
have been using:

cat<<EOF>/tmp/chilli.conf
net 10.1.0.0/16
dynip 10.1.0.0/24
statip 10.1.1.0/24

uamlisten 11.1.0.1 
dhcplisten 10.1.0.1 
dhcpstart 10
uamaliasname chilli
ipup=
ipdown= 

radiusserver1 localhost
radiussecret testing123
dhcpif eth0
dns1 192.168.1.1
uamdomain coova.org
uamserver http://portal/hotspot
uamsecret uamsecret
cmdsock /var/run/chilli.sock
kname chilli
EOF

Give it a try if interested in testing! 

David



From mctiew at yahoo.com  Wed Apr  7 06:25:33 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Tue, 6 Apr 2010 23:25:33 -0700 (PDT)
Subject: [Chilli] kmod-coova
In-Reply-To: <1270617050.18129.899.camel@david-laptop>
Message-ID: <501316.23329.qm@web31507.mail.mud.yahoo.com>



--- On Wed, 4/7/10, David Bird <david at coova.com> wrote:

> From: David Bird <david at coova.com>
> Subject: [Chilli] kmod-coova
> To: chilli at coova.org
> Date: Wednesday, April 7, 2010, 5:10 AM
> Hi,
> 
> Been working on a concept for a kernel module for
> CoovaChilli. With the
> subversion code, configure with "--with-nfcoova" to have
> the module
> built. With the support built in, and the xt_coova module
> loaded, the
> idea is that authenticated traffic goes straight through
> the kernel and
> unauthorized traffic still goes through chilli user-space -
> enforcing
> captive portal and doing the walled garden, etc. xt_coova
> (which borrows
> from the 'recent' module) does a simple allow/drop decision
> based on
> authentication status. Some specific configurations are
> needed for this
> to work. 
> 

What would be the implication of this change with respect to rate limit ?
Will per-user chilli attributes ( eg WISPr-Bandwidth-Max-Down ) continues to work in user mode ?

Will it make "group rate limit" ( verses per-user rate limit ) easier to implement ?  

Rgds.


      

From oguzhank at bilkent.edu.tr  Wed Apr  7 07:40:01 2010
From: oguzhank at bilkent.edu.tr (Oguzhan Kayhan)
Date: Wed, 7 Apr 2010 10:40:01 +0300
Subject: [Chilli] kmod-coova
In-Reply-To: <1270617050.18129.899.camel@david-laptop>
References: <1270617050.18129.899.camel@david-laptop>
Message-ID: <201004071040.01560.oguzhank@bilkent.edu.tr>

It might create a great improvement in performance for sure,
But what about the users that doesnt us NAT in their network.
For ex, with me, i got no NAT  all my users gets real ip.
So does it work with me too?

On Wednesday 07 April 2010 08:10:50 am David Bird wrote:
> Hi,
> 
> Been working on a concept for a kernel module for CoovaChilli. With the
> subversion code, configure with "--with-nfcoova" to have the module
> built. With the support built in, and the xt_coova module loaded, the
> idea is that authenticated traffic goes straight through the kernel and
> unauthorized traffic still goes through chilli user-space - enforcing
> captive portal and doing the walled garden, etc. xt_coova (which borrows
> from the 'recent' module) does a simple allow/drop decision based on
> authentication status. Some specific configurations are needed for this
> to work.
> 
> The iptables rules might look like this:
> 
> iptables -I FORWARD -o eth0 --src 10.0.0.0/8 \
>   -m coova --name chilli -j ACCEPT
> iptables -I FORWARD -i eth0 --dst 10.0.0.0/8 \
>   -m coova --name chilli --dest -j ACCEPT
> 
> iptables -I FORWARD --src 11.0.0.0/8 -j ACCEPT
> iptables -I FORWARD --dst 11.0.0.0/8 -j ACCEPT
> 
> (where the assumption is that the default FORWARD rule is to DENY). The
> idea is that traffic to/from eth0 (WAN) from source 10.0.0.0/8 (the
> chilli DHCP IP space) is either allowed or dropped by the xt_coova
> module based on authentication status. The 11.0.0.0/8 network, in this
> example, is the network chilli has configured for it's uamlisten.
> 
> I should mention that when using the kernel module, I have it setup such
> that the dhcpif (eth1) is actually configured with IP address 10.1.0.1
> and the same IP is configured in chilli as the 'dhcplisten' (note that
> typically chilli doesn't want the dhcpif interface configured with an
> IP). Chilli is then also configured with 'uamlisten' of 11.0.0.1 and
> this is the IP address that gets assigned to tun0 (so note that
> dhcplisten and uamlisten are different!). The high level concept is that
> subscribers get a 10.1.0.0/24 IP address which is routed (when
> authenticated) through the kernel. Chilli still monitors all traffic on
> the dhcpif and when users are not authorized yet (i.e. their 10.1.0.0/24
> address is not being forwarded), then chilli does the routing (after
> doing a NAT translation from 10.1.0.0/24 to 11.1.0.0/24).
> 
> Thus, chilli basically is only routing unauthorized traffic while
> authorized traffic goes straight through the kernel. With some testing
> on open-mesh routers, we have seen this can drastically increase
> throughput for authenticated users.
> 
> With the iptables rules above, here is an example chilli.conf that I
> have been using:
> 
> cat<<EOF>/tmp/chilli.conf
> net 10.1.0.0/16
> dynip 10.1.0.0/24
> statip 10.1.1.0/24
> 
> uamlisten 11.1.0.1
> dhcplisten 10.1.0.1
> dhcpstart 10
> uamaliasname chilli
> ipup=
> ipdown=
> 
> radiusserver1 localhost
> radiussecret testing123
> dhcpif eth0
> dns1 192.168.1.1
> uamdomain coova.org
> uamserver http://portal/hotspot
> uamsecret uamsecret
> cmdsock /var/run/chilli.sock
> kname chilli
> EOF
> 
> Give it a try if interested in testing!
> 
> David
> 
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> 

From david at coova.com  Wed Apr  7 08:14:26 2010
From: david at coova.com (David Bird)
Date: Wed, 07 Apr 2010 10:14:26 +0200
Subject: [Chilli] kmod-coova
In-Reply-To: <201004071040.01560.oguzhank@bilkent.edu.tr>
References: <1270617050.18129.899.camel@david-laptop>
	<201004071040.01560.oguzhank@bilkent.edu.tr>
Message-ID: <1270628066.18129.910.camel@david-laptop>

Yes, there would be an issue. Chilli does a little "trick" with it's
additional NAT'ing for unauthenticated traffic. The "dhcplisten" and
"uamlisten" IP addresses are made to be separate networks. The
dhcplisten IP is the actual IP of the dhcpif and clients get addresses
in that same network. Before authentication, all their traffic (via
FORWARD) is dropped, but chilli is listening and sending the packets
(NAT'ed one-to-one to the uamlisten network, i.e. 10.1.0.10 <->
11.1.0.10) and packets are forwarded that way (this is necessary such
that chilli can get the return packets via tun0/11.1.0.10). You would
have the issue (without using MASQUERADING) that clients would have a
different IP on the WAN side before and after authentication. 

On Wed, 2010-04-07 at 10:40 +0300, Oguzhan Kayhan wrote:
> It might create a great improvement in performance for sure,
> But what about the users that doesnt us NAT in their network.
> For ex, with me, i got no NAT  all my users gets real ip.
> So does it work with me too?
> 
> On Wednesday 07 April 2010 08:10:50 am David Bird wrote:
> > Hi,
> > 
> > Been working on a concept for a kernel module for CoovaChilli. With the
> > subversion code, configure with "--with-nfcoova" to have the module
> > built. With the support built in, and the xt_coova module loaded, the
> > idea is that authenticated traffic goes straight through the kernel and
> > unauthorized traffic still goes through chilli user-space - enforcing
> > captive portal and doing the walled garden, etc. xt_coova (which borrows
> > from the 'recent' module) does a simple allow/drop decision based on
> > authentication status. Some specific configurations are needed for this
> > to work.
> > 
> > The iptables rules might look like this:
> > 
> > iptables -I FORWARD -o eth0 --src 10.0.0.0/8 \
> >   -m coova --name chilli -j ACCEPT
> > iptables -I FORWARD -i eth0 --dst 10.0.0.0/8 \
> >   -m coova --name chilli --dest -j ACCEPT
> > 
> > iptables -I FORWARD --src 11.0.0.0/8 -j ACCEPT
> > iptables -I FORWARD --dst 11.0.0.0/8 -j ACCEPT
> > 
> > (where the assumption is that the default FORWARD rule is to DENY). The
> > idea is that traffic to/from eth0 (WAN) from source 10.0.0.0/8 (the
> > chilli DHCP IP space) is either allowed or dropped by the xt_coova
> > module based on authentication status. The 11.0.0.0/8 network, in this
> > example, is the network chilli has configured for it's uamlisten.
> > 
> > I should mention that when using the kernel module, I have it setup such
> > that the dhcpif (eth1) is actually configured with IP address 10.1.0.1
> > and the same IP is configured in chilli as the 'dhcplisten' (note that
> > typically chilli doesn't want the dhcpif interface configured with an
> > IP). Chilli is then also configured with 'uamlisten' of 11.0.0.1 and
> > this is the IP address that gets assigned to tun0 (so note that
> > dhcplisten and uamlisten are different!). The high level concept is that
> > subscribers get a 10.1.0.0/24 IP address which is routed (when
> > authenticated) through the kernel. Chilli still monitors all traffic on
> > the dhcpif and when users are not authorized yet (i.e. their 10.1.0.0/24
> > address is not being forwarded), then chilli does the routing (after
> > doing a NAT translation from 10.1.0.0/24 to 11.1.0.0/24).
> > 
> > Thus, chilli basically is only routing unauthorized traffic while
> > authorized traffic goes straight through the kernel. With some testing
> > on open-mesh routers, we have seen this can drastically increase
> > throughput for authenticated users.
> > 
> > With the iptables rules above, here is an example chilli.conf that I
> > have been using:
> > 
> > cat<<EOF>/tmp/chilli.conf
> > net 10.1.0.0/16
> > dynip 10.1.0.0/24
> > statip 10.1.1.0/24
> > 
> > uamlisten 11.1.0.1
> > dhcplisten 10.1.0.1
> > dhcpstart 10
> > uamaliasname chilli
> > ipup=
> > ipdown=
> > 
> > radiusserver1 localhost
> > radiussecret testing123
> > dhcpif eth0
> > dns1 192.168.1.1
> > uamdomain coova.org
> > uamserver http://portal/hotspot
> > uamsecret uamsecret
> > cmdsock /var/run/chilli.sock
> > kname chilli
> > EOF
> > 
> > Give it a try if interested in testing!
> > 
> > David
> > 
> > 
> > _______________________________________________
> > Chilli mailing list
> > Chilli at coova.org
> > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> > 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From wichert at wiggy.net  Wed Apr  7 08:19:10 2010
From: wichert at wiggy.net (Wichert Akkerman)
Date: Wed, 07 Apr 2010 10:19:10 +0200
Subject: [Chilli] kmod-coova
In-Reply-To: <501316.23329.qm@web31507.mail.mud.yahoo.com>
References: <501316.23329.qm@web31507.mail.mud.yahoo.com>
Message-ID: <4BBC3FFE.3000902@wiggy.net>

On 4/7/10 08:25 , Ming-Ching Tiew wrote:
>
>
> --- On Wed, 4/7/10, David Bird<david at coova.com>  wrote:
>
>> From: David Bird<david at coova.com>
>> Subject: [Chilli] kmod-coova
>> To: chilli at coova.org
>> Date: Wednesday, April 7, 2010, 5:10 AM
>> Hi,
>>
>> Been working on a concept for a kernel module for
>> CoovaChilli. With the
>> subversion code, configure with "--with-nfcoova" to have
>> the module
>> built. With the support built in, and the xt_coova module
>> loaded, the
>> idea is that authenticated traffic goes straight through
>> the kernel and
>> unauthorized traffic still goes through chilli user-space -
>> enforcing
>> captive portal and doing the walled garden, etc. xt_coova
>> (which borrows
>> from the 'recent' module) does a simple allow/drop decision
>> based on
>> authentication status. Some specific configurations are
>> needed for this
>> to work.
>>
>
> What would be the implication of this change with respect to rate limit ?
> Will per-user chilli attributes ( eg WISPr-Bandwidth-Max-Down ) continues to work in user mode ?
>
> Will it make "group rate limit" ( verses per-user rate limit ) easier to implement ?

Linux has extremely flexible traffic shapping logic in its network stack 
that should easily be able to do this. I'ld assume that chilli can use 
that directly instead of trying to do that itself like it does now.

Wichert.

From david at coova.com  Wed Apr  7 08:22:59 2010
From: david at coova.com (David Bird)
Date: Wed, 07 Apr 2010 10:22:59 +0200
Subject: [Chilli] kmod-coova
In-Reply-To: <501316.23329.qm@web31507.mail.mud.yahoo.com>
References: <501316.23329.qm@web31507.mail.mud.yahoo.com>
Message-ID: <1270628579.18129.923.camel@david-laptop>

> > 
> 
> What would be the implication of this change with respect to rate limit ?
> Will per-user chilli attributes ( eg WISPr-Bandwidth-Max-Down ) continues to work in user mode ?
> 
> Will it make "group rate limit" ( verses per-user rate limit ) easier to implement ?  
> 

It isn't there yet, but the simplistic "leaky bucket" rate shaping of
chilli could easily be also implemented in the kernel module. Or, as
Wichert mentioned, it could tap into more sophisticated kernel features
(any examples Wichert?). This would be required as chilli does not route
packets for authenticated traffic in this scenario. Chilli sees the
packets, but just ignores them. 

Also, similar to how the 'recent' module, you can interact with the
kernel module in the /proc file system. This is also how chilli itself
updates client status and fetches up/down octets/packets for
accounting. 

David


From mctiew at yahoo.com  Wed Apr  7 08:43:56 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Wed, 7 Apr 2010 01:43:56 -0700 (PDT)
Subject: [Chilli] skip leaky bucket for certain packets
Message-ID: <612679.67059.qm@web31505.mail.mud.yahoo.com>

As mentioned in the forum, attached please find the patch for it.


      
-------------- next part --------------
A non-text attachment was scrubbed...
Name: 400-coova-chilli-1.2.2-bypass.patch
Type: text/x-diff
Size: 10402 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100407/cfbb50b6/attachment.patch>

From wichert at wiggy.net  Wed Apr  7 08:48:44 2010
From: wichert at wiggy.net (Wichert Akkerman)
Date: Wed, 07 Apr 2010 10:48:44 +0200
Subject: [Chilli] kmod-coova
In-Reply-To: <1270628579.18129.923.camel@david-laptop>
References: <501316.23329.qm@web31507.mail.mud.yahoo.com>
	<1270628579.18129.923.camel@david-laptop>
Message-ID: <4BBC46EC.6090402@wiggy.net>

On 4/7/10 10:22 , David Bird wrote:
>>>
>>
>> What would be the implication of this change with respect to rate limit ?
>> Will per-user chilli attributes ( eg WISPr-Bandwidth-Max-Down ) continues to work in user mode ?
>>
>> Will it make "group rate limit" ( verses per-user rate limit ) easier to implement ?
>>
>
> It isn't there yet, but the simplistic "leaky bucket" rate shaping of
> chilli could easily be also implemented in the kernel module. Or, as
> Wichert mentioned, it could tap into more sophisticated kernel features
> (any examples Wichert?).

I'm afraid my knowledge of the internals does not go beyond what you can 
find at http://lartc.org/. The wondershaper (see 
http://lartc.org/wondershaper/ ) is a pretty nice demo of what can be 
done with it. I suspect you can get excellent help on the netfilter 
mailinglist though.

Wichert.

From jmeiring at amobia.com  Wed Apr  7 08:56:19 2010
From: jmeiring at amobia.com (Johan Meiring)
Date: Wed, 07 Apr 2010 10:56:19 +0200
Subject: [Chilli] kmod-coova - Shaping rules
In-Reply-To: <1270628579.18129.923.camel@david-laptop>
References: <501316.23329.qm@web31507.mail.mud.yahoo.com>
	<1270628579.18129.923.camel@david-laptop>
Message-ID: <4BBC48B3.1040702@amobia.com>

David Bird wrote:
>> What would be the implication of this change with respect to rate limit ?
>> Will per-user chilli attributes ( eg WISPr-Bandwidth-Max-Down ) continues to work in user mode ?
>>
>> Will it make "group rate limit" ( verses per-user rate limit ) easier to implement ?  
>>

The HTB below could be extended to do something like this...

> 
> It isn't there yet, but the simplistic "leaky bucket" rate shaping of
> chilli could easily be also implemented in the kernel module. Or, as
> Wichert mentioned, it could tap into more sophisticated kernel features
> (any examples Wichert?). This would be required as chilli does not route
> packets for authenticated traffic in this scenario. Chilli sees the
> packets, but just ignores them. 
> 
> Also, similar to how the 'recent' module, you can interact with the
> kernel module in the /proc file system. This is also how chilli itself
> updates client status and fetches up/down octets/packets for
> accounting. 
> 

Here are some "working" examples.

You need to create a unique ID for each client.
You need the ID again when "deleting" the shaping if the client goes down.

Maybe chilli could use the last octect of the /24 ip?
(No idea what to do if bigger than /24, anyway
each client needs a unique ID)


The shaping implementation uses a HTB, with a SFQ at every leaf.

For the example the assumption is that the clients connect to tun1 and eth0 
is the upstream interface


Setup the "base" when chilli starts as follows:
------------------------------------------------
#!/bin/sh

# Delete any old shaping
tc qdisc del dev eth0 root
tc qdisc del dev tun1 root

# Set interface to use htb and send unclassified traffic to class 1:10
tc qdisc add dev eth0 root handle 1: htb default 10 r2q 5
tc qdisc add dev tun1 root handle 1: htb default 10 r2q 5

# Default class - No speed limit (100mbit)
tc class add dev eth0 parent 1: classid 1:10 htb \
   rate 100000kbit ceil 100000kbit
tc class add dev tun1 parent 1: classid 1:10 htb \
   rate 100000kbit ceil 100000kbit

# New qdisc for better traffic below default class
tc qdisc add dev eth0 parent 1:10 handle 10: sfq perturb 10
tc qdisc add dev tun1 parent 1:10 handle 10: sfq perturb 10


Run this for each client that connects:
---------------------------------------
#!/bin/sh

# $(id) = unique client identifier (minimum 2)
# $(ip) = client ip address
# $(speedup) = client upload speed in bits/s
# $(speeddown) = client download speed in bits/s

# Classes
tc class add dev eth0 parent 1: classid 1:$(id)0 htb \
   rate $(speedup)bit ceil $(speedup)bit
tc class add dev tun1 parent 1: classid 1:$(id)0 htb \
   rate $(speeddown)bit ceil $(speeddown)bit

# Qdiscs
tc qdisc add dev eth0 parent 1:$(id)0 handle $(id)0: sfq perturb 10
tc qdisc add dev tun1 parent 1:$(id)0 handle $(id)0: sfq perturb 10

# Filters (can be repeated if client has more routes)
tc filter add dev eth0 protocol ip parent 1:0 \
   prio $(id)0 u32 match ip src $(ip)/32 flowid 1:$(id)0
tc filter add dev tun1 protocol ip parent 1:0 \
   prio $(id)0 u32 match ip dst $(ip)/32 flowid 1:$(id)0


Run this for each client that disconnects:
------------------------------------------
#!/bin/sh

# $(id) = unique client identifier

# Filters (Does not need to be repeated for more routes)
tc filter del dev eth0 protocol ip parent 1:0 prio $(id)0
tc filter del dev tun1 protocol ip parent 1:0 prio $(id)0

# Qdiscs
tc qdisc del dev eth0 parent 1:$(id)0 handle $(id)0:
tc qdisc del dev tun1 parent 1:$(id)0 handle $(id)0:

# Classes
tc class del dev eth0 parent 1: classid 1:$(id)0
tc class del dev tun1 parent 1: classid 1:$(id)0



In the examples above a client with in $(id) if 1 gets a handle of 10.

e.g.

Client id     = 2
Speed up/down = 1MBit/s

# Classes
tc class add dev eth0 parent 1: classid 1:20 htb \
   rate 1000000bit ceil 1000000bit


Cheers,

-- 


Johan Meiring
Amobia Communications
Tel: (0861) AMOBIA / (0861) 266242
Fax: (0861) AMOFAX / (0861) 266329


From david at coova.com  Wed Apr  7 10:21:24 2010
From: david at coova.com (David Bird)
Date: Wed, 07 Apr 2010 12:21:24 +0200
Subject: [Chilli] kmod-coova - Shaping rules
In-Reply-To: <4BBC48B3.1040702@amobia.com>
References: <501316.23329.qm@web31507.mail.mud.yahoo.com>
	<1270628579.18129.923.camel@david-laptop> <4BBC48B3.1040702@amobia.com>
Message-ID: <1270635684.18129.945.camel@david-laptop>

Thanks! Though, I'd be interested in the kernel code version ;) 

Assigning a unique ID isn't a problem. It's also possible, as shown,
already with the up/down scripts. 

On Wed, 2010-04-07 at 10:56 +0200, Johan Meiring wrote:
> David Bird wrote:
> >> What would be the implication of this change with respect to rate limit ?
> >> Will per-user chilli attributes ( eg WISPr-Bandwidth-Max-Down ) continues to work in user mode ?
> >>
> >> Will it make "group rate limit" ( verses per-user rate limit ) easier to implement ?  
> >>
> 
> The HTB below could be extended to do something like this...
> 
> > 
> > It isn't there yet, but the simplistic "leaky bucket" rate shaping of
> > chilli could easily be also implemented in the kernel module. Or, as
> > Wichert mentioned, it could tap into more sophisticated kernel features
> > (any examples Wichert?). This would be required as chilli does not route
> > packets for authenticated traffic in this scenario. Chilli sees the
> > packets, but just ignores them. 
> > 
> > Also, similar to how the 'recent' module, you can interact with the
> > kernel module in the /proc file system. This is also how chilli itself
> > updates client status and fetches up/down octets/packets for
> > accounting. 
> > 
> 
> Here are some "working" examples.
> 
> You need to create a unique ID for each client.
> You need the ID again when "deleting" the shaping if the client goes down.
> 
> Maybe chilli could use the last octect of the /24 ip?
> (No idea what to do if bigger than /24, anyway
> each client needs a unique ID)
> 
> 
> The shaping implementation uses a HTB, with a SFQ at every leaf.
> 
> For the example the assumption is that the clients connect to tun1 and eth0 
> is the upstream interface
> 
> 
> Setup the "base" when chilli starts as follows:
> ------------------------------------------------
> #!/bin/sh
> 
> # Delete any old shaping
> tc qdisc del dev eth0 root
> tc qdisc del dev tun1 root
> 
> # Set interface to use htb and send unclassified traffic to class 1:10
> tc qdisc add dev eth0 root handle 1: htb default 10 r2q 5
> tc qdisc add dev tun1 root handle 1: htb default 10 r2q 5
> 
> # Default class - No speed limit (100mbit)
> tc class add dev eth0 parent 1: classid 1:10 htb \
>    rate 100000kbit ceil 100000kbit
> tc class add dev tun1 parent 1: classid 1:10 htb \
>    rate 100000kbit ceil 100000kbit
> 
> # New qdisc for better traffic below default class
> tc qdisc add dev eth0 parent 1:10 handle 10: sfq perturb 10
> tc qdisc add dev tun1 parent 1:10 handle 10: sfq perturb 10
> 
> 
> Run this for each client that connects:
> ---------------------------------------
> #!/bin/sh
> 
> # $(id) = unique client identifier (minimum 2)
> # $(ip) = client ip address
> # $(speedup) = client upload speed in bits/s
> # $(speeddown) = client download speed in bits/s
> 
> # Classes
> tc class add dev eth0 parent 1: classid 1:$(id)0 htb \
>    rate $(speedup)bit ceil $(speedup)bit
> tc class add dev tun1 parent 1: classid 1:$(id)0 htb \
>    rate $(speeddown)bit ceil $(speeddown)bit
> 
> # Qdiscs
> tc qdisc add dev eth0 parent 1:$(id)0 handle $(id)0: sfq perturb 10
> tc qdisc add dev tun1 parent 1:$(id)0 handle $(id)0: sfq perturb 10
> 
> # Filters (can be repeated if client has more routes)
> tc filter add dev eth0 protocol ip parent 1:0 \
>    prio $(id)0 u32 match ip src $(ip)/32 flowid 1:$(id)0
> tc filter add dev tun1 protocol ip parent 1:0 \
>    prio $(id)0 u32 match ip dst $(ip)/32 flowid 1:$(id)0
> 
> 
> Run this for each client that disconnects:
> ------------------------------------------
> #!/bin/sh
> 
> # $(id) = unique client identifier
> 
> # Filters (Does not need to be repeated for more routes)
> tc filter del dev eth0 protocol ip parent 1:0 prio $(id)0
> tc filter del dev tun1 protocol ip parent 1:0 prio $(id)0
> 
> # Qdiscs
> tc qdisc del dev eth0 parent 1:$(id)0 handle $(id)0:
> tc qdisc del dev tun1 parent 1:$(id)0 handle $(id)0:
> 
> # Classes
> tc class del dev eth0 parent 1: classid 1:$(id)0
> tc class del dev tun1 parent 1: classid 1:$(id)0
> 
> 
> 
> In the examples above a client with in $(id) if 1 gets a handle of 10.
> 
> e.g.
> 
> Client id     = 2
> Speed up/down = 1MBit/s
> 
> # Classes
> tc class add dev eth0 parent 1: classid 1:20 htb \
>    rate 1000000bit ceil 1000000bit
> 
> 
> Cheers,
> 
> -- 
> 
> 
> Johan Meiring
> Amobia Communications
> Tel: (0861) AMOBIA / (0861) 266242
> Fax: (0861) AMOFAX / (0861) 266329
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From wichert at wiggy.net  Wed Apr  7 10:26:24 2010
From: wichert at wiggy.net (Wichert Akkerman)
Date: Wed, 07 Apr 2010 12:26:24 +0200
Subject: [Chilli] kmod-coova - Shaping rules
In-Reply-To: <1270635684.18129.945.camel@david-laptop>
References: <501316.23329.qm@web31507.mail.mud.yahoo.com>	<1270628579.18129.923.camel@david-laptop>
	<4BBC48B3.1040702@amobia.com>
	<1270635684.18129.945.camel@david-laptop>
Message-ID: <4BBC5DD0.5020503@wiggy.net>

On 4/7/10 12:21 , David Bird wrote:
> Thanks! Though, I'd be interested in the kernel code version ;)

tc communicates over netlink, you should be able to do that from the 
nfcoova module as well.

Wichert.

From jmeiring at amobia.com  Wed Apr  7 10:30:11 2010
From: jmeiring at amobia.com (Johan Meiring)
Date: Wed, 07 Apr 2010 12:30:11 +0200
Subject: [Chilli] kmod-coova - Shaping rules
In-Reply-To: <1270635684.18129.945.camel@david-laptop>
References: <501316.23329.qm@web31507.mail.mud.yahoo.com>	
	<1270628579.18129.923.camel@david-laptop>
	<4BBC48B3.1040702@amobia.com>
	<1270635684.18129.945.camel@david-laptop>
Message-ID: <4BBC5EB3.3020400@amobia.com>

David Bird wrote:
> Thanks! Though, I'd be interested in the kernel code version ;) 
> 

So whould I.
My c / tc knowledge sucks.....

-- 


Johan Meiring
Amobia Communications
Tel: (0861) AMOBIA / (0861) 266242
Fax: (0861) AMOFAX / (0861) 266329


From mctiew at yahoo.com  Wed Apr  7 10:43:40 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Wed, 7 Apr 2010 03:43:40 -0700 (PDT)
Subject: [Chilli] kmod-coova - Shaping rules
In-Reply-To: <1270635684.18129.945.camel@david-laptop>
Message-ID: <800052.19046.qm@web31506.mail.mud.yahoo.com>



--- On Wed, 4/7/10, David Bird <david at coova.com> wrote:

> Thanks! Though, I'd be interested in
> the kernel code version ;) 
> 

A two tier implementation would be nice :-

eg.
user1 - per user rate limit1 - group A
user2 - per user rate limit1 - group A
user3 - per user rate limit2 - group A
user4 - per user rate limit3 - group B
user5 - per user rate limit3 - group B
....

Group A - use to a maximum aggregated bandwidth of A
Group B - use to a maximum aggregated bandwidth of B
....
Group X - use the remaining bandwidth

:)



      

From Anatoly.Oreshkin at pnpi.spb.ru  Wed Apr  7 14:57:12 2010
From: Anatoly.Oreshkin at pnpi.spb.ru (Anatoly Oreshkin)
Date: Wed, 7 Apr 2010 18:57:12 +0400 (MSD)
Subject: [Chilli] chilli as proxy for 802.1X
In-Reply-To: <1270543095.18129.79.camel@david-laptop>
References: <32838.195.19.214.216.1270477766.squirrel@mail.pnpi.spb.ru>
	<1270543095.18129.79.camel@david-laptop>
Message-ID: <Pine.LNX.4.62.1004071855450.7183@mail.pnpi.spb.ru>


I've run chilli and radius in debug mode.

Here is chilli debug output:
---------------------------

Starting chilli: 
main-opt.c: 307: 0 (Debug) DHCP Listen: 10.2.3.1
main-opt.c: 308: 0 (Debug) UAM Listen: 10.2.3.1
...

chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
dhcp.c: 389: 0 (Debug) DHCP newconn: 00:16:ea:8a:de:38
chilli.c: 3274: 0 (Debug) New DHCP request from MAC=00-16-EA-8A-DE-38
chilli.c: 3277: 0 (Debug) New DHCP connection established
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

chilli.c: 2817: 0 (Debug) Received access challenge from radius server
chilli.c: 913: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

chilli.c: 2817: 0 (Debug) Received access challenge from radius server
chilli.c: 913: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

chilli.c: 2817: 0 (Debug) Received access challenge from radius server
chilli.c: 913: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

chilli.c: 2817: 0 (Debug) Received access challenge from radius server
chilli.c: 913: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

chilli.c: 2817: 0 (Debug) Received access challenge from radius server
chilli.c: 913: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

chilli.c: 2817: 0 (Debug) Received access challenge from radius server
chilli.c: 913: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

chilli.c: 2817: 0 (Debug) Received access challenge from radius server
chilli.c: 913: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

chilli.c: 2817: 0 (Debug) Received access challenge from radius server
chilli.c: 913: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

chilli.c: 2817: 0 (Debug) Received access challenge from radius server
chilli.c: 913: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2781: 0 (Debug) Received access request confirmation from radius server

radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1813
chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1813
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
radius.c: 1703: 0 (Debug) Authenticator does not match request!
radius.c: 337: 0 (Debug) No such id in radius queue: id=12!
radius.c: 1698: 0 (Debug) Matching request was not found in queue: 12!

chilli.c: 1946: 0 (Debug) RADIUS Access-Request received
chilli.c: 1975: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
chilli.c: 2047: 0 (Debug) Dropping RADIUS while waiting
chilli.c: 92: 0 (Debug) SIGTERM: shutdown


Radius debug is very big so I provide  only extract from radius log:
--------------------------------------------------------------------


rad_recv: Access-Request packet from host 195.19.214.216 port 34666, id=1, length=176
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         User-Name = "csd-notebook\\oreshkin"
         EAP-Message = 0x0200001a016373642d6e6f7465626f6f6b5c6f726573686b696e
         Calling-Station-Id = "00-16-EA-8A-DE-38"
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Port-Type = Wireless-802.11
         NAS-Port = 22
         Service-Type = Login-User
         NAS-IP-Address = 10.2.3.1
         NAS-Identifier = "nas01"
         Message-Authenticator = 0xa196cb3c72607c5a911c0d818fbf849d
+- entering group authorize {...}
++[preprocess] returns ok
++[chap] returns noop
++[mschap] returns noop
[suffix] No '@' in User-Name = "csd-notebook\oreshkin", looking up realm NULL
[suffix] Found realm "DEFAULT"
[suffix] Adding Stripped-User-Name = "csd-notebook\oreshkin"
[suffix] Adding Realm = "DEFAULT"
[suffix] Authentication realm is LOCAL.
++[suffix] returns ok

...

Sending Access-Challenge of id 1 to 195.19.214.216 port 34666
         EAP-Message = 0x010100061920
         Message-Authenticator = 0x00000000000000000000000000000000
         State = 0xb4a908b4b4a811d634d2e603ef8b3686
Finished request 1.
Going to the next request
Waking up in 4.9 seconds.
rad_recv: Access-Request packet from host 195.19.214.216 port 34666, id=2, length=300
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         User-Name = "csd-notebook\\oreshkin"
         State = 0xb4a908b4b4a811d634d2e603ef8b3686
         EAP-Message = 
0x0201008419800000007a16030100750100007103014bbc8ca76a6a0af22c248b376d914e3b1bd333d1d667531662313ed
82eddda12000018002f00350005000ac009c00ac013c0140032003800130004010000300000001a00180000156373642d6e6f7465626f6f6b5c6f7265
73686b696e000a00080006001700180019000b00020100
         Calling-Station-Id = "00-16-EA-8A-DE-38"
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Port-Type = Wireless-802.11
         NAS-Port = 22
         Service-Type = Login-User
         NAS-IP-Address = 10.2.3.1
         NAS-Identifier = "nas01"
         Message-Authenticator = 0x5c5c2b874fa4a310fba8a70cf5ca495b
+- entering group authorize {...}

...

eap] Request found, released from the list
[eap] EAP/peap
[eap] processing type peap
[peap] processing EAP-TLS
   TLS Length 122
[peap] Length Included
[peap] eaptls_verify returned 11 
[peap]     (other): before/accept initialization 
[peap]     TLS_accept: before/accept initialization 
[peap] <<< TLS 1.0 Handshake [length 0075], ClientHello 
[peap]     TLS_accept: SSLv3 read client hello A 
[peap] >>> TLS 1.0 Handshake [length 002a], ServerHello 
[peap]     TLS_accept: SSLv3 write server hello A 
[peap] >>> TLS 1.0 Handshake [length 084e], Certificate 
[peap]     TLS_accept: SSLv3 write certificate A 
[peap] >>> TLS 1.0 Handshake [length 0004], ServerHelloDone 
[peap]     TLS_accept: SSLv3 write server done A 
[peap]     TLS_accept: SSLv3 flush data 
[peap]     TLS_accept: Need to read more data: SSLv3 read client certificate A
In SSL Handshake Phase 
In SSL Accept mode 
[peap] eaptls_process returned 13

Sending Access-Challenge of id 2 to 195.19.214.216 port 34666
         EAP-Message = 0x0102040019c00000088b160301002a02
....

rad_recv: Access-Request packet from host 195.19.214.216 port 34666, id=3, length=174
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         User-Name = "csd-notebook\\oreshkin"
         State = 0xb4a908b4b5ab11d634d2e603ef8b3686
         EAP-Message = 0x020200061900
         Calling-Station-Id = "00-16-EA-8A-DE-38"
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Port-Type = Wireless-802.11
         NAS-Port = 22
         Service-Type = Login-User
         NAS-IP-Address = 10.2.3.1
         NAS-Identifier = "nas01"
         Message-Authenticator = 0x2134d380e3d668d43346116f694eaa5a
+- entering group authorize {...}
++[preprocess] returns ok

...

Sending Access-Challenge of id 3 to 195.19.214.216 port 34666
         EAP-Message = 0x010303fc194000300d06092a864886f70d

...

rad_recv: Access-Request packet from host 195.19.214.216 port 34666, id=4, length=174
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         User-Name = "csd-notebook\\oreshkin"
         State = 0xb4a908b4b6aa11d634d2e603ef8b3686
         EAP-Message = 0x020300061900
         Calling-Station-Id = "00-16-EA-8A-DE-38"
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Port-Type = Wireless-802.11
         NAS-Port = 22
         Service-Type = Login-User
         NAS-IP-Address = 10.2.3.1
         NAS-Identifier = "nas01"
         Message-Authenticator = 0x0ba6de3feb6774afb1682c78ee26b3f5
+- entering group authorize {...}
++[preprocess] returns ok

...


Sending Access-Challenge of id 5 to 195.19.214.216 port 34666
         EAP-Message = 0x010500411900140301000101160301
...

Login OK: [csd-notebook\\oreshkin] (from client Chilli port 22 cli 00-16-EA-8A-DE-38 via TLS 
tunnel)
} # server inner-tunnel
[peap] Got tunneled reply code 2
         EAP-Message = 0x03080004
         Message-Authenticator = 0x00000000000000000000000000000000
         User-Name = "oreshkin"
[peap] Got tunneled reply RADIUS code 2
         EAP-Message = 0x03080004
         Message-Authenticator = 0x00000000000000000000000000000000
         User-Name = "oreshkin"
[peap] Tunneled authentication was successful.
[peap] SUCCESS
++[eap] returns handled
Sending Access-Challenge of id 9 to 195.19.214.216 port 34666
         EAP-Message = 
0x0109002b190017030100207a551685a86341f23608b1e782e24ba9952823075fe750bc7cd4a3a630d78b3a
         Message-Authenticator = 0x00000000000000000000000000000000
         State = 0xb4a908b4bca011d634d2e603ef8b3686
Finished request 9.

...

Sending Access-Accept of id 10 to 195.19.214.216 port 34666
         MS-MPPE-Recv-Key = 0x74131f24dd18434ebc00b17e4de36927023adb596def04cf80f05b8639ef7bfc
         MS-MPPE-Send-Key = 0x292842662ebec27e20e94036aba5d3526e1bb29eb016fa290734e4df500349e1
         EAP-Message = 0x03090004
         Message-Authenticator = 0x00000000000000000000000000000000
         User-Name = "csd-notebook\\oreshkin"
Finished request 10.

...

rad_recv: Accounting-Request packet from host 195.19.214.216 port 34666, id=11, length=230
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         Vendor-14559-Attr-10 = 0x00000002
         Acct-Status-Type = Start
         User-Name = "csd-notebook\\oreshkin"
         Calling-Station-Id = "00-16-EA-8A-DE-38"
         NAS-Port-Type = Wireless-802.11
         NAS-Port = 22
         NAS-Port-Id = "00000022"
         Framed-IP-Address = 10.2.3.11
         Acct-Session-Id = "4bbc8ca200000016"
         NAS-IP-Address = 10.2.3.1
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Identifier = "nas01"
         WISPr-Location-ID = "isocc=,cc=,ac=,network=Coova,"
         WISPr-Location-Name = "My_HotSpot"
+- entering group preacct {...}
++[preprocess] returns ok

[acct_unique] Hashing 'NAS-Port = 22,Client-IP-Address = 195.19.214.216,NAS-IP-Address = 
10.2.3.1,Acct-Session-Id = "4bbc
8ca200000016",User-Name = "csd-notebook\\oreshkin"'
[acct_unique] Acct-Unique-Session-ID = "7891c6f25ae215b3".
++[acct_unique] returns ok
[suffix] No '@' in User-Name = "csd-notebook\oreshkin", looking up realm NULL
[suffix] Found realm "DEFAULT"
[suffix] Adding Stripped-User-Name = "csd-notebook\oreshkin"
[suffix] Adding Realm = "DEFAULT"
[suffix] Accounting realm is LOCAL.
++[suffix] returns ok
++[files] returns noop
+- entering group accounting {...}
[detail]        expand: /usr/local/var/log/radius/radacct/%{Client-IP-Address}/detail-%Y%m%d 
-> /usr/local/var/log/radius
/radacct/195.19.214.216/detail-20100407
[detail] /usr/local/var/log/radius/radacct/%{Client-IP-Address}/detail-%Y%m%d expands to 
/usr/local/var/log/radius/radacc
t/195.19.214.216/detail-20100407
[detail]        expand: %t -> Wed Apr  7 17:46:10 2010
++[detail] returns ok
++[unix] returns ok
[radutmp]       expand: /usr/local/var/log/radius/radutmp -> /usr/local/var/log/radius/radutmp
[radutmp]       expand: %{User-Name} -> csd-notebook\oreshkin
++[radutmp] returns ok
[attr_filter.accounting_response]       expand: %{User-Name} -> csd-notebook\oreshkin

  attr_filter: Matched entry DEFAULT at line 12
++[attr_filter.accounting_response] returns updated
Sending Accounting-Response of id 11 to 195.19.214.216 port 34666
Finished request 11.
Cleaning up request 11 ID 11 with timestamp +71
Going to the next request
Waking up in 4.9 seconds.
rad_recv: Access-Request packet from host 195.19.214.216 port 34666, id=12, length=176
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         User-Name = "csd-notebook\\oreshkin"
         EAP-Message = 0x0200001a016373642d6e6f7465626f6f6b5c6f726573686b696e
         Calling-Station-Id = "00-16-EA-8A-DE-38"
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Port-Type = Wireless-802.11
         NAS-Port = 22
         Service-Type = Login-User
         NAS-IP-Address = 10.2.3.1
         NAS-Identifier = "nas01"
         Message-Authenticator = 0xa159e7391af38849331fcee9aa4d4126
+- entering group authorize {...}

...

Sending Access-Challenge of id 12 to 195.19.214.216 port 34666
         EAP-Message = 0x010100061920
         Message-Authenticator = 0x00000000000000000000000000000000
         State = 0x806bce12806ad75a757217b94df2bf0a

...

rad_recv: Accounting-Request packet from host 195.19.214.216 port 34666, id=12, length=278
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         Vendor-14559-Attr-10 = 0x00000002
         Acct-Status-Type = Stop
         User-Name = "csd-notebook\\oreshkin"
         Calling-Station-Id = "00-16-EA-8A-DE-38"
         NAS-Port-Type = Wireless-802.11
         NAS-Port = 22
         NAS-Port-Id = "00000022"
         Framed-IP-Address = 10.2.3.11
         Acct-Session-Id = "4bbc8ca200000016"
         NAS-IP-Address = 10.2.3.1
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Identifier = "nas01"
         Acct-Input-Octets = 0
         Acct-Output-Octets = 0
         Acct-Input-Gigawords = 0
         Acct-Output-Gigawords = 0
         Acct-Input-Packets = 0
         Acct-Output-Packets = 0
         Acct-Session-Time = 4
         WISPr-Location-ID = "isocc=,cc=,ac=,network=Coova,"
         WISPr-Location-Name = "My_HotSpot"
         Acct-Terminate-Cause = User-Request
...

rad_recv: Accounting-Request packet from host 195.19.214.216 port 34666, id=14, length=148
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         Vendor-14559-Attr-10 = 0x00000002
         Acct-Status-Type = Accounting-Off
         NAS-IP-Address = 10.2.3.1
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Identifier = "nas01"
         WISPr-Location-ID = "isocc=,cc=,ac=,network=Coova,"
         WISPr-Location-Name = "My_HotSpot"
         Acct-Terminate-Cause = 0
+- entering group preacct {...}
++[preprocess] returns ok

...





On Tue, 6 Apr 2010, David Bird wrote:

> Date: Tue, 06 Apr 2010 10:38:15 +0200
> From: David Bird <david at coova.com>
> To: Anatoly Oreshkin <Anatoly.Oreshkin at pnpi.spb.ru>
> Cc: chilli at coova.org
> Subject: Re: [Chilli] chilli as proxy for 802.1X
> 
> The chilli log suggests a bad shared secret. Of course, the auth success
> doesn't. Though, you would have seen more than just one packet to
> accomplish the EAP success, so the secret must be correct (and working).
> Run chilli and FreeRADIUS in debug mode for additional debugging.
>
>
> On Mon, 2010-04-05 at 18:29 +0400, Anatoly Oreshkin wrote:
>> Hello,
>>
>> I would like to use chilli as proxy between Access Point (AP) and
>> Radius server.
>> AP (not CoovaAP) is configured for WPA2/AES security with
>> 802.1X/EAP/PEAP/MSCHAPv2
>> authentication. Chilli address is specified as radius server in AP.
>>
>> Coovachilli is configured as follows.
>>
>> /usr/local/etc/chilli/config have the lines:
>>
>> HS_WANIF=eth0     # has 195.19.214.216 address
>> HS_LANIF=eth1
>> HS_NETWORK=10.2.3.0
>> HS_NETMASK=255.255.255.0
>> HS_UAMLISTEN=10.2.3.1
>> HS_UAMPORT=3990
>> HS_UAMUIPORT=4990
>> HS_DNS_DOMAIN=<my domain>
>> HS_DNS1=ipaddress1
>> HS_DNS2=ipaddress2
>> HS_RADIUS=<radius server address>
>> HS_RADIUS2=<radius server address>
>> HS_UAMALLOW="10.2.3.1/24,195.19.214.216"
>> HS_RADSECRET=<radius secret>
>> HS_UAMSECRET=<uam secret>
>> HS_UAMALIASNAME=chilli
>> HS_UAMSERVER=<uam server>
>> HS_UAMFORMAT=https://\$HS_UAMSERVER/cgi-bin/hotspotlogin.cgi
>> HS_TCP_PORTS="80 443"
>> HS_MODE=hotspot
>> HS_TYPE=chillispot
>> HS_WWWDIR=/usr/local/etc/chilli/www
>> HS_WWWBIN=/usr/local/etc/chilli/wwwsh
>> HS_PROVIDER=Coova
>> HS_PROVIDER_LINK=http://www.coova.org/
>> HS_LOC_NAME="My HotSpot"
>>
>> /usr/local/etc/chilli/local.conf:
>>
>> proxylisten=195.19.214.216     # eth0 address
>> proxyport=1812
>> proxyclient=192.168.14.242    #  AP address
>> proxysecret=<proxy secret>
>>
>>
>>
>> Radius configuration.
>> --------------------
>>
>> /usr/local/etc/raddb/clients.conf:
>>
>> # chilli hotspot
>> client 195.19.214.216 {
>>         secret      = <chilli secret>
>>         shortname   = Chilli
>>         nastype     = other
>> }
>>
>> /usr/local/etc/raddb/users:
>>
>> oreshkin Cleartext-Password := "client password", Calling-Station-Id ==
>> "00-16-EA-8A-DE-38"
>>
>> When a client is trying to authenticate through chilli I see on chilli
>> server in /var/log/messages:
>>
>> chilli.c: 3274: New DHCP request from MAC=00-16-EA-8A-DE-38
>> radius.c: 1703: Authenticator does not match request!
>> radius.c: 337: No such id in radius queue: id=12!
>> radius.c: 1698: Matching request was not found in queue: 12!
>> radius.c: 337: No such id in radius queue: id=12!
>> ....
>>
>> What do these messages mean ?
>>
>> On radius server in /usr/local/var/log/radius/radius.log I see
>>
>>  Auth: Login OK: [csd-notebook\\oreshkin] (from client Chilli port 15 cli
>> 00-16-EA-8A-DE-38 via TLS tunnel)
>> Auth: Login OK: [csd-notebook\\oreshkin] (from client Chilli port 15 cli
>> 00-16-EA-8A-DE-38)
>>
>>
>> That is the radius server authenticates the client successfully however
>> chilli does not.
>>
>> Coovachilli is taken from SVN and installed with the options:
>>
>> ./configure --enable-chilliproxy --with-curl
>>
>>
>> Also I've tried with additional parameter "eapolenable"  in local.conf but
>> with no difference.
>>
>> What might be wrong ? What more parameters should I specify ?
>>
>> Thanks.
>>
>> _______________________________________________
>> Chilli mailing list
>> Chilli at coova.org
>> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>

From d.courtaillier at gmail.com  Thu Apr  8 14:43:17 2010
From: d.courtaillier at gmail.com (Damien Courtaillier)
Date: Thu, 8 Apr 2010 16:43:17 +0200
Subject: [Chilli] init script and radconf options.
Message-ID: <q2mf1b5213e1004080743t8606f712jc972a75d4ba3a419@mail.gmail.com>

Hi everybody,

I would like to have a few tips about Coova-chilli v1.2.2-1 running on
OpenWRT kamikaze.

Starting with the init file (/etc/init.d/chilli):

When I try to start coova using the command /etc/init.d/chilli start, the
differents configuration files are created (main.conf, hs.conf, local.conf)
according to the /etc/chilli/config I set up, but I get the same error again
and again:

coova-chilli[10362]: options.c: 174: could not generate configuration
(/tmp/chilli-10362/config.bin), sleeping one second

The directory /tmp/chilli-**** is created (actually the number is different
at each start), but keeps empty.

When I start coova in debug mode directly from the command line (chilli
-df), it works well.

Any idea of where that issue could come from?


Now about the RADCONF options.

Is there a documentation for those options? I've not been able to fing
anything on the web.

Thank you for everything.

Cheers

Damien Courtaillier
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100408/31a06556/attachment.htm>

From hardybm at gmail.com  Thu Apr  8 14:33:00 2010
From: hardybm at gmail.com (Hardy Beltran Monasterios)
Date: Thu, 08 Apr 2010 10:33:00 -0400
Subject: [Chilli] Unable to build coova-chilli 1.2.2 in CentOS 5.4
	--with-openssl	option
Message-ID: <1270737180.6398.19.camel@agua.hardy.com.bo>

Hi,

I'm trying to build coova-chilli-1.2.2 on CentOS 5.4 but i have errors
when I use '--with-openssl' option

I did:

./configure --enable-miniportal --enable-chilliredir
--enable-chilliproxy --with-openssl

This is the error (only first 20 lines):

In file included from /usr/include/krb5.h:7,
                 from /usr/include/openssl/kssl.h:72,
                 from /usr/include/openssl/ssl.h:191,
                 from ssl.h:42,
                 from conn.h:25,
                 from redir.h:26,
                 from chilli.c:27:
/usr/include/krb5/krb5.h:139:2: error: #error undefined 16 bit type
/usr/include/krb5/krb5.h:152:2: error: #error : undefined 32 bit type
In file included from /usr/include/krb5.h:7,
                 from /usr/include/openssl/kssl.h:72,
                 from /usr/include/openssl/ssl.h:191,
                 from ssl.h:42,
                 from conn.h:25,
                 from redir.h:26,
                 from chilli.c:27:
/usr/include/krb5/krb5.h:191: error: expected '=', ',', ';', 'asm' or
'__attribute__' before 'krb5_addrtype'
/usr/include/krb5/krb5.h:192: error: expected '=', ',', ';', 'asm' or
'__attribute__' before 'krb5_enctype'
/usr/include/krb5/krb5.h:193: error: expected '=', ',', ';', 'asm' or
'__attribute__' before 'krb5_cksumtype'
/usr/include/krb5/krb5.h:194: error: expected '=', ',', ';', 'asm' or
'__attribute__' before 'krb5_authdatatype'


My build environment

gcc 4.1.2
glibc 2.5
openssl 0.9.8e

The file '/usr/include/krb5/krb5.h' comes with this package:

krb5-devel-1.6.1-36.el5_4.1


What might be wrong ? 


TIA

---
Hardy Beltran Monasterios
La Paz, Bolivia


From david at coova.com  Mon Apr 12 05:15:49 2010
From: david at coova.com (David Bird)
Date: Mon, 12 Apr 2010 07:15:49 +0200
Subject: [Chilli] CoovaChilli 1.2.3
Message-ID: <1271049349.4130.180.camel@david-laptop>

Hi all, As there are a few bug fixes in subversion, I'd like to release
CoovaChilli 1.2.3 soon. Any issues? Any patches? I still have to
integrate the one submitted for "leaky bucket exceptions" .. any
others? 

David


From mctiew at yahoo.com  Mon Apr 12 07:15:43 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Mon, 12 Apr 2010 00:15:43 -0700 (PDT)
Subject: [Chilli] CoovaChilli 1.2.3
In-Reply-To: <1271049349.4130.180.camel@david-laptop>
Message-ID: <192220.42546.qm@web31502.mail.mud.yahoo.com>



--- On Mon, 4/12/10, David Bird <david at coova.com> wrote:

>
> .. any
> others? 
> 

Regarding the patch to accept hex string as dhcp option, 
there is a comment that it will break existing compatibility.

Would you consider it again if the patch detects the presence of 
"hex string" ( ie xx:xx:xx .... ) and then perform the job
accordingly ? I am still keen on this as I think when the 
dhcp options are stored in sql database, it is (slightly) easier 
to manupulate it as hex string instead of binary data.

Regards


      

From Anatoly.Oreshkin at pnpi.spb.ru  Mon Apr 12 15:31:57 2010
From: Anatoly.Oreshkin at pnpi.spb.ru (Anatoly Oreshkin)
Date: Mon, 12 Apr 2010 19:31:57 +0400 (MSD)
Subject: [Chilli] chilli as proxy question
Message-ID: <Pine.LNX.4.62.1004121929240.32524@mail.pnpi.spb.ru>


Hello,

I am trying to use chilli as proxy beetween Access Point (AP) and Radius 
server. AP is configured with WPA2 security and EAP/PEAP/MSCHAPv2 
authentication.

Chilli configuration.

/usr/local/etc/chilli/config:

HS_WANIF=eth0             # address 195.19.214.216 
HS_LANIF=eth1             # address 10.2.3.1
HS_NETWORK=10.2.3.0
HS_NETMASK=255.255.255.0
HS_UAMLISTEN=10.2.3.1
HS_RADIUS=212.193.96.134
...

/usr/local/etc/chilli/local.conf:

proxylisten=10.2.3.1
proxyport=1812
proxyclient=10.2.3.254  # AP address
proxysecret=<secret>

Radius configuration.

clients.conf:

# chilli hotspot
client 195.19.214.216 {
         secret      = <secret>
         shortname   = Chilli
         nastype     = other
}

I ran chilli in debug mode and got such output:

chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
dhcp.c: 389: 0 (Debug) DHCP newconn: 00:16:ea:8a:de:38
chilli.c: 3285: 0 (Debug) New DHCP request from MAC=00-16-EA-8A-DE-38
chilli.c: 3288: 0 (Debug) New DHCP connection established
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
...
chilli.c: 2792: 0 (Debug) Received access request confirmation from radius 
server

chilli.c: 2828: 0 (Debug) Received access challenge from radius server
chilli.c: 920: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2792: 0 (Debug) Received access request confirmation from radius 
server

chilli.c: 2828: 0 (Debug) Received access challenge from radius server
chilli.c: 920: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
chilli.c: 2792: 0 (Debug) Received access request confirmation from radius server
...

chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1813
radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
radius.c: 1703: 0 (Debug) Authenticator does not match request!
radius.c: 337: 0 (Debug) No such id in radius queue: id=12!
radius.c: 1698: 0 (Debug) Matching request was not found in queue: 12!
chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
...


Radius output:
--------------

Radius received from chilli Access-Request packet with id=1:

rad_recv: Access-Request packet from host 195.19.214.216 port 37455, id=1, length=176
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         User-Name = "csd-notebook\\oreshkin"
         EAP-Message = 
0x0200001a016373642d6e6f7465626f6f6b5c6f726573686b696e
         Calling-Station-Id = "00-16-EA-8A-DE-38"
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Port-Type = Wireless-802.11
         NAS-Port = 2
         Service-Type = Login-User
         NAS-IP-Address = 10.2.3.1
         NAS-Identifier = "nas01"
         Message-Authenticator = 0x70bb92e04f02f1717329cf61fff2e2f1
+- entering group authorize {...}
++[preprocess] returns ok

...
...

Radius authenticated the client with MAC: 00-16-EA-8A-DE-38 and sent 
chilli Access-Accept packet with id=10  to confirm authentication.

Sending Access-Accept of id 10 to 195.19.214.216 port 37455
         MS-MPPE-Recv-Key = 
0x446fcdddb89288bd3b720a314422d9cccb1c09941636fbb4bbc15a07c1873bfb
         MS-MPPE-Send-Key = 
0x117f6d0a36318d0e869f7570773cf36a916c7c8ea4910d4c25c965977d876814
         EAP-Message = 0x03090004
         Message-Authenticator = 0x00000000000000000000000000000000
         User-Name = "csd-notebook\\oreshkin"
Finished request 10.

Then radius  received from chilli Accounting-Request packet with id=11 and 
sent Accounting-Response to chilli.

Sending Accounting-Response of id 11 to 195.19.214.216 port 37455
Finished request 11.

It seemed that authentication process to be complete !

But radius got unexpectedly from chilli   Access-Request packet with id=12

rad_recv: Access-Request packet from host 195.19.214.216 port 37455, id=12, length=176
         Vendor-14559-Attr-8 = 0x312e322e332d726331
         User-Name = "csd-notebook\\oreshkin"
         EAP-Message = 
0x0200001a016373642d6e6f7465626f6f6b5c6f726573686b696e
         Calling-Station-Id = "00-16-EA-8A-DE-38"
         Called-Station-Id = "00-0E-0C-36-AE-AA"
         NAS-Port-Type = Wireless-802.11
         NAS-Port = 2
         Service-Type = Login-User
         NAS-IP-Address = 10.2.3.1
         NAS-Identifier = "nas01"
         Message-Authenticator = 0x647799f84fc9779142b12a59a00dcac1
+- entering group authorize {...}
++[preprocess] returns ok
...


Why did this Access-Request with id=12 come from chilli ?
Chilli does not see such id=12 in radius queue and can not complete authentication.

What might be wrong ? Configuration or something else ?
I installed chilli from SVN.

Thanks.




From david at coova.com  Tue Apr 13 05:27:49 2010
From: david at coova.com (David Bird)
Date: Tue, 13 Apr 2010 07:27:49 +0200
Subject: [Chilli] chilli as proxy question
In-Reply-To: <Pine.LNX.4.62.1004121929240.32524@mail.pnpi.spb.ru>
References: <Pine.LNX.4.62.1004121929240.32524@mail.pnpi.spb.ru>
Message-ID: <1271136469.4130.455.camel@david-laptop>

Hmm.. If the access-accept went through chilli, then you should see the
session authorized using chilli_query. As for packet with id=12, you
should be checking to see if it was your AP that sent that packet
(chilli is just proxying) and you might check your AP logs for any
related errors, etc. 

On Mon, 2010-04-12 at 19:31 +0400, Anatoly Oreshkin wrote:
> Hello,
> 
> I am trying to use chilli as proxy beetween Access Point (AP) and Radius 
> server. AP is configured with WPA2 security and EAP/PEAP/MSCHAPv2 
> authentication.
> 
> Chilli configuration.
> 
> /usr/local/etc/chilli/config:
> 
> HS_WANIF=eth0             # address 195.19.214.216 
> HS_LANIF=eth1             # address 10.2.3.1
> HS_NETWORK=10.2.3.0
> HS_NETMASK=255.255.255.0
> HS_UAMLISTEN=10.2.3.1
> HS_RADIUS=212.193.96.134
> ...
> 
> /usr/local/etc/chilli/local.conf:
> 
> proxylisten=10.2.3.1
> proxyport=1812
> proxyclient=10.2.3.254  # AP address
> proxysecret=<secret>
> 
> Radius configuration.
> 
> clients.conf:
> 
> # chilli hotspot
> client 195.19.214.216 {
>          secret      = <secret>
>          shortname   = Chilli
>          nastype     = other
> }
> 
> I ran chilli in debug mode and got such output:
> 
> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
> chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
> dhcp.c: 389: 0 (Debug) DHCP newconn: 00:16:ea:8a:de:38
> chilli.c: 3285: 0 (Debug) New DHCP request from MAC=00-16-EA-8A-DE-38
> chilli.c: 3288: 0 (Debug) New DHCP connection established
> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
> ...
> chilli.c: 2792: 0 (Debug) Received access request confirmation from radius 
> server
> 
> chilli.c: 2828: 0 (Debug) Received access challenge from radius server
> chilli.c: 920: 0 (Debug) Sending RADIUS AccessChallenge to client
> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
> chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
> chilli.c: 2792: 0 (Debug) Received access request confirmation from radius 
> server
> 
> chilli.c: 2828: 0 (Debug) Received access challenge from radius server
> chilli.c: 920: 0 (Debug) Sending RADIUS AccessChallenge to client
> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
> chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
> chilli.c: 2792: 0 (Debug) Received access request confirmation from radius server
> ...
> 
> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
> chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1813
> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
> radius.c: 1703: 0 (Debug) Authenticator does not match request!
> radius.c: 337: 0 (Debug) No such id in radius queue: id=12!
> radius.c: 1698: 0 (Debug) Matching request was not found in queue: 12!
> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
> ...
> 
> 
> Radius output:
> --------------
> 
> Radius received from chilli Access-Request packet with id=1:
> 
> rad_recv: Access-Request packet from host 195.19.214.216 port 37455, id=1, length=176
>          Vendor-14559-Attr-8 = 0x312e322e332d726331
>          User-Name = "csd-notebook\\oreshkin"
>          EAP-Message = 
> 0x0200001a016373642d6e6f7465626f6f6b5c6f726573686b696e
>          Calling-Station-Id = "00-16-EA-8A-DE-38"
>          Called-Station-Id = "00-0E-0C-36-AE-AA"
>          NAS-Port-Type = Wireless-802.11
>          NAS-Port = 2
>          Service-Type = Login-User
>          NAS-IP-Address = 10.2.3.1
>          NAS-Identifier = "nas01"
>          Message-Authenticator = 0x70bb92e04f02f1717329cf61fff2e2f1
> +- entering group authorize {...}
> ++[preprocess] returns ok
> 
> ...
> ...
> 
> Radius authenticated the client with MAC: 00-16-EA-8A-DE-38 and sent 
> chilli Access-Accept packet with id=10  to confirm authentication.
> 
> Sending Access-Accept of id 10 to 195.19.214.216 port 37455
>          MS-MPPE-Recv-Key = 
> 0x446fcdddb89288bd3b720a314422d9cccb1c09941636fbb4bbc15a07c1873bfb
>          MS-MPPE-Send-Key = 
> 0x117f6d0a36318d0e869f7570773cf36a916c7c8ea4910d4c25c965977d876814
>          EAP-Message = 0x03090004
>          Message-Authenticator = 0x00000000000000000000000000000000
>          User-Name = "csd-notebook\\oreshkin"
> Finished request 10.
> 
> Then radius  received from chilli Accounting-Request packet with id=11 and 
> sent Accounting-Response to chilli.
> 
> Sending Accounting-Response of id 11 to 195.19.214.216 port 37455
> Finished request 11.
> 
> It seemed that authentication process to be complete !
> 
> But radius got unexpectedly from chilli   Access-Request packet with id=12
> 
> rad_recv: Access-Request packet from host 195.19.214.216 port 37455, id=12, length=176
>          Vendor-14559-Attr-8 = 0x312e322e332d726331
>          User-Name = "csd-notebook\\oreshkin"
>          EAP-Message = 
> 0x0200001a016373642d6e6f7465626f6f6b5c6f726573686b696e
>          Calling-Station-Id = "00-16-EA-8A-DE-38"
>          Called-Station-Id = "00-0E-0C-36-AE-AA"
>          NAS-Port-Type = Wireless-802.11
>          NAS-Port = 2
>          Service-Type = Login-User
>          NAS-IP-Address = 10.2.3.1
>          NAS-Identifier = "nas01"
>          Message-Authenticator = 0x647799f84fc9779142b12a59a00dcac1
> +- entering group authorize {...}
> ++[preprocess] returns ok
> ...
> 
> 
> Why did this Access-Request with id=12 come from chilli ?
> Chilli does not see such id=12 in radius queue and can not complete authentication.
> 
> What might be wrong ? Configuration or something else ?
> I installed chilli from SVN.
> 
> Thanks.
> 
> 
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From b.bennici at it360.it  Tue Apr 13 15:34:24 2010
From: b.bennici at it360.it (Brigitta Bennici)
Date: Tue, 13 Apr 2010 17:34:24 +0200
Subject: [Chilli] help with openssl
Message-ID: <002e01cadb1e$cc02ae30$64080a90$@bennici@it360.it>

Hello,

i have problems installing coova-chilli in my CentOS 5.4: when I try to
install the rpm it fails for a openssl 0.9.8.

I have installed 0.9.8b version and no downgrade is possible.

Anyone can help?

Thanks a lot

 

Regards

 

Brigitta Bennici
E-mail: b.bennici at it360.it
Web:  <http://www.it360.it> http://www.it360.it

 

----------------------------------------------------------------------------
----------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100413/6a726644/attachment.htm>

From Anatoly.Oreshkin at pnpi.spb.ru  Tue Apr 13 16:05:48 2010
From: Anatoly.Oreshkin at pnpi.spb.ru (Anatoly Oreshkin)
Date: Tue, 13 Apr 2010 20:05:48 +0400 (MSD)
Subject: [Chilli] chilli as proxy question
In-Reply-To: <1271136469.4130.455.camel@david-laptop>
References: <Pine.LNX.4.62.1004121929240.32524@mail.pnpi.spb.ru>
	<1271136469.4130.455.camel@david-laptop>
Message-ID: <Pine.LNX.4.62.1004131943570.7525@mail.pnpi.spb.ru>


I've understood the cause of my problem. Chilli correctly proxies radius 
requests from wifi 802.1X client to radius server and vice verse. And as 
result client is authenticated. When client disconnects from access point (AP) chilli 
does not know about it and does not release client's IP address. 
Therefore when clients reconnects again and send radius requests to chilli 
again then chilli answers with messages like these:

radius.c: 1703: 0 (Debug) Authenticator does not match request!
radius.c: 337: 0 (Debug) No such id in radius queue: id=12!

What options are there to solve this problem ?

Yet another question. How can I do that clients with UAM authentication 
get dynamic ip addresses from pool but 802.1X clients get static addresses 
from different subnet ?

Thanks.


On Tue, 13 Apr 2010, David Bird wrote:

> Date: Tue, 13 Apr 2010 07:27:49 +0200
> From: David Bird <david at coova.com>
> To: Anatoly Oreshkin <Anatoly.Oreshkin at pnpi.spb.ru>
> Cc: chilli at coova.org
> Subject: Re: [Chilli] chilli as proxy question
> 
> Hmm.. If the access-accept went through chilli, then you should see the
> session authorized using chilli_query. As for packet with id=12, you
> should be checking to see if it was your AP that sent that packet
> (chilli is just proxying) and you might check your AP logs for any
> related errors, etc.
>
> On Mon, 2010-04-12 at 19:31 +0400, Anatoly Oreshkin wrote:
>> Hello,
>>
>> I am trying to use chilli as proxy beetween Access Point (AP) and Radius
>> server. AP is configured with WPA2 security and EAP/PEAP/MSCHAPv2
>> authentication.
>>
>> Chilli configuration.
>>
>> /usr/local/etc/chilli/config:
>>
>> HS_WANIF=eth0             # address 195.19.214.216
>> HS_LANIF=eth1             # address 10.2.3.1
>> HS_NETWORK=10.2.3.0
>> HS_NETMASK=255.255.255.0
>> HS_UAMLISTEN=10.2.3.1
>> HS_RADIUS=212.193.96.134
>> ...
>>
>> /usr/local/etc/chilli/local.conf:
>>
>> proxylisten=10.2.3.1
>> proxyport=1812
>> proxyclient=10.2.3.254  # AP address
>> proxysecret=<secret>
>>
>> Radius configuration.
>>
>> clients.conf:
>>
>> # chilli hotspot
>> client 195.19.214.216 {
>>          secret      = <secret>
>>          shortname   = Chilli
>>          nastype     = other
>> }
>>
>> I ran chilli in debug mode and got such output:
>>
>> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
>> chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
>> dhcp.c: 389: 0 (Debug) DHCP newconn: 00:16:ea:8a:de:38
>> chilli.c: 3285: 0 (Debug) New DHCP request from MAC=00-16-EA-8A-DE-38
>> chilli.c: 3288: 0 (Debug) New DHCP connection established
>> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
>> ...
>> chilli.c: 2792: 0 (Debug) Received access request confirmation from radius
>> server
>>
>> chilli.c: 2828: 0 (Debug) Received access challenge from radius server
>> chilli.c: 920: 0 (Debug) Sending RADIUS AccessChallenge to client
>> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
>> chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
>> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
>> chilli.c: 2792: 0 (Debug) Received access request confirmation from radius
>> server
>>
>> chilli.c: 2828: 0 (Debug) Received access challenge from radius server
>> chilli.c: 920: 0 (Debug) Sending RADIUS AccessChallenge to client
>> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
>> chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
>> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
>> chilli.c: 2792: 0 (Debug) Received access request confirmation from radius server
>> ...
>>
>> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
>> chilli.c: 1986: 0 (Debug) Calling Station ID is: 00-16-EA-8A-DE-38
>> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1813
>> radius.c: 1446: 0 (Debug) RADIUS to 212.193.96.134:1812
>> radius.c: 1703: 0 (Debug) Authenticator does not match request!
>> radius.c: 337: 0 (Debug) No such id in radius queue: id=12!
>> radius.c: 1698: 0 (Debug) Matching request was not found in queue: 12!
>> chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
>> ...
>>
>>
>> Radius output:
>> --------------
>>
>> Radius received from chilli Access-Request packet with id=1:
>>
>> rad_recv: Access-Request packet from host 195.19.214.216 port 37455, id=1, length=176
>>          Vendor-14559-Attr-8 = 0x312e322e332d726331
>>          User-Name = "csd-notebook\\oreshkin"
>>          EAP-Message =
>> 0x0200001a016373642d6e6f7465626f6f6b5c6f726573686b696e
>>          Calling-Station-Id = "00-16-EA-8A-DE-38"
>>          Called-Station-Id = "00-0E-0C-36-AE-AA"
>>          NAS-Port-Type = Wireless-802.11
>>          NAS-Port = 2
>>          Service-Type = Login-User
>>          NAS-IP-Address = 10.2.3.1
>>          NAS-Identifier = "nas01"
>>          Message-Authenticator = 0x70bb92e04f02f1717329cf61fff2e2f1
>> +- entering group authorize {...}
>> ++[preprocess] returns ok
>>
>> ...
>> ...
>>
>> Radius authenticated the client with MAC: 00-16-EA-8A-DE-38 and sent
>> chilli Access-Accept packet with id=10  to confirm authentication.
>>
>> Sending Access-Accept of id 10 to 195.19.214.216 port 37455
>>          MS-MPPE-Recv-Key =
>> 0x446fcdddb89288bd3b720a314422d9cccb1c09941636fbb4bbc15a07c1873bfb
>>          MS-MPPE-Send-Key =
>> 0x117f6d0a36318d0e869f7570773cf36a916c7c8ea4910d4c25c965977d876814
>>          EAP-Message = 0x03090004
>>          Message-Authenticator = 0x00000000000000000000000000000000
>>          User-Name = "csd-notebook\\oreshkin"
>> Finished request 10.
>>
>> Then radius  received from chilli Accounting-Request packet with id=11 and
>> sent Accounting-Response to chilli.
>>
>> Sending Accounting-Response of id 11 to 195.19.214.216 port 37455
>> Finished request 11.
>>
>> It seemed that authentication process to be complete !
>>
>> But radius got unexpectedly from chilli   Access-Request packet with id=12
>>
>> rad_recv: Access-Request packet from host 195.19.214.216 port 37455, id=12, length=176
>>          Vendor-14559-Attr-8 = 0x312e322e332d726331
>>          User-Name = "csd-notebook\\oreshkin"
>>          EAP-Message =
>> 0x0200001a016373642d6e6f7465626f6f6b5c6f726573686b696e
>>          Calling-Station-Id = "00-16-EA-8A-DE-38"
>>          Called-Station-Id = "00-0E-0C-36-AE-AA"
>>          NAS-Port-Type = Wireless-802.11
>>          NAS-Port = 2
>>          Service-Type = Login-User
>>          NAS-IP-Address = 10.2.3.1
>>          NAS-Identifier = "nas01"
>>          Message-Authenticator = 0x647799f84fc9779142b12a59a00dcac1
>> +- entering group authorize {...}
>> ++[preprocess] returns ok
>> ...
>>
>>
>> Why did this Access-Request with id=12 come from chilli ?
>> Chilli does not see such id=12 in radius queue and can not complete authentication.
>>
>> What might be wrong ? Configuration or something else ?
>> I installed chilli from SVN.
>>
>> Thanks.
>>
>>
>>
>> _______________________________________________
>> Chilli mailing list
>> Chilli at coova.org
>> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>

From jason at theallens.id.au  Wed Apr 14 00:33:37 2010
From: jason at theallens.id.au (Jason Allen)
Date: Wed, 14 Apr 2010 10:33:37 +1000
Subject: [Chilli] Squid transparent proxy on same server
Message-ID: <l2s3e888d0e1004131733r6307cb4r4fb5533d21588760@mail.gmail.com>

Hi,

Using coova as the gateway and charging portal for a public wireless
service.
Looking at implementing squid on the coova server to act as a transparent
proxy, and thus save data(money) on external web requests.

Can anyone share configuration settings (or point me towards and article or
how-to), with regard to iptable rules, to ensure that port 80 traffic is
transparently routed through to squid? I'd need to ensure that port 80
traffic to the server itself is still available as the server runs apache
for teh charging portal.


Thanks.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100414/21cea833/attachment.htm>

From david at coova.com  Wed Apr 14 04:22:49 2010
From: david at coova.com (David Bird)
Date: Wed, 14 Apr 2010 06:22:49 +0200
Subject: [Chilli] CoovaChilli 1.2.3
In-Reply-To: <192220.42546.qm@web31502.mail.mud.yahoo.com>
References: <192220.42546.qm@web31502.mail.mud.yahoo.com>
Message-ID: <1271218969.4283.12.camel@david-laptop>


On Mon, 2010-04-12 at 00:15 -0700, Ming-Ching Tiew wrote:
> 
> --- On Mon, 4/12/10, David Bird <david at coova.com> wrote:
> 
> >
> > .. any
> > others? 
> > 
> 
> Regarding the patch to accept hex string as dhcp option, 
> there is a comment that it will break existing compatibility.
> 
> Would you consider it again if the patch detects the presence of 
> "hex string" ( ie xx:xx:xx .... ) and then perform the job
> accordingly ? I am still keen on this as I think when the 
> dhcp options are stored in sql database, it is (slightly) easier 
> to manupulate it as hex string instead of binary data.
> 
> Regards
> 

Perhaps when using some RADIUS servers, but not with JRadius. It's
easy. :)

Indeed, perhaps the feature is a better feature for your RADIUS server
(to have the ability to optionally load a hex string into a binary
RADIUS attribute string). I'm sure it would be useful in lots of places.

David



From david at coova.com  Wed Apr 14 04:29:37 2010
From: david at coova.com (David Bird)
Date: Wed, 14 Apr 2010 06:29:37 +0200
Subject: [Chilli] help with openssl
In-Reply-To: <002e01cadb1e$cc02ae30$64080a90$@bennici@it360.it>
References: <002e01cadb1e$cc02ae30$64080a90$@bennici@it360.it>
Message-ID: <1271219377.4283.13.camel@david-laptop>

Hi, You will likely want to build from source instead. 


On Tue, 2010-04-13 at 17:34 +0200, Brigitta Bennici wrote:
> Hello,
> 
> i have problems installing coova-chilli in my CentOS 5.4: when I try
> to install the rpm it fails for a openssl 0.9.8.
> 
> I have installed 0.9.8b version and no downgrade is possible.
> 
> Anyone can help?
> 
> Thanks a lot
> 
>  
> 
> Regards
> 
>  
> 
> Brigitta Bennici
> E-mail: b.bennici at it360.it
> Web: http://www.it360.it
> 
>  
> 
> --------------------------------------------------------------------------------------------
> Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> personale (DLgs. 196/03 e collegate), questa mail ? destinata
> unicamente
> alle persone sopra indicate e le informazioni in essa contenute sono
> da
> considerarsi strettamente riservate. E' proibito leggere, copiare,
> usare o
> diffondere il contenuto della presente mail senza autorizzazione. Se
> avete
> ricevuto questo messaggio per errore, siete pregati di rispedire lo
> stesso
> al mittente. Grazie
> 
>  
> 
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From david at coova.com  Wed Apr 14 04:32:20 2010
From: david at coova.com (David Bird)
Date: Wed, 14 Apr 2010 06:32:20 +0200
Subject: [Chilli] init script and radconf options.
In-Reply-To: <q2mf1b5213e1004080743t8606f712jc972a75d4ba3a419@mail.gmail.com>
References: <q2mf1b5213e1004080743t8606f712jc972a75d4ba3a419@mail.gmail.com>
Message-ID: <1271219540.4283.15.camel@david-laptop>

Strange. Usually when you get that error (could not generate
configuration...) it's because the configuration isn't correct (no
surprise there). Though, you would usually see the true error also,
especially when starting in debug mode. Also check your dmesg log. 


On Thu, 2010-04-08 at 16:43 +0200, Damien Courtaillier wrote:
> Hi everybody,
> 
> I would like to have a few tips about Coova-chilli v1.2.2-1 running on
> OpenWRT kamikaze.
> 
> Starting with the init file (/etc/init.d/chilli):
> 
> When I try to start coova using the command /etc/init.d/chilli start,
> the differents configuration files are created (main.conf, hs.conf,
> local.conf) according to the /etc/chilli/config I set up, but I get
> the same error again and again:
> 
> coova-chilli[10362]: options.c: 174: could not generate configuration
> (/tmp/chilli-10362/config.bin), sleeping one second
> 
> The directory /tmp/chilli-**** is created (actually the number is
> different at each start), but keeps empty. 
> 
> When I start coova in debug mode directly from the command line
> (chilli -df), it works well.
> 
> Any idea of where that issue could come from?
> 
> 
> Now about the RADCONF options. 
> 
> Is there a documentation for those options? I've not been able to fing
> anything on the web.
> 
> Thank you for everything.
> 
> Cheers
> 
> Damien Courtaillier
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From david at coova.com  Wed Apr 14 04:38:01 2010
From: david at coova.com (David Bird)
Date: Wed, 14 Apr 2010 06:38:01 +0200
Subject: [Chilli] MAC blacklist and other security measures
In-Reply-To: <4BBB5675.6090504@hpp.org.br>
References: <4BA25D15.8030400@hpp.org.br>
	<1269152189.4135.167.camel@david-laptop> <4BBB5675.6090504@hpp.org.br>
Message-ID: <1271219881.4283.17.camel@david-laptop>

Hi Felipe,

Thanks for the analysis. Indeed, the putting of the 'splash' into the
configuration file would be a mistake (bug).

David


On Tue, 2010-04-06 at 12:42 -0300, Felipe Augusto van de Wiel wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA512
> 
> Hi,
> 
> 	Although it seems that I finally could make
> the below configuration to work, I would like to
> confirm if the solution is correct (or properly
> implemented). I would also like to report a possible
> bug related to this setup.
> 
> 	I'm also writing to document it on the list
> archive as reference for people trying to get the
> blacklist of MAC addresses working while still
> allowing users to authenticate thru the captive
> portal.
> 
> 
> On 21-03-2010 03:16, David Bird wrote:
> > Hm.. one way might be to enable MAC authentication
> > such that:
> 
> 	That means enable 'macauth', right?  Using
> only 'macauthdeny' didn't result in the expected
> behavior.
> 
> 
> > - You always return Access-Accept (plus attribute
> >   Chillispot-Config = 'splash') for non-blocked
> >   users.
> 
> > - You can return an Access-Reject for blocked users.
> >   When used with --macauthdeny, it means these
> >   devices will be ignored.
> 
> 	The proper way to achieve that would be to
> use a DEFAULT user in RADIUS? Here is the relevant
> part of my FreeRADIUS' users file:
> 
> <...>
> | AA-BB-CC-DD-EE-FF  Auth-Type := Reject
> |                    Reply-Message = "MAC address administratively blocked."
> |
> | 11-22-33-44-55-66  Auth-Type := Reject
> |                    Reply-Message = "MAC address administratively blocked."
> |
> | DEFAULT            Auth-Type := Accept
> |                    Chillispot-config = 'splash',
> |                    Fall-Through = Yes
> |
> | "user"             Cleartext-Password := "pass"
> |                    Reply-Message = "Hello, %{User-Name}"
> <...>
> 
> 
> 	Of course, that only worked after I added an
> include line inside /etc/freeradius/dictionary:
> 
> $INCLUDE        /etc/freeradius/dictionary.chillispot
> 
> 
> 	Now, the MAC addresses listed on the users
> file gets a 'drop' state when chilli starts, the rest
> gets a 'splash' state and addresses in the ethers file
> stays as 'dnat'. Once the user authenticates thru the
> splash screen they change to 'pass' as expected.
> 
> 	There is one interesting side effect that
> smells like a bug. Once I started using the
> Chillispot-config = 'splash' the contents of my
> local.conf file is replaced with 'splash' and Coova
> complains that there is no option '--splash':
> 
> Starting chilli: coova-chilli: unrecognized option `--splash'
> coova-chilli[7358]: options.c: 174: could not generate
>   configuration (/tmp/chilli-7358/config.bin), sleeping
>   one second
> coova-chilli: unrecognized option `--splash'
> 
> 
> 	The dirty hack I used is 'chattr +i local.conf'.
> I tried to figure out something from the functions or
> shell scripts but I couldn't spot where it replaces
> the contents of local.conf. For now, it solved the
> problem, but it isn't supposed to do that, or am I
> missing something?
> 
> 	So, I hope this helps others. :)
> 
> Kind regards,
> - -- 
> Felipe Augusto van de Wiel <felipe.wiel at hpp.org.br>
> Tecnologia da Informa??o (TI) - Complexo Pequeno Pr?ncipe
> http://www.pequenoprincipe.org.br/    T: +55 41 3310 1747
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> 
> iQIcBAEBCgAGBQJLu1ZyAAoJECCPPxLgxLxPyLMP+gM7u6DJWZzZ89F0WaFhmKAB
> BxnLklJv2jsKvgFCH/AVlEhK3j1q9BaGJkZJnizC90PkgwKzz065iu7x+9v1zvN4
> xyfrUoRIbyO+4iUuDbP+bmg3j9WGnsKrvouKZDvXb+sBd5LB/prWHlVdOUi22XwP
> y56RibxFkNqg08rQfZAHFiUKOAWQEXSVmAkc7ung9U2K1AxWyvuW9nDAcWGylD0h
> 4+8lOzU8ghlDfGR+5KKStdyIU1Qmsq4boe5qNknAlB1elUlk/8ohLQAulPhaROI4
> UPCPUZ4kzuP1YrYbCcyRC35A6UvTGo62pFiayJH7rD0pun8ueEljIRLARNW5n3j9
> Z2uZ3uDu08vVks7Pt9F2Yi53K3zFlKq9xxp+j8wTiefOwrnShnfbe5+v/ZnIu41Q
> Qs45z8DnhrhOPIwBCUZCQTxUwHFQn0Y81nNlVEI+9oNGjlsZ6g3w5r52hh7cErxd
> tXpg+ZidB2IZBQonhC3QvQCtzO+Z418erSlfcnP1Dw2b7nCud5AycvbIQvfKnKC8
> VCnBnbHRvW+SdNq3SLRJW0ZMpOULRbLu+VpeYGfKo98EH/ceWpwbyMlmxtwvfrKk
> EI18niSHbhbG9UuLm7BhIVQcTYpBnTmH680LIGwIAVHgoV/QtddaEZOWDE+x1rZ0
> Qr/CPJBG4RVQapvqAKx4
> =8VQ7
> -----END PGP SIGNATURE-----



From chilli at quidecco.de  Wed Apr 14 04:51:21 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Wed, 14 Apr 2010 06:51:21 +0200 (CEST)
Subject: [Chilli] help with openssl
In-Reply-To: <002e01cadb1e$cc02ae30$64080a90$@bennici@it360.it>
Message-ID: <20100414045121.7EF2D786F84@quidecco.de>

Hello,

> 
> i have problems installing coova-chilli in my CentOS 5.4: when I try to
> install the rpm it fails for a openssl 0.9.8.
> 
> I have installed 0.9.8b version and no downgrade is possible.
> 

What rpm did you use? Was it one built for CentOS 5.4?

The coova-chilli source tree comes with a spec file which can be used
to build rpm packages using rpmbuild.

Best regards,

Isidor

From chilli at quidecco.de  Wed Apr 14 04:42:34 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Wed, 14 Apr 2010 06:42:34 +0200 (CEST)
Subject: [Chilli] Squid transparent proxy on same server
In-Reply-To: <l2s3e888d0e1004131733r6307cb4r4fb5533d21588760@mail.gmail.com>
Message-ID: <20100414044234.48942786F23@quidecco.de>

Hi Jason,

> 
> Can anyone share configuration settings (or point me towards and article or
> how-to), with regard to iptable rules, to ensure that port 80 traffic is
> transparently routed through to squid? I'd need to ensure that port 80
> traffic to the server itself is still available as the server runs apache
> for teh charging portal.
> 

The HS_POSTAUTH_PROXY and HS_POSTAUTH_PROXYPORT configuration settings
are there to configure a transparent proxy to handle requests after
the user is authenticated. This is handled through chilli, not
iptables, and does not prevent you from still running a web server.

Best regards,

Isidor

From b.bennici at it360.it  Wed Apr 14 08:22:58 2010
From: b.bennici at it360.it (Brigitta Bennici)
Date: Wed, 14 Apr 2010 10:22:58 +0200
Subject: [Chilli] R:  help with openssl
In-Reply-To: <1271219377.4283.13.camel@david-laptop>
References: <002e01cadb1e$cc02ae30$64080a90$@bennici@it360.it>
	<1271219377.4283.13.camel@david-laptop>
Message-ID: <001601cadbab$b10dc280$13294780$@bennici@it360.it>

Sorry David,
i didn't answer to all before. As I said the problem is that
1)When I try to install rpm, I fail because of dependencies for libraries of openssl 0.9.8.
2)I tried to install forcing the dependencies, the installation goes fine, but when I try to start chilli:it fails because it doesn't find libssl.so.0.9.8
3)i tried to download the tar.gz file but after the command make I have these errors:
make[2]: Entering directory `/home/centos/coova-chilli-1.2.2/debian'
make[2]: Nothing to be done for `all'.
make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2/debian'
make[2]: Entering directory `/home/centos/coova-chilli-1.2.2'
make[2]: Nothing to be done for `all-am'.
make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2'
make[1]: Leaving directory `/home/centos/coova-chilli-1.2.2'

Hope it is useful

Thank you very much.

Kind regards


Brigitta Bennici
E-mail: b.bennici at it360.it
Web: http://www.it360.it

--------------------------------------------------------------------------------------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie


-----Messaggio originale-----
Da: David Bird [mailto:david at coova.com] 
Inviato: mercoled? 14 aprile 2010 6.30
A: Brigitta Bennici
Cc: chilli at coova.org
Oggetto: Re: [Chilli] help with openssl

Hi, You will likely want to build from source instead. 


On Tue, 2010-04-13 at 17:34 +0200, Brigitta Bennici wrote:
> Hello,
> 
> i have problems installing coova-chilli in my CentOS 5.4: when I try
> to install the rpm it fails for a openssl 0.9.8.
> 
> I have installed 0.9.8b version and no downgrade is possible.
> 
> Anyone can help?
> 
> Thanks a lot
> 
>  
> 
> Regards
> 
>  
> 
> Brigitta Bennici
> E-mail: b.bennici at it360.it
> Web: http://www.it360.it
> 
>  
> 
> --------------------------------------------------------------------------------------------
> Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> personale (DLgs. 196/03 e collegate), questa mail ? destinata
> unicamente
> alle persone sopra indicate e le informazioni in essa contenute sono
> da
> considerarsi strettamente riservate. E' proibito leggere, copiare,
> usare o
> diffondere il contenuto della presente mail senza autorizzazione. Se
> avete
> ricevuto questo messaggio per errore, siete pregati di rispedire lo
> stesso
> al mittente. Grazie
> 
>  
> 
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From b.bennici at it360.it  Wed Apr 14 13:14:51 2010
From: b.bennici at it360.it (Brigitta Bennici)
Date: Wed, 14 Apr 2010 15:14:51 +0200
Subject: [Chilli] R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <mailman.1.1271246402.10516.chilli@coova.org>
References: <mailman.1.1271246402.10516.chilli@coova.org>
Message-ID: <001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>

Hello Isidor,
yes i use the CentOS rpm. So I have to build an rpm from the source?  
Any information about it?
Regards,

Brigitta Bennici
E-mail: b.bennici at it360.it
Web: http://www.it360.it

----------------------------------------------------------------------------
----------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie


-----Messaggio originale-----
Da: chilli-bounces at coova.org [mailto:chilli-bounces at coova.org] Per conto di
chilli-request at coova.org
Inviato: mercoled? 14 aprile 2010 14.00
A: chilli at coova.org
Oggetto: Chilli Digest, Vol 7, Issue 13

Send Chilli mailing list submissions to
	chilli at coova.org

To subscribe or unsubscribe via the World Wide Web, visit
	http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
or, via email, send a message with subject or body 'help' to
	chilli-request at coova.org

You can reach the person managing the list at
	chilli-owner at coova.org

When replying, please edit your Subject line so it is more specific
than "Re: Contents of Chilli digest..."


Today's Topics:

   1. Re: help with openssl (Isidor Zeuner)
   2. Re: Squid transparent proxy on same server (Isidor Zeuner)
   3. R:  help with openssl (Brigitta Bennici)


----------------------------------------------------------------------

Message: 1
Date: Wed, 14 Apr 2010 06:51:21 +0200 (CEST)
From: Isidor Zeuner <chilli at quidecco.de>
Subject: Re: [Chilli] help with openssl
To: <chilli at coova.org>
Message-ID: <20100414045121.7EF2D786F84 at quidecco.de>
Content-Type: text/plain;	charset="iso-8859-1"

Hello,

> 
> i have problems installing coova-chilli in my CentOS 5.4: when I try to
> install the rpm it fails for a openssl 0.9.8.
> 
> I have installed 0.9.8b version and no downgrade is possible.
> 

What rpm did you use? Was it one built for CentOS 5.4?

The coova-chilli source tree comes with a spec file which can be used
to build rpm packages using rpmbuild.

Best regards,

Isidor


------------------------------

Message: 2
Date: Wed, 14 Apr 2010 06:42:34 +0200 (CEST)
From: Isidor Zeuner <chilli at quidecco.de>
Subject: Re: [Chilli] Squid transparent proxy on same server
To: chilli at coova.org
Message-ID: <20100414044234.48942786F23 at quidecco.de>
Content-Type: text/plain; charset=ISO-8859-1

Hi Jason,

> 
> Can anyone share configuration settings (or point me towards and article
or
> how-to), with regard to iptable rules, to ensure that port 80 traffic is
> transparently routed through to squid? I'd need to ensure that port 80
> traffic to the server itself is still available as the server runs apache
> for teh charging portal.
> 

The HS_POSTAUTH_PROXY and HS_POSTAUTH_PROXYPORT configuration settings
are there to configure a transparent proxy to handle requests after
the user is authenticated. This is handled through chilli, not
iptables, and does not prevent you from still running a web server.

Best regards,

Isidor


------------------------------

Message: 3
Date: Wed, 14 Apr 2010 10:22:58 +0200
From: "Brigitta Bennici" <b.bennici at it360.it>
Subject: [Chilli] R:  help with openssl
To: "'David Bird'" <david at coova.com>
Cc: chilli at coova.org
Message-ID: <001601cadbab$b10dc280$13294780$@bennici at it360.it>
Content-Type: text/plain;	charset="UTF-8"

Sorry David,
i didn't answer to all before. As I said the problem is that
1)When I try to install rpm, I fail because of dependencies for libraries of
openssl 0.9.8.
2)I tried to install forcing the dependencies, the installation goes fine,
but when I try to start chilli:it fails because it doesn't find
libssl.so.0.9.8
3)i tried to download the tar.gz file but after the command make I have
these errors:
make[2]: Entering directory `/home/centos/coova-chilli-1.2.2/debian'
make[2]: Nothing to be done for `all'.
make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2/debian'
make[2]: Entering directory `/home/centos/coova-chilli-1.2.2'
make[2]: Nothing to be done for `all-am'.
make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2'
make[1]: Leaving directory `/home/centos/coova-chilli-1.2.2'

Hope it is useful

Thank you very much.

Kind regards


Brigitta Bennici
E-mail: b.bennici at it360.it
Web: http://www.it360.it

----------------------------------------------------------------------------
----------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie


-----Messaggio originale-----
Da: David Bird [mailto:david at coova.com] 
Inviato: mercoled? 14 aprile 2010 6.30
A: Brigitta Bennici
Cc: chilli at coova.org
Oggetto: Re: [Chilli] help with openssl

Hi, You will likely want to build from source instead. 


On Tue, 2010-04-13 at 17:34 +0200, Brigitta Bennici wrote:
> Hello,
> 
> i have problems installing coova-chilli in my CentOS 5.4: when I try
> to install the rpm it fails for a openssl 0.9.8.
> 
> I have installed 0.9.8b version and no downgrade is possible.
> 
> Anyone can help?
> 
> Thanks a lot
> 
>  
> 
> Regards
> 
>  
> 
> Brigitta Bennici
> E-mail: b.bennici at it360.it
> Web: http://www.it360.it
> 
>  
> 
>
----------------------------------------------------------------------------
----------------
> Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> personale (DLgs. 196/03 e collegate), questa mail ? destinata
> unicamente
> alle persone sopra indicate e le informazioni in essa contenute sono
> da
> considerarsi strettamente riservate. E' proibito leggere, copiare,
> usare o
> diffondere il contenuto della presente mail senza autorizzazione. Se
> avete
> ricevuto questo messaggio per errore, siete pregati di rispedire lo
> stesso
> al mittente. Grazie
> 
>  
> 
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli




------------------------------

_______________________________________________
Chilli mailing list
Chilli at coova.org
http://lists.coova.org/cgi-bin/mailman/listinfo/chilli


End of Chilli Digest, Vol 7, Issue 13
*************************************


From david at coova.com  Wed Apr 14 13:19:28 2010
From: david at coova.com (David Bird)
Date: Wed, 14 Apr 2010 15:19:28 +0200
Subject: [Chilli] R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>
References: <mailman.1.1271246402.10516.chilli@coova.org>
	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>
Message-ID: <1271251168.15867.7.camel@david-laptop>

see http://www.coova.org/CoovaChilli/DistroBuilding

also, while on the topic of building, Wickert I think you changed
debian/rules making the install directory debian/coova-chilli instead of
debian/tmp, but that makes my building (using debuild as shown on that
page) fail. ? I figured I'd ask you given your name appears in the
dpkg-buildpackage man page ;)

David


On Wed, 2010-04-14 at 15:14 +0200, Brigitta Bennici wrote:
> Hello Isidor,
> yes i use the CentOS rpm. So I have to build an rpm from the source?  
> Any information about it?
> Regards,
> 
> Brigitta Bennici
> E-mail: b.bennici at it360.it
> Web: http://www.it360.it
> 
> ----------------------------------------------------------------------------
> ----------------
> Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> alle persone sopra indicate e le informazioni in essa contenute sono da
> considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> diffondere il contenuto della presente mail senza autorizzazione. Se avete
> ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> al mittente. Grazie
> 
> 
> -----Messaggio originale-----
> Da: chilli-bounces at coova.org [mailto:chilli-bounces at coova.org] Per conto di
> chilli-request at coova.org
> Inviato: mercoled? 14 aprile 2010 14.00
> A: chilli at coova.org
> Oggetto: Chilli Digest, Vol 7, Issue 13
> 
> Send Chilli mailing list submissions to
> 	chilli at coova.org
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> 	http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> or, via email, send a message with subject or body 'help' to
> 	chilli-request at coova.org
> 
> You can reach the person managing the list at
> 	chilli-owner at coova.org
> 
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Chilli digest..."
> 
> 
> Today's Topics:
> 
>    1. Re: help with openssl (Isidor Zeuner)
>    2. Re: Squid transparent proxy on same server (Isidor Zeuner)
>    3. R:  help with openssl (Brigitta Bennici)
> 
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Wed, 14 Apr 2010 06:51:21 +0200 (CEST)
> From: Isidor Zeuner <chilli at quidecco.de>
> Subject: Re: [Chilli] help with openssl
> To: <chilli at coova.org>
> Message-ID: <20100414045121.7EF2D786F84 at quidecco.de>
> Content-Type: text/plain;	charset="iso-8859-1"
> 
> Hello,
> 
> > 
> > i have problems installing coova-chilli in my CentOS 5.4: when I try to
> > install the rpm it fails for a openssl 0.9.8.
> > 
> > I have installed 0.9.8b version and no downgrade is possible.
> > 
> 
> What rpm did you use? Was it one built for CentOS 5.4?
> 
> The coova-chilli source tree comes with a spec file which can be used
> to build rpm packages using rpmbuild.
> 
> Best regards,
> 
> Isidor
> 
> 
> ------------------------------
> 
> Message: 2
> Date: Wed, 14 Apr 2010 06:42:34 +0200 (CEST)
> From: Isidor Zeuner <chilli at quidecco.de>
> Subject: Re: [Chilli] Squid transparent proxy on same server
> To: chilli at coova.org
> Message-ID: <20100414044234.48942786F23 at quidecco.de>
> Content-Type: text/plain; charset=ISO-8859-1
> 
> Hi Jason,
> 
> > 
> > Can anyone share configuration settings (or point me towards and article
> or
> > how-to), with regard to iptable rules, to ensure that port 80 traffic is
> > transparently routed through to squid? I'd need to ensure that port 80
> > traffic to the server itself is still available as the server runs apache
> > for teh charging portal.
> > 
> 
> The HS_POSTAUTH_PROXY and HS_POSTAUTH_PROXYPORT configuration settings
> are there to configure a transparent proxy to handle requests after
> the user is authenticated. This is handled through chilli, not
> iptables, and does not prevent you from still running a web server.
> 
> Best regards,
> 
> Isidor
> 
> 
> ------------------------------
> 
> Message: 3
> Date: Wed, 14 Apr 2010 10:22:58 +0200
> From: "Brigitta Bennici" <b.bennici at it360.it>
> Subject: [Chilli] R:  help with openssl
> To: "'David Bird'" <david at coova.com>
> Cc: chilli at coova.org
> Message-ID: <001601cadbab$b10dc280$13294780$@bennici at it360.it>
> Content-Type: text/plain;	charset="UTF-8"
> 
> Sorry David,
> i didn't answer to all before. As I said the problem is that
> 1)When I try to install rpm, I fail because of dependencies for libraries of
> openssl 0.9.8.
> 2)I tried to install forcing the dependencies, the installation goes fine,
> but when I try to start chilli:it fails because it doesn't find
> libssl.so.0.9.8
> 3)i tried to download the tar.gz file but after the command make I have
> these errors:
> make[2]: Entering directory `/home/centos/coova-chilli-1.2.2/debian'
> make[2]: Nothing to be done for `all'.
> make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2/debian'
> make[2]: Entering directory `/home/centos/coova-chilli-1.2.2'
> make[2]: Nothing to be done for `all-am'.
> make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2'
> make[1]: Leaving directory `/home/centos/coova-chilli-1.2.2'
> 
> Hope it is useful
> 
> Thank you very much.
> 
> Kind regards
> 
> 
> Brigitta Bennici
> E-mail: b.bennici at it360.it
> Web: http://www.it360.it
> 
> ----------------------------------------------------------------------------
> ----------------
> Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> alle persone sopra indicate e le informazioni in essa contenute sono da
> considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> diffondere il contenuto della presente mail senza autorizzazione. Se avete
> ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> al mittente. Grazie
> 
> 
> -----Messaggio originale-----
> Da: David Bird [mailto:david at coova.com] 
> Inviato: mercoled? 14 aprile 2010 6.30
> A: Brigitta Bennici
> Cc: chilli at coova.org
> Oggetto: Re: [Chilli] help with openssl
> 
> Hi, You will likely want to build from source instead. 
> 
> 
> On Tue, 2010-04-13 at 17:34 +0200, Brigitta Bennici wrote:
> > Hello,
> > 
> > i have problems installing coova-chilli in my CentOS 5.4: when I try
> > to install the rpm it fails for a openssl 0.9.8.
> > 
> > I have installed 0.9.8b version and no downgrade is possible.
> > 
> > Anyone can help?
> > 
> > Thanks a lot
> > 
> >  
> > 
> > Regards
> > 
> >  
> > 
> > Brigitta Bennici
> > E-mail: b.bennici at it360.it
> > Web: http://www.it360.it
> > 
> >  
> > 
> >
> ----------------------------------------------------------------------------
> ----------------
> > Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> > personale (DLgs. 196/03 e collegate), questa mail ? destinata
> > unicamente
> > alle persone sopra indicate e le informazioni in essa contenute sono
> > da
> > considerarsi strettamente riservate. E' proibito leggere, copiare,
> > usare o
> > diffondere il contenuto della presente mail senza autorizzazione. Se
> > avete
> > ricevuto questo messaggio per errore, siete pregati di rispedire lo
> > stesso
> > al mittente. Grazie
> > 
> >  
> > 
> > 
> > _______________________________________________
> > Chilli mailing list
> > Chilli at coova.org
> > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> 
> 
> 
> 
> ------------------------------
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> 
> 
> End of Chilli Digest, Vol 7, Issue 13
> *************************************
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From wichert at wiggy.net  Wed Apr 14 13:22:26 2010
From: wichert at wiggy.net (Wichert Akkerman)
Date: Wed, 14 Apr 2010 15:22:26 +0200
Subject: [Chilli] R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <1271251168.15867.7.camel@david-laptop>
References: <mailman.1.1271246402.10516.chilli@coova.org>	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>
	<1271251168.15867.7.camel@david-laptop>
Message-ID: <4BC5C192.907@wiggy.net>

On 4/14/10 15:19 , David Bird wrote:
> see http://www.coova.org/CoovaChilli/DistroBuilding
>
> also, while on the topic of building, Wickert I think you changed
> debian/rules making the install directory debian/coova-chilli instead of
> debian/tmp, but that makes my building (using debuild as shown on that
> page) fail. ? I figured I'd ask you given your name appears in the
> dpkg-buildpackage man page ;)

That's more a debhelper thing than a dpkg thing. debian/tmp has not been 
the right place to install things for a few years. I saw that things 
were partially installed in debian/tmp and partially in 
debian/coova-chilli which resulted in a broken package being created.

Wichert.

From b.bennici at it360.it  Wed Apr 14 15:20:02 2010
From: b.bennici at it360.it (Brigitta Bennici)
Date: Wed, 14 Apr 2010 17:20:02 +0200
Subject: [Chilli] R:  R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <1271251168.15867.7.camel@david-laptop>
References: <mailman.1.1271246402.10516.chilli@coova.org>	
	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>
	<1271251168.15867.7.camel@david-laptop>
Message-ID: <002901cadbe5$f6050bc0$e20f2340$@bennici@it360.it>

Thanks david,
i tried to do rpmbuild but I had errors too.
I attached the config.log I hope it describes better what is my problem. :(
Thanks again you are so kind

My best regards,

Brigitta Bennici
E-mail: b.bennici at it360.it
Web: http://www.it360.it

--------------------------------------------------------------------------------------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie


-----Messaggio originale-----
Da: David Bird [mailto:david at coova.com] 
Inviato: mercoled? 14 aprile 2010 15.19
A: Brigitta Bennici
Cc: chilli at quidecco.de; chilli at coova.org
Oggetto: Re: [Chilli] R: Chilli Digest, Vol 7, Issue 13

see http://www.coova.org/CoovaChilli/DistroBuilding

also, while on the topic of building, Wickert I think you changed
debian/rules making the install directory debian/coova-chilli instead of
debian/tmp, but that makes my building (using debuild as shown on that
page) fail. ? I figured I'd ask you given your name appears in the
dpkg-buildpackage man page ;)

David


On Wed, 2010-04-14 at 15:14 +0200, Brigitta Bennici wrote:
> Hello Isidor,
> yes i use the CentOS rpm. So I have to build an rpm from the source?  
> Any information about it?
> Regards,
> 
> Brigitta Bennici
> E-mail: b.bennici at it360.it
> Web: http://www.it360.it
> 
> ----------------------------------------------------------------------------
> ----------------
> Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> alle persone sopra indicate e le informazioni in essa contenute sono da
> considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> diffondere il contenuto della presente mail senza autorizzazione. Se avete
> ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> al mittente. Grazie
> 
> 
> -----Messaggio originale-----
> Da: chilli-bounces at coova.org [mailto:chilli-bounces at coova.org] Per conto di
> chilli-request at coova.org
> Inviato: mercoled? 14 aprile 2010 14.00
> A: chilli at coova.org
> Oggetto: Chilli Digest, Vol 7, Issue 13
> 
> Send Chilli mailing list submissions to
> 	chilli at coova.org
> 
> To subscribe or unsubscribe via the World Wide Web, visit
> 	http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> or, via email, send a message with subject or body 'help' to
> 	chilli-request at coova.org
> 
> You can reach the person managing the list at
> 	chilli-owner at coova.org
> 
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Chilli digest..."
> 
> 
> Today's Topics:
> 
>    1. Re: help with openssl (Isidor Zeuner)
>    2. Re: Squid transparent proxy on same server (Isidor Zeuner)
>    3. R:  help with openssl (Brigitta Bennici)
> 
> 
> ----------------------------------------------------------------------
> 
> Message: 1
> Date: Wed, 14 Apr 2010 06:51:21 +0200 (CEST)
> From: Isidor Zeuner <chilli at quidecco.de>
> Subject: Re: [Chilli] help with openssl
> To: <chilli at coova.org>
> Message-ID: <20100414045121.7EF2D786F84 at quidecco.de>
> Content-Type: text/plain;	charset="iso-8859-1"
> 
> Hello,
> 
> > 
> > i have problems installing coova-chilli in my CentOS 5.4: when I try to
> > install the rpm it fails for a openssl 0.9.8.
> > 
> > I have installed 0.9.8b version and no downgrade is possible.
> > 
> 
> What rpm did you use? Was it one built for CentOS 5.4?
> 
> The coova-chilli source tree comes with a spec file which can be used
> to build rpm packages using rpmbuild.
> 
> Best regards,
> 
> Isidor
> 
> 
> ------------------------------
> 
> Message: 2
> Date: Wed, 14 Apr 2010 06:42:34 +0200 (CEST)
> From: Isidor Zeuner <chilli at quidecco.de>
> Subject: Re: [Chilli] Squid transparent proxy on same server
> To: chilli at coova.org
> Message-ID: <20100414044234.48942786F23 at quidecco.de>
> Content-Type: text/plain; charset=ISO-8859-1
> 
> Hi Jason,
> 
> > 
> > Can anyone share configuration settings (or point me towards and article
> or
> > how-to), with regard to iptable rules, to ensure that port 80 traffic is
> > transparently routed through to squid? I'd need to ensure that port 80
> > traffic to the server itself is still available as the server runs apache
> > for teh charging portal.
> > 
> 
> The HS_POSTAUTH_PROXY and HS_POSTAUTH_PROXYPORT configuration settings
> are there to configure a transparent proxy to handle requests after
> the user is authenticated. This is handled through chilli, not
> iptables, and does not prevent you from still running a web server.
> 
> Best regards,
> 
> Isidor
> 
> 
> ------------------------------
> 
> Message: 3
> Date: Wed, 14 Apr 2010 10:22:58 +0200
> From: "Brigitta Bennici" <b.bennici at it360.it>
> Subject: [Chilli] R:  help with openssl
> To: "'David Bird'" <david at coova.com>
> Cc: chilli at coova.org
> Message-ID: <001601cadbab$b10dc280$13294780$@bennici at it360.it>
> Content-Type: text/plain;	charset="UTF-8"
> 
> Sorry David,
> i didn't answer to all before. As I said the problem is that
> 1)When I try to install rpm, I fail because of dependencies for libraries of
> openssl 0.9.8.
> 2)I tried to install forcing the dependencies, the installation goes fine,
> but when I try to start chilli:it fails because it doesn't find
> libssl.so.0.9.8
> 3)i tried to download the tar.gz file but after the command make I have
> these errors:
> make[2]: Entering directory `/home/centos/coova-chilli-1.2.2/debian'
> make[2]: Nothing to be done for `all'.
> make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2/debian'
> make[2]: Entering directory `/home/centos/coova-chilli-1.2.2'
> make[2]: Nothing to be done for `all-am'.
> make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2'
> make[1]: Leaving directory `/home/centos/coova-chilli-1.2.2'
> 
> Hope it is useful
> 
> Thank you very much.
> 
> Kind regards
> 
> 
> Brigitta Bennici
> E-mail: b.bennici at it360.it
> Web: http://www.it360.it
> 
> ----------------------------------------------------------------------------
> ----------------
> Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> alle persone sopra indicate e le informazioni in essa contenute sono da
> considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> diffondere il contenuto della presente mail senza autorizzazione. Se avete
> ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> al mittente. Grazie
> 
> 
> -----Messaggio originale-----
> Da: David Bird [mailto:david at coova.com] 
> Inviato: mercoled? 14 aprile 2010 6.30
> A: Brigitta Bennici
> Cc: chilli at coova.org
> Oggetto: Re: [Chilli] help with openssl
> 
> Hi, You will likely want to build from source instead. 
> 
> 
> On Tue, 2010-04-13 at 17:34 +0200, Brigitta Bennici wrote:
> > Hello,
> > 
> > i have problems installing coova-chilli in my CentOS 5.4: when I try
> > to install the rpm it fails for a openssl 0.9.8.
> > 
> > I have installed 0.9.8b version and no downgrade is possible.
> > 
> > Anyone can help?
> > 
> > Thanks a lot
> > 
> >  
> > 
> > Regards
> > 
> >  
> > 
> > Brigitta Bennici
> > E-mail: b.bennici at it360.it
> > Web: http://www.it360.it
> > 
> >  
> > 
> >
> ----------------------------------------------------------------------------
> ----------------
> > Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> > personale (DLgs. 196/03 e collegate), questa mail ? destinata
> > unicamente
> > alle persone sopra indicate e le informazioni in essa contenute sono
> > da
> > considerarsi strettamente riservate. E' proibito leggere, copiare,
> > usare o
> > diffondere il contenuto della presente mail senza autorizzazione. Se
> > avete
> > ricevuto questo messaggio per errore, siete pregati di rispedire lo
> > stesso
> > al mittente. Grazie
> > 
> >  
> > 
> > 
> > _______________________________________________
> > Chilli mailing list
> > Chilli at coova.org
> > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> 
> 
> 
> 
> ------------------------------
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> 
> 
> End of Chilli Digest, Vol 7, Issue 13
> *************************************
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli

-------------- next part --------------
A non-text attachment was scrubbed...
Name: config.log
Type: application/octet-stream
Size: 60362 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100414/8d81114f/attachment-0001.obj>

From jason at theallens.id.au  Thu Apr 15 01:13:12 2010
From: jason at theallens.id.au (Jason Allen)
Date: Thu, 15 Apr 2010 11:13:12 +1000
Subject: [Chilli] Squid transparent proxy on same server
In-Reply-To: <20100414044234.48942786F23@quidecco.de>
References: <l2s3e888d0e1004131733r6307cb4r4fb5533d21588760@mail.gmail.com> 
	<20100414044234.48942786F23@quidecco.de>
Message-ID: <m2q3e888d0e1004141813m3d3fc7a6x10dac3bf40018ee3@mail.gmail.com>

Thanks Isidor, this looks great.

How does it work? ( I could not find any further details on coova's website
or wiki). Does chilli auto redirect the post-auth user received packets to
the defined proxy server? Is it only port 80 destination traffic? Thus if
squid is installed on the same box as coova (and apache), then 127.0.0.1 and
3128 would be valid and correct entries?

I'm using Coova v1.2.1 and have set the config file proxy settings to
127.0.0.1 3128 but am not seeing any client activity in squid's access.log.
I know squid is working properly, because if I define the proxy in a client
browser then squid's access.log is recording the relevant entries.


Thanks.

On Wed, Apr 14, 2010 at 14:42, Isidor Zeuner <chilli at quidecco.de> wrote:

> Hi Jason,
>
> >
> > Can anyone share configuration settings (or point me towards and article
> or
> > how-to), with regard to iptable rules, to ensure that port 80 traffic is
> > transparently routed through to squid? I'd need to ensure that port 80
> > traffic to the server itself is still available as the server runs apache
> > for teh charging portal.
> >
>
> The HS_POSTAUTH_PROXY and HS_POSTAUTH_PROXYPORT configuration settings
> are there to configure a transparent proxy to handle requests after
> the user is authenticated. This is handled through chilli, not
> iptables, and does not prevent you from still running a web server.
>
> Best regards,
>
> Isidor
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>



-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100415/70d446db/attachment.htm>

From chilli at quidecco.de  Thu Apr 15 01:17:06 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Thu, 15 Apr 2010 03:17:06 +0200 (CEST)
Subject: [Chilli] R:  R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <002901cadbe5$f6050bc0$e20f2340$@bennici@it360.it>
References: <002901cadbe5$f6050bc0$e20f2340$@bennici@it360.it>
	<mailman.1.1271246402.10516.chilli@coova.org>	
	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>
	<1271251168.15867.7.camel@david-laptop>
Message-ID: <20100415011706.B494B787679@quidecco.de>

Hi Brigitta,

> i tried to do rpmbuild but I had errors too.
> I attached the config.log I hope it describes better what is my problem. :(

It looks like the openssl-devel package is not installed. It is needed
for building RPMs that link against openssl.

David, should this package be listed under BuildRequires in the spec
file, as the spec file sets "--with-openssl"?

Best regards,

Isidor

From b.bennici at it360.it  Thu Apr 15 08:23:56 2010
From: b.bennici at it360.it (Brigitta Bennici)
Date: Thu, 15 Apr 2010 10:23:56 +0200
Subject: [Chilli] R: R:  R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <20100415011706.B494B787679@quidecco.de>
References: <002901cadbe5$f6050bc0$e20f2340$@bennici@it360.it>
	<mailman.1.1271246402.10516.chilli@coova.org>	
	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>
	<1271251168.15867.7.camel@david-laptop>
	<20100415011706.B494B787679@quidecco.de>
Message-ID: <004e01cadc74$ff1e18c0$fd5a4a40$@bennici@it360.it>

Hello friends,
i followed Isidor kind advice, installed openssl-devel, I tried rpmbuild but still problems.
I attached the outpout.
Another question: my priority is to have anyIP and anyDNS correctly running.
Can I try some other version or you think I will have the same problems installing coova-chilli?
Thank you so much for your support 

My best regards,

Brigitta Bennici
E-mail: b.bennici at it360.it
Web: http://www.it360.it

--------------------------------------------------------------------------------------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie


-----Messaggio originale-----
Da: Isidor Zeuner [mailto:chilli at quidecco.de] 
Inviato: gioved? 15 aprile 2010 3.17
A: Brigitta Bennici
Cc: 'David Bird'; chilli at coova.org
Oggetto: Re: R: [Chilli] R: Chilli Digest, Vol 7, Issue 13

Hi Brigitta,

> i tried to do rpmbuild but I had errors too.
> I attached the config.log I hope it describes better what is my problem. :(

It looks like the openssl-devel package is not installed. It is needed
for building RPMs that link against openssl.

David, should this package be listed under BuildRequires in the spec
file, as the spec file sets "--with-openssl"?

Best regards,

Isidor
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: bri.txt
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100415/a7e461bd/attachment-0001.txt>

From chilli at quidecco.de  Thu Apr 15 09:32:01 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Thu, 15 Apr 2010 11:32:01 +0200 (CEST)
Subject: [Chilli] Squid transparent proxy on same server
In-Reply-To: <m2q3e888d0e1004141813m3d3fc7a6x10dac3bf40018ee3@mail.gmail.com>
References: <m2q3e888d0e1004141813m3d3fc7a6x10dac3bf40018ee3@mail.gmail.com>
	<l2s3e888d0e1004131733r6307cb4r4fb5533d21588760@mail.gmail.com> 
	<20100414044234.48942786F23@quidecco.de>
Message-ID: <20100415093201.C77D1787B71@quidecco.de>

Hi Jason,

> 
> How does it work? ( I could not find any further details on coova's website
> or wiki). Does chilli auto redirect the post-auth user received packets to
> the defined proxy server? Is it only port 80 destination traffic? Thus if
> squid is installed on the same box as coova (and apache), then 127.0.0.1 and
> 3128 would be valid and correct entries?
> 

Yes, the setting causes port 80 traffic to be routed through the
supplied proxy server, plus port 443 traffic if the HS_REDIRSSL is
set.

I have used the "squid on the same box as chilli" scenario with squid
listening on virtual IPs on the 10.0.0.0/8 block (because I had to
have squid distinguish between different configurations based on these
IPs), but I don't see why 127.0.0.1 shouldn't work, too.

> I'm using Coova v1.2.1 and have set the config file proxy settings to
> 127.0.0.1 3128 but am not seeing any client activity in squid's access.log.
> I know squid is working properly, because if I define the proxy in a client
> browser then squid's access.log is recording the relevant entries.
> 

Did you configure squid to run as a transparent proxy? This is most
likely not what you would have if it is used in a browser proxy
setting, but chilli's HS_POSTAUTH_PROXY setting expects a
transparent proxy.

With debug logging enabled, chilli will diagnostics like "rewriting
packet for post-auth proxy..." when using the proxy setting, which
might help to test your configuration.

Best regards,

Isidor

From d.courtaillier at gmail.com  Thu Apr 15 15:36:12 2010
From: d.courtaillier at gmail.com (Damien Courtaillier)
Date: Thu, 15 Apr 2010 17:36:12 +0200
Subject: [Chilli] Radius Proxy
Message-ID: <s2yf1b5213e1004150836x29780039jfd0ff89e3725c654@mail.gmail.com>

Hello,

I'm trying to setup coova as a radius proxy, using radproxy options.
I use coova-chilli 1.2.3 (from the svn) on OpenWrt Kamikaze

coova runs directly on the AP that provides WPA2 wireless.

When I try to connect, I can see the Access-Accept in my radius log, but
coova never gives acces to the client.

Here is coova's output:

chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 701a04a76fc3
dhcp.c: 389: 0 (Debug) DHCP newconn: 70:1a:04:a7:6f:c3
chilli.c: 3285: 0 (Debug) New DHCP request from MAC=70-1A-04-A7-6F-C3
chilli.c: 3288: 0 (Debug) New DHCP connection established
radius.c: 1446: 0 (Debug) RADIUS to 192.168.0.5:1812
chilli.c: 2792: 0 (Debug) Received access request confirmation from radius
server

chilli.c: 2828: 0 (Debug) Received access challenge from radius server
chilli.c: 920: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 701a04a76fc3
radius.c: 1446: 0 (Debug) RADIUS to 192.168.0.5:1812
chilli.c: 2792: 0 (Debug) Received access request confirmation from radius
server

Coova receives the dhcp request but seems not to respond to it...

when I try a chilli_query list, I get:

70-1A-04-A7-6F-C3 10.1.0.2 pass 4bc72fad44400001 1 net_test 9/0 9/0 0/0 0/0
0 0 0/0 0/0 -

It is the MAC address of my client, so chilli thinks it is connected however
it is not...

I tried giving an address directly to the client, I definitely can't
communicate with my AP.

What am  I doing wrong?

Does the WPA2 client communicate with coova's tun interface or directly with
the bridge ?
Actually, does the WPA2 clients have to be connected directly to the network
handled by coova (that is my case) or  can they connect to another network,
and coova just makes the authentication ?

Thanks for your answers.

Cheers.

Damien Courtaillier
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100415/0a96cc41/attachment.htm>

From jason at theallens.id.au  Fri Apr 16 01:02:57 2010
From: jason at theallens.id.au (Jason Allen)
Date: Fri, 16 Apr 2010 11:02:57 +1000
Subject: [Chilli] Squid transparent proxy on same server
In-Reply-To: <20100415093201.C77D1787B71@quidecco.de>
References: <l2s3e888d0e1004131733r6307cb4r4fb5533d21588760@mail.gmail.com> 
	<20100414044234.48942786F23@quidecco.de>
	<m2q3e888d0e1004141813m3d3fc7a6x10dac3bf40018ee3@mail.gmail.com>
	<20100415093201.C77D1787B71@quidecco.de>
Message-ID: <z2p3e888d0e1004151802x93ab87fbxb4a33e91f1d5f4e5@mail.gmail.com>

On Thu, Apr 15, 2010 at 19:32, Isidor Zeuner <chilli at quidecco.de> wrote:

> Hi Jason,
>
> >
> > How does it work? ( I could not find any further details on coova's
> website
> > or wiki). Does chilli auto redirect the post-auth user received packets
> to
> > the defined proxy server? Is it only port 80 destination traffic? Thus if
> > squid is installed on the same box as coova (and apache), then 127.0.0.1
> and
> > 3128 would be valid and correct entries?
> >
>
> Yes, the setting causes port 80 traffic to be routed through the
> supplied proxy server, plus port 443 traffic if the HS_REDIRSSL is
> set.
>
> I have used the "squid on the same box as chilli" scenario with squid
> listening on virtual IPs on the 10.0.0.0/8 block (because I had to
> have squid distinguish between different configurations based on these
> IPs), but I don't see why 127.0.0.1 shouldn't work, too.
>

Interesting. My concern is that if I have squid listening on the ethernet
adapter (or ip range) that the wireless clients are using, then wouldn't
they be able to bypass chilli and it's authentication altogether by
assigning the squid server directly within their browser?

Scenario ... chilli, dhcp, squid is on the one box called
wireless.mydomain.com. If the authenticated wireless client configures their
browser to us a proxy on wireless.mydomain.com:3128, then would they be able
to bypass chilli (and authentication) altogether? That's why my thinking is
that I would only want squid listening on the localhost and not on the
ethernet or ip range that wireless clients are using?



> > I'm using Coova v1.2.1 and have set the config file proxy settings to
> > 127.0.0.1 3128 but am not seeing any client activity in squid's
> access.log.
> > I know squid is working properly, because if I define the proxy in a
> client
> > browser then squid's access.log is recording the relevant entries.
> >
>
> Did you configure squid to run as a transparent proxy? This is most
> likely not what you would have if it is used in a browser proxy
> setting, but chilli's HS_POSTAUTH_PROXY setting expects a
> transparent proxy.
>

I have "http_port 3128 transparent" configured within squid, so I do not
think that is my issue


> With debug logging enabled, chilli will diagnostics like "rewriting
> packet for post-auth proxy..." when using the proxy setting, which
> might help to test your configuration.
>

I will give this a try and see what it reveals.

Thanks.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100416/038633e2/attachment.htm>

From david at coova.com  Fri Apr 16 06:33:47 2010
From: david at coova.com (David Bird)
Date: Fri, 16 Apr 2010 08:33:47 +0200
Subject: [Chilli] R:  R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <002901cadbe5$f6050bc0$e20f2340$@bennici@it360.it>
References: <mailman.1.1271246402.10516.chilli@coova.org>
	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>
	<1271251168.15867.7.camel@david-laptop>
	<002901cadbe5$f6050bc0$e20f2340$@bennici@it360.it>
Message-ID: <1271399627.15867.59.camel@david-laptop>

You can also try building without the --with-openssl option. But your
log seems to indicate you don't have openssl installed. 

On Wed, 2010-04-14 at 17:20 +0200, Brigitta Bennici wrote:
> Thanks david,
> i tried to do rpmbuild but I had errors too.
> I attached the config.log I hope it describes better what is my problem. :(
> Thanks again you are so kind
> 
> My best regards,
> 
> Brigitta Bennici
> E-mail: b.bennici at it360.it
> Web: http://www.it360.it
> 
> --------------------------------------------------------------------------------------------
> Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> alle persone sopra indicate e le informazioni in essa contenute sono da
> considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> diffondere il contenuto della presente mail senza autorizzazione. Se avete
> ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> al mittente. Grazie
> 
> 
> -----Messaggio originale-----
> Da: David Bird [mailto:david at coova.com] 
> Inviato: mercoled? 14 aprile 2010 15.19
> A: Brigitta Bennici
> Cc: chilli at quidecco.de; chilli at coova.org
> Oggetto: Re: [Chilli] R: Chilli Digest, Vol 7, Issue 13
> 
> see http://www.coova.org/CoovaChilli/DistroBuilding
> 
> also, while on the topic of building, Wickert I think you changed
> debian/rules making the install directory debian/coova-chilli instead of
> debian/tmp, but that makes my building (using debuild as shown on that
> page) fail. ? I figured I'd ask you given your name appears in the
> dpkg-buildpackage man page ;)
> 
> David
> 
> 
> On Wed, 2010-04-14 at 15:14 +0200, Brigitta Bennici wrote:
> > Hello Isidor,
> > yes i use the CentOS rpm. So I have to build an rpm from the source?  
> > Any information about it?
> > Regards,
> > 
> > Brigitta Bennici
> > E-mail: b.bennici at it360.it
> > Web: http://www.it360.it
> > 
> > ----------------------------------------------------------------------------
> > ----------------
> > Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> > personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> > alle persone sopra indicate e le informazioni in essa contenute sono da
> > considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> > diffondere il contenuto della presente mail senza autorizzazione. Se avete
> > ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> > al mittente. Grazie
> > 
> > 
> > -----Messaggio originale-----
> > Da: chilli-bounces at coova.org [mailto:chilli-bounces at coova.org] Per conto di
> > chilli-request at coova.org
> > Inviato: mercoled? 14 aprile 2010 14.00
> > A: chilli at coova.org
> > Oggetto: Chilli Digest, Vol 7, Issue 13
> > 
> > Send Chilli mailing list submissions to
> > 	chilli at coova.org
> > 
> > To subscribe or unsubscribe via the World Wide Web, visit
> > 	http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> > or, via email, send a message with subject or body 'help' to
> > 	chilli-request at coova.org
> > 
> > You can reach the person managing the list at
> > 	chilli-owner at coova.org
> > 
> > When replying, please edit your Subject line so it is more specific
> > than "Re: Contents of Chilli digest..."
> > 
> > 
> > Today's Topics:
> > 
> >    1. Re: help with openssl (Isidor Zeuner)
> >    2. Re: Squid transparent proxy on same server (Isidor Zeuner)
> >    3. R:  help with openssl (Brigitta Bennici)
> > 
> > 
> > ----------------------------------------------------------------------
> > 
> > Message: 1
> > Date: Wed, 14 Apr 2010 06:51:21 +0200 (CEST)
> > From: Isidor Zeuner <chilli at quidecco.de>
> > Subject: Re: [Chilli] help with openssl
> > To: <chilli at coova.org>
> > Message-ID: <20100414045121.7EF2D786F84 at quidecco.de>
> > Content-Type: text/plain;	charset="iso-8859-1"
> > 
> > Hello,
> > 
> > > 
> > > i have problems installing coova-chilli in my CentOS 5.4: when I try to
> > > install the rpm it fails for a openssl 0.9.8.
> > > 
> > > I have installed 0.9.8b version and no downgrade is possible.
> > > 
> > 
> > What rpm did you use? Was it one built for CentOS 5.4?
> > 
> > The coova-chilli source tree comes with a spec file which can be used
> > to build rpm packages using rpmbuild.
> > 
> > Best regards,
> > 
> > Isidor
> > 
> > 
> > ------------------------------
> > 
> > Message: 2
> > Date: Wed, 14 Apr 2010 06:42:34 +0200 (CEST)
> > From: Isidor Zeuner <chilli at quidecco.de>
> > Subject: Re: [Chilli] Squid transparent proxy on same server
> > To: chilli at coova.org
> > Message-ID: <20100414044234.48942786F23 at quidecco.de>
> > Content-Type: text/plain; charset=ISO-8859-1
> > 
> > Hi Jason,
> > 
> > > 
> > > Can anyone share configuration settings (or point me towards and article
> > or
> > > how-to), with regard to iptable rules, to ensure that port 80 traffic is
> > > transparently routed through to squid? I'd need to ensure that port 80
> > > traffic to the server itself is still available as the server runs apache
> > > for teh charging portal.
> > > 
> > 
> > The HS_POSTAUTH_PROXY and HS_POSTAUTH_PROXYPORT configuration settings
> > are there to configure a transparent proxy to handle requests after
> > the user is authenticated. This is handled through chilli, not
> > iptables, and does not prevent you from still running a web server.
> > 
> > Best regards,
> > 
> > Isidor
> > 
> > 
> > ------------------------------
> > 
> > Message: 3
> > Date: Wed, 14 Apr 2010 10:22:58 +0200
> > From: "Brigitta Bennici" <b.bennici at it360.it>
> > Subject: [Chilli] R:  help with openssl
> > To: "'David Bird'" <david at coova.com>
> > Cc: chilli at coova.org
> > Message-ID: <001601cadbab$b10dc280$13294780$@bennici at it360.it>
> > Content-Type: text/plain;	charset="UTF-8"
> > 
> > Sorry David,
> > i didn't answer to all before. As I said the problem is that
> > 1)When I try to install rpm, I fail because of dependencies for libraries of
> > openssl 0.9.8.
> > 2)I tried to install forcing the dependencies, the installation goes fine,
> > but when I try to start chilli:it fails because it doesn't find
> > libssl.so.0.9.8
> > 3)i tried to download the tar.gz file but after the command make I have
> > these errors:
> > make[2]: Entering directory `/home/centos/coova-chilli-1.2.2/debian'
> > make[2]: Nothing to be done for `all'.
> > make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2/debian'
> > make[2]: Entering directory `/home/centos/coova-chilli-1.2.2'
> > make[2]: Nothing to be done for `all-am'.
> > make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2'
> > make[1]: Leaving directory `/home/centos/coova-chilli-1.2.2'
> > 
> > Hope it is useful
> > 
> > Thank you very much.
> > 
> > Kind regards
> > 
> > 
> > Brigitta Bennici
> > E-mail: b.bennici at it360.it
> > Web: http://www.it360.it
> > 
> > ----------------------------------------------------------------------------
> > ----------------
> > Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> > personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> > alle persone sopra indicate e le informazioni in essa contenute sono da
> > considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> > diffondere il contenuto della presente mail senza autorizzazione. Se avete
> > ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> > al mittente. Grazie
> > 
> > 
> > -----Messaggio originale-----
> > Da: David Bird [mailto:david at coova.com] 
> > Inviato: mercoled? 14 aprile 2010 6.30
> > A: Brigitta Bennici
> > Cc: chilli at coova.org
> > Oggetto: Re: [Chilli] help with openssl
> > 
> > Hi, You will likely want to build from source instead. 
> > 
> > 
> > On Tue, 2010-04-13 at 17:34 +0200, Brigitta Bennici wrote:
> > > Hello,
> > > 
> > > i have problems installing coova-chilli in my CentOS 5.4: when I try
> > > to install the rpm it fails for a openssl 0.9.8.
> > > 
> > > I have installed 0.9.8b version and no downgrade is possible.
> > > 
> > > Anyone can help?
> > > 
> > > Thanks a lot
> > > 
> > >  
> > > 
> > > Regards
> > > 
> > >  
> > > 
> > > Brigitta Bennici
> > > E-mail: b.bennici at it360.it
> > > Web: http://www.it360.it
> > > 
> > >  
> > > 
> > >
> > ----------------------------------------------------------------------------
> > ----------------
> > > Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> > > personale (DLgs. 196/03 e collegate), questa mail ? destinata
> > > unicamente
> > > alle persone sopra indicate e le informazioni in essa contenute sono
> > > da
> > > considerarsi strettamente riservate. E' proibito leggere, copiare,
> > > usare o
> > > diffondere il contenuto della presente mail senza autorizzazione. Se
> > > avete
> > > ricevuto questo messaggio per errore, siete pregati di rispedire lo
> > > stesso
> > > al mittente. Grazie
> > > 
> > >  
> > > 
> > > 
> > > _______________________________________________
> > > Chilli mailing list
> > > Chilli at coova.org
> > > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> > 
> > 
> > 
> > 
> > ------------------------------
> > 
> > _______________________________________________
> > Chilli mailing list
> > Chilli at coova.org
> > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> > 
> > 
> > End of Chilli Digest, Vol 7, Issue 13
> > *************************************
> > 
> > _______________________________________________
> > Chilli mailing list
> > Chilli at coova.org
> > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> 



From david at coova.com  Fri Apr 16 06:37:21 2010
From: david at coova.com (David Bird)
Date: Fri, 16 Apr 2010 08:37:21 +0200
Subject: [Chilli] R:  R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <20100415011706.B494B787679@quidecco.de>
References: <002901cadbe5$f6050bc0$e20f2340$@bennici@it360.it>
	<mailman.1.1271246402.10516.chilli@coova.org>
	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>
	<1271251168.15867.7.camel@david-laptop>
	<20100415011706.B494B787679@quidecco.de>
Message-ID: <1271399841.15867.60.camel@david-laptop>

On Thu, 2010-04-15 at 03:17 +0200, Isidor Zeuner wrote:

> David, should this package be listed under BuildRequires in the spec
> file, as the spec file sets "--with-openssl"?
> 

Yes, it probably should. I will add it. 


From david at coova.com  Fri Apr 16 06:45:08 2010
From: david at coova.com (David Bird)
Date: Fri, 16 Apr 2010 08:45:08 +0200
Subject: [Chilli] R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <4BC5C192.907@wiggy.net>
References: <mailman.1.1271246402.10516.chilli@coova.org>
	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>
	<1271251168.15867.7.camel@david-laptop>  <4BC5C192.907@wiggy.net>
Message-ID: <1271400308.15867.66.camel@david-laptop>

I think it's the opposite for me... with your change, I found have of
the files in debian/tmp and others in debian/coova-chilli. I change the
rules back to installing to debian/tmp and all is well again for me.


On Wed, 2010-04-14 at 15:22 +0200, Wichert Akkerman wrote:
> On 4/14/10 15:19 , David Bird wrote:
> > see http://www.coova.org/CoovaChilli/DistroBuilding
> >
> > also, while on the topic of building, Wickert I think you changed
> > debian/rules making the install directory debian/coova-chilli instead of
> > debian/tmp, but that makes my building (using debuild as shown on that
> > page) fail. ? I figured I'd ask you given your name appears in the
> > dpkg-buildpackage man page ;)
> 
> That's more a debhelper thing than a dpkg thing. debian/tmp has not been 
> the right place to install things for a few years. I saw that things 
> were partially installed in debian/tmp and partially in 
> debian/coova-chilli which resulted in a broken package being created.
> 
> Wichert.
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From b.bennici at it360.it  Fri Apr 16 08:20:17 2010
From: b.bennici at it360.it (Brigitta Bennici)
Date: Fri, 16 Apr 2010 10:20:17 +0200
Subject: [Chilli] R: R:  R: Chilli Digest, Vol 7, Issue 13
In-Reply-To: <1271399841.15867.60.camel@david-laptop>
References: <002901cadbe5$f6050bc0$e20f2340$@bennici@it360.it>	
	<mailman.1.1271246402.10516.chilli@coova.org>	
	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>	
	<1271251168.15867.7.camel@david-laptop>	
	<20100415011706.B494B787679@quidecco.de>
	<1271399841.15867.60.camel@david-laptop>
Message-ID: <000901cadd3d$a6d438b0$f47caa10$@bennici@it360.it>

David,
i have openssl installed:

[centos at localhost coova-chilli-1.2.2]$ yum list openssl
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * addons: mirror.fraunhofer.de
 * base: ftp.eutelia.it
 * extras: ftp.eutelia.it
 * updates: ftp.eutelia.it
Installed Packages
openssl.i686                             0.9.8e-12.el5_4.6                              installed
Available Packages
openssl.i386                             0.9.8e-12.el5_4.6                              updates  

So, do you think I can try some other version to avoid this kind of problems?

Regards,

Brigitta Bennici
E-mail: b.bennici at it360.it
Web: http://www.it360.it

--------------------------------------------------------------------------------------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie

-----Messaggio originale-----
Da: David Bird [mailto:david at coova.com] 
Inviato: venerd? 16 aprile 2010 8.37
A: Isidor Zeuner
Cc: Brigitta Bennici; chilli at coova.org
Oggetto: Re: R: [Chilli] R: Chilli Digest, Vol 7, Issue 13

On Thu, 2010-04-15 at 03:17 +0200, Isidor Zeuner wrote:

> David, should this package be listed under BuildRequires in the spec
> file, as the spec file sets "--with-openssl"?
> 

Yes, it probably should. I will add it. 


From david at coova.com  Fri Apr 16 08:30:19 2010
From: david at coova.com (David Bird)
Date: Fri, 16 Apr 2010 10:30:19 +0200
Subject: [Chilli] Twitter, yes, it's inevitable
Message-ID: <1271406619.15867.70.camel@david-laptop>

Hello all,

I've setup a twitter list for coova:
http://twitter.com/wlanmac/coova

If you want to be listed, let me know! 

David


From b.bennici at it360.it  Fri Apr 16 09:36:36 2010
From: b.bennici at it360.it (Brigitta Bennici)
Date: Fri, 16 Apr 2010 11:36:36 +0200
Subject: [Chilli] R: R: help with openssl
In-Reply-To: <1271399627.15867.59.camel@david-laptop>
References: <mailman.1.1271246402.10516.chilli@coova.org>	
	<001b01cadbd4$782a2ca0$687e85e0$@bennici@it360.it>	
	<1271251168.15867.7.camel@david-laptop>	
	<002901cadbe5$f6050bc0$e20f2340$@bennici@it360.it>
	<1271399627.15867.59.camel@david-laptop>
Message-ID: <000d01cadd48$505964a0$f10c2de0$@bennici@it360.it>

David i tried to do what you say: i did rpmbuild without --with-openssl option, but when I try to start chilli :

[centos at localhost coova-chilli-1.2.2]$ /usr/sbin/chilli: error while loading shared libraries: libssl.so.0.9.8: cannot open shared object file: No such file or directory
                                                           [FAILED]

Thanks for your support

Regards,

Brigitta Bennici
E-mail: b.bennici at it360.it
Web: http://www.it360.it

--------------------------------------------------------------------------------------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie


-----Messaggio originale-----
Da: David Bird [mailto:david at coova.com] 
Inviato: venerd? 16 aprile 2010 8.34
A: Brigitta Bennici
Cc: chilli at quidecco.de; chilli at coova.org
Oggetto: Re: R: [Chilli] R: Chilli Digest, Vol 7, Issue 13

You can also try building without the --with-openssl option. But your
log seems to indicate you don't have openssl installed. 

On Wed, 2010-04-14 at 17:20 +0200, Brigitta Bennici wrote:
> Thanks david,
> i tried to do rpmbuild but I had errors too.
> I attached the config.log I hope it describes better what is my problem. :(
> Thanks again you are so kind
> 
> My best regards,
> 
> Brigitta Bennici
> E-mail: b.bennici at it360.it
> Web: http://www.it360.it
> 
> --------------------------------------------------------------------------------------------
> Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> alle persone sopra indicate e le informazioni in essa contenute sono da
> considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> diffondere il contenuto della presente mail senza autorizzazione. Se avete
> ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> al mittente. Grazie
> 
> 
> -----Messaggio originale-----
> Da: David Bird [mailto:david at coova.com] 
> Inviato: mercoled? 14 aprile 2010 15.19
> A: Brigitta Bennici
> Cc: chilli at quidecco.de; chilli at coova.org
> Oggetto: Re: [Chilli] R: Chilli Digest, Vol 7, Issue 13
> 
> see http://www.coova.org/CoovaChilli/DistroBuilding
> 
> also, while on the topic of building, Wickert I think you changed
> debian/rules making the install directory debian/coova-chilli instead of
> debian/tmp, but that makes my building (using debuild as shown on that
> page) fail. ? I figured I'd ask you given your name appears in the
> dpkg-buildpackage man page ;)
> 
> David
> 
> 
> On Wed, 2010-04-14 at 15:14 +0200, Brigitta Bennici wrote:
> > Hello Isidor,
> > yes i use the CentOS rpm. So I have to build an rpm from the source?  
> > Any information about it?
> > Regards,
> > 
> > Brigitta Bennici
> > E-mail: b.bennici at it360.it
> > Web: http://www.it360.it
> > 
> > ----------------------------------------------------------------------------
> > ----------------
> > Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> > personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> > alle persone sopra indicate e le informazioni in essa contenute sono da
> > considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> > diffondere il contenuto della presente mail senza autorizzazione. Se avete
> > ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> > al mittente. Grazie
> > 
> > 
> > -----Messaggio originale-----
> > Da: chilli-bounces at coova.org [mailto:chilli-bounces at coova.org] Per conto di
> > chilli-request at coova.org
> > Inviato: mercoled? 14 aprile 2010 14.00
> > A: chilli at coova.org
> > Oggetto: Chilli Digest, Vol 7, Issue 13
> > 
> > Send Chilli mailing list submissions to
> > 	chilli at coova.org
> > 
> > To subscribe or unsubscribe via the World Wide Web, visit
> > 	http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> > or, via email, send a message with subject or body 'help' to
> > 	chilli-request at coova.org
> > 
> > You can reach the person managing the list at
> > 	chilli-owner at coova.org
> > 
> > When replying, please edit your Subject line so it is more specific
> > than "Re: Contents of Chilli digest..."
> > 
> > 
> > Today's Topics:
> > 
> >    1. Re: help with openssl (Isidor Zeuner)
> >    2. Re: Squid transparent proxy on same server (Isidor Zeuner)
> >    3. R:  help with openssl (Brigitta Bennici)
> > 
> > 
> > ----------------------------------------------------------------------
> > 
> > Message: 1
> > Date: Wed, 14 Apr 2010 06:51:21 +0200 (CEST)
> > From: Isidor Zeuner <chilli at quidecco.de>
> > Subject: Re: [Chilli] help with openssl
> > To: <chilli at coova.org>
> > Message-ID: <20100414045121.7EF2D786F84 at quidecco.de>
> > Content-Type: text/plain;	charset="iso-8859-1"
> > 
> > Hello,
> > 
> > > 
> > > i have problems installing coova-chilli in my CentOS 5.4: when I try to
> > > install the rpm it fails for a openssl 0.9.8.
> > > 
> > > I have installed 0.9.8b version and no downgrade is possible.
> > > 
> > 
> > What rpm did you use? Was it one built for CentOS 5.4?
> > 
> > The coova-chilli source tree comes with a spec file which can be used
> > to build rpm packages using rpmbuild.
> > 
> > Best regards,
> > 
> > Isidor
> > 
> > 
> > ------------------------------
> > 
> > Message: 2
> > Date: Wed, 14 Apr 2010 06:42:34 +0200 (CEST)
> > From: Isidor Zeuner <chilli at quidecco.de>
> > Subject: Re: [Chilli] Squid transparent proxy on same server
> > To: chilli at coova.org
> > Message-ID: <20100414044234.48942786F23 at quidecco.de>
> > Content-Type: text/plain; charset=ISO-8859-1
> > 
> > Hi Jason,
> > 
> > > 
> > > Can anyone share configuration settings (or point me towards and article
> > or
> > > how-to), with regard to iptable rules, to ensure that port 80 traffic is
> > > transparently routed through to squid? I'd need to ensure that port 80
> > > traffic to the server itself is still available as the server runs apache
> > > for teh charging portal.
> > > 
> > 
> > The HS_POSTAUTH_PROXY and HS_POSTAUTH_PROXYPORT configuration settings
> > are there to configure a transparent proxy to handle requests after
> > the user is authenticated. This is handled through chilli, not
> > iptables, and does not prevent you from still running a web server.
> > 
> > Best regards,
> > 
> > Isidor
> > 
> > 
> > ------------------------------
> > 
> > Message: 3
> > Date: Wed, 14 Apr 2010 10:22:58 +0200
> > From: "Brigitta Bennici" <b.bennici at it360.it>
> > Subject: [Chilli] R:  help with openssl
> > To: "'David Bird'" <david at coova.com>
> > Cc: chilli at coova.org
> > Message-ID: <001601cadbab$b10dc280$13294780$@bennici at it360.it>
> > Content-Type: text/plain;	charset="UTF-8"
> > 
> > Sorry David,
> > i didn't answer to all before. As I said the problem is that
> > 1)When I try to install rpm, I fail because of dependencies for libraries of
> > openssl 0.9.8.
> > 2)I tried to install forcing the dependencies, the installation goes fine,
> > but when I try to start chilli:it fails because it doesn't find
> > libssl.so.0.9.8
> > 3)i tried to download the tar.gz file but after the command make I have
> > these errors:
> > make[2]: Entering directory `/home/centos/coova-chilli-1.2.2/debian'
> > make[2]: Nothing to be done for `all'.
> > make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2/debian'
> > make[2]: Entering directory `/home/centos/coova-chilli-1.2.2'
> > make[2]: Nothing to be done for `all-am'.
> > make[2]: Leaving directory `/home/centos/coova-chilli-1.2.2'
> > make[1]: Leaving directory `/home/centos/coova-chilli-1.2.2'
> > 
> > Hope it is useful
> > 
> > Thank you very much.
> > 
> > Kind regards
> > 
> > 
> > Brigitta Bennici
> > E-mail: b.bennici at it360.it
> > Web: http://www.it360.it
> > 
> > ----------------------------------------------------------------------------
> > ----------------
> > Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> > personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
> > alle persone sopra indicate e le informazioni in essa contenute sono da
> > considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
> > diffondere il contenuto della presente mail senza autorizzazione. Se avete
> > ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
> > al mittente. Grazie
> > 
> > 
> > -----Messaggio originale-----
> > Da: David Bird [mailto:david at coova.com] 
> > Inviato: mercoled? 14 aprile 2010 6.30
> > A: Brigitta Bennici
> > Cc: chilli at coova.org
> > Oggetto: Re: [Chilli] help with openssl
> > 
> > Hi, You will likely want to build from source instead. 
> > 
> > 
> > On Tue, 2010-04-13 at 17:34 +0200, Brigitta Bennici wrote:
> > > Hello,
> > > 
> > > i have problems installing coova-chilli in my CentOS 5.4: when I try
> > > to install the rpm it fails for a openssl 0.9.8.
> > > 
> > > I have installed 0.9.8b version and no downgrade is possible.
> > > 
> > > Anyone can help?
> > > 
> > > Thanks a lot
> > > 
> > >  
> > > 
> > > Regards
> > > 
> > >  
> > > 
> > > Brigitta Bennici
> > > E-mail: b.bennici at it360.it
> > > Web: http://www.it360.it
> > > 
> > >  
> > > 
> > >
> > ----------------------------------------------------------------------------
> > ----------------
> > > Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
> > > personale (DLgs. 196/03 e collegate), questa mail ? destinata
> > > unicamente
> > > alle persone sopra indicate e le informazioni in essa contenute sono
> > > da
> > > considerarsi strettamente riservate. E' proibito leggere, copiare,
> > > usare o
> > > diffondere il contenuto della presente mail senza autorizzazione. Se
> > > avete
> > > ricevuto questo messaggio per errore, siete pregati di rispedire lo
> > > stesso
> > > al mittente. Grazie
> > > 
> > >  
> > > 
> > > 
> > > _______________________________________________
> > > Chilli mailing list
> > > Chilli at coova.org
> > > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> > 
> > 
> > 
> > 
> > ------------------------------
> > 
> > _______________________________________________
> > Chilli mailing list
> > Chilli at coova.org
> > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> > 
> > 
> > End of Chilli Digest, Vol 7, Issue 13
> > *************************************
> > 
> > _______________________________________________
> > Chilli mailing list
> > Chilli at coova.org
> > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> 



From david at coova.com  Fri Apr 16 18:25:22 2010
From: david at coova.com (David Bird)
Date: Fri, 16 Apr 2010 20:25:22 +0200
Subject: [Chilli] nearing 1.2.3
Message-ID: <1271442322.15867.79.camel@david-laptop>

Hello,

Subversion 305:
http://coova-chilli.s3.amazonaws.com/coova-chilli-1.2.3-rc1.tar.gz

== ChangeLog (CoovaChilli current svn revision) ==

* Bug fix for RADIUS (EAP) proxy
* Preliminary support for Netfilter NFQUEUE usage ''--with-nfqueue''
* Preliminary support for Coova Netfilter kernel module
''--with-nfcoova''
* Support for globbing of cmdsock filename(s) in chilli_query
* Compile option ''--enable-proxyvsa'' to have proxy port sniff out VSAs
* Runtime option ''--proxylocattr'' that defines the "location"
attribute in MAC auth proxy requests
* Runtime option ''--proxymacaccept'' to have chilli always return
AccessAccept for MAC auth proxy requests
* Improved ''chilli_redir'' main loop to optionally support poll/epoll
(''--with-poll'') and no waiting for input
* Improved support for ethers file used with binary status file
* New option ''chilli_query listippool'' to list the IP address pool
* Bug fix in static ip allocation - particularly noticeable on 64bit
* Fix bootstrap: install missing automake files automatically

So, there is a mixture of bug fixes and features. I'll be blogging about
the --enable-proxyvsa/--proxylocattr/--proxymacaccept features. There
are important fixes for proxy-eap (though I believe someone had an issue
even still?). 

David



From felipe.wiel at hpp.org.br  Fri Apr 16 18:42:01 2010
From: felipe.wiel at hpp.org.br (Felipe Augusto van de Wiel)
Date: Fri, 16 Apr 2010 15:42:01 -0300
Subject: [Chilli] nearing 1.2.3
In-Reply-To: <1271442322.15867.79.camel@david-laptop>
References: <1271442322.15867.79.camel@david-laptop>
Message-ID: <4BC8AF79.80308@hpp.org.br>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

On 16-04-2010 15:25, David Bird wrote:
> Subversion 305:
> http://coova-chilli.s3.amazonaws.com/coova-chilli-1.2.3-rc1.tar.gz
> 
> == ChangeLog (CoovaChilli current svn revision) ==
> 
> * Bug fix for RADIUS (EAP) proxy
> * Preliminary support for Netfilter NFQUEUE usage ''--with-nfqueue''
> * Preliminary support for Coova Netfilter kernel module
> ''--with-nfcoova''
> * Support for globbing of cmdsock filename(s) in chilli_query
> * Compile option ''--enable-proxyvsa'' to have proxy port sniff out VSAs
> * Runtime option ''--proxylocattr'' that defines the "location"
> attribute in MAC auth proxy requests
> * Runtime option ''--proxymacaccept'' to have chilli always return
> AccessAccept for MAC auth proxy requests
> * Improved ''chilli_redir'' main loop to optionally support poll/epoll
> (''--with-poll'') and no waiting for input
> * Improved support for ethers file used with binary status file
> * New option ''chilli_query listippool'' to list the IP address pool
> * Bug fix in static ip allocation - particularly noticeable on 64bit
> * Fix bootstrap: install missing automake files automatically
> 
> So, there is a mixture of bug fixes and features. I'll be blogging about
> the --enable-proxyvsa/--proxylocattr/--proxymacaccept features. There
> are important fixes for proxy-eap (though I believe someone had an issue
> even still?). 

That's great news.

Did you found/fixed the bug regarding 'splash'?

Did you have an opinion related to the HTTP header
that may fix the IE 6 and IE 7 problem with the
mini-captive protal?

Kind regards,
- -- 
Felipe Augusto van de Wiel <felipe.wiel at hpp.org.br>
Tecnologia da Informa??o (TI) - Complexo Pequeno Pr?ncipe
http://www.pequenoprincipe.org.br/    T: +55 41 3310 1747
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQIcBAEBCgAGBQJLyK92AAoJECCPPxLgxLxPrRAP/j3p2LSLVgZO5KBcY6JCVDX9
x8VHix5zu3a/bhuKjpL3/zuioDN1q4ZiqfHdrbThSojnsniJppDcZlU1F2x88GKN
JlO50F3V13FzUlZnc7GphMj1K+sD0hsvYtK7KnOt62X9+FQJ/gWkAI9TZijAQQ8M
njMCeEph6B4aoSVuMkBPej/F85Ug61jX//IjirJ22+s6cJnx4VKCOQoCE7U7br9J
3wL9520HsgvL4WUm1/ed/iAnfIFpR7vjnmyzVviV4kqQApo+KLtlzELx95fb56uE
g4pUc+3GaxoajpZYozZmSWpAvjsaE0skjK07W3ehgjDazuwM/JDVbMyt0LqKZgGa
tOv4BvkWZs0zNwofjPt5vdef1Rz7MR9cyE2oWv15jrqcUBzruTMj+ZFrQaQ7Cl+N
71B3bXg1nD89V4V7Br3pux9u7vhGDnSqKFnmkneGZbJSOgr71K+2IQ/LcTUniWiK
di+g2o7cidVt3n/sirqWmvzUHRPSJ0ZsWLIbt2cb5khuOVgHBttU8msDW0bzrUuA
pzdNWZ9HaVBRJ9iXJZZEPL8F7QIHwIEhUCifiJv5RqjfZas1y0rsmmCHGMEoY7cw
YD9UXQ0jzjx05GSZcxxZhR62RllESGjcBiJ0/Rmq/DmaNsRPQFeNKuz76W3EUICF
uFuzxIGfj+HIZzCntfyT
=lsOS
-----END PGP SIGNATURE-----

From david at coova.com  Fri Apr 16 18:57:00 2010
From: david at coova.com (David Bird)
Date: Fri, 16 Apr 2010 20:57:00 +0200
Subject: [Chilli] skip leaky bucket for certain packets
In-Reply-To: <612679.67059.qm@web31505.mail.mud.yahoo.com>
References: <612679.67059.qm@web31505.mail.mud.yahoo.com>
Message-ID: <1271444220.15867.83.camel@david-laptop>

Looking the patch again.. it has a couple issues:

- the can_bypass() is only checking one direction
- it not only bypasses leaky bucket, but accounting too

I don't think either of those are intentional. ? I would also rather see
the options as bwbypasstos and bwbypasshost (once they only stop bw
shaping from happening) since "bypass" can mean lots of things. 

On Wed, 2010-04-07 at 01:43 -0700, Ming-Ching Tiew wrote:
> As mentioned in the forum, attached please find the patch for it.
> 
> 
>       
> _______________________________________________ Chilli mailing list Chilli at coova.org http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From david at coova.com  Fri Apr 16 18:59:28 2010
From: david at coova.com (David Bird)
Date: Fri, 16 Apr 2010 20:59:28 +0200
Subject: [Chilli] nearing 1.2.3
In-Reply-To: <4BC8AF79.80308@hpp.org.br>
References: <1271442322.15867.79.camel@david-laptop>
	<4BC8AF79.80308@hpp.org.br>
Message-ID: <1271444368.15867.85.camel@david-laptop>

Actually, I think you 'splash' getting in the config file issue is
because you have DEFAULT rule with ChilliSpot-Config=splash and the
Administrative-User session is active. Try setting --adminuser="".

I took a HTTP header suggest, I think, from the forum. Was that yours?
Yeah, that should already be in..

On Fri, 2010-04-16 at 15:42 -0300, Felipe Augusto van de Wiel wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA512
> 
> On 16-04-2010 15:25, David Bird wrote:
> > Subversion 305:
> > http://coova-chilli.s3.amazonaws.com/coova-chilli-1.2.3-rc1.tar.gz
> > 
> > == ChangeLog (CoovaChilli current svn revision) ==
> > 
> > * Bug fix for RADIUS (EAP) proxy
> > * Preliminary support for Netfilter NFQUEUE usage ''--with-nfqueue''
> > * Preliminary support for Coova Netfilter kernel module
> > ''--with-nfcoova''
> > * Support for globbing of cmdsock filename(s) in chilli_query
> > * Compile option ''--enable-proxyvsa'' to have proxy port sniff out VSAs
> > * Runtime option ''--proxylocattr'' that defines the "location"
> > attribute in MAC auth proxy requests
> > * Runtime option ''--proxymacaccept'' to have chilli always return
> > AccessAccept for MAC auth proxy requests
> > * Improved ''chilli_redir'' main loop to optionally support poll/epoll
> > (''--with-poll'') and no waiting for input
> > * Improved support for ethers file used with binary status file
> > * New option ''chilli_query listippool'' to list the IP address pool
> > * Bug fix in static ip allocation - particularly noticeable on 64bit
> > * Fix bootstrap: install missing automake files automatically
> > 
> > So, there is a mixture of bug fixes and features. I'll be blogging about
> > the --enable-proxyvsa/--proxylocattr/--proxymacaccept features. There
> > are important fixes for proxy-eap (though I believe someone had an issue
> > even still?). 
> 
> That's great news.
> 
> Did you found/fixed the bug regarding 'splash'?
> 
> Did you have an opinion related to the HTTP header
> that may fix the IE 6 and IE 7 problem with the
> mini-captive protal?
> 
> Kind regards,
> - -- 
> Felipe Augusto van de Wiel <felipe.wiel at hpp.org.br>
> Tecnologia da Informa??o (TI) - Complexo Pequeno Pr?ncipe
> http://www.pequenoprincipe.org.br/    T: +55 41 3310 1747
> -----BEGIN PGP SIGNATURE-----
> Version: GnuPG v1.4.10 (GNU/Linux)
> Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/
> 
> iQIcBAEBCgAGBQJLyK92AAoJECCPPxLgxLxPrRAP/j3p2LSLVgZO5KBcY6JCVDX9
> x8VHix5zu3a/bhuKjpL3/zuioDN1q4ZiqfHdrbThSojnsniJppDcZlU1F2x88GKN
> JlO50F3V13FzUlZnc7GphMj1K+sD0hsvYtK7KnOt62X9+FQJ/gWkAI9TZijAQQ8M
> njMCeEph6B4aoSVuMkBPej/F85Ug61jX//IjirJ22+s6cJnx4VKCOQoCE7U7br9J
> 3wL9520HsgvL4WUm1/ed/iAnfIFpR7vjnmyzVviV4kqQApo+KLtlzELx95fb56uE
> g4pUc+3GaxoajpZYozZmSWpAvjsaE0skjK07W3ehgjDazuwM/JDVbMyt0LqKZgGa
> tOv4BvkWZs0zNwofjPt5vdef1Rz7MR9cyE2oWv15jrqcUBzruTMj+ZFrQaQ7Cl+N
> 71B3bXg1nD89V4V7Br3pux9u7vhGDnSqKFnmkneGZbJSOgr71K+2IQ/LcTUniWiK
> di+g2o7cidVt3n/sirqWmvzUHRPSJ0ZsWLIbt2cb5khuOVgHBttU8msDW0bzrUuA
> pzdNWZ9HaVBRJ9iXJZZEPL8F7QIHwIEhUCifiJv5RqjfZas1y0rsmmCHGMEoY7cw
> YD9UXQ0jzjx05GSZcxxZhR62RllESGjcBiJ0/Rmq/DmaNsRPQFeNKuz76W3EUICF
> uFuzxIGfj+HIZzCntfyT
> =lsOS
> -----END PGP SIGNATURE-----



From felipe.wiel at hpp.org.br  Fri Apr 16 19:29:57 2010
From: felipe.wiel at hpp.org.br (Felipe Augusto van de Wiel)
Date: Fri, 16 Apr 2010 16:29:57 -0300
Subject: [Chilli] nearing 1.2.3
In-Reply-To: <1271444368.15867.85.camel@david-laptop>
References: <1271442322.15867.79.camel@david-laptop>	
	<4BC8AF79.80308@hpp.org.br>
	<1271444368.15867.85.camel@david-laptop>
Message-ID: <4BC8BAB5.40400@hpp.org.br>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

On 16-04-2010 15:59, David Bird wrote:
> Actually, I think you 'splash' getting in the config file issue is
> because you have DEFAULT rule with ChilliSpot-Config=splash and the
> Administrative-User session is active. Try setting --adminuser="".

	No luck. :-(

	I added the --adminuser="" to the OPTS
inside initscript but it replaced the local.conf.
	

> I took a HTTP header suggest, I think, from the forum. Was that yours?
> Yeah, that should already be in..

	No, probably it was from Colin Simpson. He
contacted me privately because he saw on the list
I had a similar problem. BTW, he told me he had
sent the message to the list and it got hold for
moderation. :)

Kind regards,
- -- 
Felipe Augusto van de Wiel <felipe.wiel at hpp.org.br>
Tecnologia da Informa??o (TI) - Complexo Pequeno Pr?ncipe
http://www.pequenoprincipe.org.br/    T: +55 41 3310 1747
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQIcBAEBCgAGBQJLyLqxAAoJECCPPxLgxLxPwnoQAJR/fZavtMpf5pdQU1LmwscP
U6oUfqQaEpBQSksaonLzh+EyaDyR6lVEGgCAA2GlhbhsyKEw3avcexq7hqZb7sVD
HwsM+bplM5HGx3/PtlzwOauIqhfq7YefSG5tp1fwQXTxMW8ouZjAqKs9VAM8lOCZ
pCF9uMHt9VnfPrAvkRLM2Z/29+m1FeYl6ZatYVsmYs2QECFAQuixqL5BaCuWlUHs
23ZhkH0Mvg2/55/RC7rqvvf+rM/EKVuj4nCUYwkrSO7VwK7pG6LwlQabu+9XXJ81
c5R5VynhsjLwjboDtuk2FZL+AuQk33BdspXbHsAeatvud2fiH7A4nSpRNiCNEvBj
Tjl315eopeNbZQJY6U81iEpNopHUr8U+c41c6aF3xoB2VE+8CSLccRmrenKPuroP
8NrpsnUYGVYDVoGed/Iieps8ZcLMmvPhOzAlex2s7tL8jJNbTM3FCf5zySk7nK/H
Bo1hrYnTTLySNzqrJ5ULHXXcdfjMKPCJdJWL54WYXmvLEuMCPUV/0IA5KXx4cy3i
jG3RfSNkTXrH1IIZdt3JtBSPnGviNAyTfbjJnGFA/5vLy6ErJd+VpCILPOh1SEBR
//zjTxlMawuhvod3ud3kID8dx71ScT+Uix/ci2rgcO+tRdvU/htoZwhnt6veTUd7
EZIeUk73eZgdYHReif9q
=rA95
-----END PGP SIGNATURE-----

From chilli at quidecco.de  Fri Apr 16 23:57:20 2010
From: chilli at quidecco.de ('Isidor Zeuner')
Date: Sat, 17 Apr 2010 01:57:20 +0200 (CEST)
Subject: [Chilli] building chilli from source (was: R: R:  R: Chilli Digest,
	Vol 7, Issue 13)
In-Reply-To: <004e01cadc74$ff1e18c0$fd5a4a40$@bennici@it360.it>
References: <004e01cadc74$ff1e18c0$fd5a4a40$@bennici@it360.it>
	<20100415011706.B494B787679@quidecco.de>
Message-ID: <20100416235720.B3737787CF2@quidecco.de>

Hello Brigitta,

> i followed Isidor kind advice, installed openssl-devel, I tried rpmbuild but still problems.
> I attached the outpout.

I looked at your build output but the error messages seem to be
missing. How did you create the output file? It looks a bit as if you
have only submitted the standard output stream (as you would get it if
you did a "rpmbuild -ba coova-chilli.spec > bri.txt" redirect). To
find out what is going wrong, we also need the standard error stream
(as you could get it in bri.err.txt if you did something like
"rpmbuild -ba coova-chilli.spec > bri.txt 2> bri.err.txt" instead).

> Another question: my priority is to have anyIP and anyDNS correctly running.
> Can I try some other version or you think I will have the same problems installing coova-chilli?

I can't tell yet, as I am not sure what is going wrong in your
case.

Best regards,

Isidor

From chilli at quidecco.de  Fri Apr 16 23:57:20 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Sat, 17 Apr 2010 01:57:20 +0200 (CEST)
Subject: [Chilli] Squid transparent proxy on same server
In-Reply-To: <z2p3e888d0e1004151802x93ab87fbxb4a33e91f1d5f4e5@mail.gmail.com>
References: <z2p3e888d0e1004151802x93ab87fbxb4a33e91f1d5f4e5@mail.gmail.com>
	<l2s3e888d0e1004131733r6307cb4r4fb5533d21588760@mail.gmail.com> 
	<20100414044234.48942786F23@quidecco.de>
	<m2q3e888d0e1004141813m3d3fc7a6x10dac3bf40018ee3@mail.gmail.com>
	<20100415093201.C77D1787B71@quidecco.de>
Message-ID: <20100416235720.E2657787CF3@quidecco.de>

Hi Jason,

> >
> > I have used the "squid on the same box as chilli" scenario with squid
> > listening on virtual IPs on the 10.0.0.0/8 block (because I had to
> > have squid distinguish between different configurations based on these
> > IPs), but I don't see why 127.0.0.1 shouldn't work, too.
> >
> 
> Interesting. My concern is that if I have squid listening on the ethernet
> adapter (or ip range) that the wireless clients are using, then wouldn't
> they be able to bypass chilli and it's authentication altogether by
> assigning the squid server directly within their browser?
> 
> Scenario ... chilli, dhcp, squid is on the one box called
> wireless.mydomain.com. If the authenticated wireless client configures their
> browser to us a proxy on wireless.mydomain.com:3128, then would they be able
> to bypass chilli (and authentication) altogether? That's why my thinking is
> that I would only want squid listening on the localhost and not on the
> ethernet or ip range that wireless clients are using?
> 

Chilli would probably prevent this on its DHCP device, as it puts the
device in promiscuous mode and processes the raw packets before they
reach squid. Still, I would not want to take such a risk by having
to-be-protected services running on the client subnet. Instead, I
created a virtual subnet on a tap device which the clients never
access directly.

> 
> > With debug logging enabled, chilli will diagnostics like "rewriting
> > packet for post-auth proxy..." when using the proxy setting, which
> > might help to test your configuration.
> >
> 
> I will give this a try and see what it reveals.
> 

All the best on this.

Best regards,

Isidor

From chilli at quidecco.de  Sat Apr 17 00:10:09 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Sat, 17 Apr 2010 02:10:09 +0200 (CEST)
Subject: [Chilli] building rpm with openssl (was: Re: R:  R: Chilli Digest,
	Vol 7, Issue 13)
In-Reply-To: <1271399841.15867.60.camel@david-laptop>
References: <1271399841.15867.60.camel@david-laptop>
	<20100415011706.B494B787679@quidecco.de>
Message-ID: <20100417001009.1B439787CF2@quidecco.de>

> On Thu, 2010-04-15 at 03:17 +0200, Isidor Zeuner wrote:
> 
> > David, should this package be listed under BuildRequires in the spec
> > file, as the spec file sets "--with-openssl"?
> > 
> 
> Yes, it probably should. I will add it. 
> 

Even better (and inspired by the current build issue), the spec file
could have ssl as a build option.

Suggested patch is attached. It will correctly set the build
requirement by default, and also allow to create a non-ssl build by
passing "--without ssl" to rpmbuild.

Best regards,

Isidor
-------------- next part --------------
A non-text attachment was scrubbed...
Name: coova-rpm-ssl.diff
Type: text/x-patch
Size: 666 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100417/b85f3048/attachment.bin>

From mctiew at yahoo.com  Sat Apr 17 00:56:02 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Fri, 16 Apr 2010 17:56:02 -0700 (PDT)
Subject: [Chilli] skip leaky bucket for certain packets
In-Reply-To: <1271444220.15867.83.camel@david-laptop>
Message-ID: <865162.34926.qm@web31502.mail.mud.yahoo.com>



--- On Fri, 4/16/10, David Bird <david at coova.com> wrote:


> Looking the patch again.. it has a
> couple issues:
> 
> - the can_bypass() is only checking one direction
> - it not only bypasses leaky bucket, but accounting too
> 
> I don't think either of those are intentional. ? I would
> also rather see
> the options as bwbypasstos and bwbypasshost (once they only
> stop bw
> shaping from happening) since "bypass" can mean lots of
> things. 
> 

Feel free to change anyway you like as I only half understood your the code, and all I need is to have a way to skip the bandwidth shaping for certain (high priority) packets.

Regards.


      

From toboganfing at googlegroups.com  Sat Apr 17 18:55:21 2010
From: toboganfing at googlegroups.com (Jose)
Date: Sat, 17 Apr 2010 15:55:21 -0300
Subject: [Chilli] interacting with Coovachilli
In-Reply-To: <1271400192.15867.65.camel@david-laptop>
References: <r2z1ebd35581004142224m51493f90z11165548ea7e9a83@mail.gmail.com>
	<1271400192.15867.65.camel@david-laptop>
Message-ID: <t2t1ebd35581004171155w682dab07pbd601a03846dd114@mail.gmail.com>

Hi list,

The network is already built and we can't change the architecture. You can
see an example in the image attached.
When a laptop wants to get connected through an AP doing outdoor coverage,
it broadcast a DHCP discover packet that arrive to both servers because they
are in the same broadcast domain (bridged network). So, as both servers are
running Coovachilli, Coovachilli's DHCP services would respond to that with
a DHCP offer packet. Actually the first server that respond with an offer is
the one that finally configure and authenticate the host.
We have to develop a software that must run in every server, monitor its
state and the state of  the network. By a three hand shake exchange between
the servers each one decide if is optimum or not. The optimum server must be
the one that configure and authenticate the host.
Then our application must listen on port 67 to be able to control the IP
assignation. The problem is that we don't know hot to change the
Coovachilli's dhcp listening port.
Thank you in advance!

2010/4/16 David Bird <david at coova.com>

> Hi Jos?,
>
> Do you have any diagram of the network you are building? I don't
> understand how you plan to have DHCP services...
>
> Also, you might ask your question to the chilli at coova.org mailing list
> (after signing up for the list) as I think a few people there might be
> doing similar things.
>
> David
>
>
> On Thu, 2010-04-15 at 02:24 -0300, Jose wrote:
> > Dear David,
> >
> >
> > I am part of a group of students from Uruguay that is working on their
> > graduate thesis for the Plan Ceibal (implementation of the OLPC
> > project in Uruguay). We are trying to balance connections in a bridged
> > network that has several possible gateways to internet, every server
> > has Coovachilli running to grant access control. For that purpose, we
> > have to develop an application that must run in each server and
> > intercept the DHCP packets before they get to the coova dhcp server,
> > and then depending on the state of the server, give or not to give an
> > IP to the host. Meaning, if the server is the optimal one it will
> > forward the packet to Coova DHCP server, otherwise it will discard the
> > packet. To be able to do that we would need to change the port where
> > Coovachilli is listening for DHCP packets and some firewall rules I
> > imagine, but we don't have any idea on how to do that. Would you be
> > able to gibe us some guidance?
> > I'm sorry for my english and hope you understand.
> >
> >
> > Yours sincerely.
> >
> >
> > Jos? Luis Horta
> >
> >
> >
> >
> >
> >
> >
> >
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100417/82181adf/attachment-0001.htm>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: DIAGRAMA.jpg
Type: image/jpeg
Size: 77814 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100417/82181adf/attachment-0001.jpg>

From david at coova.com  Sun Apr 18 04:53:55 2010
From: david at coova.com (David Bird)
Date: Sun, 18 Apr 2010 06:53:55 +0200
Subject: [Chilli] building rpm with openssl (was: Re: R: R: Chilli
 Digest, Vol 7, Issue 13)
In-Reply-To: <20100417001009.1B439787CF2@quidecco.de>
References: <1271399841.15867.60.camel@david-laptop>
	<20100415011706.B494B787679@quidecco.de>
	<20100417001009.1B439787CF2@quidecco.de>
Message-ID: <1271566435.15867.101.camel@david-laptop>

Thanks.

On Sat, 2010-04-17 at 02:10 +0200, Isidor Zeuner wrote:
> > On Thu, 2010-04-15 at 03:17 +0200, Isidor Zeuner wrote:
> > 
> > > David, should this package be listed under BuildRequires in the spec
> > > file, as the spec file sets "--with-openssl"?
> > > 
> > 
> > Yes, it probably should. I will add it. 
> > 
> 
> Even better (and inspired by the current build issue), the spec file
> could have ssl as a build option.
> 
> Suggested patch is attached. It will correctly set the build
> requirement by default, and also allow to create a non-ssl build by
> passing "--without ssl" to rpmbuild.
> 
> Best regards,
> 
> Isidor



From fddhdd at gmail.com  Sat Apr 17 05:17:40 2010
From: fddhdd at gmail.com (ziyen)
Date: Sat, 17 Apr 2010 14:17:40 +0900
Subject: [Chilli] WISPr-Redirection-URL attribute problem
Message-ID: <n2ofda269331004162217wc208cdb3h33c502fa125e2ef2@mail.gmail.com>

Hi all



Radius setting VSA "WISPr-Redirection-URL = www.aaa.com" attribute setting
case

1. correct userid and wrong password then "not" retrun
redirect_again_login_url <- never return

2. wrong userid any passwd return redirect_again_login_url

3. correct userid and correct password then auth ok and redirect
WISPr-Redirection-URL



when coovachilli 1.0.4 version not happen

but 1.2.2 version happen

what's wrong case1

Thanks
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100417/2f499f8e/attachment.htm>

From hardybm at gmail.com  Sun Apr 18 16:37:26 2010
From: hardybm at gmail.com (Hardy Beltran Monasterios)
Date: Sun, 18 Apr 2010 12:37:26 -0400
Subject: [Chilli] Error coova-chilli 1.2.2, CentOS 5.4 --with-openssl option
Message-ID: <1271608646.25500.1.camel@agua.hardy.com.bo>

Hi,

I'm trying to build coova-chilli-1.2.2 on CentOS 5.4 but i have errors
when I use '--with-openssl' option

I did:

./configure --enable-miniportal --enable-chilliredir
--enable-chilliproxy --with-openssl

This is the error (only first 20 lines):

In file included from /usr/include/krb5.h:7,
                 from /usr/include/openssl/kssl.h:72,
                 from /usr/include/openssl/ssl.h:191,
                 from ssl.h:42,
                 from conn.h:25,
                 from redir.h:26,
                 from chilli.c:27:
/usr/include/krb5/krb5.h:139:2: error: #error undefined 16 bit type
/usr/include/krb5/krb5.h:152:2: error: #error : undefined 32 bit type
In file included from /usr/include/krb5.h:7,
                 from /usr/include/openssl/kssl.h:72,
                 from /usr/include/openssl/ssl.h:191,
                 from ssl.h:42,
                 from conn.h:25,
                 from redir.h:26,
                 from chilli.c:27:
/usr/include/krb5/krb5.h:191: error: expected '=', ',', ';', 'asm' or
'__attribute__' before 'krb5_addrtype'
/usr/include/krb5/krb5.h:192: error: expected '=', ',', ';', 'asm' or
'__attribute__' before 'krb5_enctype'
/usr/include/krb5/krb5.h:193: error: expected '=', ',', ';', 'asm' or
'__attribute__' before 'krb5_cksumtype'
/usr/include/krb5/krb5.h:194: error: expected '=', ',', ';', 'asm' or
'__attribute__' before 'krb5_authdatatype'


My build environment

gcc 4.1.2
glibc 2.5
openssl 0.9.8e

The file '/usr/include/krb5/krb5.h' comes with this package:

krb5-devel-1.6.1-36.el5_4.1


What might be wrong ? 


TIA

---
Hardy Beltran Monasterios
La Paz, Bolivia


From chilli at quidecco.de  Sun Apr 18 17:08:34 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Sun, 18 Apr 2010 19:08:34 +0200 (CEST)
Subject: [Chilli] Error coova-chilli 1.2.2,
	CentOS 5.4 --with-openssl option
In-Reply-To: <1271608646.25500.1.camel@agua.hardy.com.bo>
Message-ID: <20100418170834.61AC1787C4B@quidecco.de>

Hi Hardy,

> 
> I'm trying to build coova-chilli-1.2.2 on CentOS 5.4 but i have errors
> when I use '--with-openssl' option
> 
> I did:
> 
> ./configure --enable-miniportal --enable-chilliredir
> --enable-chilliproxy --with-openssl
> 
> This is the error (only first 20 lines):
> 
> In file included from /usr/include/krb5.h:7,
>                  from /usr/include/openssl/kssl.h:72,
>                  from /usr/include/openssl/ssl.h:191,
>                  from ssl.h:42,
>                  from conn.h:25,
>                  from redir.h:26,
>                  from chilli.c:27:
> /usr/include/krb5/krb5.h:139:2: error: #error undefined 16 bit type
> /usr/include/krb5/krb5.h:152:2: error: #error : undefined 32 bit type
> In file included from /usr/include/krb5.h:7,
>                  from /usr/include/openssl/kssl.h:72,
>                  from /usr/include/openssl/ssl.h:191,
>                  from ssl.h:42,
>                  from conn.h:25,
>                  from redir.h:26,
>                  from chilli.c:27:

The failing conditional in /usr/include/krb5/krb5.h depends on a
preprocessor variable defined in the system limits.h. Chilli has its
own limits.h, so krb5.h probably includes the wrong limits.h.

Could you try if it compiles correctly using the attached patch, which
will avoid this collision by renaming limits.h?

Best regards,

Isidor
-------------- next part --------------
A non-text attachment was scrubbed...
Name: coova-chilli-1.2.2-limits.diff.gz
Type: application/x-gzip
Size: 2664 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100418/df82378b/attachment.bin>

From b.bennici at it360.it  Mon Apr 19 08:01:57 2010
From: b.bennici at it360.it (Brigitta Bennici)
Date: Mon, 19 Apr 2010 10:01:57 +0200
Subject: [Chilli] R: building chilli from source (was: R: R: R: Chilli
	Digest, Vol 7, Issue 13)
In-Reply-To: <20100416235720.B3737787CF2@quidecco.de>
References: <004e01cadc74$ff1e18c0$fd5a4a40$@bennici@it360.it>
	<20100415011706.B494B787679@quidecco.de>
	<20100416235720.B3737787CF2@quidecco.de>
Message-ID: <002001cadf96$95d4a530$c17def90$@bennici@it360.it>

Hello Isidor,
sorry I did exactly that error. I attached the output as you suggested. Hope I did fine this time. Thank you for your support.

My best regards,

Brigitta Bennici
E-mail: b.bennici at it360.it
Web: http://www.it360.it

--------------------------------------------------------------------------------------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie

-----Messaggio originale-----
Da: 'Isidor Zeuner' [mailto:chilli at quidecco.de] 
Inviato: sabato 17 aprile 2010 1.57
A: Brigitta Bennici
Cc: 'David Bird'; chilli at coova.org
Oggetto: building chilli from source (was: R: R: [Chilli] R: Chilli Digest, Vol 7, Issue 13)

Hello Brigitta,

> i followed Isidor kind advice, installed openssl-devel, I tried rpmbuild but still problems.
> I attached the outpout.

I looked at your build output but the error messages seem to be
missing. How did you create the output file? It looks a bit as if you
have only submitted the standard output stream (as you would get it if
you did a "rpmbuild -ba coova-chilli.spec > bri.txt" redirect). To
find out what is going wrong, we also need the standard error stream
(as you could get it in bri.err.txt if you did something like
"rpmbuild -ba coova-chilli.spec > bri.txt 2> bri.err.txt" instead).

> Another question: my priority is to have anyIP and anyDNS correctly running.
> Can I try some other version or you think I will have the same problems installing coova-chilli?

I can't tell yet, as I am not sure what is going wrong in your
case.

Best regards,

Isidor
-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: bri3.err.txt
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100419/357d81d2/attachment-0001.txt>

From d.courtaillier at gmail.com  Mon Apr 19 15:22:15 2010
From: d.courtaillier at gmail.com (Damien Courtaillier)
Date: Mon, 19 Apr 2010 17:22:15 +0200
Subject: [Chilli] Radius Proxy
In-Reply-To: <s2yf1b5213e1004150836x29780039jfd0ff89e3725c654@mail.gmail.com>
References: <s2yf1b5213e1004150836x29780039jfd0ff89e3725c654@mail.gmail.com>
Message-ID: <l2uf1b5213e1004190822zc8b7fa08la6515e9ece7826b8@mail.gmail.com>

Hi,

After building and installing the latest svn 1.2.3 release, I'm still
struggling against the same problem.

Is there really nobody who faced this issue or has tips on that?

Here's my chilli config file:

*HS_WANIF=eth0.1            # WAN Interface toward the Internet
HS_LANIF=br-lan           # Subscriber Interface for client devices
HS_NETWORK=10.1.0.0       # HotSpot Network (must include HS_UAMLISTEN)
HS_NETMASK=255.255.255.0   # HotSpot Network Netmask
HS_UAMLISTEN=10.1.0.1       # HotSpot IP Address (on subscriber network)
HS_UAMPORT=3990            # HotSpot UAM Port (on subscriber network)
HS_UAMUIPORT=4990          # HotSpot UAM "UI" Port (on subscriber network,
for embedded portal)

HS_DNS1=8.8.8.8
HS_DNS2=8.8.8.8

HS_NASID=nas01
HS_RADIUS=radius1.domain.com
HS_RADIUS2=radius2.domain.com
HS_UAMALLOW=www.coova.org
HS_RADSECRET=secret    # Set to be your RADIUS shared secret
HS_UAMSECRET=change-me     # Set to be your UAM secret
HS_UAMALIASNAME=chilli

HS_RADPROXY=on
 HS_RADPROXY_LISTEN=127.0.0.1
 HS_RADPROXY_CLIENT=127.0.0.1
 HS_RADPROXY_PORT=1645
 HS_RADPROXY_SECRET=$HS_RADSECRET

HS_MODE=hotspot
HS_TYPE=chillispot*

and my /etc/config/wireless:

*config 'wifi-iface'
    option 'device' 'wl0'
    option 'mode' 'ap'
    option 'ssid' 'WPA'
    option 'network' 'lan'
    option 'encryption' 'wpa2'
    option 'server' '127.0.0.1'
    option 'port' '1645'
    option 'key' 'secret'
    option 'isolate' '1'
    option 'hidden' '1'

*
Regards,

Damien Courtaillier

---------- Forwarded message ----------
From: Damien Courtaillier <d.courtaillier at gmail.com>
Date: 2010/4/15
Subject: Radius Proxy
To: chilli at coova.org


Hello,

I'm trying to setup coova as a radius proxy, using radproxy options.
I use coova-chilli 1.2.3 (from the svn) on OpenWrt Kamikaze

coova runs directly on the AP that provides WPA2 wireless.

When I try to connect, I can see the Access-Accept in my radius log, but
coova never gives acces to the client.

Here is coova's output:

chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 701a04a76fc3
dhcp.c: 389: 0 (Debug) DHCP newconn: 70:1a:04:a7:6f:c3
chilli.c: 3285: 0 (Debug) New DHCP request from MAC=70-1A-04-A7-6F-C3
chilli.c: 3288: 0 (Debug) New DHCP connection established
radius.c: 1446: 0 (Debug) RADIUS to 192.168.0.5:1812
chilli.c: 2792: 0 (Debug) Received access request confirmation from radius
server

chilli.c: 2828: 0 (Debug) Received access challenge from radius server
chilli.c: 920: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 701a04a76fc3
radius.c: 1446: 0 (Debug) RADIUS to 192.168.0.5:1812
chilli.c: 2792: 0 (Debug) Received access request confirmation from radius
server

Coova receives the dhcp request but seems not to respond to it...

when I try a chilli_query list, I get:

70-1A-04-A7-6F-C3 10.1.0.2 pass 4bc72fad44400001 1 net_test 9/0 9/0 0/0 0/0
0 0 0/0 0/0 -

It is the MAC address of my client, so chilli thinks it is connected however
it is not...

I tried giving an address directly to the client, I definitely can't
communicate with my AP.

What am  I doing wrong?

Does the WPA2 client communicate with coova's tun interface or directly with
the bridge ?
Actually, does the WPA2 clients have to be connected directly to the network
handled by coova (that is my case) or  can they connect to another network,
and coova just makes the authentication ?

Thanks for your answers.

Cheers.

Damien Courtaillier
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100419/efbbe7de/attachment.htm>

From jason at theallens.id.au  Tue Apr 20 05:17:55 2010
From: jason at theallens.id.au (Jason Allen)
Date: Tue, 20 Apr 2010 15:17:55 +1000
Subject: [Chilli] Squid transparent proxy on same server
In-Reply-To: <20100414044234.48942786F23@quidecco.de>
References: <l2s3e888d0e1004131733r6307cb4r4fb5533d21588760@mail.gmail.com> 
	<20100414044234.48942786F23@quidecco.de>
Message-ID: <k2k3e888d0e1004192217j54bc5511x44a96e3365773973@mail.gmail.com>

On Wed, Apr 14, 2010 at 14:42, Isidor Zeuner <chilli at quidecco.de> wrote:

> Hi Jason,
>
> >
> > Can anyone share configuration settings (or point me towards and article
> or
> > how-to), with regard to iptable rules, to ensure that port 80 traffic is
> > transparently routed through to squid? I'd need to ensure that port 80
> > traffic to the server itself is still available as the server runs apache
> > for teh charging portal.
> >
>
> The HS_POSTAUTH_PROXY and HS_POSTAUTH_PROXYPORT configuration settings
> are there to configure a transparent proxy to handle requests after
> the user is authenticated. This is handled through chilli, not
> iptables, and does not prevent you from still running a web server.
>
> Best regards,
>
> Isidor
>

For the information of other (potential) users, I have not been able to get
this successfully work with the Squid proxy on the same server as chilli
(ie. HS_POSTAUTH_PROXY = 127.0.0.1). I have confirmed, via lynx, that squid
works fine for localhost/127.0.0.1 connections, but it does not work through
chilli for chilli authenticated clients.

Debug logs showed redirection to squid, but according to squid logs it
(squid) was not receiving the request.

Unfortunately, I'm not development minded enough to know what the problem is
or might be. If anyone has it working in this scenario, I would like to hear
from you if your willing to provide some advice on your configuration.


Thanks.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100420/21d385e6/attachment.htm>

From chilli at quidecco.de  Tue Apr 20 05:30:50 2010
From: chilli at quidecco.de ('Isidor Zeuner')
Date: Tue, 20 Apr 2010 07:30:50 +0200 (CEST)
Subject: [Chilli] R: building chilli from source (was: R: R: R: Chilli
	Digest, Vol 7, Issue 13)
In-Reply-To: <002001cadf96$95d4a530$c17def90$@bennici@it360.it>
References: <002001cadf96$95d4a530$c17def90$@bennici@it360.it>
	<20100416235720.B3737787CF2@quidecco.de>
Message-ID: <20100420053050.A9C237894FB@quidecco.de>

Hi Brigitta,

> sorry I did exactly that error. I attached the output as you suggested. Hope I did fine this time. Thank you for your support.
> 

It seems like you are having the same issue as Hardy Beltran
Monasterios had the day before (probably everyone compiling on CentOS
with ssl has). You might try if my patch (attached) works for you.

Best regards,

Isidor
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/x-gzip
Size: 3753 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100420/abed012e/attachment.bin>

From nzkbuk at gmail.com  Tue Apr 20 12:23:01 2010
From: nzkbuk at gmail.com (Timothy)
Date: Tue, 20 Apr 2010 13:23:01 +0100
Subject: [Chilli] OpenSSL & redirssl etc
Message-ID: <4BCD9CA5.6070500@gmail.com>

Hi,

A while ago there were some issues with REDIRSSL and OpenSSL (matrix SSL
worked fine)
The error was ssl_error_rx_record_too_long
Has anyone been able to get this working correctly with openssl (rather
than matrix) or is this issue still outstanding ?

I'm trying to get UAMUISSL working but I get the
ssl_error_rx_record_too_long.

Tim

From b.bennici at it360.it  Tue Apr 20 15:08:25 2010
From: b.bennici at it360.it (Brigitta Bennici)
Date: Tue, 20 Apr 2010 17:08:25 +0200
Subject: [Chilli] R: building chilli from source
In-Reply-To: <mailman.1.1271764802.31416.chilli@coova.org>
References: <mailman.1.1271764802.31416.chilli@coova.org>
Message-ID: <000f01cae09b$53cbd360$fb637a20$@bennici@it360.it>

Hello Isidor,
i tried to apply the patch you attached before but I fail to apply it.
This is the error:

[centos at localhost coova-chilli-1.2.2]$ sudo patch coova-chilli.spec.in <
coova-rpm-ssl.diff 
patching file coova-chilli.spec.in
Reversed (or previously applied) patch detected!  Assume -R? [n] y
Hunk #2 FAILED at 22.
1 out of 2 hunks FAILED -- saving rejects to file coova-chilli.spec.in.rej
[centos at localhost coova-chilli-1.2.2]$

Thank you

My best regards,

Brigitta Bennici
E-mail: b.bennici at it360.it
Web: http://www.it360.it

----------------------------------------------------------------------------
----------------
Ai sensi e per gli effetti della Legge sulla tutela della riservatezza
personale (DLgs. 196/03 e collegate), questa mail ? destinata unicamente
alle persone sopra indicate e le informazioni in essa contenute sono da
considerarsi strettamente riservate. E' proibito leggere, copiare, usare o
diffondere il contenuto della presente mail senza autorizzazione. Se avete
ricevuto questo messaggio per errore, siete pregati di rispedire lo stesso
al mittente. Grazie

-----Messaggio originale-----
Da: chilli-bounces at coova.org [mailto:chilli-bounces at coova.org] Per conto di
chilli-request at coova.org
Inviato: marted? 20 aprile 2010 14.00
A: chilli at coova.org
Oggetto: Chilli Digest, Vol 7, Issue 23

Send Chilli mailing list submissions to
	chilli at coova.org

To subscribe or unsubscribe via the World Wide Web, visit
	http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
or, via email, send a message with subject or body 'help' to
	chilli-request at coova.org

You can reach the person managing the list at
	chilli-owner at coova.org

When replying, please edit your Subject line so it is more specific
than "Re: Contents of Chilli digest..."


Today's Topics:

   1. Re: Radius Proxy (Damien Courtaillier)
   2. Re: Squid transparent proxy on same server (Jason Allen)
   3. Re: R: building chilli from source (was: R: R: R: Chilli
      Digest, Vol 7, Issue 13) ('Isidor Zeuner')


----------------------------------------------------------------------

Message: 1
Date: Mon, 19 Apr 2010 17:22:15 +0200
From: Damien Courtaillier <d.courtaillier at gmail.com>
Subject: Re: [Chilli] Radius Proxy
To: chilli at coova.org
Message-ID:
	<l2uf1b5213e1004190822zc8b7fa08la6515e9ece7826b8 at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

Hi,

After building and installing the latest svn 1.2.3 release, I'm still
struggling against the same problem.

Is there really nobody who faced this issue or has tips on that?

Here's my chilli config file:

*HS_WANIF=eth0.1            # WAN Interface toward the Internet
HS_LANIF=br-lan           # Subscriber Interface for client devices
HS_NETWORK=10.1.0.0       # HotSpot Network (must include HS_UAMLISTEN)
HS_NETMASK=255.255.255.0   # HotSpot Network Netmask
HS_UAMLISTEN=10.1.0.1       # HotSpot IP Address (on subscriber network)
HS_UAMPORT=3990            # HotSpot UAM Port (on subscriber network)
HS_UAMUIPORT=4990          # HotSpot UAM "UI" Port (on subscriber network,
for embedded portal)

HS_DNS1=8.8.8.8
HS_DNS2=8.8.8.8

HS_NASID=nas01
HS_RADIUS=radius1.domain.com
HS_RADIUS2=radius2.domain.com
HS_UAMALLOW=www.coova.org
HS_RADSECRET=secret    # Set to be your RADIUS shared secret
HS_UAMSECRET=change-me     # Set to be your UAM secret
HS_UAMALIASNAME=chilli

HS_RADPROXY=on
 HS_RADPROXY_LISTEN=127.0.0.1
 HS_RADPROXY_CLIENT=127.0.0.1
 HS_RADPROXY_PORT=1645
 HS_RADPROXY_SECRET=$HS_RADSECRET

HS_MODE=hotspot
HS_TYPE=chillispot*

and my /etc/config/wireless:

*config 'wifi-iface'
    option 'device' 'wl0'
    option 'mode' 'ap'
    option 'ssid' 'WPA'
    option 'network' 'lan'
    option 'encryption' 'wpa2'
    option 'server' '127.0.0.1'
    option 'port' '1645'
    option 'key' 'secret'
    option 'isolate' '1'
    option 'hidden' '1'

*
Regards,

Damien Courtaillier

---------- Forwarded message ----------
From: Damien Courtaillier <d.courtaillier at gmail.com>
Date: 2010/4/15
Subject: Radius Proxy
To: chilli at coova.org


Hello,

I'm trying to setup coova as a radius proxy, using radproxy options.
I use coova-chilli 1.2.3 (from the svn) on OpenWrt Kamikaze

coova runs directly on the AP that provides WPA2 wireless.

When I try to connect, I can see the Access-Accept in my radius log, but
coova never gives acces to the client.

Here is coova's output:

chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 701a04a76fc3
dhcp.c: 389: 0 (Debug) DHCP newconn: 70:1a:04:a7:6f:c3
chilli.c: 3285: 0 (Debug) New DHCP request from MAC=70-1A-04-A7-6F-C3
chilli.c: 3288: 0 (Debug) New DHCP connection established
radius.c: 1446: 0 (Debug) RADIUS to 192.168.0.5:1812
chilli.c: 2792: 0 (Debug) Received access request confirmation from radius
server

chilli.c: 2828: 0 (Debug) Received access challenge from radius server
chilli.c: 920: 0 (Debug) Sending RADIUS AccessChallenge to client
chilli.c: 1957: 0 (Debug) RADIUS Access-Request received
chilli.c: 1986: 0 (Debug) Calling Station ID is: 701a04a76fc3
radius.c: 1446: 0 (Debug) RADIUS to 192.168.0.5:1812
chilli.c: 2792: 0 (Debug) Received access request confirmation from radius
server

Coova receives the dhcp request but seems not to respond to it...

when I try a chilli_query list, I get:

70-1A-04-A7-6F-C3 10.1.0.2 pass 4bc72fad44400001 1 net_test 9/0 9/0 0/0 0/0
0 0 0/0 0/0 -

It is the MAC address of my client, so chilli thinks it is connected however
it is not...

I tried giving an address directly to the client, I definitely can't
communicate with my AP.

What am  I doing wrong?

Does the WPA2 client communicate with coova's tun interface or directly with
the bridge ?
Actually, does the WPA2 clients have to be connected directly to the network
handled by coova (that is my case) or  can they connect to another network,
and coova just makes the authentication ?

Thanks for your answers.

Cheers.

Damien Courtaillier
-------------- next part --------------
An HTML attachment was scrubbed...
URL:
<http://lists.coova.org/pipermail/chilli/attachments/20100419/efbbe7de/attac
hment.html>

------------------------------

Message: 2
Date: Tue, 20 Apr 2010 15:17:55 +1000
From: Jason Allen <jason at theallens.id.au>
Subject: Re: [Chilli] Squid transparent proxy on same server
To: Isidor Zeuner <chilli at quidecco.de>
Cc: chilli at coova.org
Message-ID:
	<k2k3e888d0e1004192217j54bc5511x44a96e3365773973 at mail.gmail.com>
Content-Type: text/plain; charset="iso-8859-1"

On Wed, Apr 14, 2010 at 14:42, Isidor Zeuner <chilli at quidecco.de> wrote:

> Hi Jason,
>
> >
> > Can anyone share configuration settings (or point me towards and article
> or
> > how-to), with regard to iptable rules, to ensure that port 80 traffic is
> > transparently routed through to squid? I'd need to ensure that port 80
> > traffic to the server itself is still available as the server runs
apache
> > for teh charging portal.
> >
>
> The HS_POSTAUTH_PROXY and HS_POSTAUTH_PROXYPORT configuration settings
> are there to configure a transparent proxy to handle requests after
> the user is authenticated. This is handled through chilli, not
> iptables, and does not prevent you from still running a web server.
>
> Best regards,
>
> Isidor
>

For the information of other (potential) users, I have not been able to get
this successfully work with the Squid proxy on the same server as chilli
(ie. HS_POSTAUTH_PROXY = 127.0.0.1). I have confirmed, via lynx, that squid
works fine for localhost/127.0.0.1 connections, but it does not work through
chilli for chilli authenticated clients.

Debug logs showed redirection to squid, but according to squid logs it
(squid) was not receiving the request.

Unfortunately, I'm not development minded enough to know what the problem is
or might be. If anyone has it working in this scenario, I would like to hear
from you if your willing to provide some advice on your configuration.


Thanks.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL:
<http://lists.coova.org/pipermail/chilli/attachments/20100420/21d385e6/attac
hment-0001.htm>

------------------------------

Message: 3
Date: Tue, 20 Apr 2010 07:30:50 +0200 (CEST)
From: "'Isidor Zeuner'" <chilli at quidecco.de>
Subject: Re: [Chilli] R: building chilli from source (was: R: R: R:
	Chilli	Digest, Vol 7, Issue 13)
To: "Brigitta Bennici" <b.bennici at it360.it>
Cc: chilli at coova.org
Message-ID: <20100420053050.A9C237894FB at quidecco.de>
Content-Type: text/plain; charset="utf-8"

Hi Brigitta,

> sorry I did exactly that error. I attached the output as you suggested.
Hope I did fine this time. Thank you for your support.
> 

It seems like you are having the same issue as Hardy Beltran
Monasterios had the day before (probably everyone compiling on CentOS
with ssl has). You might try if my patch (attached) works for you.

Best regards,

Isidor
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/x-gzip
Size: 3753 bytes
Desc: not available
URL:
<http://lists.coova.org/pipermail/chilli/attachments/20100420/abed012e/attac
hment-0001.bin>

------------------------------

_______________________________________________
Chilli mailing list
Chilli at coova.org
http://lists.coova.org/cgi-bin/mailman/listinfo/chilli


End of Chilli Digest, Vol 7, Issue 23
*************************************


From Anatoly.Oreshkin at pnpi.spb.ru  Tue Apr 20 16:13:54 2010
From: Anatoly.Oreshkin at pnpi.spb.ru (Anatoly Oreshkin)
Date: Tue, 20 Apr 2010 20:13:54 +0400 (MSD)
Subject: [Chilli] chilli dhcp problem
Message-ID: <Pine.LNX.4.62.1004202010350.11119@mail.pnpi.spb.ru>


Hello,

I've configured coovachilli on Linux box as proxy for 802.1X  clients. 
Also I've specified external DHCP server to assign static addresses to  802.1X  clients.

The whole subscriber net 10.2.3.0/24 is divided into 2 parts.

dynamic subnet 10.2.3.0/25 for dynamic address allocation 
static subnet  10.2.3.128/25 for static address allocation.

My chilli server configuration is as follows.

/usr/local/etc/chilli/config:

HS_WANIF=eth0
HS_LANIF=eth1
HS_NETWORK=10.2.3.0
HS_NETMASK=255.255.255.0
HS_UAMLISTEN=10.2.3.1
HS_RADIUS=212.193.96.134
HS_RADIUS2=212.193.96.134

....

/usr/local/etc/chilli/local.conf:

----------------------
proxylisten=10.2.3.1            # chilli eth1 (internal) interface address
proxyport=1812
proxyclient=10.2.3.0/25         # access points (AP)  addresses
proxysecret=<secret>
dynip 10.2.3.0/25               # dynamic subnet
statip 10.2.3.128/25            # static  subnet
dhcpgateway 212.193.96.134      # external DHCP server
dhcprelayagent 195.19.214.216   # chilli  eth0 (external) interface address
dhcpgatewayport 67
--------------------


Coovachilli proxies  successfully requests from 802.1X clients to radius server and
radius challenges from radius server back to clients.

The problem arises with static ip address assignment.

Coovachilli relays client dhcp requests to external dhcp server  and a client gets 
from external dhcp server static address, for example 10.2.3.139, as needed.

I see on the client its ip configuration:
ip address:   10.2.3.139
netmask: 255.255.255.0
gateway: 10.2.3.1
dhcp server: 10.2.3.1


But coovachilli assigns a client different ip address, 10.2.3.2 from dynamic ip subnet.
The command /usr/local/sbin/chilli_query list gives

00-16-EA-8A-DE-38 10.2.3.2 pass 4bcdc49000000001 1 csd-notebook\oreshkin 19/0 19/0 0/0 0/0 0 0 
0/0 0/0 -

Chilli debug output shows:

...
dhcp.c: 2511: 0 (Debug) dhcp/bootps request being processed
dhcp.c: 2784: 0 (Debug) DHCP relay response of length 300 received
dhcp.c: 3044: 0 (Debug) ARP: 00-16-EA-8A-DE-38 asking about 10.2.3.139
dhcp.c: 3054: 0 (Debug) ARP: Ignoring self-discovery: 10.2.3.139
chilli.c: 3213: 0 (Debug) DHCP request for IP address
...

dhcp.c: 3044: 0 (Debug) ARP: 00-16-EA-8A-DE-38 asking about 10.2.3.1
dhcp.c: 2982: 0 (Debug) ARP: Replying to 10.2.3.2 / 00-16-EA-8A-DE-38
dhcp.c: 3003: 0 (Debug) ARP: Received other ARP than request!
dhcp.c: 2576: 0 (Debug) Received packet with spoofed source!
dhcp.c: 2576: 0 (Debug) Received packet with spoofed source!
dhcp.c: 3044: 0 (Debug) ARP: 00-16-EA-8A-DE-38 asking about 10.2.3.139
dhcp.c: 3054: 0 (Debug) ARP: Ignoring self-discovery: 10.2.3.139
chilli.c: 3213: 0 (Debug) DHCP request for IP address
dhcp.c: 2707: 0 (Debug) Layer2 PROT: 0xdd86 dropped
dhcp.c: 2707: 0 (Debug) Layer2 PROT: 0xdd86 dropped
dhcp.c: 2576: 0 (Debug) Received packet with spoofed source!
dhcp.c: 2576: 0 (Debug) Received packet with spoofed source!
dhcp.c: 2576: 0 (Debug) Received packet with spoofed source!
dhcp.c: 2511: 0 (Debug) dhcp/bootps request being processed
dhcp.c: 2576: 0 (Debug) Received packet with spoofed source!
dhcp.c: 2576: 0 (Debug) Received packet with spoofed source!
....

What's wrong ?  Wrong chilli configuration ?
Is this scenario possible at all ?
How to work around this problem ?

Thanks.

From david at coova.com  Wed Apr 21 12:30:29 2010
From: david at coova.com (David Bird)
Date: Wed, 21 Apr 2010 14:30:29 +0200
Subject: [Chilli] OpenSSL & redirssl etc
In-Reply-To: <4BCD9CA5.6070500@gmail.com>
References: <4BCD9CA5.6070500@gmail.com>
Message-ID: <1271853029.15867.250.camel@david-laptop>

Hi Tim,

You are always encouraged to check against the current subversion; and
to restate your problem if it persists. I'm testing various features
now, including redirssl, uamuissl, and radsec, and have success. I'm
currently configured with:  ./configure --enable-largelimits
--enable-proxyvsa --enable-miniportal --enable-chilliredir
--enable-chilliproxy --enable-binstatusfile --with-poll
--enable-chilliradsec --with-openssl , btw, I took your off-line
suggestion and you'll find this also in the subversion version:

$ chilli --help
coova-chilli 1.2.3-rc1

...

Compiled with ENABLE_BINSTATFILE ENABLE_CHILLIPROXY ENABLE_CHILLIRADSEC
ENABLE_CHILLIREDIR ENABLE_CHILLIXML ENABLE_IEEE8021Q ENABLE_JSON
ENABLE_LARGELIMITS ENABLE_LEAKYBUCKET ENABLE_MINIPORTAL ENABLE_PROXYVSA
ENABLE_SESSGARDEN ENABLE_STATFILE HAVE_OPENSSL USING_POLL 

David

On Tue, 2010-04-20 at 13:23 +0100, Timothy wrote:
> Hi,
> 
> A while ago there were some issues with REDIRSSL and OpenSSL (matrix SSL
> worked fine)
> The error was ssl_error_rx_record_too_long
> Has anyone been able to get this working correctly with openssl (rather
> than matrix) or is this issue still outstanding ?
> 
> I'm trying to get UAMUISSL working but I get the
> ssl_error_rx_record_too_long.
> 
> Tim
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From hardybm at gmail.com  Wed Apr 21 14:56:32 2010
From: hardybm at gmail.com (Hardy Beltran Monasterios)
Date: Wed, 21 Apr 2010 10:56:32 -0400
Subject: [Chilli] Error coova-chilli 1.2.2,
	CentOS 5.4 --with-openssl	option
In-Reply-To: <20100418170834.61AC1787C4B@quidecco.de>
References: <20100418170834.61AC1787C4B@quidecco.de>
Message-ID: <1271861792.6333.36.camel@agua.hardy.com.bo>

El dom, 18-04-2010 a las 19:08 +0200, Isidor Zeuner escribi?:
> Hi Hardy,
> 
> > 
> > I'm trying to build coova-chilli-1.2.2 on CentOS 5.4 but i have errors
> > when I use '--with-openssl' option
> > 
> > I did:
> > 
> > ./configure --enable-miniportal --enable-chilliredir
> > --enable-chilliproxy --with-openssl
> > 
> > This is the error (only first 20 lines):
> > 
> > In file included from /usr/include/krb5.h:7,
> >                  from /usr/include/openssl/kssl.h:72,
> >                  from /usr/include/openssl/ssl.h:191,
> >                  from ssl.h:42,
> >                  from conn.h:25,
> >                  from redir.h:26,
> >                  from chilli.c:27:
> > /usr/include/krb5/krb5.h:139:2: error: #error undefined 16 bit type
> > /usr/include/krb5/krb5.h:152:2: error: #error : undefined 32 bit type
> > In file included from /usr/include/krb5.h:7,
> >                  from /usr/include/openssl/kssl.h:72,
> >                  from /usr/include/openssl/ssl.h:191,
> >                  from ssl.h:42,
> >                  from conn.h:25,
> >                  from redir.h:26,
> >                  from chilli.c:27:
> 
> The failing conditional in /usr/include/krb5/krb5.h depends on a
> preprocessor variable defined in the system limits.h. Chilli has its
> own limits.h, so krb5.h probably includes the wrong limits.h.
> 
> Could you try if it compiles correctly using the attached patch, which
> will avoid this collision by renaming limits.h?

Hi Isidor

I have applied your patch

# cd coova-chilli-1.2.2
# patch -p1 < coova-chilli-1.2.2-limits.diff

But still I have the same compile errors :-(

I have read too the messages fomr Brigitta Bennici, which seems like has
the same compile errors.

Based on your comments about limits on limits.h and krb5.h, I will try
to find what to do. AFAIU limits.h should not include values already
defined in krb5.h. I got it right?

Thanks for your support


----
Hardy






From daniel at firewall-services.com  Wed Apr 21 15:07:14 2010
From: daniel at firewall-services.com (Daniel Berteaud)
Date: Wed, 21 Apr 2010 17:07:14 +0200
Subject: [Chilli] Error coova-chilli 1.2.2,
 CentOS 5.4 --with-openssl option
In-Reply-To: <1271861792.6333.36.camel@agua.hardy.com.bo>
References: <20100418170834.61AC1787C4B@quidecco.de>
	<1271861792.6333.36.camel@agua.hardy.com.bo>
Message-ID: <1271862434.1987.4244.camel@localhost>

Hi.

I've been able to successfully compile coova-chilli 1.2.2 with openssl
on CentOS (4.X but should also work on 5.X) with a modified version of
the patch from Isidor Zeuner (Thank you)

I attach it.

The only changes are some additionnals limits -> chilli_limits in
Makefil.in and Makfil.am


Note that I've not tested the functionnality yet, it just compile fine.

Regards, Daniel

Le mercredi 21 avril 2010 ? 10:56 -0400, Hardy Beltran Monasterios a
?crit :
> El dom, 18-04-2010 a las 19:08 +0200, Isidor Zeuner escribi?:
> > Hi Hardy,
> > 
> > > 
> > > I'm trying to build coova-chilli-1.2.2 on CentOS 5.4 but i have errors
> > > when I use '--with-openssl' option
> > > 
> > > I did:
> > > 
> > > ./configure --enable-miniportal --enable-chilliredir
> > > --enable-chilliproxy --with-openssl
> > > 
> > > This is the error (only first 20 lines):
> > > 
> > > In file included from /usr/include/krb5.h:7,
> > >                  from /usr/include/openssl/kssl.h:72,
> > >                  from /usr/include/openssl/ssl.h:191,
> > >                  from ssl.h:42,
> > >                  from conn.h:25,
> > >                  from redir.h:26,
> > >                  from chilli.c:27:
> > > /usr/include/krb5/krb5.h:139:2: error: #error undefined 16 bit type
> > > /usr/include/krb5/krb5.h:152:2: error: #error : undefined 32 bit type
> > > In file included from /usr/include/krb5.h:7,
> > >                  from /usr/include/openssl/kssl.h:72,
> > >                  from /usr/include/openssl/ssl.h:191,
> > >                  from ssl.h:42,
> > >                  from conn.h:25,
> > >                  from redir.h:26,
> > >                  from chilli.c:27:
> > 
> > The failing conditional in /usr/include/krb5/krb5.h depends on a
> > preprocessor variable defined in the system limits.h. Chilli has its
> > own limits.h, so krb5.h probably includes the wrong limits.h.
> > 
> > Could you try if it compiles correctly using the attached patch, which
> > will avoid this collision by renaming limits.h?
> 
> Hi Isidor
> 
> I have applied your patch
> 
> # cd coova-chilli-1.2.2
> # patch -p1 < coova-chilli-1.2.2-limits.diff
> 
> But still I have the same compile errors :-(
> 
> I have read too the messages fomr Brigitta Bennici, which seems like has
> the same compile errors.
> 
> Based on your comments about limits on limits.h and krb5.h, I will try
> to find what to do. AFAIU limits.h should not include values already
> defined in krb5.h. I got it right?
> 
> Thanks for your support
> 
> 
> ----
> Hardy
> 
> 
> 
> 
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli

-- 
Daniel Berteaud
FIREWALL-SERVICES SARL.
Soci?t? de Services en Logiciels Libres
Technop?le Montesquieu
33650 MARTILLAC
Tel : 05 56 64 15 32
Fax : 05 56 64 15 32
Mail: daniel at firewall-services.com
Web : http://www.firewall-services.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: coova-chilli-1.2.2-rename_limits_to_chilli_limits.patch
Type: text/x-patch
Size: 15462 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100421/1d9fb5de/attachment.bin>

From chilli at quidecco.de  Wed Apr 21 16:03:26 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Wed, 21 Apr 2010 18:03:26 +0200 (CEST)
Subject: [Chilli] Error coova-chilli 1.2.2,
 CentOS 5.4 --with-openssl option
In-Reply-To: <1271862434.1987.4244.camel@localhost>
References: <1271862434.1987.4244.camel@localhost>
	<20100418170834.61AC1787C4B@quidecco.de>
	<1271861792.6333.36.camel@agua.hardy.com.bo>
Message-ID: <20100421160326.311DF789CC3@quidecco.de>

Hi,

> 
> I've been able to successfully compile coova-chilli 1.2.2 with openssl
> on CentOS (4.X but should also work on 5.X) with a modified version of
> the patch from Isidor Zeuner (Thank you)
> 
> I attach it.
> 

Thank you. Actually, I had just rediffed a patch which worked for me
on coova-chilli svn, where it worked correctly. I assume some
autotools magic led to your additional changes being unnecessary
there.

> Le mercredi 21 avril 2010 ? 10:56 -0400, Hardy Beltran Monasterios a
> ?crit :
..
> > Based on your comments about limits on limits.h and krb5.h, I will try
> > to find what to do. AFAIU limits.h should not include values already
> > defined in krb5.h. I got it right?
> > 

Actually, it is pretty much the other way around: krb5.h includes
limits.h, and the patch is to have it include /usr/include/limits.h
instead of the chilli one.

Best regards,

Isidor

From chilli at quidecco.de  Wed Apr 21 16:03:25 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Wed, 21 Apr 2010 18:03:25 +0200 (CEST)
Subject: [Chilli] R: building chilli from source
In-Reply-To: <000f01cae09b$53cbd360$fb637a20$@bennici@it360.it>
References: <000f01cae09b$53cbd360$fb637a20$@bennici@it360.it>
	<mailman.1.1271764802.31416.chilli@coova.org>
Message-ID: <20100421160326.0A921789C69@quidecco.de>

Hello Brigitta,

> i tried to apply the patch you attached before but I fail to apply it.
> This is the error:
> 
> [centos at localhost coova-chilli-1.2.2]$ sudo patch coova-chilli.spec.in <
> coova-rpm-ssl.diff 
> patching file coova-chilli.spec.in
> Reversed (or previously applied) patch detected!  Assume -R? [n] y
> Hunk #2 FAILED at 22.
> 1 out of 2 hunks FAILED -- saving rejects to file > coova-chilli.spec.in.rej
> [centos at localhost coova-chilli-1.2.2]$
> 

Why did you apply it on the file coova-chilli.spec.in? It was meant to
be applied to the complete source directory. As you are creating an
RPM, the cleanest way would be to register the patch in the spec file
before running rpmbuild, see [1] on how to do this. If you want to
apply it to the source directory directly and run configure/make
yourself, please have a look on how Hardy did it (to whom I sent the
same patch). Please note that this is not exactly a coova-chilli issue
anymore.

When proceeding, please use the fixed patch Daniel has posted a short
while ago. Mine apparently did not work correctly with version 1.2.2.

Best regards,

Isidor

[1] https://fedoraproject.org/wiki/How_to_create_an_RPM_package#An_example:_eject

From hardybm at gmail.com  Wed Apr 21 17:34:19 2010
From: hardybm at gmail.com (Hardy Beltran Monasterios)
Date: Wed, 21 Apr 2010 13:34:19 -0400
Subject: [Chilli] Error coova-chilli 1.2.2,
	CentOS 5.4 --with-openssl	option
In-Reply-To: <1271862434.1987.4244.camel@localhost>
References: <20100418170834.61AC1787C4B@quidecco.de>
	<1271861792.6333.36.camel@agua.hardy.com.bo>
	<1271862434.1987.4244.camel@localhost>
Message-ID: <1271871259.6333.45.camel@agua.hardy.com.bo>

El mi?, 21-04-2010 a las 17:07 +0200, Daniel Berteaud escribi?:
> Hi.
> 
> I've been able to successfully compile coova-chilli 1.2.2 with openssl
> on CentOS (4.X but should also work on 5.X) with a modified version of
> the patch from Isidor Zeuner (Thank you)
> 
> I attach it.

Hi Daniel:

Applying your path I get a successful compilation on CentOS 5.4, with
the following options:

# ./configure --enable-miniportal --enable-chilliredir
--enable-chilliproxy --with-openssl


> Note that I've not tested the functionnality yet, it just compile fine.

The same for me. I will try to test tomorrow

Thanks


Hardy


From david at coova.com  Wed Apr 21 17:41:56 2010
From: david at coova.com (David Bird)
Date: Wed, 21 Apr 2010 19:41:56 +0200
Subject: [Chilli] Error coova-chilli 1.2.2,
 CentOS 5.4 --with-openssl option
In-Reply-To: <1271862434.1987.4244.camel@localhost>
References: <20100418170834.61AC1787C4B@quidecco.de>
	<1271861792.6333.36.camel@agua.hardy.com.bo>
	<1271862434.1987.4244.camel@localhost>
Message-ID: <1271871716.15867.259.camel@david-laptop>

I committed some cleanups in the headers, allowing most .c files to just
include chillli.h. I also renamed limits.h to chilli_limits.h. 


On Wed, 2010-04-21 at 17:07 +0200, Daniel Berteaud wrote:
> Hi.

> I've been able to successfully compile coova-chilli 1.2.2 with openssl
> on CentOS (4.X but should also work on 5.X) with a modified version of
> the patch from Isidor Zeuner (Thank you)
> 
> I attach it.
> 
> The only changes are some additionnals limits -> chilli_limits in
> Makefil.in and Makfil.am
> 
> 
> Note that I've not tested the functionnality yet, it just compile fine.
> 
> Regards, Daniel
> 
> Le mercredi 21 avril 2010 ? 10:56 -0400, Hardy Beltran Monasterios a
> ?crit :
> > El dom, 18-04-2010 a las 19:08 +0200, Isidor Zeuner escribi?:
> > > Hi Hardy,
> > > 
> > > > 
> > > > I'm trying to build coova-chilli-1.2.2 on CentOS 5.4 but i have errors
> > > > when I use '--with-openssl' option
> > > > 
> > > > I did:
> > > > 
> > > > ./configure --enable-miniportal --enable-chilliredir
> > > > --enable-chilliproxy --with-openssl
> > > > 
> > > > This is the error (only first 20 lines):
> > > > 
> > > > In file included from /usr/include/krb5.h:7,
> > > >                  from /usr/include/openssl/kssl.h:72,
> > > >                  from /usr/include/openssl/ssl.h:191,
> > > >                  from ssl.h:42,
> > > >                  from conn.h:25,
> > > >                  from redir.h:26,
> > > >                  from chilli.c:27:
> > > > /usr/include/krb5/krb5.h:139:2: error: #error undefined 16 bit type
> > > > /usr/include/krb5/krb5.h:152:2: error: #error : undefined 32 bit type
> > > > In file included from /usr/include/krb5.h:7,
> > > >                  from /usr/include/openssl/kssl.h:72,
> > > >                  from /usr/include/openssl/ssl.h:191,
> > > >                  from ssl.h:42,
> > > >                  from conn.h:25,
> > > >                  from redir.h:26,
> > > >                  from chilli.c:27:
> > > 
> > > The failing conditional in /usr/include/krb5/krb5.h depends on a
> > > preprocessor variable defined in the system limits.h. Chilli has its
> > > own limits.h, so krb5.h probably includes the wrong limits.h.
> > > 
> > > Could you try if it compiles correctly using the attached patch, which
> > > will avoid this collision by renaming limits.h?
> > 
> > Hi Isidor
> > 
> > I have applied your patch
> > 
> > # cd coova-chilli-1.2.2
> > # patch -p1 < coova-chilli-1.2.2-limits.diff
> > 
> > But still I have the same compile errors :-(
> > 
> > I have read too the messages fomr Brigitta Bennici, which seems like has
> > the same compile errors.
> > 
> > Based on your comments about limits on limits.h and krb5.h, I will try
> > to find what to do. AFAIU limits.h should not include values already
> > defined in krb5.h. I got it right?
> > 
> > Thanks for your support
> > 
> > 
> > ----
> > Hardy
> > 
> > 
> > 
> > 
> > 
> > _______________________________________________
> > Chilli mailing list
> > Chilli at coova.org
> > http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From chilli at quidecco.de  Wed Apr 21 20:39:37 2010
From: chilli at quidecco.de (Isidor Zeuner)
Date: Wed, 21 Apr 2010 22:39:37 +0200 (CEST)
Subject: [Chilli] Squid transparent proxy on same server
In-Reply-To: <k2k3e888d0e1004192217j54bc5511x44a96e3365773973@mail.gmail.com>
References: <k2k3e888d0e1004192217j54bc5511x44a96e3365773973@mail.gmail.com>
	<l2s3e888d0e1004131733r6307cb4r4fb5533d21588760@mail.gmail.com> 
	<20100414044234.48942786F23@quidecco.de>
Message-ID: <20100421203937.B49FF78A139@quidecco.de>

Hi Jason,

> 
> For the information of other (potential) users, I have not been able to get
> this successfully work with the Squid proxy on the same server as chilli
> (ie. HS_POSTAUTH_PROXY = 127.0.0.1). I have confirmed, via lynx, that squid
> works fine for localhost/127.0.0.1 connections, but it does not work through
> chilli for chilli authenticated clients.
> 
> Debug logs showed redirection to squid, but according to squid logs it
> (squid) was not receiving the request.
> 

You might want to check if iptables eats the packets chilli sends to
squid. In this case, putting LOG rules in front of the DROP and REJECT
rules should make them show up in the logs.

Best regards,

Isidor

From jason at theallens.id.au  Thu Apr 22 06:03:16 2010
From: jason at theallens.id.au (Jason Allen)
Date: Thu, 22 Apr 2010 16:03:16 +1000
Subject: [Chilli] MacAuth failing after wireless drop
Message-ID: <u2q3e888d0e1004212303wbe71ffaftffc9550339fff77f@mail.gmail.com>

Hi,

We are having a scenario where MacAuth clients are failing if they drop
their wireless connection and re-connect again.

/etc/chilli/config has "HS_MACAUTH=on" and HS_MACAUTHMODE is commented out,
meaning radius auth. The MAC is setup correctly in the RADHECK table with
attribute='Auth-Type' and value='Accept'

The client can successfully automatically connect in the morning, but if
they move to an area where their wireless connection drops and then
re-established again shortly after, instead of being authenticated and
having internet access they are redirected to the UAMHOMEPAGE (our
login/purchase page).

Has anyone experienced/resolved this issue, or have any advice?


Thanks.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100422/2c308709/attachment.htm>

From daniel at firewall-services.com  Thu Apr 22 17:25:45 2010
From: daniel at firewall-services.com (Daniel Berteaud)
Date: Thu, 22 Apr 2010 19:25:45 +0200
Subject: [Chilli] Squid transparent proxy on same server
In-Reply-To: <k2k3e888d0e1004192217j54bc5511x44a96e3365773973@mail.gmail.com>
References: <l2s3e888d0e1004131733r6307cb4r4fb5533d21588760@mail.gmail.com>
	<20100414044234.48942786F23@quidecco.de>
	<k2k3e888d0e1004192217j54bc5511x44a96e3365773973@mail.gmail.com>
Message-ID: <1271957145.1987.4253.camel@localhost>

Le mardi 20 avril 2010 ? 15:17 +1000, Jason Allen a ?crit :

> For the information of other (potential) users, I have not been able
> to get this successfully work with the Squid proxy on the same server
> as chilli (ie. HS_POSTAUTH_PROXY = 127.0.0.1). I have confirmed, via
> lynx, that squid works fine for localhost/127.0.0.1 connections, but
> it does not work through chilli for chilli authenticated clients.
> 
> Debug logs showed redirection to squid, but according to squid logs it
> (squid) was not receiving the request.
> 
> Unfortunately, I'm not development minded enough to know what the
> problem is or might be. If anyone has it working in this scenario, I
> would like to hear from you if your willing to provide some advice on
> your configuration.

Hi.

I had the exact same problem: running squid on the same server than
chilli. I solved it without the postauthproxy and postauthproxyport
which I think are only for upstream proxy.

To let squid running on the same server without letting it open for
unauthenticated client, I used some conup/condown script, which insert
the correct rules in iptables (the default being to deny squid access
for everyone). I attache those I use as example (of course, you'll have
to adapt it to your environnement. In mine, all the traffic to/from
chilli is sent to some special chain called FORWARD_FROM_CHILLI,
FORWARD_TO_CHILLI, PREROUTING_FROM_CHILLI etc...).

In my script I also have some special settings for the distribution that
I use (SME Server), you can skip it of course. (all the db configuration
getprop etc...)

Oh, and one last thing, you run chilli with reduced privileges, you
should call these scripts with some other wrapper scripts which uses
sudo.

Regards, Daniel

> 
> 
> Thanks.
> 
> -- 
> Cheers,
> Jason
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli

-- 
Daniel Berteaud
FIREWALL-SERVICES SARL.
Soci?t? de Services en Logiciels Libres
Technop?le Montesquieu
33650 MARTILLAC
Tel : 05 56 64 15 32
Fax : 05 56 64 15 32
Mail: daniel at firewall-services.com
Web : http://www.firewall-services.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: condown.sh
Type: application/x-shellscript
Size: 523 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100422/bb15e082/attachment.bin>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: conup.sh
Type: application/x-shellscript
Size: 549 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100422/bb15e082/attachment-0001.bin>

From nzkbuk at gmail.com  Fri Apr 23 15:07:33 2010
From: nzkbuk at gmail.com (Timothy)
Date: Fri, 23 Apr 2010 16:07:33 +0100
Subject: [Chilli] OpenSSL & redirssl etc
In-Reply-To: <1271853029.15867.250.camel@david-laptop>
References: <4BCD9CA5.6070500@gmail.com>
	<1271853029.15867.250.camel@david-laptop>
Message-ID: <4BD1B7B5.5000404@gmail.com>

Hi David,

I look to still be having the problem.

When running in debug & connecting via http to a static file in
/etc/chilli/www

redir.c: 2524: 0 (Debug) Calling redir_getstate()
redir.c: 2550: 0 (Debug) Receiving HTTP Request
redir.c: 1497: 0 (Debug) The path: www/test.html
redir.c: 1567: 0 (Debug) Host: <removed>:3990
redir.c: 1584: 0 (Debug) User-Agent: Mozilla/5.0 (Windows; U; Windows NT
5.1; en-GB; rv:1.9.1.8) Gecko/20100202 Firefox/3.5.8 (.NET CLR 3.5.30729)
redir.c: 1550: 0 (Debug) end of http-request
redir.c: 1693: 0 (Debug) Serving file test.html
redir.c: 2598: 0 (Debug) Processing HTTP Request
redir.c: 2318: 0 (Debug) close_exit
chilli.c: 73: 0 (Debug) received 18 signal

When trying with https:// I get

redir.c: 1385: 0 (Debug) HTTP request timeout!
redir.c: 1706: 0 (Debug) -->> Setting userurl=[http:///]
redir.c: 2598: 0 (Debug) Processing HTTP Request
redir.c: 2839: 0 (Debug) Processing received request
redir.c: 3051: 0 (Debug) redir_accept: Original request
redir.c: 3072: 0 (Debug) ---->>> resetting challenge:
c62d84b69bd8916fc3a536a63e7b5976
redir.c: 3083: 0 (Debug) ---->>> challenge: c62d84b69bd8916fc3a536a63e7b5976
redir.c: 2318: 0 (Debug) close_exit
chilli.c: 73: 0 (Debug) received 18 signal




Compiled with ENABLE_CHILLIPROXY ENABLE_CHILLIRADSEC ENABLE_CHILLIXML
ENABLE_IEEE8021Q ENABLE_JSON ENABLE_LEAKYBUCKET ENABLE_SESSGARDEN
HAVE_OPENSSL

I think there may need to be some additional items for radsec config
still (remote server(s) and port(s), I might be misreading the defaults
and functions file though). I can see where radsec is configured to
listen on localhost. Does HS_RADPROXY=on cause coova-chilli to speak to
the local proxy and then HS_RADIUS= is the remote server ?

    [ -n "$HS_SSLKEYFILE" -a -n "$HS_SSLCERTFILE" ] && {
        addconfig2 "sslkeyfile $HS_SSLKEYFILE"
        addconfig2 "sslcertfile $HS_SSLCERTFILE"
    }

Should that contain sslcafile.

Maybe I've just been looking at this too long and not thinking clearly
enough

Tim

David Bird wrote:
> Hi Tim,
>
> You are always encouraged to check against the current subversion; and
> to restate your problem if it persists. I'm testing various features
> now, including redirssl, uamuissl, and radsec, and have success. I'm
> currently configured with:  ./configure --enable-largelimits
> --enable-proxyvsa --enable-miniportal --enable-chilliredir
> --enable-chilliproxy --enable-binstatusfile --with-poll
> --enable-chilliradsec --with-openssl , btw, I took your off-line
> suggestion and you'll find this also in the subversion version:
>
> $ chilli --help
> coova-chilli 1.2.3-rc1
>
> ...
>
> Compiled with ENABLE_BINSTATFILE ENABLE_CHILLIPROXY ENABLE_CHILLIRADSEC
> ENABLE_CHILLIREDIR ENABLE_CHILLIXML ENABLE_IEEE8021Q ENABLE_JSON
> ENABLE_LARGELIMITS ENABLE_LEAKYBUCKET ENABLE_MINIPORTAL ENABLE_PROXYVSA
> ENABLE_SESSGARDEN ENABLE_STATFILE HAVE_OPENSSL USING_POLL 
>
> David
>
> On Tue, 2010-04-20 at 13:23 +0100, Timothy wrote:
>   
>> Hi,
>>
>> A while ago there were some issues with REDIRSSL and OpenSSL (matrix SSL
>> worked fine)
>> The error was ssl_error_rx_record_too_long
>> Has anyone been able to get this working correctly with openssl (rather
>> than matrix) or is this issue still outstanding ?
>>
>> I'm trying to get UAMUISSL working but I get the
>> ssl_error_rx_record_too_long.
>>
>> Tim
>> _______________________________________________
>> Chilli mailing list
>> Chilli at coova.org
>> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>>     
>
>
>   


From david at coova.com  Sat Apr 24 05:41:00 2010
From: david at coova.com (David Bird)
Date: Sat, 24 Apr 2010 07:41:00 +0200
Subject: [Chilli] OpenSSL & redirssl etc
In-Reply-To: <4BD1B7B5.5000404@gmail.com>
References: <4BCD9CA5.6070500@gmail.com>
	<1271853029.15867.250.camel@david-laptop> <4BD1B7B5.5000404@gmail.com>
Message-ID: <1272087660.4496.89.camel@david-laptop>

Hi Tim,

I don't think you want "RADPROXY" at all.. you would use that for 802.1x
authentication proxy (or, more recently, if using MAC authentication
with gear like Cisco or OmniAccess). For RadSec, yes, you do indeed need
the sslcertfile, sslkeyfile, and sslcafile. Currently, the sslcertfile
and sslkeyfile are also used for the uamuissl and redirssl (though,
should probably separate as you'd eventually want different certs for
those purposes). With the subversion code, using RadSec means that
chilli_radsec will listen to localhost ports radiusauthport and
radiusacctport and will connect to RadSec server radiusserver1 port 2083
(not yet able to change the standard RadSec port). Chilli is then
configured (by itself, internally) to use the chilli_radsec ports (on
localhost) for it's RADIUS. 

I will have to give your setup a try regarding redirssl (is that what
you are testing below?). I recently tested it all working, though I was
configured with --enable-chilliredir. Will also verify without it. 

David


On Fri, 2010-04-23 at 16:07 +0100, Timothy wrote:
> Hi David,
> 
> I look to still be having the problem.
> 
> When running in debug & connecting via http to a static file in
> /etc/chilli/www
> 
> redir.c: 2524: 0 (Debug) Calling redir_getstate()
> redir.c: 2550: 0 (Debug) Receiving HTTP Request
> redir.c: 1497: 0 (Debug) The path: www/test.html
> redir.c: 1567: 0 (Debug) Host: <removed>:3990
> redir.c: 1584: 0 (Debug) User-Agent: Mozilla/5.0 (Windows; U; Windows NT
> 5.1; en-GB; rv:1.9.1.8) Gecko/20100202 Firefox/3.5.8 (.NET CLR 3.5.30729)
> redir.c: 1550: 0 (Debug) end of http-request
> redir.c: 1693: 0 (Debug) Serving file test.html
> redir.c: 2598: 0 (Debug) Processing HTTP Request
> redir.c: 2318: 0 (Debug) close_exit
> chilli.c: 73: 0 (Debug) received 18 signal
> 
> When trying with https:// I get
> 
> redir.c: 1385: 0 (Debug) HTTP request timeout!
> redir.c: 1706: 0 (Debug) -->> Setting userurl=[http:///]
> redir.c: 2598: 0 (Debug) Processing HTTP Request
> redir.c: 2839: 0 (Debug) Processing received request
> redir.c: 3051: 0 (Debug) redir_accept: Original request
> redir.c: 3072: 0 (Debug) ---->>> resetting challenge:
> c62d84b69bd8916fc3a536a63e7b5976
> redir.c: 3083: 0 (Debug) ---->>> challenge: c62d84b69bd8916fc3a536a63e7b5976
> redir.c: 2318: 0 (Debug) close_exit
> chilli.c: 73: 0 (Debug) received 18 signal
> 
> 
> 
> 
> Compiled with ENABLE_CHILLIPROXY ENABLE_CHILLIRADSEC ENABLE_CHILLIXML
> ENABLE_IEEE8021Q ENABLE_JSON ENABLE_LEAKYBUCKET ENABLE_SESSGARDEN
> HAVE_OPENSSL
> 
> I think there may need to be some additional items for radsec config
> still (remote server(s) and port(s), I might be misreading the defaults
> and functions file though). I can see where radsec is configured to
> listen on localhost. Does HS_RADPROXY=on cause coova-chilli to speak to
> the local proxy and then HS_RADIUS= is the remote server ?
> 
>     [ -n "$HS_SSLKEYFILE" -a -n "$HS_SSLCERTFILE" ] && {
>         addconfig2 "sslkeyfile $HS_SSLKEYFILE"
>         addconfig2 "sslcertfile $HS_SSLCERTFILE"
>     }
> 
> Should that contain sslcafile.
> 
> Maybe I've just been looking at this too long and not thinking clearly
> enough
> 
> Tim
> 
> David Bird wrote:
> > Hi Tim,
> >
> > You are always encouraged to check against the current subversion; and
> > to restate your problem if it persists. I'm testing various features
> > now, including redirssl, uamuissl, and radsec, and have success. I'm
> > currently configured with:  ./configure --enable-largelimits
> > --enable-proxyvsa --enable-miniportal --enable-chilliredir
> > --enable-chilliproxy --enable-binstatusfile --with-poll
> > --enable-chilliradsec --with-openssl , btw, I took your off-line
> > suggestion and you'll find this also in the subversion version:
> >
> > $ chilli --help
> > coova-chilli 1.2.3-rc1
> >
> > ...
> >
> > Compiled with ENABLE_BINSTATFILE ENABLE_CHILLIPROXY ENABLE_CHILLIRADSEC
> > ENABLE_CHILLIREDIR ENABLE_CHILLIXML ENABLE_IEEE8021Q ENABLE_JSON
> > ENABLE_LARGELIMITS ENABLE_LEAKYBUCKET ENABLE_MINIPORTAL ENABLE_PROXYVSA
> > ENABLE_SESSGARDEN ENABLE_STATFILE HAVE_OPENSSL USING_POLL 
> >
> > David
> >
> > On Tue, 2010-04-20 at 13:23 +0100, Timothy wrote:
> >   
> >> Hi,
> >>
> >> A while ago there were some issues with REDIRSSL and OpenSSL (matrix SSL
> >> worked fine)
> >> The error was ssl_error_rx_record_too_long
> >> Has anyone been able to get this working correctly with openssl (rather
> >> than matrix) or is this issue still outstanding ?
> >>
> >> I'm trying to get UAMUISSL working but I get the
> >> ssl_error_rx_record_too_long.
> >>
> >> Tim
> >> _______________________________________________
> >> Chilli mailing list
> >> Chilli at coova.org
> >> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> >>     
> >
> >
> >   
> 



From muffycompoqm at gmail.com  Sat Apr 24 22:32:51 2010
From: muffycompoqm at gmail.com (Mfawa Alfred Onen)
Date: Sat, 24 Apr 2010 23:32:51 +0100
Subject: [Chilli] sarah bachir
Message-ID: <z2g3060035c1004241532s6bccb951o8ba62f3c8083bed@mail.gmail.com>

http://melreet.com/home/index.php

From mctiew at yahoo.com  Mon Apr 26 01:01:28 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Sun, 25 Apr 2010 18:01:28 -0700 (PDT)
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <u2q3e888d0e1004212303wbe71ffaftffc9550339fff77f@mail.gmail.com>
Message-ID: <962105.9042.qm@web31503.mail.mud.yahoo.com>


No body is responding to this ?

It goes to show that few people are using mac auth.

I remember tried using mac auth sometime ago but I almost come to a conclusion that mac auth is problematic, it's not advisable to use it in production environment, more so if mac auth is used with static IP. 

When mac auth is used with dynamic IP, the way to go about seeking re-auth is to switch off the device for such a time after which the dhcp lease is considered expired. 

However for static IP, it's impossible to expire the static IP until coova chilli is rebooted, meaning a failed static IP mac re-authentication is almost impossible. 

--- On Thu, 4/22/10, Jason Allen <jason at theallens.id.au> wrote:

From: Jason Allen <jason at theallens.id.au>
Subject: [Chilli] MacAuth failing after wireless drop
To: chilli at coova.org
Date: Thursday, April 22, 2010, 6:03 AM


Hi,

We are having a scenario where MacAuth clients are failing if they drop their wireless connection and re-connect again.

/etc/chilli/config has "HS_MACAUTH=on" and HS_MACAUTHMODE is commented out, meaning radius auth. The MAC is setup correctly in the RADHECK table with attribute='Auth-Type' and value='Accept'



The client can successfully automatically connect in the morning, but if they move to an area where their wireless connection drops and then re-established again shortly after, instead of being authenticated and having internet access they are redirected to the UAMHOMEPAGE (our login/purchase page).



Has anyone experienced/resolved this issue, or have any advice?


Thanks.

-- 
Cheers,
Jason


-----Inline Attachment Follows-----

_______________________________________________
Chilli mailing list
Chilli at coova.org
http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100425/4f0d3188/attachment.htm>

From liran.tal at gmail.com  Mon Apr 26 06:02:29 2010
From: liran.tal at gmail.com (Liran Tal)
Date: Mon, 26 Apr 2010 09:02:29 +0300
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <u2q3e888d0e1004212303wbe71ffaftffc9550339fff77f@mail.gmail.com>
References: <u2q3e888d0e1004212303wbe71ffaftffc9550339fff77f@mail.gmail.com>
Message-ID: <i2z81237f641004252302mfa9bfb91jb66b10567b066871@mail.gmail.com>

Hey Jason,

On Thu, Apr 22, 2010 at 9:03 AM, Jason Allen <jason at theallens.id.au> wrote:

>
> Hi,
>
> We are having a scenario where MacAuth clients are failing if they drop
> their wireless connection and re-connect again.
>
> /etc/chilli/config has "HS_MACAUTH=on" and HS_MACAUTHMODE is commented out,
> meaning radius auth. The MAC is setup correctly in the RADHECK table with
> attribute='Auth-Type' and value='Accept'
>
> The client can successfully automatically connect in the morning, but if
> they move to an area where their wireless connection drops and then
> re-established again shortly after, instead of being authenticated and
> having internet access they are redirected to the UAMHOMEPAGE (our
> login/purchase page).
>
>
I think not long ago David added some flags related to mac auth (re-auth
something, check the latest version's documentation).




-- 
-- 
Sincerely, Liran Tal

Founder and CTO
Linux and Open Source
Enginx - http://enginx.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100426/f7c84321/attachment.htm>

From mctiew at yahoo.com  Mon Apr 26 08:31:15 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Mon, 26 Apr 2010 01:31:15 -0700 (PDT)
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <i2z81237f641004252302mfa9bfb91jb66b10567b066871@mail.gmail.com>
Message-ID: <417176.53810.qm@web31503.mail.mud.yahoo.com>


Are you referring to 'macreauth' ? 'macreauth' is an option to allow a failed 'mac auth' client to get authenticated using 'UAM'. This is desirable sometimes but not always feasible. Because typically a client needs 'mac auth' because it is unmanned; if it is unmanned, how can it get reauthenticated using the interactive 'UAM' ?

--- On Mon, 4/26/10, Liran Tal <liran.tal at gmail.com> wrote
I think not long ago David added some flags related to mac auth (re-auth something, check the latest version's documentation).
?



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100426/0c8f0da8/attachment.htm>

From jason at theallens.id.au  Tue Apr 27 02:18:36 2010
From: jason at theallens.id.au (Jason Allen)
Date: Tue, 27 Apr 2010 12:18:36 +1000
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <962105.9042.qm@web31503.mail.mud.yahoo.com>
References: <u2q3e888d0e1004212303wbe71ffaftffc9550339fff77f@mail.gmail.com> 
	<962105.9042.qm@web31503.mail.mud.yahoo.com>
Message-ID: <n2l3e888d0e1004261918qe56d20f1k2d8955d1bd49312f@mail.gmail.com>

On 26 April 2010 11:01, Ming-Ching Tiew <mctiew at yahoo.com> wrote:

>
> I remember tried using mac auth sometime ago but I almost come to a
> conclusion that mac auth is problematic, it's not advisable to use it in
> production environment, more so if mac auth is used with static IP.
>
> When mac auth is used with dynamic IP, the way to go about seeking re-auth
> is to switch off the device for such a time after which the dhcp lease is
> considered expired.
>
> However for static IP, it's impossible to expire the static IP until coova
> chilli is rebooted, meaning a failed static IP mac re-authentication is
> almost impossible.
>

Thanks. I've pretty much reached the same conclusion - mac auth doesn't work
in Coova, and can't be used.

You scenario is correct for me too ... mac auth is not occurring when the
client is re-establishing a dhcp ip address or using a static ip. Fairly
fundamental and required functionality for mac auth.

I'm now looking for a working alternative.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100427/826b4daf/attachment.htm>

From jason at theallens.id.au  Tue Apr 27 02:20:53 2010
From: jason at theallens.id.au (Jason Allen)
Date: Tue, 27 Apr 2010 12:20:53 +1000
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <417176.53810.qm@web31503.mail.mud.yahoo.com>
References: <i2z81237f641004252302mfa9bfb91jb66b10567b066871@mail.gmail.com> 
	<417176.53810.qm@web31503.mail.mud.yahoo.com>
Message-ID: <o2p3e888d0e1004261920lf9cc2eces2fb3dbc06604db5a@mail.gmail.com>

On 26 April 2010 18:31, Ming-Ching Tiew <mctiew at yahoo.com> wrote:

>
> Are you referring to 'macreauth' ? 'macreauth' is an option to allow a
> failed 'mac auth' client to get authenticated using 'UAM'. This is desirable
> sometimes but not always feasible. Because typically a client needs 'mac
> auth' because it is unmanned; if it is unmanned, how can it get
> reauthenticated using the interactive 'UAM' ?
>
>
Yes, that is my scenario. I have a bunch of mobile directional signage
machines.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100427/b13cf104/attachment.htm>

From m.simioni at gmail.com  Tue Apr 27 09:42:18 2010
From: m.simioni at gmail.com (Marco Simioni)
Date: Tue, 27 Apr 2010 11:42:18 +0200
Subject: [Chilli] coova chilli inside VMWare
Message-ID: <p2sf71cb681004270242qea3b8aat7b0a59c9293b5e12@mail.gmail.com>

Hi,

has anybody used chillispot inside vmware in production environment?

The setup will be:

- Server with two network interfaces, Vmware ESXi installed, two
virtual machines running
- One guest will have Ubuntu Server with Coova Chilli installed, with
LAN attached to first network intarface, WAN attached to second
network interface
- One guest will have Windows Server 2003, with WAN attached to second
network interface

Hotspot clients will be connected to LAN interface,

Office workstations will be connected on WAN interface.

Suggestions? Should this work?

Thanks i.a.,

Best Regards

Marco

From jason at theallens.id.au  Tue Apr 27 11:41:55 2010
From: jason at theallens.id.au (Jason Allen)
Date: Tue, 27 Apr 2010 21:41:55 +1000
Subject: [Chilli] coova chilli inside VMWare
In-Reply-To: <p2sf71cb681004270242qea3b8aat7b0a59c9293b5e12@mail.gmail.com>
References: <p2sf71cb681004270242qea3b8aat7b0a59c9293b5e12@mail.gmail.com>
Message-ID: <s2p3e888d0e1004270441z157b3b82t4a6970b2fea6c923@mail.gmail.com>

On 27 April 2010 19:42, Marco Simioni <m.simioni at gmail.com> wrote:

> Hi,
>
> has anybody used chillispot inside vmware in production environment?
>
> The setup will be:
>
> - Server with two network interfaces, Vmware ESXi installed, two
> virtual machines running
> - One guest will have Ubuntu Server with Coova Chilli installed, with
> LAN attached to first network intarface, WAN attached to second
> network interface
> - One guest will have Windows Server 2003, with WAN attached to second
> network interface
>
> Hotspot clients will be connected to LAN interface,
>
> Office workstations will be connected on WAN interface.
>
> Suggestions? Should this work?
>
>
Works fine! My exact production environment.

Ubuntu server 9.10 with chilli, freeradius, mysql-5, apache-2, dnsmasq
I have 3 interfaces though - wireless clients, internet, and
office/management.
Our physical server(s) have many client, and varied, client machines on
them.

Chilli has had up-to 170 concurrent users so far.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100427/03f9937e/attachment.htm>

From sveinroed at gmail.com  Tue Apr 27 21:27:25 2010
From: sveinroed at gmail.com (SA R)
Date: Tue, 27 Apr 2010 23:27:25 +0200
Subject: [Chilli] coova-chilli on Debian Lenny
Message-ID: <g2ide1ebd541004271427k96c5d2a2k28289e265487d09d@mail.gmail.com>

Hello!


I have a Debian (Lenny) server running coova-chilli and have some trouble
getting dhcp leases past connected AP's.

Set-up as follows:

Modem <---> Debian server <---> AP

The AP, a wrt54gl w/Tomato firmware, is getting a dhcp lease from
coova-chilli. Clients do not. If I connect the ethernet cable from the
server to one of the LAN ports on the router, clients get ip, but is not
redirected.

Since the router gets an ip, I suspect there is error(s) in my way of
configuring the router. To clear up misconceptions:

* From a standalone pc running coova-chilli, should the ethernet cable
connect to the LAN or the WAN port of the router ?

* I believe the router's dhcp should be off, but how should I set the
router's LAN ip ?

* Should the router's gateway be set to coova-chilli ?

A little server info:
Freeradius (and Daloradius) is working as it should, the interface facing
internet gets an ip from the modem and the tun0 interface facing the AP is
getting the ip 10.1.0.1 from coova-chilli. Eth1 that physically connects the
server and the AP is not brought up and is not given an ip, this seem
correct to me.

What I try to achieve:
A central server + "dumb" nodes that can authenticate users by way of
(free)radius.
Freeradius, coova-chilli and apache in one package.

Hopefully these are trivial questions that will make you laugh, point and in
your guruness provide a solution:)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100427/15f77584/attachment.htm>

From david at coova.com  Wed Apr 28 04:56:54 2010
From: david at coova.com (David Bird)
Date: Wed, 28 Apr 2010 06:56:54 +0200
Subject: [Chilli] coova chilli inside VMWare
In-Reply-To: <p2sf71cb681004270242qea3b8aat7b0a59c9293b5e12@mail.gmail.com>
References: <p2sf71cb681004270242qea3b8aat7b0a59c9293b5e12@mail.gmail.com>
Message-ID: <1272430614.4496.166.camel@david-laptop>

I don't see any reason why it wouldn't work...


On Tue, 2010-04-27 at 11:42 +0200, Marco Simioni wrote:
> Hi,
> 
> has anybody used chillispot inside vmware in production environment?
> 
> The setup will be:
> 
> - Server with two network interfaces, Vmware ESXi installed, two
> virtual machines running
> - One guest will have Ubuntu Server with Coova Chilli installed, with
> LAN attached to first network intarface, WAN attached to second
> network interface
> - One guest will have Windows Server 2003, with WAN attached to second
> network interface
> 
> Hotspot clients will be connected to LAN interface,
> 
> Office workstations will be connected on WAN interface.
> 
> Suggestions? Should this work?
> 
> Thanks i.a.,
> 
> Best Regards
> 
> Marco
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From nzkbuk at gmail.com  Wed Apr 28 08:01:50 2010
From: nzkbuk at gmail.com (Timothy)
Date: Wed, 28 Apr 2010 09:01:50 +0100
Subject: [Chilli] coova-chilli on Debian Lenny
In-Reply-To: <g2ide1ebd541004271427k96c5d2a2k28289e265487d09d@mail.gmail.com>
References: <g2ide1ebd541004271427k96c5d2a2k28289e265487d09d@mail.gmail.com>
Message-ID: <4BD7EB6E.9050403@gmail.com>

To start lets clarify things a little. All 3 devices (Modem, Server, AP) 
can usually route traffic, so which one is the "router" that you're 
speaking of below.

Check your cabling between the AP and the server. You say that eth1 of 
the server connects to the AP and that it DOESN'T come up and you think 
it's correct. If you don't get atleast a link and it seeing the media 
NOTHING is going to happen.

One thing you need to remember is for Coova-chilli to work it MUST see 
the DHCP request. So you would need to make sure the AP below was 
configured as a dumb AP ideally on a second network range eg 192.168.1.2 
on it's LAN interface (so the client ip's (from coova-chilli) didn't 
overlap with the ap's ip address). Also make sure that DHCP is turned 
off on the AP.
Then the server's eth1 ip address would be 192.168.1.1

Make sure that the server and the AP can ping each other.

Tim

On 27/04/2010 22:27, SA R wrote:
> Hello!
>
>
> I have a Debian (Lenny) server running coova-chilli and have some 
> trouble getting dhcp leases past connected AP's.
>
> Set-up as follows:
>
> Modem <---> Debian server <---> AP
>
> The AP, a wrt54gl w/Tomato firmware, is getting a dhcp lease from 
> coova-chilli. Clients do not. If I connect the ethernet cable from the 
> server to one of the LAN ports on the router, clients get ip, but is 
> not redirected.
>
> Since the router gets an ip, I suspect there is error(s) in my way of 
> configuring the router. To clear up misconceptions:
>
> * From a standalone pc running coova-chilli, should the ethernet cable
> connect to the LAN or the WAN port of the router ?
>
> * I believe the router's dhcp should be off, but how should I set the 
> router's LAN ip ?
>
> * Should the router's gateway be set to coova-chilli ?
>
> A little server info:
> Freeradius (and Daloradius) is working as it should, the interface 
> facing internet gets an ip from the modem and the tun0 interface 
> facing the AP is getting the ip 10.1.0.1 from coova-chilli. Eth1 that 
> physically connects the server and the AP is not brought up and is not 
> given an ip, this seem correct to me.
>
> What I try to achieve:
> A central server + "dumb" nodes that can authenticate users by way of 
> (free)radius.
> Freeradius, coova-chilli and apache in one package.
>
> Hopefully these are trivial questions that will make you laugh, point 
> and in your guruness provide a solution:)
>
>
>
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>    
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100428/0b812f3f/attachment.htm>

From david at coova.com  Wed Apr 28 10:25:38 2010
From: david at coova.com (David Bird)
Date: Wed, 28 Apr 2010 12:25:38 +0200
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <i2z81237f641004252302mfa9bfb91jb66b10567b066871@mail.gmail.com>
References: <u2q3e888d0e1004212303wbe71ffaftffc9550339fff77f@mail.gmail.com>
	<i2z81237f641004252302mfa9bfb91jb66b10567b066871@mail.gmail.com>
Message-ID: <1272450338.4496.170.camel@david-laptop>

Yes, there is the macreauth feature, but I've seen it cause problems
with virus infected machines that will keep sending out HTTP requests.
The feature will start mac-auth for every "original redirect". 

Mac-auth currently happens when the dhcp- "connection" is created, but
this can be there with the user not authenticated. To get the case where
an authenticated session has ended, but the dhcp connection exists, we
can run through mac-auth during DHCP of unauthenticated subscribers. 

David


On Mon, 2010-04-26 at 09:02 +0300, Liran Tal wrote:
> Hey Jason,
> 
> On Thu, Apr 22, 2010 at 9:03 AM, Jason Allen <jason at theallens.id.au>
> wrote:
>         
>         Hi,
>         
>         We are having a scenario where MacAuth clients are failing if
>         they drop their wireless connection and re-connect again.
>         
>         /etc/chilli/config has "HS_MACAUTH=on" and HS_MACAUTHMODE is
>         commented out, meaning radius auth. The MAC is setup correctly
>         in the RADHECK table with attribute='Auth-Type' and
>         value='Accept'
>         
>         The client can successfully automatically connect in the
>         morning, but if they move to an area where their wireless
>         connection drops and then re-established again shortly after,
>         instead of being authenticated and having internet access they
>         are redirected to the UAMHOMEPAGE (our login/purchase page).
>         
> 
> I think not long ago David added some flags related to mac auth
> (re-auth something, check the latest version's documentation).
>  
> 
> 
> 
> -- 
> -- 
> Sincerely, Liran Tal
> 
> Founder and CTO
> Linux and Open Source
> Enginx - http://enginx.com
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From jason at theallens.id.au  Wed Apr 28 13:19:44 2010
From: jason at theallens.id.au (Jason Allen)
Date: Wed, 28 Apr 2010 23:19:44 +1000
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <1272450338.4496.170.camel@david-laptop>
References: <u2q3e888d0e1004212303wbe71ffaftffc9550339fff77f@mail.gmail.com> 
	<i2z81237f641004252302mfa9bfb91jb66b10567b066871@mail.gmail.com> 
	<1272450338.4496.170.camel@david-laptop>
Message-ID: <n2k3e888d0e1004280619j2260addfv6f9433b9b33dd1b4@mail.gmail.com>

On 28 April 2010 20:25, David Bird <david at coova.com> wrote:

> Mac-auth currently happens when the dhcp- "connection" is created, but
> this can be there with the user not authenticated. To get the case where
> an authenticated session has ended, but the dhcp connection exists, we
> can run through mac-auth during DHCP of unauthenticated subscribers.
>
> David


Hi,

How is this achieved?

Thanks.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100428/086c0f80/attachment.htm>

From mctiew at yahoo.com  Wed Apr 28 13:23:16 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Wed, 28 Apr 2010 06:23:16 -0700 (PDT)
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <1272450338.4496.170.camel@david-laptop>
Message-ID: <838341.89390.qm@web31504.mail.mud.yahoo.com>


--- On Wed, 4/28/10, David Bird <david at coova.com> wrote:

> 
> To get
> the case where
> an authenticated session has ended, but the dhcp connection
> exists, we
> can run through mac-auth during DHCP of unauthenticated
> subscribers. 
> 

Why don't we just drop/delete the "dhcp connnection" for every ending
of those mac authenticated session ?

( Only half understood what you are talking about, pardon me if we are not talking about the same thing. )

But how is this related to the original poster's situation ? Why the wifi signal drop can cause the ending of an authenticated session ? Or is it a different situation altogether ?

Regards.



      

From david at coova.com  Wed Apr 28 13:41:24 2010
From: david at coova.com (David Bird)
Date: Wed, 28 Apr 2010 15:41:24 +0200
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <838341.89390.qm@web31504.mail.mud.yahoo.com>
References: <838341.89390.qm@web31504.mail.mud.yahoo.com>
Message-ID: <1272462084.4496.171.camel@david-laptop>

Because the DHCP lease is still leased out. 

On Wed, 2010-04-28 at 06:23 -0700, Ming-Ching Tiew wrote:
> --- On Wed, 4/28/10, David Bird <david at coova.com> wrote:
> 
> > 
> > To get
> > the case where
> > an authenticated session has ended, but the dhcp connection
> > exists, we
> > can run through mac-auth during DHCP of unauthenticated
> > subscribers. 
> > 
> 
> Why don't we just drop/delete the "dhcp connnection" for every ending
> of those mac authenticated session ?
> 
> ( Only half understood what you are talking about, pardon me if we are not talking about the same thing. )
> 
> But how is this related to the original poster's situation ? Why the wifi signal drop can cause the ending of an authenticated session ? Or is it a different situation altogether ?
> 
> Regards.
> 
> 
> 
>       
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From mctiew at yahoo.com  Wed Apr 28 13:58:55 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Wed, 28 Apr 2010 06:58:55 -0700 (PDT)
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <1272462084.4496.171.camel@david-laptop>
Message-ID: <171275.84521.qm@web31502.mail.mud.yahoo.com>


--- On Wed, 4/28/10, David Bird <david at coova.com> wrote:

> Because the DHCP lease is still
> leased out. 
> 

I see.

> > > 
> > > To get
> > > the case where
> > > an authenticated session has ended, but the dhcp
> connection
> > > exists, we
> > > can run through mac-auth during DHCP of
> unauthenticated
> > > subscribers. 
> > > 

Hope the code for it can be implemented soon. 

Best regards.


      

From jason at theallens.id.au  Wed Apr 28 14:12:08 2010
From: jason at theallens.id.au (Jason Allen)
Date: Thu, 29 Apr 2010 00:12:08 +1000
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <1272462084.4496.171.camel@david-laptop>
References: <838341.89390.qm@web31504.mail.mud.yahoo.com>
	<1272462084.4496.171.camel@david-laptop>
Message-ID: <g2h3e888d0e1004280712laf5492fap4b9336070af78f85@mail.gmail.com>

On 28 April 2010 23:41, David Bird <david at coova.com> wrote:

> Because the DHCP lease is still leased out.


And thus, shouldn't macauth also operate when dhcp reallocation occurs (in
the case of a dropped and re-established) wireless, not just when the
allocation or renewal occurs?

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100429/f9ddaeea/attachment.htm>

From nzkbuk at gmail.com  Wed Apr 28 17:33:55 2010
From: nzkbuk at gmail.com (Timothy)
Date: Wed, 28 Apr 2010 18:33:55 +0100
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <g2h3e888d0e1004280712laf5492fap4b9336070af78f85@mail.gmail.com>
References: <838341.89390.qm@web31504.mail.mud.yahoo.com>	<1272462084.4496.171.camel@david-laptop>
	<g2h3e888d0e1004280712laf5492fap4b9336070af78f85@mail.gmail.com>
Message-ID: <4BD87183.4020806@gmail.com>


On 28/04/2010 15:12, Jason Allen wrote:
> On 28 April 2010 23:41, David Bird <david at coova.com 
> <mailto:david at coova.com>> wrote:
>
>     Because the DHCP lease is still leased out.
>
>
> And thus, shouldn't macauth also operate when dhcp reallocation occurs 
> (in the case of a dropped and re-established) wireless, not just when 
> the allocation or renewal occurs?

 From my experiance a DHCP lease is renewed 1/2 way through the lease. 
So if you have a 60 min lease then it would be renewed every 30 mins.
I'm not sure of the exact state machine of most devices but I do know 
from logs that most laptop's try to renew an existing (or previous) ip 
address. I don't know what embedded devices (such as iphones etc) do.

What is the network topoligy, is coova-chilli running on an access point 
(such as with openwrt) or have you got a server with 1 or more AP's / 
devices connected via a switch?

As for re-authing a session if that would be implemented I know I would 
prefer it to be a configurable option (or at worse a compile time 
option). Having EVERY DHCP request turn into a radius request could 
cause a significant volume of traffic.

Tim
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100428/b429f53c/attachment.htm>

From nzkbuk at gmail.com  Wed Apr 28 17:35:09 2010
From: nzkbuk at gmail.com (Timothy)
Date: Wed, 28 Apr 2010 18:35:09 +0100
Subject: [Chilli] OpenSSL & redirssl etc
In-Reply-To: <1272087660.4496.89.camel@david-laptop>
References: <4BCD9CA5.6070500@gmail.com>	
	<1271853029.15867.250.camel@david-laptop>
	<4BD1B7B5.5000404@gmail.com>
	<1272087660.4496.89.camel@david-laptop>
Message-ID: <4BD871CD.6040004@gmail.com>

Hi David,
Did you recieve my response ?

Tim

On 24/04/2010 06:41, David Bird wrote:
> Hi Tim,
>
> I don't think you want "RADPROXY" at all.. you would use that for 802.1x
> authentication proxy (or, more recently, if using MAC authentication
> with gear like Cisco or OmniAccess). For RadSec, yes, you do indeed need
> the sslcertfile, sslkeyfile, and sslcafile. Currently, the sslcertfile
> and sslkeyfile are also used for the uamuissl and redirssl (though,
> should probably separate as you'd eventually want different certs for
> those purposes). With the subversion code, using RadSec means that
> chilli_radsec will listen to localhost ports radiusauthport and
> radiusacctport and will connect to RadSec server radiusserver1 port 2083
> (not yet able to change the standard RadSec port). Chilli is then
> configured (by itself, internally) to use the chilli_radsec ports (on
> localhost) for it's RADIUS.
>
> I will have to give your setup a try regarding redirssl (is that what
> you are testing below?). I recently tested it all working, though I was
> configured with --enable-chilliredir. Will also verify without it.
>
> David
>
>
> On Fri, 2010-04-23 at 16:07 +0100, Timothy wrote:
>    
>> Hi David,
>>
>> I look to still be having the problem.
>>
>> When running in debug&  connecting via http to a static file in
>> /etc/chilli/www
>>
>> redir.c: 2524: 0 (Debug) Calling redir_getstate()
>> redir.c: 2550: 0 (Debug) Receiving HTTP Request
>> redir.c: 1497: 0 (Debug) The path: www/test.html
>> redir.c: 1567: 0 (Debug) Host:<removed>:3990
>> redir.c: 1584: 0 (Debug) User-Agent: Mozilla/5.0 (Windows; U; Windows NT
>> 5.1; en-GB; rv:1.9.1.8) Gecko/20100202 Firefox/3.5.8 (.NET CLR 3.5.30729)
>> redir.c: 1550: 0 (Debug) end of http-request
>> redir.c: 1693: 0 (Debug) Serving file test.html
>> redir.c: 2598: 0 (Debug) Processing HTTP Request
>> redir.c: 2318: 0 (Debug) close_exit
>> chilli.c: 73: 0 (Debug) received 18 signal
>>
>> When trying with https:// I get
>>
>> redir.c: 1385: 0 (Debug) HTTP request timeout!
>> redir.c: 1706: 0 (Debug) -->>  Setting userurl=[http:///]
>> redir.c: 2598: 0 (Debug) Processing HTTP Request
>> redir.c: 2839: 0 (Debug) Processing received request
>> redir.c: 3051: 0 (Debug) redir_accept: Original request
>> redir.c: 3072: 0 (Debug) ---->>>  resetting challenge:
>> c62d84b69bd8916fc3a536a63e7b5976
>> redir.c: 3083: 0 (Debug) ---->>>  challenge: c62d84b69bd8916fc3a536a63e7b5976
>> redir.c: 2318: 0 (Debug) close_exit
>> chilli.c: 73: 0 (Debug) received 18 signal
>>
>>
>>
>>
>> Compiled with ENABLE_CHILLIPROXY ENABLE_CHILLIRADSEC ENABLE_CHILLIXML
>> ENABLE_IEEE8021Q ENABLE_JSON ENABLE_LEAKYBUCKET ENABLE_SESSGARDEN
>> HAVE_OPENSSL
>>
>> I think there may need to be some additional items for radsec config
>> still (remote server(s) and port(s), I might be misreading the defaults
>> and functions file though). I can see where radsec is configured to
>> listen on localhost. Does HS_RADPROXY=on cause coova-chilli to speak to
>> the local proxy and then HS_RADIUS= is the remote server ?
>>
>>      [ -n "$HS_SSLKEYFILE" -a -n "$HS_SSLCERTFILE" ]&&  {
>>          addconfig2 "sslkeyfile $HS_SSLKEYFILE"
>>          addconfig2 "sslcertfile $HS_SSLCERTFILE"
>>      }
>>
>> Should that contain sslcafile.
>>
>> Maybe I've just been looking at this too long and not thinking clearly
>> enough
>>
>> Tim
>>
>> David Bird wrote:
>>      
>>> Hi Tim,
>>>
>>> You are always encouraged to check against the current subversion; and
>>> to restate your problem if it persists. I'm testing various features
>>> now, including redirssl, uamuissl, and radsec, and have success. I'm
>>> currently configured with:  ./configure --enable-largelimits
>>> --enable-proxyvsa --enable-miniportal --enable-chilliredir
>>> --enable-chilliproxy --enable-binstatusfile --with-poll
>>> --enable-chilliradsec --with-openssl , btw, I took your off-line
>>> suggestion and you'll find this also in the subversion version:
>>>
>>> $ chilli --help
>>> coova-chilli 1.2.3-rc1
>>>
>>> ...
>>>
>>> Compiled with ENABLE_BINSTATFILE ENABLE_CHILLIPROXY ENABLE_CHILLIRADSEC
>>> ENABLE_CHILLIREDIR ENABLE_CHILLIXML ENABLE_IEEE8021Q ENABLE_JSON
>>> ENABLE_LARGELIMITS ENABLE_LEAKYBUCKET ENABLE_MINIPORTAL ENABLE_PROXYVSA
>>> ENABLE_SESSGARDEN ENABLE_STATFILE HAVE_OPENSSL USING_POLL
>>>
>>> David
>>>
>>> On Tue, 2010-04-20 at 13:23 +0100, Timothy wrote:
>>>
>>>        
>>>> Hi,
>>>>
>>>> A while ago there were some issues with REDIRSSL and OpenSSL (matrix SSL
>>>> worked fine)
>>>> The error was ssl_error_rx_record_too_long
>>>> Has anyone been able to get this working correctly with openssl (rather
>>>> than matrix) or is this issue still outstanding ?
>>>>
>>>> I'm trying to get UAMUISSL working but I get the
>>>> ssl_error_rx_record_too_long.
>>>>
>>>> Tim
>>>> _______________________________________________
>>>> Chilli mailing list
>>>> Chilli at coova.org
>>>> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>>>>
>>>>          
>>>
>>>
>>>        
>>      
>
>    

From jason at theallens.id.au  Thu Apr 29 00:28:47 2010
From: jason at theallens.id.au (Jason Allen)
Date: Thu, 29 Apr 2010 10:28:47 +1000
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <4BD87183.4020806@gmail.com>
References: <838341.89390.qm@web31504.mail.mud.yahoo.com>
	<1272462084.4496.171.camel@david-laptop> 
	<g2h3e888d0e1004280712laf5492fap4b9336070af78f85@mail.gmail.com> 
	<4BD87183.4020806@gmail.com>
Message-ID: <l2j3e888d0e1004281728j84c0681elb3d3ba2fae84f6b5@mail.gmail.com>

On 29 April 2010 03:33, Timothy <nzkbuk at gmail.com> wrote:

>  From my experiance a DHCP lease is renewed 1/2 way through the lease. So
> if you have a 60 min lease then it would be renewed every 30 mins.
> I'm not sure of the exact state machine of most devices but I do know from
> logs that most laptop's try to renew an existing (or previous) ip address. I
> don't know what embedded devices (such as iphones etc) do.
>

Reallocation and renewal are different types of requests in a dhcp lease
lifecycle. A renewal request would not require macauth processing, whereas -
like initial allocation - a reallocation does and should.


> What is the network topoligy, is coova-chilli running on an access point
> (such as with openwrt) or have you got a server with 1 or more AP's /
> devices connected via a switch?
>

Chilli on a Ubuntu server (VM'd) with 94 AP's (DHCP forwarding active)
across many switches.


>  As for re-authing a session if that would be implemented I know I would
> prefer it to be a configurable option (or at worse a compile time option).
> Having EVERY DHCP request turn into a radius request could cause a
> significant volume of traffic.
>

The reauth should only need to be additionally added to the reallocation
dhcp lease request, which would be a small percentage of total dhcp
requests.

-- 
Cheers,
Jason
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100429/a8e8c254/attachment.htm>

From felipe.wiel at hpp.org.br  Thu Apr 29 00:53:47 2010
From: felipe.wiel at hpp.org.br (Felipe Augusto van de Wiel)
Date: Wed, 28 Apr 2010 21:53:47 -0300
Subject: [Chilli] coova-chilli on Debian Lenny
In-Reply-To: <g2ide1ebd541004271427k96c5d2a2k28289e265487d09d@mail.gmail.com>
References: <g2ide1ebd541004271427k96c5d2a2k28289e265487d09d@mail.gmail.com>
Message-ID: <4BD8D89B.1030406@hpp.org.br>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

On 27-04-2010 18:27, SA R wrote:
> I have a Debian (Lenny) server running coova-chilli and
> have some trouble getting dhcp leases past connected AP's.

	I'm also using Debian "Lenny" and coova-chilli.
Which version of coova are you deploying?

	
> Set-up as follows:
> Modem <---> Debian server <---> AP
> 
> The AP, a wrt54gl w/Tomato firmware, is getting a dhcp lease
> from coova-chilli. Clients do not. If I connect the ethernet
> cable from the server to one of the LAN ports on the router,
> clients get ip, but is not redirected.

As mentioned by Timothy in another message on this thread
your setup is not totally clear, I'm guessing that your
modem is your router to the Internet and that your AP is
in your internal LAN.

Another point is that all three components above can
handle DHCP leases, you could even have all three of
them serving DHCP requests at the same time with
different purposes and still have a valid Coova setup.


> Since the router gets an ip, I suspect there is error(s)
> in my way of configuring the router. To clear up
> misconceptions:
> 
> * From a standalone pc running coova-chilli, should the
>   ethernet cable connect to the LAN or the WAN port of
>   the router ?

	Depends on your router's capabilities.


> * I believe the router's dhcp should be off, but how
>   should I set the router's LAN ip ?

	Yes, you should turn off the DHCP and use the
	one from Coova. The rest of the configuration
	depend on your router's model, if it is able
	to do bridge and still hold an IP, that would
	be a nice solution.


> * Should the router's gateway be set to coova-chilli ?

	Probably.


Our setup is pretty simple:

[ Coova Server ] --- Cable Modem --- [ Internet ]
|
[ Switches ] ------- Various APs

The Coova Server has two network interfaces, one of
them is connected to a cable modem from where we get
out Internet access (the public valid IPv4 address).

The other network interface is the one used by Coova
to sent IP addresses and control the access. Most of
our APs do not work as routers, so they only have
on RJ45 connection.

We do have a few wi-fi routers and we have them in
two different setups. Some of the are connected to
the Coova network on the WAN port, that means we
have a small network that is MASQed with the same
IP address to Coova, we used it in our IT office
to simplify things and do not use IPs from the
pool (we also authenticate based on MAC to make
things simpler, but it works without MAC auth).

We also have an wi-fi router working as a small hub,
we connected the Coova network to a regular port and
turned off the internal DHCP, that way it bridged
the requests and if it were a hub/switch.



> A little server info:
> Freeradius (and Daloradius) is working as it should,
> the interface facing internet gets an ip from the
> modem and the tun0 interface facing the AP is getting
> the ip 10.1.0.1 from coova-chilli. Eth1 that physically
> connects the server and the AP is not brought up and is
> not given an ip, this seem correct to me.
> 
> What I try to achieve:
> A central server + "dumb" nodes that can authenticate
> users by way of (free)radius.
> Freeradius, coova-chilli and apache in one package.
> 
> Hopefully these are trivial questions that will make you
> laugh, point and in your guruness provide a solution:)

	Hopefully the above will help you figure out what
to do. It seems more a problem of network topology than a
problem with Coova. :)

Kind regards,
- -- 
Felipe Augusto van de Wiel <felipe.wiel at hpp.org.br>
Tecnologia da Informa??o (TI) - Complexo Pequeno Pr?ncipe
http://www.pequenoprincipe.org.br/    T: +55 41 3310 1747
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQIcBAEBCgAGBQJL2NiYAAoJECCPPxLgxLxPoM0P/iwrwqCdkLLViJCwpWKGhKbL
X4N1LmGFLPKxYzItZm/G8IqNANKCUoDijcSjXOh5aMz5K0R1K4mj4L3ZOOqNCffu
RKCpsI0XVw/rzIA+/PsbF4FRmVr0OaAtl7Es2D1oJEr4fnx0hRlX3bTM38DpgOfQ
1VNpXCKvRrbAg5q6nLJzsZxiYq5chH0aVeVbj3LJWyRBcYPUIJO9qmSqMb/4NlzN
gfv8hTRNtPtaqYY+RhxqYdOfE2LUemBG8+pPND3lyEqDCP+gcgCRMx1VIugJPrvD
ahkIZ+qX03IK0ap+W0T3K/xnRv9gtlfXc5NAwUZupyrEQsHeIPO+oV/64+SYptEW
tqogdX7GW/0qPsQZ/n4D23S+SdX4xjl9aLEYLfhQrFXD7rRaL+M/Cf/5uJFbBuzf
dxHTSysxa/x4uA2ae3LsU82zPcQa3syjM6rvzsbJbWXvFCGmps8LBWbuytZgn0z0
dXoqvA/CqO9K7oLCq+wzfHNzULFYG6U/lyVotCpS5B7pcGR0s7eh3YzRcQPCteSn
7xId2hArniKuEdLlAFeObmSQ527tGcGoLlrOuWUYQM5P9xsYott9eaTfL226mfwK
Qndr2jQmYMtjc0xMw9uyn4fHHE8nNk8nkOOZSvCro1bK3PgkuEe5b20bpJWMEyZL
K0ph36VzKEd9R5uRAlbW
=2Ovg
-----END PGP SIGNATURE-----

From david at coova.com  Thu Apr 29 04:55:09 2010
From: david at coova.com (David Bird)
Date: Thu, 29 Apr 2010 06:55:09 +0200
Subject: [Chilli] MacAuth failing after wireless drop
In-Reply-To: <l2j3e888d0e1004281728j84c0681elb3d3ba2fae84f6b5@mail.gmail.com>
References: <838341.89390.qm@web31504.mail.mud.yahoo.com>
	<1272462084.4496.171.camel@david-laptop>
	<g2h3e888d0e1004280712laf5492fap4b9336070af78f85@mail.gmail.com>
	<4BD87183.4020806@gmail.com>
	<l2j3e888d0e1004281728j84c0681elb3d3ba2fae84f6b5@mail.gmail.com>
Message-ID: <1272516909.4496.813.camel@david-laptop>

Hmm.. Well, specifically, there are DHCP-Discover and DHCP-Request. A
Discover is usually the first packet sent my the subscriber, to which
the DHCP server replies to with an Offer. Then the client will confirm
with the Request which should be replied to with an Ack. Yes, some
client devices will start out with a Request (even noting their previous
IP address) and that can be Ack'ed or Nak'ed depending on the DHCP
server. (Note that if Ack'ed here, then there wasn't a Discover packet
that "allocated" the IP). Thus, just doing Mac auth for the Discover
might not be sufficient. Indeed, doing RADIUS for every DHCP request
will mean more RADIUS.. though, I don't think it'll be a problem unless
a machine is going crazy with DHCP from a virus or something. 


On Thu, 2010-04-29 at 10:28 +1000, Jason Allen wrote:
> 
> 
> On 29 April 2010 03:33, Timothy <nzkbuk at gmail.com> wrote:
>         
>         
>         From my experiance a DHCP lease is renewed 1/2 way through the
>         lease. So if you have a 60 min lease then it would be renewed
>         every 30 mins.
>         I'm not sure of the exact state machine of most devices but I
>         do know from logs that most laptop's try to renew an existing
>         (or previous) ip address. I don't know what embedded devices
>         (such as iphones etc) do.
>         
> 
> Reallocation and renewal are different types of requests in a dhcp
> lease lifecycle. A renewal request would not require macauth
> processing, whereas - like initial allocation - a reallocation does
> and should.
>  
>         What is the network topoligy, is coova-chilli running on an
>         access point (such as with openwrt) or have you got a server
>         with 1 or more AP's / devices connected via a switch?
>         
> 
> Chilli on a Ubuntu server (VM'd) with 94 AP's (DHCP forwarding active)
> across many switches.
>  
>         As for re-authing a session if that would be implemented I
>         know I would prefer it to be a configurable option (or at
>         worse a compile time option). Having EVERY DHCP request turn
>         into a radius request could cause a significant volume of
>         traffic.
>         
> 
> The reauth should only need to be additionally added to the
> reallocation dhcp lease request, which would be a small percentage of
> total dhcp requests.
> 
> -- 
> Cheers,
> Jason
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From david at coova.com  Thu Apr 29 05:18:24 2010
From: david at coova.com (David Bird)
Date: Thu, 29 Apr 2010 07:18:24 +0200
Subject: [Chilli] subversion
Message-ID: <1272518304.4496.826.camel@david-laptop>

Hello,

I've committed a few things... 

- A possible solution to the Mac-auth issue (do mach auth during DHCP
always) - though could add some kind of limiting feature to ensure no
RADIUS floods. 

- A fixup for when relaying DHCP through chilli to an external DHCP
server. Added a Server Identifier rewrite. Still problematic to do this
when the upstream DHCP is on the same server as chilli, but this is for
other reasons (binding to port 67, determining which broadcast network
to use for DHCP, and the Server Identifier in DHCP might be "wrong" --
like set to 127.0.0.1 due to loop-back). 

- More checks on types of packets being routed (hunting down possible
segfault situations with unexpected packets)

- Thinking of supporting PPPoE for authentication purposes.. Anyone
interested in helping out (either with code or financial support :) is
encouraged to grep around for ENABLE_PPPPOE. 

- Thinking of supporting 802.3 Ethernet frames... grep around for
ENABLE_IEEE8023. 




From daniel at firewall-services.com  Thu Apr 29 06:40:55 2010
From: daniel at firewall-services.com (Daniel Berteaud)
Date: Thu, 29 Apr 2010 08:40:55 +0200
Subject: [Chilli] uid and gid not working
Message-ID: <1272523255.2040.1208.camel@localhost>

Hi.

I use coova-chilli 1.0.13 on my server, with uid and gid options to
limit the privileges (I'm not very found of publically accessible
daemons with root privileges). It's working, even if I get the following
message in the log when I start chilli:

coova-chilli[11928]: chilli.c: 3766: 1 (Operation not permitted)
setgid(460) failed while running with gid = 0

So it seems that droping uid works but not gid

I've tried with coova-chilli 1.2.2, but now uid and gid don't work at
all because chilli generate the binary configuration in /tmp/chilli-XXX
and this directory is 700 root:root

Are the uid/gid options not supported anymore ?

And why chilli now uses this binary config file in /tmp ?

Regards, Daniel

-- 
Daniel Berteaud
FIREWALL-SERVICES SARL.
Soci?t? de Services en Logiciels Libres
Technop?le Montesquieu
33650 MARTILLAC
Tel : 05 56 64 15 32
Fax : 05 56 64 15 32
Mail: daniel at firewall-services.com
Web : http://www.firewall-services.com


From sveinroed at gmail.com  Thu Apr 29 08:45:40 2010
From: sveinroed at gmail.com (SA R)
Date: Thu, 29 Apr 2010 10:45:40 +0200
Subject: [Chilli] coova-chilli on Debian Lenny
Message-ID: <k2qde1ebd541004290145o136321a1m4610e76fce8f7565@mail.gmail.com>

First time I reply here, hope this goes in the correct place..

Thanks for the input, I see that I have not been clear. I will try to
clearify more about the set-up:

Internet --- Telsey Modem --- Server --- AP

Telsey modem is where the fibre cabling enters the house.
Server is a computer running Debian Lenny. It has two network interfaces;
eth0 and eth1.
AP is a wireless router, wrt54gl with Tomato firmware.

I am a bit stumped as basic network settings usually isn't that much of a
challenge.

Currently my /etc/network/interfaces on the server is

auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp

auto eth1


When I start chilli with /etc/init.d/chilli start, tun0 is brought up with
ip address 10.1.0.1 as configured.

To make sure I have basic settings correct, how do you recommend setting the
AP (wrt54gl) in this case? WAN=dhcp ? LAN ip=? MODE=Access Point?
Clients will access the AP over wireless.

For once, google hasn't helped my, neither irc #coova. Very glad for the
replies so far.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100429/367eff5d/attachment.htm>

From felipe.wiel at hpp.org.br  Thu Apr 29 14:59:22 2010
From: felipe.wiel at hpp.org.br (Felipe Augusto van de Wiel)
Date: Thu, 29 Apr 2010 11:59:22 -0300
Subject: [Chilli] coova-chilli on Debian Lenny
In-Reply-To: <k2qde1ebd541004290145o136321a1m4610e76fce8f7565@mail.gmail.com>
References: <k2qde1ebd541004290145o136321a1m4610e76fce8f7565@mail.gmail.com>
Message-ID: <4BD99ECA.1010809@hpp.org.br>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

On 29-04-2010 05:45, SA R wrote:
[...]
> Internet --- Telsey Modem --- Server --- AP
> 
> Telsey modem is where the fibre cabling enters
> the house. Server is a computer running Debian
> Lenny. It has two network interfaces; eth0 and
> eth1. AP is a wireless router, wrt54gl with
> Tomato firmware.
> 
> I am a bit stumped as basic network settings
> usually isn't that much of a challenge.
> 
> Currently my /etc/network/interfaces on the server is
> 
> auto lo
> iface lo inet loopback
> 
> auto eth0
> iface eth0 inet dhcp
> 
> auto eth1
> 
> When I start chilli with /etc/init.d/chilli start,
> tun0 is brought up with ip address 10.1.0.1 as
> configured.

	That's correct.


> To make sure I have basic settings correct, how do
> you recommend setting the AP (wrt54gl) in this case?
> WAN=dhcp ? LAN ip=? MODE=Access Point? Clients will
> access the AP over wireless.

	You can do it either way.

	You can setup chilli to use WRT54GL DHCP or,
which I would recommend, you could setup you router
to just act as an Access Point, that way, you wifi
clients will get an IP from coova and the WRT54GL
will just act as the bridge between ethernet and
wifi.

Kind regards,
- -- 
Felipe Augusto van de Wiel <felipe.wiel at hpp.org.br>
Tecnologia da Informa??o (TI) - Complexo Pequeno Pr?ncipe
http://www.pequenoprincipe.org.br/    T: +55 41 3310 1747
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org/

iQIcBAEBCgAGBQJL2Z7HAAoJECCPPxLgxLxPwnwP/3ydb6Bog9ftnRyUAEtFRUYh
MITdzRmmbJXBKdzZBNp3ze4Dd0I8Tv3f92PegPY8koiaRfF09bQfwJ9Vv/ch5zdq
oAZhSYonHoKzEZMLdk46ep2cI/5KnMZHsNj9f2uKtrHaNhn6LKWKheeBE/SztDzr
JGl2re06O8F1xLxtulnlwLPwVYOzUjOXEDlJyL7RKiivBxOAIahkr6Z9VioBA7/G
BpRptBYcbFesKiqsHet1/6MP/dCEGDikmrglN3Z4p75We4Q7OTOUjCdJfPJkDcng
BhprLAwR9fg4lAZ0kzub5E0CMv04FDZ2KEK9JxWMXPfy9GyiEMGnoJ1aCaQgPVvj
GlGq111ufPAX0hFT1XQ0jQxjPwl1yaJ3GCzXgMmi7RdR7CXPItg9R0LhrrvWCI5m
T6SSQkU6jtWFIkmGkSQFwEf7UkAld6KdV/dLk6r/qEmARpkuCNhVxAIdNTEdTd4s
OObDeUZXMwjJ82pO5HKhWah8jAsKr60sPXRdacRAXK/SIj28u0uoyh/gDYNOlcC3
mDI9Ic7WMjkXORyc/Csqpf0r8ZsaJfBnAkwBcc+7KWUlGBlVfx+4V/SSCftg9xF3
L0MTla/7oM5VE1MEIjJbI4zJVM8cPYLBXpnpraM8SXndFYE29yuSrTTkeSRUEMBi
goI0UGIFzkpYCtLHN+dt
=tbwd
-----END PGP SIGNATURE-----

From david at coova.com  Fri Apr 30 07:24:13 2010
From: david at coova.com (David Bird)
Date: Fri, 30 Apr 2010 09:24:13 +0200
Subject: [Chilli] CoovaChilli subversion current changelog
Message-ID: <1272612253.4496.863.camel@david-laptop>

http://dev.coova.org/svn/coova-chilli/ChangeLog

== ChangeLog (CoovaChilli current svn revision) ==

* Bug fix for RADIUS (EAP) proxy
* Preliminary support for Netfilter NFQUEUE usage ''--with-nfqueue''
* Preliminary support for Coova Netfilter kernel module ''--with-nfcoova''
* Support for globbing of cmdsock filename(s) in chilli_query
* Compile option ''--enable-proxyvsa'' to have proxy port sniff out VSAs
* Runtime option ''--proxylocattr'' that defines the "location" attribute in MAC auth proxy requests
* Runtime option ''--proxymacaccept'' to have chilli always return AccessAccept for MAC auth proxy requests
* Improved ''chilli_redir'' main loop to optionally support poll/epoll (''--with-poll'') and no waiting for input
* Change such that MAC authentication happens during DHCP when not authentication, not just when 'unknown'
* Improved support for ethers file used with binary status file
* New option ''chilli_query listippool'' to list the IP address pool
* Bug fix in static ip allocation - particularly noticeable on 64bit
* Added ''Compiled with ...'' section to ''--help'' output to see compile time options
* Fix bootstrap: install missing automake files automatically
* Fixes concerning DHCP relay - rewriting of DHCP Server Identifier option
* Fixes for RadSec support
* Fixes for anydns

You will currently find the above in subversion. 

Notes:

The 'listippool' option to chilli_query will show the chilli internal IP pool, for debugging purposes mostly. 

The MAC-auth on DHCP reneweral is currently there also, as discussed in the list. 

Most recently, fixed up the anydns which had issues (two issues for DNS server other than DNS1/DNS2: the dnsnat address tracking logic was faulty, and the nat'ing wasn't happening after authentication). 

David


From david at coova.com  Fri Apr 30 07:33:06 2010
From: david at coova.com (David Bird)
Date: Fri, 30 Apr 2010 09:33:06 +0200
Subject: [Chilli] uid and gid not working
In-Reply-To: <1272523255.2040.1208.camel@localhost>
References: <1272523255.2040.1208.camel@localhost>
Message-ID: <1272612786.4496.868.camel@david-laptop>

Thanks, will review before putting out 1.2.3. 

The use of the binary configuration file comes from the desire to split
off the "parsing and resolving" of the configuration file from the main
chilli server. Previously, when chilli re-read it's configuration
(either from HUP or --interval), it would stall the main loop (meaning,
all traffic stops) while rereading the configuration - which involves
DNS lookups, etc. Now, chilli server kicks off the command line util
chilli_opt for configuration file parsing, resolving, and writing to a
binary file, which chilli server (and other chilli_* servers) can reread
with no waiting. It is also possible to run chilli_opt yourself and give
chilli the SIGUSR1 to have it reread the binary configuration. 

David

On Thu, 2010-04-29 at 08:40 +0200, Daniel Berteaud wrote:
> Hi.
> 
> I use coova-chilli 1.0.13 on my server, with uid and gid options to
> limit the privileges (I'm not very found of publically accessible
> daemons with root privileges). It's working, even if I get the following
> message in the log when I start chilli:
> 
> coova-chilli[11928]: chilli.c: 3766: 1 (Operation not permitted)
> setgid(460) failed while running with gid = 0
> 
> So it seems that droping uid works but not gid
> 
> I've tried with coova-chilli 1.2.2, but now uid and gid don't work at
> all because chilli generate the binary configuration in /tmp/chilli-XXX
> and this directory is 700 root:root
> 
> Are the uid/gid options not supported anymore ?
> 
> And why chilli now uses this binary config file in /tmp ?
> 
> Regards, Daniel
> 



From mctiew at yahoo.com  Fri Apr 30 08:33:39 2010
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Fri, 30 Apr 2010 01:33:39 -0700 (PDT)
Subject: [Chilli] CoovaChilli subversion current changelog
In-Reply-To: <1272612253.4496.863.camel@david-laptop>
Message-ID: <461663.93536.qm@web31502.mail.mud.yahoo.com>


The bypasstos and bypasshost thingie you have decided not to put in ?

:)



      

From david at coova.com  Fri Apr 30 09:52:52 2010
From: david at coova.com (David Bird)
Date: Fri, 30 Apr 2010 11:52:52 +0200
Subject: [Chilli] CoovaChilli subversion current changelog
In-Reply-To: <461663.93536.qm@web31502.mail.mud.yahoo.com>
References: <461663.93536.qm@web31502.mail.mud.yahoo.com>
Message-ID: <1272621172.4496.871.camel@david-laptop>

It wasn't complete (two issue: it was for only one direction and also
skips acct'ing), so I haven't included it as of yet.. 

On Fri, 2010-04-30 at 01:33 -0700, Ming-Ching Tiew wrote:
> The bypasstos and bypasshost thingie you have decided not to put in ?
> 
> :)
> 
> 
> 
>       



