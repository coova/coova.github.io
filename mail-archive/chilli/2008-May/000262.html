<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> Help! Chilli accounting for dropped packets
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:chilli%40coova.org?Subject=Re%3A%20Help%21%20Chilli%20accounting%20for%20dropped%20packets&In-Reply-To=%3C4821EA1F.2090303%40gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000264.html">
   <LINK REL="Next"  HREF="000263.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Help! Chilli accounting for dropped packets</H1>
    <B>Gunther Mayer</B> 
    <A HREF="mailto:chilli%40coova.org?Subject=Re%3A%20Help%21%20Chilli%20accounting%20for%20dropped%20packets&In-Reply-To=%3C4821EA1F.2090303%40gmail.com%3E"
       TITLE="Help! Chilli accounting for dropped packets">gunther.mayer at googlemail.com
       </A><BR>
    <I>Wed May  7 17:42:55 UTC 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000264.html">Messages
</A></li>
        <LI>Next message: <A HREF="000263.html">Help! Chilli accounting for dropped packets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#262">[ date ]</a>
              <a href="thread.html#262">[ thread ]</a>
              <a href="subject.html#262">[ subject ]</a>
              <a href="author.html#262">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi again,

We recently noticed that a very nasty trojan/virus is doing the rounds 
that uploads a ton of data to the Internet. Since our captive portal 
charges in data units this becomes a major problem as customers loose 
their purchased Internet units like water through a sieve. While legally 
not our problem customers still contact us all the time wondering what 
happened, demanding refunds and all that jazz.

Tricky part is: we cannot sanely ask them to &quot;quickly&quot; download, install 
and/or upgrade their anti-virus because either they already have a zero 
balance or doing so would lose them even more units. It's a catch-22 
until we find a way to block those trojans.

I started investigating instead what patterns such abnormal Internet 
usage follows and managed to block specific instances with custom 
iptables firewall rules (based on port and/or host specs). One example:

iptables -I FORWARD -p tcp --dport 5000 -j DROP

The problem though is: even though the kernel correctly drops the 
trojan's packets (verified with iptables -L -vn), chilli somehow still 
counts them, so I've only solved the smaller part of the problem, making 
sure that the bogus packets never reach the Internet. The larger part, 
that of upload accounting going ballistic is still unaddressed. I always 
thought the kernel would drop them BEFORE chilli gets its hands on them 
for accounting purposes, but it seems like it does so AFTER.

What can I do, if anything, to make sure that either chilli disregards 
certain packets or that I get the kernel to drop packets BEFORE chilli 
gets hold of them?

Gunther

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000264.html">Messages
</A></li>
	<LI>Next message: <A HREF="000263.html">Help! Chilli accounting for dropped packets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#262">[ date ]</a>
              <a href="thread.html#262">[ thread ]</a>
              <a href="subject.html#262">[ subject ]</a>
              <a href="author.html#262">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">More information about the Chilli
mailing list</a><br>
</body></html>
