From chihchun at kalug.linux.org.tw  Thu Sep  9 10:56:59 2010
From: chihchun at kalug.linux.org.tw (Rex Tsai)
Date: Thu, 9 Sep 2010 18:56:59 +0800
Subject: [Chilli] Apply default options for local users
Message-ID: <AANLkTi=3SSnvXFJjjVSiv7pkXd01Z5Y5q8YAzoQX8WL9@mail.gmail.com>

Hi, there

I found if the user login with local user account, the default radius
options does not apply to these sessions.
The options includes default session timeout, default idle time, max
up/down bandwidth, which still very useful for local accounts.

Enclosed is a quick dirty hack for people who might need the options
to work with local accounts.

Regards
-Rex
-------------- next part --------------
A non-text attachment was scrubbed...
Name: default-options.diff
Type: text/x-patch
Size: 617 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100909/030e981a/attachment.bin>

From david at coova.com  Fri Sep 10 11:42:24 2010
From: david at coova.com (David Bird)
Date: Fri, 10 Sep 2010 13:42:24 +0200
Subject: [Chilli] Apply default options for local users
In-Reply-To: <AANLkTi=3SSnvXFJjjVSiv7pkXd01Z5Y5q8YAzoQX8WL9@mail.gmail.com>
References: <AANLkTi=3SSnvXFJjjVSiv7pkXd01Z5Y5q8YAzoQX8WL9@mail.gmail.com>
Message-ID: <1284118944.32299.40.camel@david-laptop>

Thanks! Though, I will commit something similar using the existing and
now non-static session_param_defaults().

David

On Thu, 2010-09-09 at 18:56 +0800, Rex Tsai wrote:
> Hi, there
> 
> I found if the user login with local user account, the default radius
> options does not apply to these sessions.
> The options includes default session timeout, default idle time, max
> up/down bandwidth, which still very useful for local accounts.
> 
> Enclosed is a quick dirty hack for people who might need the options
> to work with local accounts.
> 
> Regards
> -Rex
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From mihamina at gulfsat.mg  Mon Sep 13 09:16:43 2010
From: mihamina at gulfsat.mg (Mihamina Rakotomandimby)
Date: Mon, 13 Sep 2010 12:16:43 +0300
Subject: [Chilli] same SSID fishing
Message-ID: <20100913121643.317f6cee@packard.rktmb.org>

Manao ahoana, Hello, Bonjour,

I set up a Chilli hotspot during a meeting.
(Chilli + auth form)

My main problem is another box, ran by soemone I dont know had set his
SSID to the same as mine, "just for fun".

My users has been "captured" by his AP wherever hiw WiFi strength is
greater than mine, because users connect to the strongest one when they
dont know what to do. Of course, the "fisher" doesnt have my user
database, so that access to the users was not granted when they used
the fake SSID, but... that annoyed me.

What are the common workarrounds for that?

Misaotra, Thanks, Merci.

-- 

       Architecte Informatique chez Blueline/Gulfsat:
    Administration Systeme, Recherche & Developpement
                                    +261 34 56 000 19

From david at coova.com  Tue Sep 14 09:48:46 2010
From: david at coova.com (David Bird)
Date: Tue, 14 Sep 2010 11:48:46 +0200
Subject: [Chilli] high availability
Message-ID: <1284457726.3835.69.camel@david-laptop>

Hi, 

There have been some comments before about running chilli in a HA
cluster.. care to summarize it again? I'm currently giving some thought
to it and some feedback would be great. 

David


From guizaicn at gmail.com  Wed Sep 15 11:21:04 2010
From: guizaicn at gmail.com (=?UTF-8?B?6ay85LuU?=)
Date: Wed, 15 Sep 2010 19:21:04 +0800
Subject: [Chilli] --with-openssl was given, but test for openssl failed
Message-ID: <AANLkTi=FzgJu7wv-Qn9pCYXdOBq725V32JTxuQAYOkyU@mail.gmail.com>

hello~
When I building CoovaChilli ipk for OpenWrt in Ubuntu 10.04, there is an
error : --with-openssl was given, but test for openssl failed
I had installed openssl and libssl-dev.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100915/3dcf30d0/attachment.htm>

From guizaicn at gmail.com  Wed Sep 15 11:32:21 2010
From: guizaicn at gmail.com (=?UTF-8?B?6ay85LuU?=)
Date: Wed, 15 Sep 2010 19:32:21 +0800
Subject: [Chilli] --with-openssl was given, but test for openssl failed
In-Reply-To: <AANLkTi=FzgJu7wv-Qn9pCYXdOBq725V32JTxuQAYOkyU@mail.gmail.com>
References: <AANLkTi=FzgJu7wv-Qn9pCYXdOBq725V32JTxuQAYOkyU@mail.gmail.com>
Message-ID: <AANLkTimf7Fuj39KLAT7zX+_vY7Pu8r=Zfjo9++RGs8KQ@mail.gmail.com>

And
make[7]: *** [main-radsec.o] Error 1
make[6]: *** [all-recursive] Error 1
make[5]: *** [all-recursive] Error 1
make[4]: *** [all] Error 2


2010/9/15 ?? <guizaicn at gmail.com>

> hello~
> When I building CoovaChilli ipk for OpenWrt in Ubuntu 10.04, there is an
> error : --with-openssl was given, but test for openssl failed
> I had installed openssl and libssl-dev.
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100915/01495a4e/attachment.htm>

From david at coova.com  Wed Sep 15 12:20:51 2010
From: david at coova.com (David Bird)
Date: Wed, 15 Sep 2010 14:20:51 +0200
Subject: [Chilli] --with-openssl was given, but test for openssl failed
In-Reply-To: <AANLkTi=FzgJu7wv-Qn9pCYXdOBq725V32JTxuQAYOkyU@mail.gmail.com>
References: <AANLkTi=FzgJu7wv-Qn9pCYXdOBq725V32JTxuQAYOkyU@mail.gmail.com>
Message-ID: <1284553251.3835.72.camel@david-laptop>

there isn't much to go on here... and your follow-up didn't include the
actual make error... 

On Wed, 2010-09-15 at 19:21 +0800, ?? wrote:
> hello~
> When I building CoovaChilli ipk for OpenWrt in Ubuntu 10.04, there is
> an error : --with-openssl was given, but test for openssl failed
> I had installed openssl and libssl-dev.
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From adam at freerunr.com  Wed Sep 15 13:03:55 2010
From: adam at freerunr.com (Adam Hammond)
Date: Wed, 15 Sep 2010 14:03:55 +0100
Subject: [Chilli] --with-openssl was given, but test for openssl failed
In-Reply-To: <1284553251.3835.72.camel@david-laptop>
References: <AANLkTi=FzgJu7wv-Qn9pCYXdOBq725V32JTxuQAYOkyU@mail.gmail.com>
	<1284553251.3835.72.camel@david-laptop>
Message-ID: <48820611-573B-474D-B7F7-2BF0ED07D341@freerunr.com>

I have seen a similar issue when running the first compilation of a  
newly checked out Openwrt build, with coova-chilli configured to use  
openssl.

A quick a dirty work around is to not compile coova-chilli in the  
first run (make sure you are compiling openssl though). Then re- 
compile, this time with coova-chilli.

Seems to have worked for me, although I'm sure there is probably a  
better solution.

--------
Adam



On 15 Sep 2010, at 13:20, David Bird wrote:

> there isn't much to go on here... and your follow-up didn't include  
> the
> actual make error...
>
> On Wed, 2010-09-15 at 19:21 +0800, ?? wrote:
>> hello~
>> When I building CoovaChilli ipk for OpenWrt in Ubuntu 10.04, there is
>> an error : --with-openssl was given, but test for openssl failed
>> I had installed openssl and libssl-dev.
>> _______________________________________________
>> Chilli mailing list
>> Chilli at coova.org
>> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli


From david at coova.com  Fri Sep 17 07:45:52 2010
From: david at coova.com (David Bird)
Date: Fri, 17 Sep 2010 09:45:52 +0200
Subject: [Chilli] multiple chilli instances on the same network
Message-ID: <1284709552.3835.97.camel@david-laptop>

Hello,

A couple of things going on in CoovaChilli development worth commenting
on.. 

There will be a compile time option to --enable-cluster code. This will
include code to manage peers on the dhcpif network. You might do this to
provide failover or load balancing of the chilli access controller. Each
peer shall be given a unique peerid in the configuration, as well as a
peerkey used for encryption of chilli control messages. The control
messages are layer 2 and I'm currently using the protocol number 0xbeef
to carry the encrypted (blowfish; requires openssl) messages. These
messages are used by chilli to coordinate and share client state
information.  

To begin with, I'm looking at an active/standby setup and have two
instances running on the same machine, both configured for the same
dhcpif (with all necessary configuration changes like uamlisten,
uamport, etc, to keep the two instances from using the same resources).
On startup, peerid 0 is always active:

./chilli_query /tmp/chilli.sock peers
Peer 0 (*)  00:11:22:33:44:55 / 10.1.0.1         Active   5 sec
Peer 1      00:11:22:33:44:55 / 10.2.0.1         Standby  4 sec

./chilli_query /tmp/chilli.sock2 peers
Peer 0      00:11:22:33:44:55 / 10.1.0.1         Active   8 sec
Peer 1 (*)  00:11:22:33:44:55 / 10.2.0.1         Standby  7 sec

Both instances (peerid 0 and peerid 1) know the status of the other.
Peer 0 is doing all the work currently, while peer 1 is ignoring all
(except for chilli control packets) dhcpif traffic. 

I can then have peer 1 instance advertise itself as the active server:

./chilli_query /tmp/chilli.sock2 peerset

Now, instantly (because I'm using uamanyip/uamnatanyip in peer 1 config)
all traffic is being handled by peer 1 instance, while peer 0 is
ignoring traffic:

./chilli_query /tmp/chilli.sock2 peers
Peer 0      00:11:22:33:44:55 / 10.1.0.1         Standby  4 sec
Peer 1 (*)  00:11:22:33:44:55 / 10.2.0.1         Active   3 sec

So, it looks promising! The peers also need to coordinate DHCP lease
status, for which I think [1] can be of inspiration. Though, I think we
can do it in the encrypted chilli control messages. 

Also, to help with some debugging/monitoring, I'll add a 'procs' option
to chilli_query to gather a bit of info like:

./chilli_query /tmp/chilli.sock2 procs
Children 2 Max 128 Total 2
PID    10005 Main     [chilli]             up 596 [Vm Size: 5060 RSS:
1616 FDs: 14]
PID    10032 Daemon   [chilli_redir]       up 596 [Vm Size: 4284 RSS:
1668 FDs: 14]
PID    10031 Daemon   [chilli_proxy]       up 596 [Vm Size: 4220 RSS:
1548 FDs: 15]

Not shown, but it will also show any Script or Redirect processes that
chilli has launched and that are running. 

[1] http://tools.ietf.org/html/draft-ietf-dhc-failover-12

David



From m.simioni at gmail.com  Thu Sep 23 13:20:16 2010
From: m.simioni at gmail.com (Marco Simioni)
Date: Thu, 23 Sep 2010 15:20:16 +0200
Subject: [Chilli] 100% cpu problem
In-Reply-To: <1280241577.2600.3.camel@david-laptop>
References: <AANLkTi=vfw-wOt5AdWzYiPVB_hWSri2Qd1yModDSeD1x@mail.gmail.com>
	<1280214335.3366.10.camel@david-laptop>
	<AANLkTin1zNacK-T6L4UdJr=OBkRBG31GcH2YNxfjatYh@mail.gmail.com>
	<1280241577.2600.3.camel@david-laptop>
Message-ID: <AANLkTin5=AMMg=Ub5_nXawBvszYkrmSxHtrqP3i3K5ax@mail.gmail.com>

It happened again: i had 100% cpu after days of uptime.

This time, i was able to identify the following:

1) Thanks to "sar" utility, i was able to localize the CPU usage
between 09:45 and 10:05.

09:05:02        CPU     %user     %nice   %system   %iowait    %steal     %idle
09:45:02        all      0,00      0,00      0,04      4,26      0,00     95,70
09:55:02        all      2,51      0,00      0,08      3,47      0,00     93,94
10:05:02        all     98,32      0,00      1,68      0,00      0,00      0,00

2) In syslog, the messages i see are:

Sep 23 09:51:10 izc coova-chilli[939]: chilli.c: 3402: DHCP addr
released by MAC=90-84-0D-D2-00-2D IP=0.0.0.0
Sep 23 09:51:11 izc coova-chilli[939]: chilli.c: 3248: New DHCP
request from MAC=90-84-0D-D2-00-2D
Sep 23 09:52:02 izc coova-chilli[939]: chilli.c: 3248: New DHCP
request from MAC=00-0E-6A-7A-AB-9C
Sep 23 09:52:02 izc coova-chilli[939]: chilli.c: 3209: Client
MAC=00-0E-6A-7A-AB-9C assigned IP 10.1.0.73
Sep 23 09:55:02 izc CRON[9452]: (root) CMD (command -v debian-sa1 >
/dev/null && debian-sa1 1 1)
Sep 23 10:00:03 izc CRON[9455]: (root) CMD (/etc/rc2.d/S20chilli radconfig)
Sep 23 10:05:01 izc CRON[9461]: (root) CMD (command -v debian-sa1 >
/dev/null && debian-sa1 1 1)

3) I tried to attach with "gdb" to the chilli process. Nothing
happened. I didn't know what to do, so tried to make a step and i got
the following:

(gdb) step
Single stepping until exit from function radius_getnextattr, wich has
no line number information.

than nothing else.

4) Tried to attach with "strace"

root at izc:# strace -p 939
Process 939 attached - interrupt to quit

and nothing happened.

Now i had to reboot to let customers surf.

What can i do next time?

The syslog "radconf" and the gdb message "radius_getnextattr" could
point to something ?

Keep in mind that the radius server is a proprietary one, it is not
freeradius or something else.

Is there something i can to the next time with gdb and/or strace ?

Thank you again.

2010/7/27 David Bird <david at coova.com>:
> Wichert asked a good question; are you using SSL features of
> CoovaChilli?
>
> For info on gdb, you can google for it, of course. Here is a quick howto
> page:
> http://www.freebsd.org/doc/en/books/developers-handbook/debugging.html
>
> For strace, use "strace -p <pid>" and you will see the system calls
> being executed - if it is using 100%, there must be a runaway loop
> occurring.
>
> David
>
> On Tue, 2010-07-27 at 09:20 +0200, Marco Simioni wrote:
>> It happened 3 times in a month,
>>
>> not immediately but after some day of regular work.
>>
>> "top" command sayd chilli was consuming 100% CPU.
>>
>> customers reported that they could not get dhcp and then login page.
>>
>> i will try to use chilli_query when will happen again.
>>
>> how can i attach with gdb or strace? can you point me some documentation?
>>
>> i can run it in debug mode only in console mode, with -fd, or also as
>> a service ?
>>
>> thank you i.a.
>>
>> regards,
>>
>> Marco
>>
>> 2010/7/27 David Bird <david at coova.com>:
>> > How quickly does this start to happen? Immediately? After how long?
>> >
>> > Is chilli also not working during this time? Does chilli_query hang?
>> >
>> > Are you able to attach gdb or use strace to get more info?
>> >
>> > If able, you can try running in debug mode for additional log
>> > information?
>> >
>> > Thanks,
>> > David
>> >
>> >
>> > On Tue, 2010-07-27 at 08:55 +0200, Marco Simioni wrote:
>> >> Hi all, my customer is reporting a cpu problem.
>> >>
>> >> Chilli goes to consume all the processor, going to 100%.
>> >>
>> >> It is a brand new setup, bult on a VMWare ESXi Virtual Machine on HP ML115,
>> >> 1.8GHz CPU allocated,
>> >> 512MB RAM allocated,
>> >> coova-chilli 1.2.2,
>> >> Ubuntu 9.10 ( 2.6.31-14-server ).
>> >>
>> >> It's about three times it happens, solved it with a reboot.
>> >>
>> >> Very few clients, < 10.
>> >>
>> >> Suggestions ?
>> >>
>> >> How can i investigate and understand when it happens ?
>> >>
>> >> Thank i.a.
>> >>
>> >> Best regards,
>> >>
>> >> Marco
>> >> _______________________________________________
>> >> Chilli mailing list
>> >> Chilli at coova.org
>> >> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>> >
>> >
>> >
>
>
>

From adam at freerunr.com  Fri Sep 24 15:22:15 2010
From: adam at freerunr.com (Adam Hammond)
Date: Fri, 24 Sep 2010 16:22:15 +0100
Subject: [Chilli] Coova-chilli-1.2.4 & SSL Problem
Message-ID: <B67987C6-ED38-477D-A051-D71BB4E35E1D@freerunr.com>

Hello everyone,

I'm trying to develop an openwrt image using openwrt backfire 10.0.3  
rc3 with coova-chilli-1.2.4, compiled with ssl support, for use with  
(amongst other smartclients) iPass. I am developing this image for the  
TP-Link WR741ND Acess Point. The critical thing I'm trying to get  
working is support in chilli for clients to post login events to the  
chilli controller using SSL.

I have been using this mailing list post as a general how-to for my  
setup: http://lists.coova.org/pipermail/chilli/2010-May/001379.html,  
and others as guides on what to and not to do.

I am writing to the mailing list as I am now a bit stuck. Suffice to  
say that I can't get it to work, and I don't know exactly why it isn't  
working either.

Below is the typical output I see from chilli when an HTTPS login post  
is sent to the controller (e.g. https://ap.thewifinetwork.net:3990/logon?username=adam at freerunr.com&password=623fcbda6a6fc5b8659f26d82a0c45ed)

redir.c: 3150: 0 (Debug) Receiving HTTP Request
redir.c: 1897: 0 (Debug) HTTP request timeout!
redir.c: 2288: 0 (Debug) -->> Setting userurl=[http:///]
redir.c: 3202: 0 (Debug) Processing HTTP Request
redir.c: 3434: 0 (Debug) Processing received request
redir.c: 3648: 0 (Debug) redir_accept: Original request
redir.c: 3678: 0 (Debug) ---->>> challenge:  
0de41675a44417e279a0754c0b251712
redir.c: 2933: 0 (Debug) close_exit
chilli.c: 114: 0 (Debug) caught 18 via selfpipe
chilli.c: 75: 0 (Debug) child 14158 terminated

I have set my UAM method for smartclients to pass back a login url in  
the WISPr tags with a hardcoded value (uamaliasname.domain) that  
corresponds to the common name set in the SSL certificate I am using  
with chilli. (I have also tried this with the more generic "https://$uamip:$uamport/logon? 
.." url with exactly the same debug output from chilli). The UAM  
method works fine with http requests.

The error I see in the iPass logs is:

WinInet error code: 12157  Message: An error occurred in the secure  
channel support

... which according to msdn means "The application experienced an  
internal error loading the SSL libraries". Not much of a clue for me.

I have tried posting to the login controller using a standard browser  
and have seen the following errors.

Chrome (pretty vague):

Error 107 (net::ERR_SSL_PROTOCOL_ERROR): SSL protocol error.

Firefox:

SSL received a record that exceeded the maximum permissible length.
(Error code: ssl_error_rx_record_too_long)

I should mention that I am using a Thawte test certificate for  
testing. I have tried using a different (non elf signed) certificate,  
if only to provoke an error in chilli, or get it to provide a  
different error message to provide me a clue, to no avail.

If I run chilli --help I notice options for 'uamaliasip' and  
'sslcafile' but cannot find reference to them in my /etc/chilli/ 
functions file. I have tried adding them to my local.conf file to no  
effect.

I know a few posters to this mailing list have been working on similar  
iPass integration projects and would be eternally grateful if they  
could provide me any clues about where I might be going wrong.

Many thanks in advance,

Adam

coova-chilli 1.2.4
Compiled with ENABLE_BINSTATFILE ENABLE_CHILLIRADSEC ENABLE_CHILLIXML  
ENABLE_IEEE8021Q ENABLE_JSON ENABLE_LEAKYBUCKET ENABLE_MINIPORTAL  
ENABLE_PROXYVSA ENABLE_SESSGARDEN ENABLE_STATFILE HAVE_OPENSSL  
USING_POLL

<snippet from /etc/chilli/defaults>
HS_UAMUISSL=on
HS_DNS_DOMAIN=thewifinetwork.net
HS_UAMALIASNAME=ap
HS_SSLKEYFILE=/etc/certs/ap.thewifinetwork.net.key
HS_SSLCERTFILE=/etc/certs/ap.thewifinetwork.net.pem
</snippet>

<snippet from /etc/chilli/local.config>
sslcafile=/etc/certs/thawte-intermediate-ca.pem
uamaliasip=172.17.172.1
</snippet>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100924/ff1193ef/attachment.htm>

From murray at skyrove.com  Mon Sep 27 13:12:46 2010
From: murray at skyrove.com (Murray Long)
Date: Mon, 27 Sep 2010 15:12:46 +0200
Subject: [Chilli] Event-Timestamp
Message-ID: <AANLkTikvh1FR+1GhMM_=Cak__UP7ur_sQFD0M9An1i3j@mail.gmail.com>

Hi All,

Does anyone know if CoovaChilli supports the Event-Timestamp attribute
as specified in radius extensions?
If so how does one enable it?

Many Thanks,
Murray

From tim at skyrove.com  Tue Sep 28 11:40:47 2010
From: tim at skyrove.com (Tim Long)
Date: Tue, 28 Sep 2010 13:40:47 +0200
Subject: [Chilli] Coova-chilli-1.2.4 & SSL Problem
In-Reply-To: <B67987C6-ED38-477D-A051-D71BB4E35E1D@freerunr.com>
References: <B67987C6-ED38-477D-A051-D71BB4E35E1D@freerunr.com>
Message-ID: <AANLkTimR6DNPtpb_5_6gXo7imjdMcaPghU2C3MikcSqk@mail.gmail.com>

Hi Adam,

Are you sure that those certificate settings in the defaults file are making
it into the configuration?

We're using an older version of openwrt, but we had to add

                [ -n "$HS_SSLKEYFILE" -a -n "$HS_SSLCERTFILE" ] && {
                        addconfig2 "sslkeyfile $HS_SSLKEYFILE"
                        addconfig2 "sslcertfile $HS_SSLCERTFILE"
                }

to the /etc/chilli/functions file, so that the init.d script would take the
values from the defaults file and add it to main.conf.



On Fri, Sep 24, 2010 at 5:22 PM, Adam Hammond <adam at freerunr.com> wrote:

> Hello everyone,
>
> I'm trying to develop an openwrt image using openwrt backfire 10.0.3 rc3
> with coova-chilli-1.2.4, compiled with ssl support, for use with (amongst
> other smartclients) iPass. I am developing this image for the TP-Link
> WR741ND Acess Point. The critical thing I'm trying to get working is support
> in chilli for clients to post login events to the chilli controller using
> SSL.
>
> I have been using this mailing list post as a general how-to for my setup:
> http://lists.coova.org/pipermail/chilli/2010-May/001379.html, and others
> as guides on what to and not to do.
>
> I am writing to the mailing list as I am now a bit stuck. Suffice to say
> that I can't get it to work, and I don't know exactly why it isn't working
> either.
>
> Below is the typical output I see from chilli when an HTTPS login post is
> sent to the controller (e.g.
> https://ap.thewifinetwork.net:3990/logon?username=adam at freerunr.com&password=623fcbda6a6fc5b8659f26d82a0c45ed)
>
> redir.c: 3150: 0 (Debug) Receiving HTTP Request
> redir.c: 1897: 0 (Debug) HTTP request timeout!
> redir.c: 2288: 0 (Debug) -->> Setting userurl=[http:///]
> redir.c: 3202: 0 (Debug) Processing HTTP Request
> redir.c: 3434: 0 (Debug) Processing received request
> redir.c: 3648: 0 (Debug) redir_accept: Original request
> redir.c: 3678: 0 (Debug) ---->>> challenge:
> 0de41675a44417e279a0754c0b251712
> redir.c: 2933: 0 (Debug) close_exit
> chilli.c: 114: 0 (Debug) caught 18 via selfpipe
> chilli.c: 75: 0 (Debug) child 14158 terminated
>
> I have set my UAM method for smartclients to pass back a login url in the
> WISPr tags with a hardcoded value (uamaliasname.domain) that corresponds
> to the common name set in the SSL certificate I am using with chilli. (I
> have also tried this with the more generic "https://$uamip:$uamport/logon?.."
> url with exactly the same debug output from chilli). The UAM method works
> fine with http requests.
>
> The error I see in the iPass logs is:
>
> WinInet error code: 12157  Message: An error occurred in the secure channel
> support
>
> ... which according to msdn means "The application experienced an internal
> error loading the SSL libraries". Not much of a clue for me.
>
> I have tried posting to the login controller using a standard browser and
> have seen the following errors.
>
> Chrome (pretty vague):
>
> Error 107 (net::ERR_SSL_PROTOCOL_ERROR): SSL protocol error.
>
> Firefox:
>
> SSL received a record that exceeded the maximum permissible length.
> (Error code: ssl_error_rx_record_too_long)
>
> I should mention that I am using a Thawte test certificate for testing. I
> have tried using a different (non elf signed) certificate, if only to
> provoke an error in chilli, or get it to provide a different error message
> to provide me a clue, to no avail.
>
> If I run chilli --help I notice options for 'uamaliasip' and 'sslcafile'
> but cannot find reference to them in my /etc/chilli/functions file. I have
> tried adding them to my local.conf file to no effect.
>
> I know a few posters to this mailing list have been working on similar
> iPass integration projects and would be eternally grateful if they could
> provide me any clues about where I might be going wrong.
>
> Many thanks in advance,
>
> Adam
>
> coova-chilli 1.2.4
> Compiled with ENABLE_BINSTATFILE ENABLE_CHILLIRADSEC ENABLE_CHILLIXML
> ENABLE_IEEE8021Q ENABLE_JSON ENABLE_LEAKYBUCKET ENABLE_MINIPORTAL
> ENABLE_PROXYVSA ENABLE_SESSGARDEN ENABLE_STATFILE HAVE_OPENSSL USING_POLL
>
> <snippet from /etc/chilli/defaults>
> HS_UAMUISSL=on
> HS_DNS_DOMAIN=thewifinetwork.net
> HS_UAMALIASNAME=ap
> HS_SSLKEYFILE=/etc/certs/ap.thewifinetwork.net.key
> HS_SSLCERTFILE=/etc/certs/ap.thewifinetwork.net.pem
> </snippet>
>
> <snippet from /etc/chilli/local.config>
> sslcafile=/etc/certs/thawte-intermediate-ca.pem
> uamaliasip=172.17.172.1
> </snippet>
>
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100928/bbc64f29/attachment.htm>

From me at gionn.net  Tue Sep 28 13:51:44 2010
From: me at gionn.net (Giovanni Toraldo)
Date: Tue, 28 Sep 2010 15:51:44 +0200
Subject: [Chilli] chilli_redir net.c: Bad file descriptor
Message-ID: <AANLkTin2_+qLtKTLn9G2wqOW3f6-f1uYAuy+et0moAB6@mail.gmail.com>

Hi,

I am using CoovaChilli 1.2.4 on Ubuntu 10.04 i386.

I've configured everything, everything seems to work, however I am
facing many errors on syslog.

Any hints?
With 1.2.2 those errors haven't raised up.

Sep 28 13:43:52 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:43:54 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 29
Sep 28 13:44:03 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 16
Sep 28 13:44:03 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 16
Sep 28 13:44:03 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:44:04 coova-chilli[5595]: chilli.c: 3631: DHCP Released
MAC=1C-4B-D6-2B-5A-91 IP=10.1.0.48
Sep 28 13:44:07 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 15
Sep 28 13:44:09 [chilli_redir]: last message repeated 2 times
Sep 28 13:44:09 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:44:32 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 23
Sep 28 13:44:39 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 24
Sep 28 13:44:39 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 24
Sep 28 13:45:02 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 25
Sep 28 13:45:02 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 25
Sep 28 13:45:03 coova-chilli[5595]: chilli.c: 3631: DHCP Released
MAC=00-0F-E2-2D-F1-B3 IP=0.0.0.0
Sep 28 13:45:06 coova-chilli[5595]: chilli.c: 3631: DHCP Released
MAC=00-0F-E2-2D-F1-A8 IP=0.0.0.0
Sep 28 13:45:09 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 16
Sep 28 13:45:09 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 16
Sep 28 13:45:19 coova-chilli[5595]: chilli.c: 3631: DHCP Released
MAC=00-0F-E2-2D-F1-72 IP=0.0.0.0
Sep 28 13:45:32 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 16
Sep 28 13:45:32 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 16
Sep 28 13:45:32 coova-chilli[5595]: chilli.c: 3476: New DHCP request
from MAC=00-0F-E2-2D-F1-B3
Sep 28 13:45:34 coova-chilli[5595]: chilli.c: 3476: New DHCP request
from MAC=F8-1E-DF-D6-67-E9
Sep 28 13:45:34 coova-chilli[5595]: chilli.c: 3431: Client
MAC=F8-1E-DF-D6-67-E9 assigned IP 10.1.0.52
Sep 28 13:45:35 coova-chilli[5595]: chilli.c: 3476: New DHCP request
from MAC=00-0F-E2-2D-F1-A8
Sep 28 13:45:39 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 18
Sep 28 13:45:48 coova-chilli[5595]: chilli.c: 3476: New DHCP request
from MAC=00-0F-E2-2D-F1-72
Sep 28 13:46:02 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 23
Sep 28 13:46:02 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 23
Sep 28 13:46:09 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 25
Sep 28 13:46:09 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 25
Sep 28 13:46:32 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 31
Sep 28 13:46:32 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 31
Sep 28 13:46:35 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 32
Sep 28 13:46:36 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 32
Sep 28 13:46:39 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 17
Sep 28 13:46:39 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 17
Sep 28 13:46:39 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:46:48 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 34
Sep 28 13:47:02 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 38
Sep 28 13:47:02 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 18
Sep 28 13:47:02 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:47:09 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 20
Sep 28 13:47:09 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 20
Sep 28 13:47:09 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:47:20 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 21
Sep 28 13:47:20 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 21
Sep 28 13:47:20 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:47:31 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 24
Sep 28 13:47:32 [chilli_redir]: last message repeated 2 times
Sep 28 13:47:32 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:47:39 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 24
Sep 28 13:47:39 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 16
Sep 28 13:47:39 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:47:46 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 17
Sep 28 13:47:46 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 17
Sep 28 13:47:46 [chilli_redir]: main-redir.c: 560: 4 (Interrupted
system call) select() returned -1!
Sep 28 13:47:46 [chilli_redir]: net.c: 346: 9 (Bad file descriptor)
Failed to remove fd 17

--
Giovanni Toraldo
http://gionn.net/

From adam at freerunr.com  Wed Sep 29 13:19:47 2010
From: adam at freerunr.com (Adam Hammond)
Date: Wed, 29 Sep 2010 14:19:47 +0100
Subject: [Chilli] Coova-chilli-1.2.4 & SSL Problem
In-Reply-To: <AANLkTimR6DNPtpb_5_6gXo7imjdMcaPghU2C3MikcSqk@mail.gmail.com>
References: <B67987C6-ED38-477D-A051-D71BB4E35E1D@freerunr.com>
	<AANLkTimR6DNPtpb_5_6gXo7imjdMcaPghU2C3MikcSqk@mail.gmail.com>
Message-ID: <FAE03BDC-890F-49D8-A50B-30CFE7DF2D90@freerunr.com>

Hi Tim,

Many thanks for the reply.

It turned out to a problem with my configuration: I was setting my  
uamaliasip in my chilli/defaults config file.

For anyone's reference who may read this in the future:

The SSL errors I noted in my initial post resulted from me posting an  
HTTPS login request to a non HTTPS channel.

I had set the uamaliasip in my chilli/defaults file to the same ip as  
that of my uamlisten ip. I had set my DNS to resolve  
(uamaliasname.domain) to that same ip address, and was posting logins  
to http://uamaliasname.domain:3990/login?... etc

I also tried posting to that same url without the port - with the same  
errors.

I got it working by NOT setting the uamaliasip in any config files -  
therefore using the default of 1.0.0.1
I changed my DNS to match this.

I added the following to my chilli/defaults configuration file:

HS_UAMUISSL=on
HS_DNS_DOMAIN=<my domain>
HS_UAMALIASNAME=<my host>
HS_SSLKEYFILE=<path to my key file>
HS_SSLCERTFILE=<path to my certificate file>

... and I added the following to my chilli/local.conf file:

sslcafile=<path to my ca root certificate file>

I set the login url in my smart client UAM method to post to:

https://uamaliasname.domain/login?..etc

... and made sure my certificate provider crl server(s) were added to  
my UAMALLOW list in my chilli/defaults config file.

So I have now got an HTTPS enabled solution for smart clients working  
using coova-chilli-1.2.4 on openWRT backfire 10.03 rc3 with  
radsecproxy 1.4 sending my RADIUS traffic using TLS.

If anyone is interested in the hardware I am using a TP-Link WR741ND  
access point.

...........
Adam


On 28 Sep 2010, at 12:40, Tim Long wrote:

> Hi Adam,
>
> Are you sure that those certificate settings in the defaults file  
> are making it into the configuration?
>
> We're using an older version of openwrt, but we had to add
>
>                 [ -n "$HS_SSLKEYFILE" -a -n "$HS_SSLCERTFILE" ] && {
>                         addconfig2 "sslkeyfile $HS_SSLKEYFILE"
>                         addconfig2 "sslcertfile $HS_SSLCERTFILE"
>                 }
>
> to the /etc/chilli/functions file, so that the init.d script would  
> take the values from the defaults file and add it to main.conf.
>
>
>
> On Fri, Sep 24, 2010 at 5:22 PM, Adam Hammond <adam at freerunr.com>  
> wrote:
> Hello everyone,
>
> I'm trying to develop an openwrt image using openwrt backfire 10.0.3  
> rc3 with coova-chilli-1.2.4, compiled with ssl support, for use with  
> (amongst other smartclients) iPass. I am developing this image for  
> the TP-Link WR741ND Acess Point. The critical thing I'm trying to  
> get working is support in chilli for clients to post login events to  
> the chilli controller using SSL.
>
> I have been using this mailing list post as a general how-to for my  
> setup: http://lists.coova.org/pipermail/chilli/2010-May/001379.html,  
> and others as guides on what to and not to do.
>
> I am writing to the mailing list as I am now a bit stuck. Suffice to  
> say that I can't get it to work, and I don't know exactly why it  
> isn't working either.
>
> Below is the typical output I see from chilli when an HTTPS login  
> post is sent to the controller (e.g. https://ap.thewifinetwork.net:3990/logon?username=adam at freerunr.com&password=623fcbda6a6fc5b8659f26d82a0c45ed)
>
> redir.c: 3150: 0 (Debug) Receiving HTTP Request
> redir.c: 1897: 0 (Debug) HTTP request timeout!
> redir.c: 2288: 0 (Debug) -->> Setting userurl=[http:///]
> redir.c: 3202: 0 (Debug) Processing HTTP Request
> redir.c: 3434: 0 (Debug) Processing received request
> redir.c: 3648: 0 (Debug) redir_accept: Original request
> redir.c: 3678: 0 (Debug) ---->>> challenge:  
> 0de41675a44417e279a0754c0b251712
> redir.c: 2933: 0 (Debug) close_exit
> chilli.c: 114: 0 (Debug) caught 18 via selfpipe
> chilli.c: 75: 0 (Debug) child 14158 terminated
>
> I have set my UAM method for smartclients to pass back a login url  
> in the WISPr tags with a hardcoded value (uamaliasname.domain) that  
> corresponds to the common name set in the SSL certificate I am using  
> with chilli. (I have also tried this with the more generic "https://$uamip:$uamport/logon? 
> .." url with exactly the same debug output from chilli). The UAM  
> method works fine with http requests.
>
> The error I see in the iPass logs is:
>
> WinInet error code: 12157  Message: An error occurred in the secure  
> channel support
>
> ... which according to msdn means "The application experienced an  
> internal error loading the SSL libraries". Not much of a clue for me.
>
> I have tried posting to the login controller using a standard  
> browser and have seen the following errors.
>
> Chrome (pretty vague):
>
> Error 107 (net::ERR_SSL_PROTOCOL_ERROR): SSL protocol error.
>
> Firefox:
>
> SSL received a record that exceeded the maximum permissible length.
> (Error code: ssl_error_rx_record_too_long)
>
> I should mention that I am using a Thawte test certificate for  
> testing. I have tried using a different (non elf signed)  
> certificate, if only to provoke an error in chilli, or get it to  
> provide a different error message to provide me a clue, to no avail.
>
> If I run chilli --help I notice options for 'uamaliasip' and  
> 'sslcafile' but cannot find reference to them in my /etc/chilli/ 
> functions file. I have tried adding them to my local.conf file to no  
> effect.
>
> I know a few posters to this mailing list have been working on  
> similar iPass integration projects and would be eternally grateful  
> if they could provide me any clues about where I might be going wrong.
>
> Many thanks in advance,
>
> Adam
>
> coova-chilli 1.2.4
> Compiled with ENABLE_BINSTATFILE ENABLE_CHILLIRADSEC  
> ENABLE_CHILLIXML ENABLE_IEEE8021Q ENABLE_JSON ENABLE_LEAKYBUCKET  
> ENABLE_MINIPORTAL ENABLE_PROXYVSA ENABLE_SESSGARDEN ENABLE_STATFILE  
> HAVE_OPENSSL USING_POLL
>
> <snippet from /etc/chilli/defaults>
> HS_UAMUISSL=on
> HS_DNS_DOMAIN=thewifinetwork.net
> HS_UAMALIASNAME=ap
> HS_SSLKEYFILE=/etc/certs/ap.thewifinetwork.net.key
> HS_SSLCERTFILE=/etc/certs/ap.thewifinetwork.net.pem
> </snippet>
>
> <snippet from /etc/chilli/local.config>
> sslcafile=/etc/certs/thawte-intermediate-ca.pem
> uamaliasip=172.17.172.1
> </snippet>
>
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20100929/31f0c611/attachment.htm>

From david at coova.com  Thu Sep 30 11:35:25 2010
From: david at coova.com (David Bird)
Date: Thu, 30 Sep 2010 13:35:25 +0200
Subject: [Chilli] pre-release for 1.2.5
Message-ID: <1285846525.28202.190.camel@david-laptop>

http://coova-chilli.s3.amazonaws.com/coova-chilli-1.2.5-svn.tar.gz

== ChangeLog (CoovaChilli current svn revision) ==

* Removed CoovaChilli-Version from Access-Accept/Challenge/Reject to EAP
NAS
* Fix to not update chilli session from a IPC request when already
autheticated
* Fix for non-null terminates username when proxying EAP
* Added options ''--macup'' and ''--macdown'' defining scripts to run
during DHCP up (assignment) and down (release)
* Added option flag ''--redir'' to turn on redir daemon when built with
''--enable-chilliredir''
* Release DHCP leave on a DHCP-Decline
* Added length checks in more places to verify proper packets
* Reviewed use of all string functions, now including snprintf.c in
bstring
* Allow for the parsing of HTTP Proxy requests for clients configured
with proxy
* Compile time option ''--enable-dnslog'' to allow for run-time option
''--dnslog'' to log all DNS requests
* Consolidated DNS parsing functions into one



From m.simioni at gmail.com  Thu Sep 30 14:31:40 2010
From: m.simioni at gmail.com (Marco Simioni)
Date: Thu, 30 Sep 2010 16:31:40 +0200
Subject: [Chilli] pre-release for 1.2.5
In-Reply-To: <1285846525.28202.190.camel@david-laptop>
References: <1285846525.28202.190.camel@david-laptop>
Message-ID: <AANLkTimfxx-S746UfLVjmqk-TzY41A5EQ_bWTumJ65AN@mail.gmail.com>

Downloaded and packaged with "debuild -b -uc -us".

Just to let you know that the package has been named
"coova-chilli_1.2.3-rc1_amd64.deb", 1.2.3 instead of 1.2.5, i think
it's a typo.

The chilli version is correct, "chilli --version" says "coova-chilli 1.2.5-svn".

Regards

Marco

2010/9/30 David Bird <david at coova.com>:
> http://coova-chilli.s3.amazonaws.com/coova-chilli-1.2.5-svn.tar.gz
>
> == ChangeLog (CoovaChilli current svn revision) ==
>
> * Removed CoovaChilli-Version from Access-Accept/Challenge/Reject to EAP
> NAS
> * Fix to not update chilli session from a IPC request when already
> autheticated
> * Fix for non-null terminates username when proxying EAP
> * Added options ''--macup'' and ''--macdown'' defining scripts to run
> during DHCP up (assignment) and down (release)
> * Added option flag ''--redir'' to turn on redir daemon when built with
> ''--enable-chilliredir''
> * Release DHCP leave on a DHCP-Decline
> * Added length checks in more places to verify proper packets
> * Reviewed use of all string functions, now including snprintf.c in
> bstring
> * Allow for the parsing of HTTP Proxy requests for clients configured
> with proxy
> * Compile time option ''--enable-dnslog'' to allow for run-time option
> ''--dnslog'' to log all DNS requests
> * Consolidated DNS parsing functions into one
>
>
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>

