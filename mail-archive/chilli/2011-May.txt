From timwhite88 at gmail.com  Mon May  2 01:19:05 2011
From: timwhite88 at gmail.com (Timothy White)
Date: Mon, 2 May 2011 11:19:05 +1000
Subject: [Chilli] UAMLogoutIP becomes Original URL
Message-ID: <BANLkTi=P58gscUTGXkE-AENcLmLQskCUCQ@mail.gmail.com>

When using the logout ip address (http://1.0.0.0 in this case) it
becomes the original URL. A user trying to then log back in, will
login, and then when the redirect to originalURL occurs, gets logged
out again. Obviously this requires the login uam system to do
automatic redirects, but it would be great if this logout ip address
didn't automatically become the originalURL (as it's not really a url
the user is trying to get to, rather a url to logout).
Any ideas if this can easily be implemented in chilli, or will I have
to force it to not redirect in the uam?

Tim

From david at coova.com  Mon May  2 06:09:52 2011
From: david at coova.com (David Bird)
Date: Mon, 02 May 2011 08:09:52 +0200
Subject: [Chilli] UAMLogoutIP becomes Original URL
Message-ID: <i3h7aoo36f4dh33wa0ar7wqy.1304316592683@email.android.com>

It is best handled in the portal as the logout URL can be a configurable IP address or hostname resolved in local DNS ...

Timothy White <timwhite88 at gmail.com> wrote:

>When using the logout ip address (http://1.0.0.0 in this case) it
>becomes the original URL. A user trying to then log back in, will
>login, and then when the redirect to originalURL occurs, gets logged
>out again. Obviously this requires the login uam system to do
>automatic redirects, but it would be great if this logout ip address
>didn't automatically become the originalURL (as it's not really a url
>the user is trying to get to, rather a url to logout).
>Any ideas if this can easily be implemented in chilli, or will I have
>to force it to not redirect in the uam?
>
>Tim
>_______________________________________________
>Chilli mailing list
>Chilli at coova.org
>http://lists.coova.org/cgi-bin/mailman/listinfo/chilli

From david at coova.com  Wed May  4 05:20:08 2011
From: david at coova.com (David Bird)
Date: Wed, 4 May 2011 07:20:08 +0200
Subject: [Chilli] Crazy TCP resets when CoovaChilli is enabled (UAM
	redirection problem)
In-Reply-To: <BANLkTi=_=FT+ZFOOq5nOwiGNWhiZjm+ibA@mail.gmail.com>
References: <BANLkTi=bYTHGUDDLR-qWrOfMe7_2b+7f0Q@mail.gmail.com>
	<BANLkTi=_=FT+ZFOOq5nOwiGNWhiZjm+ibA@mail.gmail.com>
Message-ID: <64BBD134-B260-4D8D-A94D-BAF524965622@coova.com>

Hi, after your change, do you see duplicate packets on the dhcpif interface? What do your iptables rules look l like? My suspicion is that both the kernel and chilli are forwarding packets off of the dhcpif ... In iptables, you should have a DROP for the FORWARD coming in from the dhcpif. 

--
  David Bird
  Coova Technologies, LLC

On Apr 27, 2011, at 4:33 PM, Yuh-Rong Leu <yuhrong.leu at gmail.com> wrote:

> I found the root cause of the crazy TCP reset messages.
>  
> In dhcp.c, the dhcp_data_req() function calls dhcp_undoDNAT with the do_reset parameter set to 1 when authstate == DHCP_AUTH_DNAT (at around line# 4074). Therefore, crazy TCP reset messages will be sent inside dhcp_undoDNAT.
>  
> After the code is changed to use 0 for the do_reset  parameter when calling dhcp_undoDNAT, the problem goes away, and Web redirection works well with any triggering any URL on any browser.
>  
> Yuh-Rong Leu
> 
> 
>  
> 2011/4/26 Yuh-Rong Leu <yuhrong.leu at gmail.com>
> Web redirection doesn't work stably with my CoovaChilli/OpenWrt box. Here are the test results:
>  
> If the browser home page is set to http://www.google.com:
> - IE9 is seldom redirected to the welcome/login page
> - Chrome 10 is redirected to the welcome/login page most of the time.
> - Firefox 4 is is redirected to the welcome/login page most of the time.
>  
> If the browser home page is set to http://www.microsoft.com:
> - Redirection works quite fine with all kinds of browsers.
>  
> If the browser home page is set to http://www.apple.com or http://www.bing.com:
> - Redirection does not work at all with any browsers.
>  
> Peeking the packets with Wireshark, I found TCP connections are reset several times by CoovaChilli/OpenWrt. And some TCP reset messages sent by CoovaChilli/OpenWrt have insanely large SEQ number. As the attached Wireshard packet capture, which was generated by "telnet 64.233.183.105 80," shows, 5 RST messages were sent, and 4 of them are with Seq=1246334216.
>  
> I believe it's these crazy RST messages that make UAM redirection not work stably. I doubt the RST messages were due to Firwall rules CoovaChilli added to iptables, but I have not been able to figure out where the firewall rules reside.
>  
> Can anyone tell how CoovaChilli manipulates iptables before it sends HTTP 302 Moved Temporarily for UAM redireciton?
>  
> Yuh-Rong Leu
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110504/2f0898fe/attachment.html>

From yuhrong.leu at gmail.com  Wed May  4 10:06:17 2011
From: yuhrong.leu at gmail.com (Yuh-Rong Leu)
Date: Wed, 4 May 2011 18:06:17 +0800
Subject: [Chilli] Crazy TCP resets when CoovaChilli is enabled (UAM
 redirection problem)
In-Reply-To: <64BBD134-B260-4D8D-A94D-BAF524965622@coova.com>
References: <BANLkTi=bYTHGUDDLR-qWrOfMe7_2b+7f0Q@mail.gmail.com>
	<BANLkTi=_=FT+ZFOOq5nOwiGNWhiZjm+ibA@mail.gmail.com>
	<64BBD134-B260-4D8D-A94D-BAF524965622@coova.com>
Message-ID: <BANLkTi=unxtHLXaL7woQ99=dqq5mDsDzow@mail.gmail.com>

Please see the attached firewall rules (firewall.txt) and iptables dump
(iptables.txt).

Yuh-Rong Leu

2011/5/4 David Bird <david at coova.com>

>  Hi, after your change, do you see duplicate packets on the dhcpif
> interface? What do your iptables rules look l like? My suspicion is that
> both the kernel and chilli are forwarding packets off of the dhcpif ... In
> iptables, you should have a DROP for the FORWARD coming in from the dhcpif.
>
> --
>   David Bird
>   Coova Technologies, LLC
>
> On Apr 27, 2011, at 4:33 PM, Yuh-Rong Leu <yuhrong.leu at gmail.com> wrote:
>
>   I found the root cause of the crazy TCP reset messages.
>
> In dhcp.c, the dhcp_data_req() function calls dhcp_undoDNAT with the
> do_reset parameter set to 1 when authstate == DHCP_AUTH_DNAT (at around
> line# 4074). Therefore, crazy TCP reset messages will be sent inside
> dhcp_undoDNAT.
>
> After the code is changed to use 0 for the do_reset  parameter when calling
> dhcp_undoDNAT, the problem goes away, and Web redirection works well with
> any triggering any URL on any browser.
>
> Yuh-Rong Leu
>
>
>
> 2011/4/26 Yuh-Rong Leu <yuhrong.leu at gmail.com>
>
>> Web redirection doesn't work stably with my CoovaChilli/OpenWrt box. Here
>> are the test results:
>>
>> If the browser home page is set to http://www.google.com:
>> - IE9 is seldom redirected to the welcome/login page
>> - Chrome 10 is redirected to the welcome/login page most of the time.
>> - Firefox 4 is is redirected to the welcome/login page most of the time.
>>
>> If the browser home page is set to http://www.microsoft.com:
>> - Redirection works quite fine with all kinds of browsers.
>>
>> If the browser home page is set to http://www.apple.com or
>> http://www.bing.com:
>> - Redirection does not work at all with any browsers.
>>
>> Peeking the packets with Wireshark, I found TCP connections are reset
>> several times by CoovaChilli/OpenWrt. And some TCP reset messages sent by
>> CoovaChilli/OpenWrt have insanely large SEQ number. As the attached
>> Wireshard packet capture, which was generated by "telnet 64.233.183.105 80,"
>> shows, 5 RST messages were sent, and 4 of them are with Seq=1246334216.
>>
>> I believe it's these crazy RST messages that make UAM redirection not work
>> stably. I doubt the RST messages were due to Firwall rules CoovaChilli added
>> to iptables, but I have not been able to figure out where the firewall rules
>> reside.
>>
>> Can anyone tell how CoovaChilli manipulates iptables before it sends HTTP
>> 302 Moved Temporarily for UAM redireciton?
>>
>> Yuh-Rong Leu
>>
>
>  _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110504/3f6fde63/attachment-0001.html>
-------------- next part --------------

config 'rule'
	option 'src' 'wan'
	option 'dest_port' '22'
	option 'target' 'DROP'
	

config 'rule'
	option 'src' 'wan'
	option 'dest_port' '80'
	option 'target' 'ACCEPT'

config 'rule'
	option 'src' 'lan'
	option 'dest_port' '22'
	option 'target' 'ACCEPT'

config 'rule'
	option 'src' 'wan'
	option 'dest_port' '80'
	option 'target' 'ACCEPT'
	option 'src_ip' '211.75.128.1'

config 'rule'
	option 'src' 'wan'
	option 'dest_port' '80'
	option 'src_ip' '1.2.3.4'
	option 'target' 'ACCEPT'


config 'rule'
	option 'src' 'wan'
	option 'dest_port' '80'
	option 'src_ip' '1.2.3.4'
	option 'target' 'ACCEPT'

config 'rule'
	option 'src' 'wan'
	option 'dest_port' '22'
	option 'src_ip' '192.168.0.113'
	option 'target' 'ACCEPT'

config 'rule'
	option 'src' 'wan'
	option 'src_ip' '211.75.128.1'
	option 'proto' 'icmp'
	option 'target' 'ACCEPT'

config 'rule'
	option 'src' 'wan'
	option 'src_ip' '211.75.128.2'
	option 'proto' 'icmp'
	option 'target' 'ACCEPT'

config 'rule'
	option 'src' 'wan'
	option 'src_ip' '211.75.128.1'
	option 'target' 'ACCEPT'

config 'rule'
	option 'src' 'wan'
	option 'src_ip' '211.75.128.2'
	option 'target' 'ACCEPT'

config 'defaults'
	option 'syn_flood' '1'
	option 'input' 'ACCEPT'
	option 'output' 'ACCEPT'
	option 'forward' 'ACCEPT'

config 'zone'
	option 'name' 'lan'
	option 'input' 'ACCEPT'
	option 'output' 'ACCEPT'
	option 'forward' 'ACCEPT'

config 'zone'
	option 'name' 'wireless1'
	option 'input' 'ACCEPT'
	option 'output' 'ACCEPT'
	option 'forward' 'ACCEPT'
	
config 'forwarding'
	option 'src' 'wireless1'
	option 'dest' 'wan'
	option 'mtu_fix' '1'

config 'zone'
	option 'name' 'wan'
	option 'input' 'ACCEPT'
	option 'output' 'ACCEPT'
	option 'forward' 'ACCEPT'
	option 'masq' '1'

config 'forwarding'
	option 'src' 'lan'
	option 'dest' 'wan'
	option 'mtu_fix' '1'

config 'include'
	option 'path' '/etc/firewall.user'
-------------- next part --------------
Chain INPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED 
ACCEPT     all  --  anywhere             anywhere            
syn_flood  tcp  --  anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN 
input_rule  all  --  anywhere             anywhere            
input      all  --  anywhere             anywhere            

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED 
forwarding_rule  all  --  anywhere             anywhere            
forward    all  --  anywhere             anywhere            

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            state RELATED,ESTABLISHED 
ACCEPT     all  --  anywhere             anywhere            
output_rule  all  --  anywhere             anywhere            
output     all  --  anywhere             anywhere            

Chain forward (1 references)
target     prot opt source               destination         
zone_lan_forward  all  --  anywhere             anywhere            
zone_wan_forward  all  --  anywhere             anywhere            
zone_wireless1_forward  all  --  anywhere             anywhere            

Chain forwarding_lan (1 references)
target     prot opt source               destination         

Chain forwarding_rule (1 references)
target     prot opt source               destination         

Chain forwarding_wan (1 references)
target     prot opt source               destination         

Chain forwarding_wireless1 (1 references)
target     prot opt source               destination         

Chain input (1 references)
target     prot opt source               destination         
zone_lan   all  --  anywhere             anywhere            
zone_wan   all  --  anywhere             anywhere            
zone_wireless1  all  --  anywhere             anywhere            

Chain input_lan (1 references)
target     prot opt source               destination         

Chain input_rule (1 references)
target     prot opt source               destination         

Chain input_wan (1 references)
target     prot opt source               destination         

Chain input_wireless1 (1 references)
target     prot opt source               destination         

Chain output (1 references)
target     prot opt source               destination         
zone_lan_ACCEPT  all  --  anywhere             anywhere            
zone_wireless1_ACCEPT  all  --  anywhere             anywhere            
zone_wan_ACCEPT  all  --  anywhere             anywhere            

Chain output_rule (1 references)
target     prot opt source               destination         

Chain reject (6 references)
target     prot opt source               destination         
REJECT     all  --  anywhere             anywhere            reject-with icmp-port-unreachable 

Chain syn_flood (1 references)
target     prot opt source               destination         
RETURN     tcp  --  anywhere             anywhere            tcp flags:FIN,SYN,RST,ACK/SYN limit: avg 25/sec burst 50 
DROP       all  --  anywhere             anywhere            

Chain zone_lan (1 references)
target     prot opt source               destination         
ACCEPT     udp  --  anywhere             anywhere            udp dpt:22 
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:22 
input_lan  all  --  anywhere             anywhere            
zone_lan_ACCEPT  all  --  anywhere             anywhere            

Chain zone_lan_ACCEPT (3 references)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            
ACCEPT     all  --  anywhere             anywhere            

Chain zone_lan_DROP (0 references)
target     prot opt source               destination         
DROP       all  --  anywhere             anywhere            
DROP       all  --  anywhere             anywhere            

Chain zone_lan_MSSFIX (0 references)
target     prot opt source               destination         
TCPMSS     tcp  --  anywhere             anywhere            tcp flags:SYN,RST/SYN TCPMSS clamp to PMTU 

Chain zone_lan_REJECT (0 references)
target     prot opt source               destination         
reject     all  --  anywhere             anywhere            
reject     all  --  anywhere             anywhere            

Chain zone_lan_forward (1 references)
target     prot opt source               destination         
zone_wan_MSSFIX  all  --  anywhere             anywhere            
zone_wan_ACCEPT  all  --  anywhere             anywhere            
forwarding_lan  all  --  anywhere             anywhere            
zone_lan_ACCEPT  all  --  anywhere             anywhere            

Chain zone_wan (1 references)
target     prot opt source               destination         
ACCEPT     udp  --  www.yesturnkey.com   anywhere            
ACCEPT     tcp  --  www.yesturnkey.com   anywhere            
ACCEPT     udp  --  yesturnkey.com       anywhere            
ACCEPT     tcp  --  yesturnkey.com       anywhere            
ACCEPT     icmp --  www.yesturnkey.com   anywhere            
ACCEPT     icmp --  yesturnkey.com       anywhere            
ACCEPT     udp  --  192.168.0.113        anywhere            udp dpt:22 
ACCEPT     tcp  --  192.168.0.113        anywhere            tcp dpt:22 
ACCEPT     udp  --  1.2.3.4              anywhere            udp dpt:80 
ACCEPT     tcp  --  1.2.3.4              anywhere            tcp dpt:80 
ACCEPT     udp  --  1.2.3.4              anywhere            udp dpt:80 
ACCEPT     tcp  --  1.2.3.4              anywhere            tcp dpt:80 
ACCEPT     udp  --  yesturnkey.com       anywhere            udp dpt:80 
ACCEPT     tcp  --  yesturnkey.com       anywhere            tcp dpt:80 
ACCEPT     udp  --  anywhere             anywhere            udp dpt:80 
ACCEPT     tcp  --  anywhere             anywhere            tcp dpt:80 
DROP       udp  --  anywhere             anywhere            udp dpt:22 
DROP       tcp  --  anywhere             anywhere            tcp dpt:22 
input_wan  all  --  anywhere             anywhere            
zone_wan_ACCEPT  all  --  anywhere             anywhere            

Chain zone_wan_ACCEPT (5 references)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            
ACCEPT     all  --  anywhere             anywhere            

Chain zone_wan_DROP (0 references)
target     prot opt source               destination         
DROP       all  --  anywhere             anywhere            
DROP       all  --  anywhere             anywhere            

Chain zone_wan_MSSFIX (2 references)
target     prot opt source               destination         
TCPMSS     tcp  --  anywhere             anywhere            tcp flags:SYN,RST/SYN TCPMSS clamp to PMTU 

Chain zone_wan_REJECT (0 references)
target     prot opt source               destination         
reject     all  --  anywhere             anywhere            
reject     all  --  anywhere             anywhere            

Chain zone_wan_forward (1 references)
target     prot opt source               destination         
forwarding_wan  all  --  anywhere             anywhere            
zone_wan_ACCEPT  all  --  anywhere             anywhere            

Chain zone_wireless1 (1 references)
target     prot opt source               destination         
input_wireless1  all  --  anywhere             anywhere            
zone_wireless1_ACCEPT  all  --  anywhere             anywhere            

Chain zone_wireless1_ACCEPT (3 references)
target     prot opt source               destination         
ACCEPT     all  --  anywhere             anywhere            
ACCEPT     all  --  anywhere             anywhere            

Chain zone_wireless1_DROP (0 references)
target     prot opt source               destination         
DROP       all  --  anywhere             anywhere            
DROP       all  --  anywhere             anywhere            

Chain zone_wireless1_MSSFIX (0 references)
target     prot opt source               destination         
TCPMSS     tcp  --  anywhere             anywhere            tcp flags:SYN,RST/SYN TCPMSS clamp to PMTU 

Chain zone_wireless1_REJECT (0 references)
target     prot opt source               destination         
reject     all  --  anywhere             anywhere            
reject     all  --  anywhere             anywhere            

Chain zone_wireless1_forward (1 references)
target     prot opt source               destination         
zone_wan_MSSFIX  all  --  anywhere             anywhere            
zone_wan_ACCEPT  all  --  anywhere             anywhere            
forwarding_wireless1  all  --  anywhere             anywhere            
zone_wireless1_ACCEPT  all  --  anywhere             anywhere            

From yuhrong.leu at gmail.com  Wed May  4 11:03:22 2011
From: yuhrong.leu at gmail.com (Yuh-Rong Leu)
Date: Wed, 4 May 2011 19:03:22 +0800
Subject: [Chilli] Crazy TCP resets when CoovaChilli is enabled (UAM
 redirection problem)
In-Reply-To: <64BBD134-B260-4D8D-A94D-BAF524965622@coova.com>
References: <BANLkTi=bYTHGUDDLR-qWrOfMe7_2b+7f0Q@mail.gmail.com>
	<BANLkTi=_=FT+ZFOOq5nOwiGNWhiZjm+ibA@mail.gmail.com>
	<64BBD134-B260-4D8D-A94D-BAF524965622@coova.com>
Message-ID: <BANLkTim4uK2L3y0hPoz=_k9Xu-GADOpKGw@mail.gmail.com>

Attached please find the Wireshark packet captures before and after the
change.

As you can see, there are many strange TCP reset messages (with nonsense SEQ
numbers) in before.pcap.

Yuh-Rong Leu

2011/5/4 David Bird <david at coova.com>

>  Hi, after your change, do you see duplicate packets on the dhcpif
> interface? What do your iptables rules look l like? My suspicion is that
> both the kernel and chilli are forwarding packets off of the dhcpif ... In
> iptables, you should have a DROP for the FORWARD coming in from the dhcpif.
>
> --
>   David Bird
>   Coova Technologies, LLC
>
> On Apr 27, 2011, at 4:33 PM, Yuh-Rong Leu <yuhrong.leu at gmail.com> wrote:
>
>   I found the root cause of the crazy TCP reset messages.
>
> In dhcp.c, the dhcp_data_req() function calls dhcp_undoDNAT with the
> do_reset parameter set to 1 when authstate == DHCP_AUTH_DNAT (at around
> line# 4074). Therefore, crazy TCP reset messages will be sent inside
> dhcp_undoDNAT.
>
> After the code is changed to use 0 for the do_reset  parameter when calling
> dhcp_undoDNAT, the problem goes away, and Web redirection works well with
> any triggering any URL on any browser.
>
> Yuh-Rong Leu
>
>
>
> 2011/4/26 Yuh-Rong Leu <yuhrong.leu at gmail.com>
>
>> Web redirection doesn't work stably with my CoovaChilli/OpenWrt box. Here
>> are the test results:
>>
>> If the browser home page is set to http://www.google.com:
>> - IE9 is seldom redirected to the welcome/login page
>> - Chrome 10 is redirected to the welcome/login page most of the time.
>> - Firefox 4 is is redirected to the welcome/login page most of the time.
>>
>> If the browser home page is set to http://www.microsoft.com:
>> - Redirection works quite fine with all kinds of browsers.
>>
>> If the browser home page is set to http://www.apple.com or
>> http://www.bing.com:
>> - Redirection does not work at all with any browsers.
>>
>> Peeking the packets with Wireshark, I found TCP connections are reset
>> several times by CoovaChilli/OpenWrt. And some TCP reset messages sent by
>> CoovaChilli/OpenWrt have insanely large SEQ number. As the attached
>> Wireshard packet capture, which was generated by "telnet 64.233.183.105 80,"
>> shows, 5 RST messages were sent, and 4 of them are with Seq=1246334216.
>>
>> I believe it's these crazy RST messages that make UAM redirection not work
>> stably. I doubt the RST messages were due to Firwall rules CoovaChilli added
>> to iptables, but I have not been able to figure out where the firewall rules
>> reside.
>>
>> Can anyone tell how CoovaChilli manipulates iptables before it sends HTTP
>> 302 Moved Temporarily for UAM redireciton?
>>
>> Yuh-Rong Leu
>>
>
>  _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110504/ff049974/attachment-0001.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: after.pcap
Type: application/octet-stream
Size: 81943 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110504/ff049974/attachment-0002.obj>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: before.pcap
Type: application/octet-stream
Size: 8974 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110504/ff049974/attachment-0003.obj>

From ryan.day at cirrusworks.net  Wed May  4 18:15:24 2011
From: ryan.day at cirrusworks.net (Ryan Day)
Date: Wed, 04 May 2011 14:15:24 -0400
Subject: [Chilli] MACAuth problem
Message-ID: <4DC197BC.70706@cirrusworks.net>

I'm running coova 1.2.5, with

/usr/local/sbin/chilli --macpasswd macpass --macauth --uamanydns -c
/etc/chilli2.conf --tundev tun1 -d --fg

as my command line. I'm trying to use MAC authentication, and am seeing
a very strange problem.

When I first get a DHCP reply to my laptop, I can watch the RADIUS
request go out, the server accepts it, and sends back the accept
message. I can watch the process over tcpdump, and in all the logs. I am
able to load the data for that first request(so all the text on a
webpage, but no images or javascript). When I try to reload the page, I
am sent to my splash page and asked to login.

It looks like each request after the very first are not being
authenticated. If I use --macreauth, I can see the RADIUS requests being
sent out everytime I visit a page, the requests are accepted(tcpdump
shows me the accept come back), but I'm still redirected to the splash page.

Am I missing a step, or using the wrong options, or anything else?
Thanks for any ideas!


Ryan

From david at coova.com  Thu May  5 05:48:59 2011
From: david at coova.com (David Bird)
Date: Thu, 5 May 2011 07:48:59 +0200
Subject: [Chilli] MACAuth problem
In-Reply-To: <4DC197BC.70706@cirrusworks.net>
References: <4DC197BC.70706@cirrusworks.net>
Message-ID: <4018B153-53FE-498D-84A3-E75CC1A1B1F8@coova.com>

What does the chilli debug output say? 

--
  David Bird
  Coova Technologies, LLC

On May 4, 2011, at 8:15 PM, Ryan Day <ryan.day at cirrusworks.net> wrote:

> I'm running coova 1.2.5, with
> 
> /usr/local/sbin/chilli --macpasswd macpass --macauth --uamanydns -c
> /etc/chilli2.conf --tundev tun1 -d --fg
> 
> as my command line. I'm trying to use MAC authentication, and am seeing
> a very strange problem.
> 
> When I first get a DHCP reply to my laptop, I can watch the RADIUS
> request go out, the server accepts it, and sends back the accept
> message. I can watch the process over tcpdump, and in all the logs. I am
> able to load the data for that first request(so all the text on a
> webpage, but no images or javascript). When I try to reload the page, I
> am sent to my splash page and asked to login.
> 
> It looks like each request after the very first are not being
> authenticated. If I use --macreauth, I can see the RADIUS requests being
> sent out everytime I visit a page, the requests are accepted(tcpdump
> shows me the accept come back), but I'm still redirected to the splash page.
> 
> Am I missing a step, or using the wrong options, or anything else?
> Thanks for any ideas!
> 
> 
> Ryan
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli

From ryan.day at cirrusworks.net  Thu May  5 11:15:00 2011
From: ryan.day at cirrusworks.net (Ryan Day)
Date: Thu, 05 May 2011 07:15:00 -0400
Subject: [Chilli] MACAuth problem
In-Reply-To: <4018B153-53FE-498D-84A3-E75CC1A1B1F8@coova.com>
References: <4DC197BC.70706@cirrusworks.net>
	<4018B153-53FE-498D-84A3-E75CC1A1B1F8@coova.com>
Message-ID: <4DC286B4.4000500@cirrusworks.net>

I think this is the relevant information, let me know if there is
something particular to look for.


This is me doing the initial DHCP request, the going to www.xkcd.com:

dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=ff:ff:ff:ff:ff:ff prot=0800 2048 len=342
dhcp.c: 2811: 0 (Debug) dhcp/bootps request being processed
dhcp.c: 571: 0 (Debug) DHCP newconn: 00:22:19:f7:7f:c0
chilli.c: 3721: 0 (Debug) New DHCP request from MAC=00-22-19-F7-7F-C0
chilli.c: 3724: 0 (Debug) New DHCP connection established
chilli.c: 3567: 0 (Debug) DHCP request for IP address
chilli.c: 1141: 0 (Debug) Starting radius authentication
radius.c: 1101: 0 (Debug) pw encode secret=testing123
radius.c: 1423: 0 (Debug) RADIUS to XXX.XXX.XXX.XXX:1812
ippool.c: 438: 0 (Debug) Requesting new static ip: 0.0.0.0
ippool.c: 438: 0 (Debug) Requesting new dynamic ip: 0.0.0.0
chilli.c: 3676: 0 (Debug) Client MAC=00-22-19-F7-7F-C0 assigned IP
10.192.156.2
dhcp.c: 2077: 0 (Debug) !!! dhcp server :  !!!
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=ff:ff:ff:ff:ff:ff prot=0800 2048 len=354
dhcp.c: 2811: 0 (Debug) dhcp/bootps request being processed
dhcp.c: 2077: 0 (Debug) !!! dhcp server :  !!!
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:1f:27:8e:2b:04
dst=01:00:0c:cc:cc:cd prot=0032 50 len=64
dhcp.c: 3452: 0 (Debug) Layer2 PROT: 0x0032 dropped
chilli.c: 3211: 0 (Debug) Received RADIUS response
chilli.c: 3277: 0 (Debug) Radius Access-Accept from radius server
radius.c: 1423: 0 (Debug) RADIUS to XXX.XXX.XXX.XXX:1813
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=ff:ff:ff:ff:ff:ff prot=0806 2054 len=60
dhcp.c: 3878: 0 (Debug) ARP: 00-22-19-F7-7F-C0 asking about 10.192.156.1
dhcp.c: 3803: 0 (Debug) ARP: Replying to 10.192.156.2 / 00-22-19-F7-7F-C0
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:25:90:01:32:f7
dst=00:22:19:f7:7f:c0 prot=0806 2054 len=42
dhcp.c: 3837: 0 (Debug) ARP: Received other ARP than request!
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=01:00:5e:7f:ff:fa prot=0800 2048 len=1036
dhcp.c: 2796: 0 (Debug) Not for our MAC or broadcast: 01-00-5E-7F-FF-FA
dhcp.c: 3452: 0 (Debug) Layer2 PROT: 0x0032 dropped
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:1f:27:8e:2b:04
dst=01:00:0c:cc:cc:cd prot=0032 50 len=64
dhcp.c: 3452: 0 (Debug) Layer2 PROT: 0x0032 dropped
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=ff:ff:ff:ff:ff:ff prot=0800 2048 len=92
dhcp.c: 2891: 0 (Debug) Broadcasted UDP to port 137
radius.c: 1423: 0 (Debug) RADIUS to XXX.XXX.XXX.XXX:1813
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:1f:27:8e:2b:04
dst=01:00:0c:cc:cc:cd prot=0032 50 len=64
dhcp.c: 3452: 0 (Debug) Layer2 PROT: 0x0032 dropped
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=ff:ff:ff:ff:ff:ff prot=0806 2054 len=60
dhcp.c: 3878: 0 (Debug) ARP: 00-22-19-F7-7F-C0 asking about 10.192.156.1
dhcp.c: 3803: 0 (Debug) ARP: Replying to 10.192.156.2 / 00-22-19-F7-7F-C0
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:25:90:01:32:f7
dst=00:22:19:f7:7f:c0 prot=0806 2054 len=42
dhcp.c: 3837: 0 (Debug) ARP: Received other ARP than request!
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=00:25:90:01:32:f7 prot=0800 2048 len=72
dhcp.c: 1386: 0 (Debug) dhcp_dns plen=72 dlen=18 olen=18
dhcp.c: 1388: 0 (Debug) DNS ID:    45657
dhcp.c: 1389: 0 (Debug) DNS Flags: 256
dhcp.c: 1411: 0 (Debug) qd: 1
dns.c: 182: 0 (Debug) dns_copy_res(left=18 olen=18 qsize=512)
dns.c: 205: 0 (Debug) It was a dns record type: 1 class: 1
dns.c: 39: 0 (Debug) dlen=512 reslen=18 olen=18 lvl=0
dns.c: 73: 0 (Debug) part[www] reslen=17 l=3 dlen=512
dns.c: 73: 0 (Debug) part[xkcd] reslen=13 l=4 dlen=508
dns.c: 73: 0 (Debug) part[com] reslen=8 l=3 dlen=503
dns.c: 234: 0 (Debug) Q: www.xkcd.com
dhcp.c: 1412: 0 (Debug) an: 2
dns.c: 182: 0 (Debug) dns_copy_res(left=30 olen=48 qsize=512)
dns.c: 205: 0 (Debug) It was a dns record type: 5 class: 1
dns.c: 182: 0 (Debug) dns_copy_res(left=16 olen=48 qsize=512)
dns.c: 205: 0 (Debug) It was a dns record type: 1 class: 1
dns.c: 265: 0 (Debug) A record
dns.c: 270: 0 (Debug) checking .paypal.com [www.xkcd.com]
dns.c: 270: 0 (Debug) checking .paypalobjects.com [www.xkcd.com]
dhcp.c: 1413: 0 (Debug) ns: 0
dhcp.c: 1414: 0 (Debug) ar: 0
dhcp.c: 1416: 0 (Debug) left (should be zero): 0
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=00:25:90:01:32:f7 prot=0800 2048 len=66
chilli.c: 466: 0 (Debug) Leaky bucket timediff: 0, bucketup: 72/5000,
bucketdown: 88/5000, up: 66, down: 0
tun.c: 705: 0 (Debug) tun_decaps(idx=0, len=52)




Further down the debug I see:

dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:1f:27:8e:2b:04
dst=01:00:0c:cc:cc:cd prot=0032 50 len=64
dhcp.c: 3452: 0 (Debug) Layer2 PROT: 0x0032 dropped
tun.c: 705: 0 (Debug) tun_decaps(idx=0, len=1470)
chilli.c: 466: 0 (Debug) Leaky bucket timediff: 1, bucketup: 2614/5000,
bucketdown: 4430/5000, up: 0, down: 1470
chilli.c: 506: 0 (Debug) Leaky bucket deleting downlink packet
tun.c: 705: 0 (Debug) tun_decaps(idx=0, len=40)
chilli.c: 466: 0 (Debug) Leaky bucket timediff: 1, bucketup: 2486/5000,
bucketdown: 4302/5000, up: 0, down: 40
dhcp.c: 3715: 0 (Debug) adding 14 to IP frame length 40
radius.c: 1423: 0 (Debug) RADIUS to 173.203.238.107:1813
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=00:25:90:01:32:f7 prot=0800 2048 len=60
tun.c: 705: 0 (Debug) tun_decaps(idx=0, len=40)
dhcp.c: 3715: 0 (Debug) adding 14 to IP frame length 40
tun.c: 705: 0 (Debug) tun_decaps(idx=0, len=40)
dhcp.c: 3715: 0 (Debug) adding 14 to IP frame length 40
dhcp.c: 1996: 0 (Debug) Resetting connection on port 80->65379 (undo)
dhcp.c: 3742: 0 (Debug) dhcp_undoDNAT() returns true
tun.c: 705: 0 (Debug) tun_decaps(idx=0, len=40)
dhcp.c: 3715: 0 (Debug) adding 14 to IP frame length 40
dhcp.c: 1996: 0 (Debug) Resetting connection on port 80->65379 (undo)
dhcp.c: 3742: 0 (Debug) dhcp_undoDNAT() returns true
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=00:25:90:01:32:f7 prot=0800 2048 len=66
tun.c: 705: 0 (Debug) tun_decaps(idx=0, len=52)
dhcp.c: 3715: 0 (Debug) adding 14 to IP frame length 52
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=00:25:90:01:32:f7 prot=0800 2048 len=60
dhcp.c: 3421: 0 (Debug) dhcp_decaps: src=00:22:19:f7:7f:c0
dst=00:25:90:01:32:f7 prot=0800 2048 len=733
tun.c: 705: 0 (Debug) tun_decaps(idx=0, len=40)
dhcp.c: 3715: 0 (Debug) adding 14 to IP frame length 40
redir.c: 2097: 0 (Debug) end of http-request
redir.c: 2324: 0 (Debug) -->> Setting
userurl=[http://www.google.com/cse/brand?form=cse-search-box&lang=en]
redir.c: 3490: 0 (Debug) Processing received request
redir.c: 3705: 0 (Debug) redir_accept: Original request
redir.c: 3726: 0 (Debug) ---->>> resetting challenge:
f4466fbc1fa3ddcd3714c05c35436dfa
redir.c: 3735: 0 (Debug) ---->>> challenge: f4466fbc1fa3ddcd3714c05c35436dfa
redir.c: 2969: 0 (Debug) close_exit

Which, I'm assuming, is where I'm no longer authenticated.


On 05/05/2011 01:48 AM, David Bird wrote:
> What does the chilli debug output say? 
>
> --
>   David Bird
>   Coova Technologies, LLC
>
> On May 4, 2011, at 8:15 PM, Ryan Day <ryan.day at cirrusworks.net> wrote:
>
>> I'm running coova 1.2.5, with
>>
>> /usr/local/sbin/chilli --macpasswd macpass --macauth --uamanydns -c
>> /etc/chilli2.conf --tundev tun1 -d --fg
>>
>> as my command line. I'm trying to use MAC authentication, and am seeing
>> a very strange problem.
>>
>> When I first get a DHCP reply to my laptop, I can watch the RADIUS
>> request go out, the server accepts it, and sends back the accept
>> message. I can watch the process over tcpdump, and in all the logs. I am
>> able to load the data for that first request(so all the text on a
>> webpage, but no images or javascript). When I try to reload the page, I
>> am sent to my splash page and asked to login.
>>
>> It looks like each request after the very first are not being
>> authenticated. If I use --macreauth, I can see the RADIUS requests being
>> sent out everytime I visit a page, the requests are accepted(tcpdump
>> shows me the accept come back), but I'm still redirected to the splash page.
>>
>> Am I missing a step, or using the wrong options, or anything else?
>> Thanks for any ideas!
>>
>>
>> Ryan
>> _______________________________________________
>> Chilli mailing list
>> Chilli at coova.org
>> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli


From mctiew at yahoo.com  Tue May 10 14:38:13 2011
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Tue, 10 May 2011 07:38:13 -0700 (PDT)
Subject: [Chilli] content injection for advertisement
Message-ID: <32361.45152.qm@web161403.mail.bf1.yahoo.com>

Anyone knows of a commercial grade content injection software for injecting advertisements please let me know. Maybe we can exchange mail in private for further details. 

Regards.

From superxx008 at gmail.com  Sat May 14 09:10:27 2011
From: superxx008 at gmail.com (Xin XIAO)
Date: Sat, 14 May 2011 17:10:27 +0800
Subject: [Chilli] about content injection example
Message-ID: <BANLkTimJX7UhqHdAjdzrvzh3GrXc8fYqfQ@mail.gmail.com>

Hello,

I read david's blog at http://www.coova.org/node/4656, I'm very interested
in it and does anybody has the sourcecode of the top banner example in the
post?  (/www/com.coova.Cd/com.coova.Cd.nocache.js<http://com.coova.cd/com.coova.Cd.nocache.js>
).

by the way, when I start chilli with --redir and --uamregex="*", no login
page would be displayed automatically, and page displaying was quit slow
maybe due to the redirecting processing.

Best regards.

-- 
Xiao Xin

-- 
Xiao Xin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110514/0b71c446/attachment.html>

From peter at endian.com  Tue May 17 15:20:54 2011
From: peter at endian.com (Peter Warasin)
Date: Tue, 17 May 2011 17:20:54 +0200
Subject: [Chilli] [PATCH] SNAT also ARP responses if uamnatanyip
Message-ID: <4DD29256.3000103@endian.com>

Hello again

Following scenario:

usetap is enabled, also uamanyip and uamnatanyip
The hotspot tap device joined a bridge.

ARP requests asking for a clients ip answer with the original ip instead
of the NATed one.

The following patch replaces also the target ip address with the nated
one instead of leaving the original (himip), which is not visible on the
tap side of chilli.

Fix is against 1.2.6


kind regards.,
peter

-- 
:: e n d i a n
:: open source - open minds

:: peter warasin
:: http://www.endian.com   :: peter at endian.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: coova-chilli-1.2.6-uamnatanyip-tap-answer-arp-with-natip.patch
Type: text/x-patch
Size: 1191 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110517/11ae926c/attachment.bin>

From peter at endian.com  Tue May 17 15:11:58 2011
From: peter at endian.com (Peter Warasin)
Date: Tue, 17 May 2011 17:11:58 +0200
Subject: [Chilli] [PATCH] do not set bucket*size to BUCKET_SIZE_MIN if
 bandwithmax* is disabled
Message-ID: <4DD2903E.8080803@endian.com>

Hi guys

The attached patch fixes a bug which sets bucketupsize to
BUCKET_SIZE_MIN also when it is disabled (0) in radius but the
downstream bandwidth is set to some value.. or the other way around.

Fix is against 1.2.6

kind regards,
peter

-- 
:: e n d i a n
:: open source - open minds

:: peter warasin
:: http://www.endian.com   :: peter at endian.com
-------------- next part --------------
A non-text attachment was scrubbed...
Name: coova-chilli-1.2.6-leaky-bucket-init-fix.patch
Type: text/x-patch
Size: 1093 bytes
Desc: not available
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110517/98153ff9/attachment.bin>

From derekchilli at hssl.ie  Wed May 18 01:17:35 2011
From: derekchilli at hssl.ie (Derek C)
Date: Wed, 18 May 2011 02:17:35 +0100 (IST)
Subject: [Chilli] Coova Chilli with dhcpgatway and dnsmasq on port 6700 -
 Address already in use ?
Message-ID: <55363.149.5.32.254.1305681455.squirrel@www.rivertowermail.com>

Hi,

I have a test setup with dnsmasq answering dhcp queries on port 6700
(netstat -a confirms this).

I have these three lines setup in chilli.conf: -
dhcpgateway 127.0.0.1
dhcpgatewayport 6700
dhcprelayagent 192.168.1.1

When I try to start Coova Chilli it dies and writes this into the log:
dhcp.c: 927: 98 (Address already in use) socket or bind failed for dhcp
relay!

Does the dhcpgateway port not mean the port for the outsourced dhcp
server?  (and will the chilli dhcp not still be served on port 67) ?

Maybe I'm just reading the directives wrong - and I had this working a
couple of months ago too!

thanks for any advice!

Derek

-- 
Derek C
In Ireland


From derekchilli at hssl.ie  Wed May 18 07:27:12 2011
From: derekchilli at hssl.ie (Derek C)
Date: Wed, 18 May 2011 08:27:12 +0100 (IST)
Subject: [Chilli] coova chilli and dnsmasq on same box
Message-ID: <59818.149.5.32.254.1305703632.squirrel@www.rivertowermail.com>

Hi all,

Is it possible to run dnsmasq and coova chilli (with dhcp-relaying) on the
same physical box?  I'm seeing that messages from dnsmasq (on 127.0.0.1)
don't seem to be getting back to coova chilli - I don't see this issue
when dnsmasq is running on a physically different computer so I wonder is
it something to do with local routing and multicast UDP packets?

Derek


-- 
Derek C
In Ireland


From mctiew at yahoo.com  Wed May 18 07:35:53 2011
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Wed, 18 May 2011 00:35:53 -0700 (PDT)
Subject: [Chilli] coova chilli and dnsmasq on same box
In-Reply-To: <59818.149.5.32.254.1305703632.squirrel@www.rivertowermail.com>
Message-ID: <974771.82312.qm@web161407.mail.bf1.yahoo.com>


I think dnsmasq has to listen to tun0 interface in order
for it to serve the users. What is the dnsmasq -i parameter 
you used ?

--- On Wed, 5/18/11, Derek C <derekchilli at hssl.ie> wrote:

> From: Derek C <derekchilli at hssl.ie>
> Subject: [Chilli] coova chilli and dnsmasq on same box
> To: chilli at coova.org
> Date: Wednesday, May 18, 2011, 7:27 AM
> Hi all,
> 
> Is it possible to run dnsmasq and coova chilli (with
> dhcp-relaying) on the
> same physical box?? I'm seeing that messages from
> dnsmasq (on 127.0.0.1)
> don't seem to be getting back to coova chilli - I don't see
> this issue
> when dnsmasq is running on a physically different computer
> so I wonder is
> it something to do with local routing and multicast UDP
> packets?
> 
> Derek
> 
> 
> -- 
> Derek C
> In Ireland
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
> 

From david at coova.com  Wed May 18 08:24:24 2011
From: david at coova.com (David Bird)
Date: Wed, 18 May 2011 10:24:24 +0200
Subject: [Chilli] [PATCH] SNAT also ARP responses if uamnatanyip
In-Reply-To: <4DD29256.3000103@endian.com>
References: <4DD29256.3000103@endian.com>
Message-ID: <1305707064.5281.64.camel@david-laptop>

thanks..

On Tue, 2011-05-17 at 17:20 +0200, Peter Warasin wrote:
> Hello again
> 
> Following scenario:
> 
> usetap is enabled, also uamanyip and uamnatanyip
> The hotspot tap device joined a bridge.
> 
> ARP requests asking for a clients ip answer with the original ip instead
> of the NATed one.
> 
> The following patch replaces also the target ip address with the nated
> one instead of leaving the original (himip), which is not visible on the
> tap side of chilli.
> 
> Fix is against 1.2.6
> 
> 
> kind regards.,
> peter
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From david at coova.com  Wed May 18 08:25:59 2011
From: david at coova.com (David Bird)
Date: Wed, 18 May 2011 10:25:59 +0200
Subject: [Chilli] [PATCH] do not set bucket*size to BUCKET_SIZE_MIN if
 bandwithmax* is disabled
In-Reply-To: <4DD2903E.8080803@endian.com>
References: <4DD2903E.8080803@endian.com>
Message-ID: <1305707159.5281.66.camel@david-laptop>

But, there is:
    if (!conn->s_state.bucketupsize) {
      leaky_bucket_init(conn);
    } 
which if we allow bucketupsize to remain zero will keep being called. 


On Tue, 2011-05-17 at 17:11 +0200, Peter Warasin wrote:
> Hi guys
> 
> The attached patch fixes a bug which sets bucketupsize to
> BUCKET_SIZE_MIN also when it is disabled (0) in radius but the
> downstream bandwidth is set to some value.. or the other way around.
> 
> Fix is against 1.2.6
> 
> kind regards,
> peter
> 
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli



From derekchilli at hssl.ie  Wed May 18 09:10:45 2011
From: derekchilli at hssl.ie (Derek C)
Date: Wed, 18 May 2011 10:10:45 +0100 (IST)
Subject: [Chilli] coova chilli and dnsmasq on same box
In-Reply-To: <974771.82312.qm@web161407.mail.bf1.yahoo.com>
References: <59818.149.5.32.254.1305703632.squirrel@www.rivertowermail.com>
	<974771.82312.qm@web161407.mail.bf1.yahoo.com>
Message-ID: <50020.149.5.32.254.1305709845.squirrel@www.rivertowermail.com>

Hi Ming-Ching,

In dnsmasq.conf I either 1) *disabled* listening on the ath2 interface
(with the "bind-interfaces" and "except-interface" options or 2) *only*
made dnsmasq listen on the lo (127.0.0.1) interface with "bind-interfaces"
and "interface" options.  I found that if dnsmasq was listening on ath2,
even if the dhcp port was say 6700, chilli would give an error (I don't
know why).

If I have dnsmasq listening on lo (127.0.0.1) and in chilli I set the
dhcpgateway to be 127.0.0.1, dhcpgatewayport to be 67 and dhcprelayagent
to be my internal IP (I'm using 192.168.1.1 but I could use 192.168.182.1
etc) then when I connect with a notebook it looks good (dnsmasq tries to
serve an IP which can only mean that coova chilli is relaying I guess) but
the IP never actually makes it to the device

Example /var/log/messages output with the configuration above (a little
cropped off at the end because I'm on a serial cable to the box) - you can
see that it just keeps cycling over and over again:

May 18 02:37:01 OpenWrt dnsmasq-dhcp[1160]: DHCPDISCOVER(lo)
d8:a2:5e:00:17:58
May 18 02:37:01 OpenWrt dnsmasq-dhcp[1160]: DHCPOFFER(lo) 192.168.1.244
d8:a2:5e
May 18 02:37:56 OpenWrt dnsmasq-dhcp[1160]: DHCPDISCOVER(lo)
d8:a2:5e:00:17:58
May 18 02:37:56 OpenWrt dnsmasq-dhcp[1160]: DHCPOFFER(lo) 192.168.1.244
d8:a2:5e
May 18 02:38:51 OpenWrt dnsmasq-dhcp[1160]: DHCPDISCOVER(lo)
d8:a2:5e:00:17:58
May 18 02:38:51 OpenWrt dnsmasq-dhcp[1160]: DHCPOFFER(lo) 192.168.1.244
d8:a2:5e
May 18 02:39:46 OpenWrt dnsmasq-dhcp[1160]: DHCPDISCOVER(lo)
d8:a2:5e:00:17:58
May 18 02:39:46 OpenWrt dnsmasq-dhcp[1160]: DHCPOFFER(lo) 192.168.1.244
d8:a2:5e
May 18 02:39:46 OpenWrt dnsmasq-dhcp[1160]: DHCPDISCOVER(lo)
d8:a2:5e:00:17:58
May 18 02:39:46 OpenWrt dnsmasq-dhcp[1160]: DHCPOFFER(lo) 192.168.1.244
d8:a2:5e




On Wed, May 18, 2011 8:35 am, Ming-Ching Tiew wrote:
>

> I think dnsmasq has to listen to tun0 interface in order
> for it to serve the users. What is the dnsmasq -i parameter you used ?
>
> --- On Wed, 5/18/11, Derek C <derekchilli at hssl.ie> wrote:
>
>
>> From: Derek C <derekchilli at hssl.ie>
>> Subject: [Chilli] coova chilli and dnsmasq on same box
>> To: chilli at coova.org
>> Date: Wednesday, May 18, 2011, 7:27 AM
>> Hi all,
>>
>>
>> Is it possible to run dnsmasq and coova chilli (with
>> dhcp-relaying) on the same physical box?? I'm seeing that messages from
>> dnsmasq (on 127.0.0.1) don't seem to be getting back to coova chilli - I
>> don't see this issue when dnsmasq is running on a physically different
>> computer so I wonder is it something to do with local routing and
>> multicast UDP packets?
>>
>> Derek
>>
>>
>>
>> --
>> Derek C
>> In Ireland
>>
>>
>> _______________________________________________
>> Chilli mailing list
>> Chilli at coova.org
>> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>>
>>
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>


-- 
Derek C
In Ireland


From mctiew at yahoo.com  Wed May 18 10:33:11 2011
From: mctiew at yahoo.com (Ming-Ching Tiew)
Date: Wed, 18 May 2011 03:33:11 -0700 (PDT)
Subject: [Chilli] coova chilli and dnsmasq on same box
In-Reply-To: <50020.149.5.32.254.1305709845.squirrel@www.rivertowermail.com>
Message-ID: <468548.33713.qm@web161408.mail.bf1.yahoo.com>


My previous testing revealed that have to make dnsmasq listen 
to tun0 interface.

The problem is, if dnsmasq is started first, chilli is started 
later, then tun0 does not exist yet - dnsmasq will fail. 

So it seems right to run it from up.sh, by then tun0 is created already. But care must be taken not to start more than one 
instance, if you start-stop chilli multiple times.






From derekchilli at hssl.ie  Wed May 18 11:17:15 2011
From: derekchilli at hssl.ie (Derek C)
Date: Wed, 18 May 2011 12:17:15 +0100 (IST)
Subject: [Chilli] coova chilli and dnsmasq on same box
In-Reply-To: <468548.33713.qm@web161408.mail.bf1.yahoo.com>
References: <50020.149.5.32.254.1305709845.squirrel@www.rivertowermail.com>
	<468548.33713.qm@web161408.mail.bf1.yahoo.com>
Message-ID: <37436.149.5.32.254.1305717435.squirrel@www.rivertowermail.com>

Hi Ming-Ching,

Are you using the dhcprelay features of Coova Chilli at all?  It sounds
like you are using dnsmasq in parallel to Coova Chilli in the way you are
having dnsmasq listening on tun0.  You you use the dhcpgateway,
dhcpgatewayport and dhcprelayagent directives in chilli.conf ?

Good to talk with someone doing this though!

thanks,

Derek

On Wed, May 18, 2011 11:33 am, Ming-Ching Tiew wrote:
>

> My previous testing revealed that have to make dnsmasq listen
> to tun0 interface.
>
> The problem is, if dnsmasq is started first, chilli is started
> later, then tun0 does not exist yet - dnsmasq will fail.
>
> So it seems right to run it from up.sh, by then tun0 is created already.
> But care must be taken not to start more than one
> instance, if you start-stop chilli multiple times.
>
>
>
>
>
> _______________________________________________
> Chilli mailing list
> Chilli at coova.org
> http://lists.coova.org/cgi-bin/mailman/listinfo/chilli
>
>


-- 
Derek C
In Ireland


From cesarsilvaaraujo at gmail.com  Wed May 18 15:55:55 2011
From: cesarsilvaaraujo at gmail.com (=?UTF-8?Q?C=C3=A9sar_Araujo?=)
Date: Wed, 18 May 2011 15:55:55 +0000 (UTC)
Subject: [Chilli] Invitation to connect on LinkedIn
Message-ID: <764034302.19262492.1305734155951.JavaMail.app@ela4-bed77.prod>

LinkedIn
------------

   
I'd like to add you to my professional network on LinkedIn.

- C?sar

C?sar Araujo
Software Developer at ISEP 
Porto Area, Portugal

Confirm that you know C?sar Araujo
https://www.linkedin.com/e/-yshftj-gnugeist-p/isd/2923306834/YxPEa5kW/


 
-- 
(c) 2011, LinkedIn Corporation
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110518/842bcbbc/attachment.html>

From stelio at skyrove.com  Mon May 30 15:22:46 2011
From: stelio at skyrove.com (Stelio Gouveia)
Date: Mon, 30 May 2011 17:22:46 +0200
Subject: [Chilli] Facebook in Walled Garden
Message-ID: <BANLkTi=oAyirbfD=mO04VVU7m0EwDvqXAA@mail.gmail.com>

Hi All

Anyone have any experience with this? I'm having some strange behavior where
i'm granted pass through access most of the time but sometimes some
resources (images, css files, access to facebook connect) on the facebook
servers aren't always allowed.

I suspect this has something to do with the facebook content distribution
network.

As mentioned, this is a intermittent problem which makes reproducing the
issue very difficult.

Any thoughts on how to troubleshoot?

My uamdomain entries:
uamdomain facebook.com
uamdomain facebook.net
uamdomain fbcdn.net

For lack of response from the Coova linkedin group i've posted the same
question to this mailing list.

-- 
Regards
Stelio Gouveia
--
Skyrove Software Engineer,
Skyrove (Pty) Ltd
Technology Top 100 Award Winner (2006)
Mobile: +27 82 34 09 120
Tel: +27 861 ROVERS (0861 768 377)
Fax: +27 86 6204077
Email & Gtalk: stelio at skyrove.com
Web:   www.skyrove.com

This message contains confidential information. If you are not the intended
recipient you are notified that disclosing, copying, distributing or taking
any action in reliance on the contents of this information is strictly
prohibited. E-mail transmission cannot be guaranteed to be secure or
error-free as information could be intercepted, corrupted, lost, destroyed,
arrive late or incomplete, or contain viruses. The sender therefore does not
accept liability for any errors or omissions in the contents of this
message.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://lists.coova.org/pipermail/chilli/attachments/20110530/9f22771a/attachment.html>

From a.szlezak at unwired.at  Mon May 30 19:38:06 2011
From: a.szlezak at unwired.at (Alexander Szlezak)
Date: Mon, 30 May 2011 21:38:06 +0200
Subject: [Chilli] IPv6 Support
Message-ID: <4DE3F21E.8010004@unwired.at>

Dear Developers,

Thanks for the great work in the Coova Project so far. I have a few 
questions concerning a new project:

a) Does Coova Chili currently support clients connecting via ipv6 (for 
captive portal)?

b) is it possible to have a central coova chili instance and have the 
access points bridged to this server via openvpn and still have 
individual accounting as well as knowledge about which ap the client 
comes from in Coova Chili (e.g. for personalized Splash Pages) - 
Identifier would be the mac of the access points)?

c) which (sourceforge) project for managing client and server data in 
the radius database do you recommend?

thank you for you help,
Alexander
-- 
Follow me on Twitter @ http://twitter.com/magicshark
__________________________________________________________________
Mag. Alexander SZLEZAK                            Unwired Networks
Inhaber
Tel.: +43 699 13504101                           Reischergasse 6/2
Fax.: +43 720 345179                        A-1130 Vienna, Austria

