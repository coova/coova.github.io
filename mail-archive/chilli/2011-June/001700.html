<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Chilli] [PATCH] fix casts which turn out invalid under armv5tel
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20%5BPATCH%5D%20fix%20casts%20which%20turn%20out%20invalid%20under%20armv5tel&In-Reply-To=%3C4E00712F.6080107%40endian.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001698.html">
   <LINK REL="Next"  HREF="001701.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Chilli] [PATCH] fix casts which turn out invalid under armv5tel</H1>
    <B>Peter Warasin</B> 
    <A HREF="mailto:chilli%40coova.org?Subject=Re%3A%20%5BChilli%5D%20%5BPATCH%5D%20fix%20casts%20which%20turn%20out%20invalid%20under%20armv5tel&In-Reply-To=%3C4E00712F.6080107%40endian.com%3E"
       TITLE="[Chilli] [PATCH] fix casts which turn out invalid under armv5tel">peter at endian.com
       </A><BR>
    <I>Tue Jun 21 10:23:43 UTC 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="001698.html">[Chilli] cast issue with packed structs under arm
</A></li>
        <LI>Next message: <A HREF="001701.html">[Chilli] [PATCH] fix casts which turn out invalid under armv5tel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1700">[ date ]</a>
              <a href="thread.html#1700">[ thread ]</a>
              <a href="subject.html#1700">[ subject ]</a>
              <a href="author.html#1700">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi list

With coova-chilli 1.2.6 compiled for armv5tel
(run on marvell kirkwood Feroceon 88FR131)
due to casting of type-punned variables to/from packed structs we get
wrong values after the cast because the cast reads out wrong memory
areas due to missing padding.
Note, this happens only on arm due to its particular nature and
necessity to have all structs aligned. With x86 this does not happen.

The attached patch fixes right now:
- value of static ip supplied by radius is read correctly
- chilli_query listip passes now correct value for ip address
- chilli_query logout ip passes now correct value for ip address

I fear this happens on more places than these which actually happened to
me and were the most obvious ones.
I think every cast from/to packed struct needs to be handled this way.

What do you think?

peter

-- 
::<i> e n d i a n
</I>::<i> open source - open minds
</I>
::<i> peter warasin
</I>::<i> <A HREF="http://www.endian.com">http://www.endian.com</A>   :: <A HREF="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">peter at endian.com</A>
</I>-------------- next part --------------
A non-text attachment was scrubbed...
Name: coova-chilli-1.2.6-fix-invalid-cast-on-arm.patch
Type: text/x-patch
Size: 3225 bytes
Desc: not available
URL: &lt;<A HREF="http://lists.coova.org/pipermail/chilli/attachments/20110621/5638d788/attachment.bin">http://lists.coova.org/pipermail/chilli/attachments/20110621/5638d788/attachment.bin</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001698.html">[Chilli] cast issue with packed structs under arm
</A></li>
	<LI>Next message: <A HREF="001701.html">[Chilli] [PATCH] fix casts which turn out invalid under armv5tel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1700">[ date ]</a>
              <a href="thread.html#1700">[ thread ]</a>
              <a href="subject.html#1700">[ subject ]</a>
              <a href="author.html#1700">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://lists.coova.org/cgi-bin/mailman/listinfo/chilli">More information about the Chilli
mailing list</a><br>
</body></html>
